(function(){define("modules/clean/account_photo_modal/account_header",["jquery","require"],function(e,t){var r;return r=function(){function r(){}return r.init=function(r,s,o){return e(r).add(s).on("click",function(e){return e.preventDefault(),t(["modules/clean/account_photo_modal/controller"],function(e){return e.show()})}),e(document).on("db:account_photo:photo_set",function(t){return e(s).addClass(o)}),e(document).on("db:account_photo:photo_deleted",function(t){return e(s).removeClass(o)})},r.initialize_module=function(e){return r.init(e.open_modal_button_selector,e.add_photo_link_selector,e.hide_add_photo_link_class)},r}()})}).call(this),function(){define("modules/clean/avatar/inherited_count_avatar",["external/classnames","external/react","modules/clean/react/css"],function(e,t,r){var s,o;return o=t.DOM,s=t.createClass({displayName:"InheritedMemberCountAvatar",propTypes:{inheritedMemberCount:t.PropTypes.number.isRequired,onClick:t.PropTypes.func},render:function(){var t;return t=e({"inherited-count-avatar u-pad-horizontal-xxs":!0}),null!=this.props.onClick?o.button({className:t,onClick:this.props.onClick},this.props.inheritedMemberCount):o.div({className:t},this.props.inheritedMemberCount)}}),s=r(s,["/static/css/avatar_list-vflo6SmYO.css","/static/css/scooter/scooter-scoped-vflx8uhBs.css"])})}.call(this),function(){define("modules/clean/avatar/list",["external/classnames","external/react","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/overflow_count_pill","modules/clean/avatar/size","modules/clean/react/css"],function(e,t,r,s,o,n){var i,a,l,u;return a=o.VALID_AVATAR_DIMENSIONS,l=t.createElement,u=t.DOM,i=t.createClass({displayName:"HorizontalAvatarList",propTypes:{avatars:t.PropTypes.array.isRequired,avatarDimension:t.PropTypes.oneOf(a).isRequired,maxVisible:t.PropTypes.number.isRequired,undisplayableCount:t.PropTypes.number.isRequired,onOverflowCountClick:t.PropTypes.func,overflowCountRenderer:t.PropTypes.func,animation:t.PropTypes.bool,inheritedCountAvatar:t.PropTypes.node,className:t.PropTypes.string,isInAudienceBox:t.PropTypes.bool,reverseAvatars:t.PropTypes.bool},getDefaultProps:function(){return{className:"",inheritedCountAvatar:null}},_defaultRenderOverflowCount:function(e){return l(s,{count:e,dimension:this.props.avatarDimension,key:"overflow_pill:"+e,onClick:this.props.onOverflowCountClick})},render:function(){var t,r,s,o,n;return t=this.props.avatars,r=this.props.maxVisible,s=0,this.props.undisplayableCount&&(s+=this.props.undisplayableCount),(this.props.undisplayableCount||t.length>r)&&(r--,s+=t.length-r,t=t.slice(0,r)),s&&(n=null!=(o=this.props.overflowCountRenderer)?o:this._defaultRenderOverflowCount,t.push(n(s))),this.props.reverseAvatars&&t.reverse(),u.div({className:e({"c-facepile":!0,"audience-box-padding":this.props.isInAudienceBox})},[this.props.inheritedCountAvatar?u.div({className:"u-l-ib u-mar-right-xxs",key:"inherited_count"},this.props.inheritedCountAvatar):void 0,u.div({className:this.getClassName(),key:"facepile"},t)])},getClassName:function(){return e(["horizontal-avatar-list",this.props.className,this.props.animation?["animation","is-animated"]:null])}}),i=n(i,["/static/css/avatar_list-vflo6SmYO.css"])})}.call(this),function(){define("modules/clean/avatar/overflow_count_pill",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/core/i18n"],function(e,t,r,s,o){var n,i,a,l,u;return i=t.VALID_AVATAR_DIMENSIONS,l=r.getClassName,u=o.ungettext,a=e.DOM,n=e.createClass({displayName:"OverflowCountPill",propTypes:{dimension:e.PropTypes.oneOf(i).isRequired,count:e.PropTypes.number.isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return s.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},render:function(){var e,t;return t=" +"+this.props.count+" ",e=u("%(count)s more member","%(count)s more members",this.props.count).format({count:this.props.count}),null!=this.props.onClick?a.button({className:l(this.props.dimension,["overflow-pill c-avatar--meta u-unbutton"]),onClick:this.props.onClick},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e)):a.div({className:l(this.props.dimension,["overflow-pill c-avatar--meta"])},a.span({"aria-hidden":!0},t),a.span({className:"ax-visually-hidden"},e))}})})}.call(this),function(){define("modules/clean/avatar/shared_link_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/static_urls","modules/core/i18n"],function(e,t,r,s,o,n){var i,a,l,u,c,p;return a=t.VALID_AVATAR_DIMENSIONS,c=r.getClassName,p=o.static_url,l=n._,u=e.DOM,i=e.createClass({displayName:"SharedLinkAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,onClick:e.PropTypes.func},componentDidMount:function(){return s.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},render:function(){var e,t;return t=u.img({src:p("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||l("Shared link"),width:12}),null!=this.props.onClick?(e=c(this.props.dimension,["c-avatar--meta u-unbutton"]),u.button({className:e,onClick:this.props.onClick},t)):(e=c(this.props.dimension,["c-avatar--meta"]),u.div({className:e,onClick:this.props.onClick},t))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function s(){this.constructor=e}for(var o in t)r.call(t,o)&&(e[o]=t[o]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},r={}.hasOwnProperty;define("modules/clean/components/bubble_menu",["jquery","modules/clean/keycode","modules/clean/components/bubble_dropdown"],function(r,s,o){var n;return n=function(o){function n(t,r,s,o){this.$root=t,this.arrow_direction=r,this.show_on_hover=s,this.top_adjustment=null!=o?o:0,this.onKeyDown=e(this.onKeyDown,this),this.onMouseEnter=e(this.onMouseEnter,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$target.on("keydown",this.onKeyDown),this.$menu=this.$root.find('*[role="menu"]'),this.$menuitems=this.$root.find('*[role="menuitem"]'),this.$menuitems.attr("role","menuitem"),this.$menuitems.on("keydown",this.onKeyDown),this.$menuitems.on("mouseenter",this.onMouseEnter),n.__super__.constructor.apply(this,arguments)}return t(n,o),n.prototype.focusPrevious=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},n.prototype.focusNext=function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},n.prototype.onMouseEnter=function(e){return r(this.$menu).removeClass("bubble-menu--keyboard")},n.prototype.onKeyDown=function(e){return r(this.$menu).addClass("bubble-menu--keyboard"),e.keyCode===s.DOWN?(this.focusNext(e.target),e.stopPropagation(),e.preventDefault()):e.keyCode===s.UP?(this.focusPrevious(e.target),e.stopPropagation(),e.preventDefault()):void 0},n}(o)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function s(){this.constructor=e}for(var o in t)r.call(t,o)&&(e[o]=t[o]);return s.prototype=t.prototype,e.prototype=new s,e.__super__=t.prototype,e},r={}.hasOwnProperty;define("modules/clean/components/form",["jquery","modules/core/cookies","modules/constants/request"],function(r,s,o){var n,i;return n=function(){function t(t,s){this.submit=e(this.submit,this),this.form=r("#"+t),this.form.on("submit",this.submit),this.csrfTokenInputName=s}return t.prototype.submit=function(e){var t;return t=s.read(o.JS_CSRF_COOKIE),t?this.form.find("input[name='"+this.csrfTokenInputName+"']").val(t):void 0},t}(),i=function(r){function s(t,r){this.submit=e(this.submit,this),s.__super__.constructor.call(this,t),this.submitted=!1}return t(s,r),s.prototype.submit=function(e){return s.__super__.submit.call(this,e),this.submitted?(e.preventDefault(),!1):(this.submitted=!0,this.form.addClass("submitted"),setTimeout(function(e){return function(){return e.submitted=!1,e.form.removeClass("submitted")}}(this),2e3))},s}(n),{Form:n,SubmitOnceForm:i}})}.call(this),function(){define("modules/clean/components/loading_indicator",["external/classnames","external/underscore","external/react","modules/core/accessible_announce","modules/core/i18n"],function(e,t,r,s,o){var n,i,a,l;return a=o._,l=r.DOM,i={DOTS:"dots",SPINNER:"spinner",BLUE_SPINNER:"blue_spinner"},n=r.createClass({displayName:"LoadingIndicator",statics:{LoadingIndicatorStyle:i},propTypes:{style:r.PropTypes.oneOf(t.values(i)),className:r.PropTypes.string,startMessage:r.PropTypes.string,finishMessage:r.PropTypes.string,shouldAnnounceMessage:r.PropTypes.bool},getDefaultProps:function(){return{style:i.DOTS,className:"",startMessage:a("Loading…"),finishMessage:null,shouldAnnounceMessage:!0}},componentDidMount:function(){return this.props.shouldAnnounceMessage?s.polite(this.props.startMessage):void 0},componentWillUnmount:function(){return this.props.finishMessage&&this.props.shouldAnnounceMessage?s.polite(this.props.finishMessage):void 0},render:function(){var r;return r={},this.props.className&&(r=t.object(this.props.className.split(" ").map(function(e){return[e,!0]}))),r=t.extend(r,{"c-loader":!0,"c-loader--spinner":this.props.style===i.SPINNER,"c-loader--spinner--blue":this.props.style===i.BLUE_SPINNER}),l.div({className:e(r)},this.props.startMessage)}})})}.call(this),function(){define("modules/clean/components/title_bubble",["jquery","external/classnames","external/react","external/react-dom","modules/clean/react/css"],function(e,t,r,s,o){var n,i;return i=r.DOM,n=r.createClass({displayName:"TitleBubble",propTypes:{text:r.PropTypes.string.isRequired,direction:r.PropTypes.oneOf(["north","south","east","west"]).isRequired,onMouseEnter:r.PropTypes.func,respectLineBreaks:r.PropTypes.bool,className:r.PropTypes.string},getInitialState:function(){return{isChildFocused:!1}},componentDidMount:function(){return e(s.findDOMNode(this)).on("focusin.title-bubble",function(e){return function(t){return e.setState({isChildFocused:!0})}}(this)).on("focusout.title-bubble",function(e){return function(t){return e.setState({isChildFocused:!1})}}(this)).on("mouseenter.title-bubble",function(e){return function(){var t;return"function"==typeof(t=e.props).onMouseEnter?t.onMouseEnter():void 0}}(this))},componentWillUnmount:function(){return e(s.findDOMNode(this)).off("focusin.title-bubble").off("focusout.title-bubble").off("mouseenter.title-bubble")},render:function(){var e;return e={"c-title-bubble":!0,"is-child-focused":this.state.isChildFocused,"c-title-bubble--respect-line-break":this.props.respectLineBreaks},e["c-title-bubble--"+this.props.direction.slice(0,1)]=!0,i.div({className:t([e,this.props.className]),"data-title":this.props.text,onClick:function(e){return function(t){return t.detail>0?e.setState({isChildFocused:!1}):void 0}}(this)},this.props.children)}}),n=o(n,["/static/css/scooter/scooter-scoped-vflx8uhBs.css"])})}.call(this),function(){define("modules/clean/dropbox_nav",["jquery","modules/clean/analytics","modules/clean/photos/photos_engagement_logger"],function(e,t,r){var s;return s=function(){function s(){e(".carousel-nav-item").click(function(e){return function(){return e.log_click("carousel_nav_link_click")}}(this)),e(".composer-nav-item").click(function(e){return function(){return e.log_click("composer_nav_link_click")}}(this)),e(".mailbox-nav-item").click(function(e){return function(){return e.log_click("mailbox_nav_link_click")}}(this)),e(".carousel-nav-item").click(function(){return r.log_and_send(r.CAROUSEL_NAV_LINK_CLICK)}),e(".photos-nav-item").click(function(){return r.log_and_send(r.PHOTOS_NAV_LINK_CLICK)})}return s.prototype.log_click=function(e){return t.WebMiscActivityLogger.log(e)},s}()})}.call(this),function(){"use strict";var e=[].slice;define("modules/clean/flux/store_mixin",[],function(){var t;return t=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],{getInitialState:function(){return this._get_state_from_stores(this.props)},componentDidMount:function(){var e,r,s;for(e=0,r=t.length;r>e;e++)s=t[e],s.add_change_listener(this._handle_store_changed);return this.setState(this._get_state_from_stores(this.props))},componentWillUnmount:function(){var e,r,s,o;for(s=[],e=0,r=t.length;r>e;e++)o=t[e],s.push(o.remove_change_listener(this._handle_store_changed));return s},_handle_store_changed:function(){var e;return this.isMounted()&&(e=this._get_state_from_stores(this.props),null!=e)?this.setState(e):void 0}}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/growth/admin_console_ad",["jquery","modules/clean/analytics","modules/clean/dbmodal","modules/core/browser"],function(t,r,s,o){var n;return n=function(){function n(r,o,n){this.cta_selector=n,this._handleLinkClick=e(this._handleLinkClick,this),this.modal=new s.DBModal({element_id:o}),t(r).click(this._handleLinkClick)}return n.prototype._handleLinkClick=function(e){return e.preventDefault(),r.TeamsWebActionsLogger.log("click_admin_console_ad"),this.modal.show(),t(this.cta_selector).off(),t(this.cta_selector).click(this._handleCTAClick)},n.prototype._handleCTAClick=function(e){var s;return e.preventDefault(),s=t(e.target).attr("href"),r.TeamsWebActionsLogger.log("click_admin_console_ad_cta",{},function(){return o.redirect(s)})},n}()})}.call(this),function(){define("modules/clean/payments/pro_trial_onboarding_tour",["jquery","modules/clean/react/pro/pro_onboarding_tour_modal"],function(e,t){var r,s;return r=t.ProOnboardingTourModal,s=function(){function e(e,t,s,o,n){this.$container=e,this.modal_autoshow=t,this.modal_id=s,this.modal_paths=o,this.modal_content=n,this.tourProps={modalId:this.modal_id,onboardingPaths:this.modal_paths,contentSource:this.modal_content},this.modal_autoshow&&r.renderWithProps(this.tourProps),this._listen()}return e.prototype._listen=function(){return this.$container.find(".start-tour").on("click",function(e){return function(t){return t.preventDefault(),r.renderWithProps(e.tourProps)}}(this))},e}(),{ProTrialOnboardingTourHeaderLink:s}})}.call(this),function(){define("modules/clean/photos/photos_engagement_logger",["jquery","modules/clean/ajax"],function(e,t){var r;return r=function(){function r(){}return r.Platform={WEB:"web",WEB_CAROUSEL:"web_carousel"},r.CAROUSEL_NAV_LINK_CLICK="carousel_nav_link_click",r.PHOTOS_NAV_LINK_CLICK="photos_nav_link_click",r.WEBAPP_VIEW_TIMELINE="webapp_view_gallery",r.WEBAPP_VIEW_ALBUMS_GRID="webapp_view_albums_grid",r.WEBAPP_VIEW_ALBUM="webapp_view_albums",r.WEBAPP_ACTION_ADD_TO_ALBUM="webapp_action_add_to_album",r.WEBAPP_ACTION_REMOVE_FROM_ALBUM="webapp_action_remove_from_album",r.WEBAPP_ACTION_DOWNLOAD="webapp_action_download",r.WEBAPP_ACTION_SHOW_IN_FOLDER="webapp_action_show_in_folder",r.WEBAPP_ACTION_DELETE="webapp_action_delete",r.WEBAPP_SHOW_EXCLUDE_MODAL="webapp_show_exclude_modal",r.ATTEMPT_EXCLUDE_CU_FOLDER="attempt_exclude_cu_folder",r.ATTEMPT_EXCLUDE_DROPBOX_ROOT="attempt_exclude_dropbox_root",r.WEBAPP_GALLERY_SELECT_EVENT="webapp_gallery_select_event",r.WEBAPP_GALLERY_DESELECT_EVENT="webapp_gallery_deselect_event",r.WEBAPP_GALLERY_SELECT_ITEM="webapp_gallery_select_item",r.WEBAPP_GALLERY_DESELECT_ITEM="webapp_gallery_deselect_item",r.WEBAPP_GALLERY_TIME_FIRST_ITEM="webapp_gallery_time_first_item",r.WEBAPP_GALLERY_TIME_EVENTS_OUTLINE="webapp_gallery_time_events_outline",r.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_EVENTS="webapp_gallery_time_first_visible_events",r.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_THUMBS_BATCH="webapp_gallery_time_first_visible_thumbs_batch",r.WEBAPP_GALLERY_EMPTY="webapp_gallery_empty",r.WEBAPP_GALLERY_CONTEXT_MENU_SHOWN="webapp_gallery_context_menu_shown",r.WEBAPP_LIGHTBOX_OPEN="webapp_lightbox_open",r.WEBAPP_LIGHTBOX_DOWNLOAD="webapp_lightbox_download",r.WEBAPP_LIGHTBOX_SELECT_ITEM="webapp_lightbox_select_item",r.WEBAPP_LIGHTBOX_DESELECT_ITEM="webapp_lightbox_deselect_item",r.WEBAPP_LIGHTBOX_FORWARD="webapp_lightbox_forward",r.WEBAPP_LIGHTBOX_BACK="webapp_lightbox_back",r.WEBAPP_LIGHTBOX_SHARE="webapp_lightbox_share",r.WEBAPP_LIGHTBOX_CLOSE_ICON="webapp_lightbox_close_icon",r.WEBAPP_LIGHTBOX_CLOSE_KEY="webapp_lightbox_close_key",r.WEBAPP_TIMELINE_NAVIGATION_SHOWN="webapp_timeline_navigation_shown",r.WEBAPP_TIMELINE_NAVIGATION_TRACK_CLICKED="webapp_timeline_navigation_track_clicked",r.WEBAPP_TIMELINE_NAVIGATION_SCRUBBER_DRAGGED="webapp_timeline_navigation_scrubber_dragged",r.WEBAPP_SHARE_CART_CANCEL="webapp_share_cart_cancel",r.WEBAPP_SHARE_CART_SHARE="webapp_share_cart_share",r.WEBAPP_SHARE_CART_SHARE_FACEBOOK="webapp_share_cart_share_facebook",r.WEBAPP_SHARE_CART_SHARE_TWITTER="webapp_share_cart_share_twitter",r.WEBAPP_SHARE_CART_ITEM_CLICKED="webapp_share_cart_item_clicked",r.WEBAPP_SHARE_DROPDOWN_SEND_LINK="webapp_share_dropdown_send_link",r.WEBAPP_SHARE_DROPDOWN_SHARED_ALBUM="webapp_share_dropdown_shared_album",r.WEBAPP_OPEN_SHARE_MODAL="webapp_open_share_modal",r.WEBAPP_GALLERY_DELETE_MODAL_CONFIRMED="webapp_gallery_delete_modal_confirmed",r.WEBAPP_GALLERY_DELETE_MODAL_CANCELED="webapp_gallery_delete_modal_canceled",r.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CONFIRMED="webapp_gallery_remove_from_album_modal_confirmed",r.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CANCELED="webapp_gallery_remove_from_album_modal_canceled",r.WEBAPP_SHARE_COMPOSER_LINK="webapp_share_composer_link",r.first_log_sent=!1,r.logs_queued=[],r.HACK_prefix_to_replace=null,r.HACK_prefix_replace_with=null,r.HACK_new_platform=null,r.HACK_extra={},r.hack_all_log_prefixes_and_platform=function(e){var t,s,o,n;return n=e.prefix_to_replace,o=e.prefix_replace_with,s=e.new_platform,t=e.extra,r.HACK_prefix_to_replace=n,r.HACK_prefix_replace_with=o,r.HACK_new_platform=s,r.HACK_extra=t},r.apply_hacky_log_overrides=function(t,s,o){var n,i;return r.HACK_prefix_to_replace?(i=0===t.indexOf(r.HACK_prefix_to_replace)?t.replace(r.HACK_prefix_to_replace,r.HACK_prefix_replace_with):0!==t.indexOf(r.HACK_prefix_replace_with)?r.HACK_prefix_replace_with+t:t,n=e.extend({},o,this.HACK_extra),[i,r.HACK_new_platform,n]):[t,s,o]},r.log_and_send=function(e,s,o){var n;return null==s&&(s={}),null==o&&(o=r.Platform.WEB),n=r.apply_hacky_log_overrides(e,o,s),e=n[0],o=n[1],s=n[2],t.SilentBackgroundRequest({url:"/photos/photos_engagement_log",data:{event:e,extra:JSON.stringify(s),platform:o}})},r.log=function(e,t,s){var o,n;return this._init(),r.first_log_sent?(null==t&&(t={}),null==s&&(s=r.Platform.WEB),n=r.apply_hacky_log_overrides(e,s,t),e=n[0],s=n[1],t=n[2],o={event:e,extra:t,platform:s},r.logs_queued.push(o)):(r.log_and_send(e,t,s),void(r.first_log_sent=!0))},r.log_carousel=function(e,t){return r.log(e,t,r.Platform.WEB_CAROUSEL)},r._send_log_batch=function(){return r.logs_queued.length?(t.SilentBackgroundRequest({url:"/photos/photos_engagement_batch_log",data:{events:JSON.stringify(r.logs_queued)}}),r.logs_queued=[]):void 0},r._init=function(){return this._initialized?void 0:(this._initialized=!0,setInterval(r._send_log_batch,1e4),e(window).unload(r._send_log_batch))},r}()})}.call(this),function(){define("modules/clean/raf",function(){var e,t,r,s,o,n,i;for(t=window.requestAnimationFrame,e=window.cancelAnimationFrame,n=["ms","moz","webkit","o"],r=0,o=n.length;o>r&&(i=n[r],!t);r++)t=window[i+"RequestAnimationFrame"],e=window[i+"CancelAnimationFrame"]||window[i+"CancelRequestAnimationFrame"];return t||(s=0,t=function(e,t){var r,o,n,i;return r=(new Date).getTime(),i=Math.max(0,16-(r-s)),o=function(){return e(r+i)},n=setTimeout(o,i),s=r+i,n}),e||(e=function(e){return clearTimeout(e)}),{requestAnimationFrame:t.bind(window),cancelAnimationFrame:e.bind(window)}})}.call(this),function(){define("modules/clean/react/app_actions_view",["external/react","modules/clean/react/css","modules/clean/react/prompt/react_ha","modules/clean/react/sprite_div","modules/clean/react/maestro_feedback","modules/constants/maestro_feedback"],function(e,t,r,s,o,n){var i,a,l,u;return u=e.DOM,a=e.PropTypes.shape({displayName:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func}),l=e.PropTypes.shape({displayName:e.PropTypes.string.isRequired,handleClick:e.PropTypes.func,iconName:e.PropTypes.string.isRequired}),i=e.createClass({displayName:"AppActionsView",propTypes:{headerText:e.PropTypes.string,primaryMenuItem:a.isRequired,primarySubnode:e.PropTypes.node,secondaryMenuItems:e.PropTypes.arrayOf(l)},getDefaultProps:function(){return{headerText:"",secondaryMenuItems:[]}},_renderMenuItemIcon:function(t){return e.createElement(s,{ref:"icon",alt:"",group:"web",name:t.iconName})},render:function(){var t,s;return t=u.div({className:"primary-action-menu"},u.span({className:"primary-action-menu__header-text"},this.props.headerText),u.button({className:"primary-action-menu__button button-primary",onClick:this.props.primaryMenuItem.handleClick},this.props.primaryMenuItem.displayName)),s=this.props.secondaryMenuItems.map(function(e){return function(t){var r,s;return s=e._renderMenuItemIcon(t),r=u.button({className:"secondary-action-menu__button",onClick:t.handleClick},s,u.span({className:"secondary-action-menu__button-text"},t.displayName)),u.li({className:"secondary-action-menu__item"},r)}}(this)),u.div({className:"appactions-menu"},t,this.props.primarySubnode,u.ul({className:"secondary-action-menu"},s),e.createElement(r),n.MAESTRO_FEEEDBACK_FORM?e.createElement(o):void 0)}}),t(i,["/static/css/dropbox/app_actions-vflTHreXr.css"])})}.call(this),function(){define("modules/clean/react/browse/action_logger",["modules/clean/web_user_action_logger","modules/clean/react/browse/store"],function(e,t){var r,s,o,n,i;return n=e.WebUserActionLog,i=e.WebUserActionLogEvents,o=t.BrowseStore,r={MAESTRO_RIGHT_SIDEBAR:"MAESTRO_RIGHT_SIDEBAR",LEGACY_CONTEXT_MENU:"LEGACY_CONTEXT_MENU",LEGACY_HEADER_ACTIONS:"LEGACY_HEADER_ACTIONS",DRAG:"DRAG"},s=function(){function e(){}return e.prototype._countFilesAndFolders=function(){var e,t,r;return r=o.selectedFiles().toArray(),e=r.filter(function(e){return e.is_dir}).length,t=r.filter(function(e){return!e.is_dir}).length,{num_files:t,num_dirs:e}},e.prototype._logGeneralAction=function(e,t,r,s,o){var i,a,l;return l=this._countFilesAndFolders(),a=l.num_files,i=l.num_dirs,n.log(e,o,{num_files_selected:a,num_folders_selected:i,source:s})},e.prototype.logSelectRow=function(e){var t,r;return r=e.uid,t=e.entity_type,n.log(r,i.SELECT_ROW,{entity_type:t})},e.prototype.logOpenRow=function(e){var t,r;return r=e.uid,t=e.entity_type,n.log(r,i.OPEN_ROW,{entity_type:t})},e.prototype.logUploadFile=function(e){var t,r,s,o,a;return s=e.uid,r=e.num_files,t=e.num_dirs,a=e.uploader_type,o=e.upload_method,n.log(s,i.UPLOAD_FILE,{num_files:r,num_dirs:t,uploader_type:a,upload_method:o})},e.prototype.logCreateFolder=function(e){var t;return t=e.uid,n.log(t,i.CREATE_FOLDER,{})},e.prototype.logViewShareModel=function(e){var t,r;return r=e.uid,t=e.modal_session_id,n.log(r,i.VIEW_SHARE_MODEL,{modal_session_id:t})},e.prototype.logToggleDeletedFiles=function(e){var t,r;return r=e.uid,t=e.show_deleted_files,n.log(r,i.TOGGLE_DELETED_FILES,{show_deleted_files:t})},e.prototype.logSortRecords=function(e){var t,r,s;return s=e.uid,t=e.sort_by,r=e.sort_direction,n.log(s,i.SORT_RECORDS,{sort_by:t,sort_direction:r})},e.prototype.logVersions=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.VERSIONS)},e.prototype.logOpenMoveModal=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.OPEN_MOVE_MODAL)},e.prototype.logMoveFiles=function(e){var t,r,s,o,n;return n=e.uid,s=e.path,t=e.files,r=e.newPath,o=e.source,this._logGeneralAction(n,s,t,o,i.MOVE)},e.prototype.logRenameFiles=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.RENAME)},e.prototype.logAddComment=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.ADD_COMMENT)},e.prototype.logDownload=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.DOWNLOAD)},e.prototype.logOpenCopyModal=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.OPEN_COPY_MODAL)},e.prototype.logCopyFiles=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.COPY)},e.prototype.logDeleteFiles=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.DELETE)},e.prototype.logPermanentDeleteFiles=function(e){var t,r,s,o;return o=e.uid,r=e.path,t=e.files,s=e.source,this._logGeneralAction(o,r,t,s,i.PERMANENT_DELETE)},e}(),{BrowseLogger:new s,BrowseLogEventSources:r}})}.call(this),function(){define("modules/clean/react/browse/browse_location",["jquery","external/immutable","external/classnames","external/react","external/react-dom","modules/clean/browse_interface","modules/clean/react/browse/actions","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/filepath","modules/clean/viewer","modules/clean/em_string","modules/clean/react/bubble_menu","modules/core/i18n","modules/clean/react/file_uploader/actions"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m){var _,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N;return C=n.browse_uri_for_fq_path,v=d.BubbleMenu,y=d.BubbleMenuItem,I=h._,E=m.UploaderActions,N=s.DOM,F=s.createElement,S=2.625,T=20,w=1.64,P=37,b=s.createClass({displayName:"BrowseLocation",mixins:[s.addons.PureRenderMixin],propTypes:{path:s.PropTypes.string,user:s.PropTypes.object,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,shouldHighlightDropTargets:s.PropTypes.bool,isBrowseInContentManager:s.PropTypes.bool},getDefaultProps:function(){return{path:"/",selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1,shouldHighlightDropTargets:!1,isBrowseInContentManager:!1}},_getFirstBreadcrumbName:function(){var e,t,r;return this.props.isBrowseInContentManager?I("Team Folders"):(e=null!=(r=this.props.user.cdm_path)?r:"",t=this.props.path,e?I(t.substr(0,e.length)===e?"Team files":"My files"):u.filename("",c.get_root_name(this.props.user)))},_generateBreadcrumbData:function(){var e,t,r,s,o,n,i,a,l,c,d,h,m,_,f,g,b,v,y,S;for(r=this.props.user.cdm_path,null==r&&(r=""),t="",h=this.props.path,r&&h.substr(0,r.length)===r&&(h=h.substr(r.length),t=r),v=this._getFirstBreadcrumbName(),o=function(){var e,t,r,o;for(r=h.split("/"),o=[],e=0,t=r.length;t>e;e++)s=r[e],s.length>0&&o.push(s);return o}(),e=[{path:t,folderName:v,icon:"work"===this.props.user.role?"work_icon":"personal_icon",alt:I("work"===this.props.user.role?"Work":"Personal")}],n=i=0,m=o.length;m>=0?m>i:i>m;n=m>=0?++i:--i)h=t+("/"+o.slice(0,n+1).join("/")),e.push({path:h,folderName:u.filename(h),icon:"folder_32",alt:I("Folder")});if(e.length<3)return{dropdownCrumbs:[],inlineCrumbs:e,root:e[0]};for(b=null!=(_=null!=(f=e[0])?f.folderName:void 0)?_:"",l=this._getMaxBreadcrumbWidth(b,!1),S=function(){var t,r,o,n;for(n=[],t=0,r=e.length;r>t;t++)s=e[t],n.push(new p(null!=(o=s.folderName)?o:"").length);return n}(),d=1,y=S[e.length-1],n=a=g=e.length-2;(1>=g?1>=a:a>=1)&&(y+=w,y+=S[n],!(y>l));n=1>=g?++a:--a)d+=1;return e.length===d+1&&(d+=1),c=e.length-d,{dropdownCrumbs:e.slice(0,c),inlineCrumbs:e.slice(c),root:e[0]}},_getMaxBreadcrumbWidth:function(e,t){var r;return r=t?S:new p(e).length,T-r},render:function(){var t,r,s,o,n,i,a,l,c;return a=this._generateBreadcrumbData(),s=a.dropdownCrumbs,n=a.inlineCrumbs,c=a.root,i=this._getMaxBreadcrumbWidth(null!=(l=null!=c?c.folderName:void 0)?l:"",s.length>0),t="page-header-text u-l-fl",n.length>1||s.length>0?N.span({},N.h1({className:"ax-visually-hidden"},u.filename(this.props.path)),N.nav({className:t,id:"browse-location","aria-label":I("Folder hierarchy"),role:"navigation"},s.length>0?F(_,{crumbs:s,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.shouldHighlightDropTargets}):void 0,function(){var t,a,l;for(l=[],o=t=0,a=n.length;a>t;o=++t)r=n[o],l.push(F(g,e.extend({},r,{key:encodeURI(r.path),user:this.props.user,isOnlyCrumb:0===o&&1===n.length&&0===s.length,isLastCrumb:o===n.length-1,maxWidth:i,currentPath:this.props.path,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isHighlightedDropTarget:this.props.shouldHighlightDropTargets})));return l}.call(this))):N.h1({className:t},this._getFirstBreadcrumbName())}}),D=s.createClass({displayName:"Spacer",render:function(){return N.span({},F(a,{group:"web",name:"chevron",className:"breadcrumb__spacer",alt:""}))}}),g=s.createClass({displayName:"BreadCrumbSegment",propTypes:{path:s.PropTypes.string.isRequired,user:s.PropTypes.object,folderName:s.PropTypes.string.isRequired,isLastCrumb:s.PropTypes.bool.isRequired,isOnlyCrumb:s.PropTypes.bool,maxWidth:s.PropTypes.number.isRequired,currentPath:s.PropTypes.string.isRequired,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool,isHighlightedDropTarget:s.PropTypes.bool},getDefaultProps:function(){return{isOnlyCrumb:!1,isDraggingInternalFiles:!1,isHighlightedDropTarget:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},componentDidMount:function(){var t,r;return t=0,r=null,e(o.findDOMNode(this)).on("dragenter.breadcrumb",function(e){return function(s){return s.preventDefault(),s.target!==r?(r=s.target,t+=1,e.setState({isDraggedOver:!0}),e.props.isLastCrumb?void 0:E.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumb",function(e){return function(s){return s.preventDefault(),r=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(E.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumb",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumb",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumb",this.handleMouseEnter).on("mouseleave.breadcrumb",this.handleMouseLeave).on("mouseup.breadcrumb",this.handleMouseUp)},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".breadcrumb")},render:function(){var e,t;return t=this.props.isOnlyCrumb?this.props.folderName:p.em_snippet(this.props.folderName,this.props.maxWidth),e={"breadcrumb-segment":!0,"breadcrumb-segment--is-drop-target":!this.props.isLastCrumb&&this.props.isHighlightedDropTarget,"breadcrumb-segment--file-dragged-over":!this.props.isLastCrumb&&this.state.isDraggedOver},this.props.isLastCrumb?N.span({},t):N.span({},N.a({href:C(this.props.user,this.props.path),onClick:this.navigateToFolder,className:r(e)},t),F(D))},navigateToFolder:function(e){return e.preventDefault(),i.setUrl({path:this.props.path})}}),f=s.createClass({displayName:"BreadCrumbDropdownMenuItem",propTypes:{path:s.PropTypes.string.isRequired,icon:s.PropTypes.string.isRequired,folderName:s.PropTypes.string.isRequired,alt:s.PropTypes.string,isHighlightedDropTarget:s.PropTypes.bool,closeFunc:s.PropTypes.func,isDraggingInternalFiles:s.PropTypes.bool,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),currentPath:s.PropTypes.string.isRequired},getDefaultProps:function(){return{isHighlightedDropTarget:!1,closeFunc:function(){},alt:"",isDraggingInternalFiles:!1,selectedFiles:t.OrderedSet()}},getInitialState:function(){return{isDraggedOver:!1}},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles?this.setState({isDraggedOver:!0}):void 0},handleMouseLeave:function(e){return this.state.isDraggedOver?this.setState({isDraggedOver:!1}):void 0},handleMouseUp:function(e){return this.state.isDraggedOver&&this.setState({isDraggedOver:!1}),this.props.isDraggingInternalFiles&&!this.props.isLastCrumb?this.props.closeFunc():void 0;
},componentDidMount:function(){var t,r;return t=0,r=null,e(o.findDOMNode(this)).on("dragenter.breadcrumbMenuItem",function(e){return function(s){return s.preventDefault(),s.target!==r?(r=s.target,t+=1,e.setState({isDraggedOver:!0}),E.setPath({path:e.props.path})):void 0}}(this)).on("dragleave.breadcrumbMenuItem",function(e){return function(s){return s.preventDefault(),r=null,t-=1,1>t&&(t=0,e.state.isDraggedOver)?(E.setPath({path:e.props.currentPath}),e.setState({isDraggedOver:!1})):void 0}}(this)).on("drop.breadcrumbMenuItem",function(e){return function(t){return e.setState({isDraggedOver:!1})}}(this)).on("dragover.breadcrumbMenuItem",function(e){return e.preventDefault(),e.stopPropagation()}).on("mouseenter.breadcrumbMenuItem",this.handleMouseEnter).on("mouseleave.breadcrumbMenuItem",this.handleMouseLeave).on("mouseup.breadcrumbMenuItem",this.handleMouseUp)},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".breadcrumbMenuItem")},handleCrumbClick:function(e){return e.preventDefault(),i.setUrl({path:this.props.path})},render:function(){var e;return e={"breadcrumb-menu-item":!0,"breadcrumb-menu-item--is-drop-target":this.props.isHighlightedDropTarget,"breadcrumb-menu-item--file-dragged-over":this.state.isDraggedOver},F(y,{onClick:this.handleCrumbClick,closeFunc:this.props.closeFunc,className:r(e)},N.span({className:"force-no-break"},F(l,{group:"web",name:this.props.icon,alt:this.props.alt,text:p.em_snippet(this.props.folderName,P)})))}}),_=s.createClass({displayName:"BreadCrumbDropdown",propTypes:{crumbs:s.PropTypes.array.isRequired,currentPath:s.PropTypes.string.isRequired,shouldHighlightDropTargets:s.PropTypes.bool,selectedFiles:s.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:s.PropTypes.bool},getDefaultProps:function(){return{shouldHighlightDropTargets:!1,selectedFiles:t.OrderedSet(),isDraggingInternalFiles:!1}},componentDidMount:function(){return e(o.findDOMNode(this)).on("dragenter.breadcrumbDropdown",function(e){return function(t){return t.preventDefault(),e.refs.bubbleMenu.showMenu()}}(this)).on("mouseenter.breadcrumbDropdown",function(e){return function(t){return e.props.isDraggingInternalFiles?(t.preventDefault(),e.refs.bubbleMenu.showMenu()):void 0}}(this))},componentWillUnmount:function(){return e(o.findDOMNode(this)).off(".breadcrumbDropdown")},render:function(){var e,t,r,s;return t=this.props.crumbs,t.reverse(),s=N.button({className:"u-unbutton breadcrumb-overflow-button u-l-fl"},F(a,{group:"web",name:"folder_arrow_32",alt:I("Show parent folders (descending)")})),r=function(){var r,s,o;for(o=[],r=0,s=t.length;s>r;r++)e=t[r],o.push(F(f,{key:encodeURI(e.path),path:e.path,icon:e.icon,alt:e.alt,folderName:e.folderName,currentPath:this.props.currentPath,isHighlightedDropTarget:this.props.shouldHighlightDropTargets,isDraggingInternalFiles:this.props.isDraggingInternalFiles,selectedFiles:this.props.selectedFiles}));return o}.call(this),N.span({className:"breadcrumb-dropdown-container"},F(v,{ref:"bubbleMenu",position:v.POSITIONS.BOTTOM_RIGHT,targetButton:s,targetFixed:!0,items:r}),F(D))}}),b})}.call(this),function(){define("modules/clean/react/browse/cdm_mve_work_usage_banner",["external/react","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/teams/cdm_mve_quota_usage","modules/core/i18n"],function(e,t,r,s,o){var n,i,a,l,u,c;return i=t.QuotaStats,a=o._,c=e.DOM,u=e.createElement,l=e.createClass({displayName:"CdmMveWorkUsageBanner",propTypes:{userQuota:e.PropTypes.instanceOf(i).isRequired},mixins:[e.addons.PureRenderMixin],render:function(){return c.div({className:"c-banner c-banner--unpinned u-pad-s"},c.strong({},a("Only you have access")),u(s,{quotaStats:this.props.userQuota}))}}),n=r(l,["/static/css/shared_folder_members_preview/cdm_mve_banner-vflRBgSZE.css"])})}.call(this),function(){define("modules/clean/react/browse/comment_status",["modules/clean/activity/constants","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/flux/dispatcher","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/store"],function(e,t,r,s,o,n,i){var a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T;return a=e.ActivityContext,l=n.BrowseActionTypes,c=n.FileTypes,u=i.BrowseStore,S={},p=function(e){var t;return r.fetchCommentStatusBatch({actorId:null!=(t=u.user())?t.id:void 0,context:a.BROWSE_FILE_VIEWER,contextDataList:e,isBackgroundRequest:!0})},h=function(e){return null==e.feedback_off&&null==e.comment_count&&null==e.unresolved_comment_count},m=function(e){return e.type===c.FILE},_=function(e){return null!=e.after},d=function(e){var t,r;return t=e.files,r=t.filter(m).filter(h).map(function(e){return e.fq_path}),r.length>0?p(r).then(function(e){return o.addCommentStatusBatch({commentStatusByFqPath:e})}):void 0},y=d,b=d,g=d,v=function(e){var t,r,s;return t=e.fileDeltas,s=e.path,r=t.filter(_).map(function(e){var t;return t=e.after}),d({files:r})},f=function(e){var t;switch(t=e.action,t.type){case l.LOAD_PATH:return y(t.data);case l.ADD_FILES:return b(t.data);case l.INITIALIZE_EVERYTHING:return g(t.data);case l.CHANGE_FILES:return v(t.data)}},w=function(e){return null==e&&(e=s),S={dispatcher:e,dispatchToken:e.register(f)},d({files:u.files().toArray()})},T=function(){return S.dispatcher.unregister(S.dispatchToken),S={}},{setup:w,teardown:T}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/file_jump",["modules/clean/keycode","modules/clean/react/browse/store","modules/core/dom","modules/clean/react/browse/constants","modules/clean/flux/dispatcher"],function(t,r,s,o,n){var i,a,l,u,c;return l=r.BrowseStore,a=o.BrowseActionTypes,i=["/","\\",":","?","*","<",">","|"],c=1e3,u={_timeout:null,_reset:function(){return n.dispatch({type:a.RESET_FILE_JUMP})},handleKeyPress:function(r){var o,u,p;return u=null!=(p=r.which)?p:r.keyCode,o=String.fromCharCode(u),u<t.SPACE||e.call(i,o)>=0||s.focus_in_input()||r.metaKey||r.altKey||r.altGraphKey||r.ctrlKey||u===t.SPACE&&!l.isFileJumping()?void 0:(u===t.SPACE&&l.isFileJumping()&&r.preventDefault(),n.dispatch({type:a.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:o}}),null!=this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._reset,c))}}})}.call(this),function(){define("modules/clean/react/browse/file_list_empty_folder",["external/classnames","external/react","modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/react/button","modules/clean/react/file_uploader/uploader","modules/clean/react/image","modules/clean/static_urls","modules/core/i18n"],function(e,t,r,s,o,n,i,a,l){var u,c,p,d,h,m,_,f,g;return d=r.TeamsWebActionsLogger,p=s.NameSpaceAccess,m=o.button,c=n.FileUploader,g=a.static_url,h=l._,f=t.DOM,_=t.createElement,u=t.createClass({propTypes:{currentSharedFolderPermissionRole:t.PropTypes.number,isArchiveState:t.PropTypes.bool,isBrowseInContentManager:t.PropTypes.bool,isInCdmMve:t.PropTypes.bool,isInsideSharedFolder:t.PropTypes.bool,isSearchState:t.PropTypes.bool,isViewingTeamFolder:t.PropTypes.bool,userId:t.PropTypes.number.isRequired,userFamiliarName:t.PropTypes.string},mixins:[t.addons.PureRenderMixin],displayName:"EmptyFolder",getDefaultProps:function(){return{isSearchState:!1}},_logTeamAction:function(e){return d.log(e,null,null,this.props.userId,!1,d.LOG_CATEGORY.TEAM_INFO)},render:function(){var t,r,s,o,n,a,l,u;return a=this.props.isInsideSharedFolder&&((l=this.props.currentSharedFolderPermissionRole)===p.ACCESS_READER||l===p.ACCESS_READER_NO_COMMENT),r={"u-l-dn":a,"drag-prompt":!0},this.props.isSearchState?f.div({className:"u-font-center u-pad-top-xl"},_(i,{src:g("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:g("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),f.h2({className:"u-pad-top-l"},h("No results found")),f.div({},h("Please update your search and try again"))):this.props.isBrowseInContentManager&&this.props.isArchiveState?f.div({className:"u-font-center u-font-meta u-pad-top-xl"},h("No archived team folders")):this.props.isBrowseInContentManager&&this.props.isViewingTeamFolder?f.div({className:"u-font-center u-pad-top-xl"},_(i,{src:g("/static/images/empty_states/collaboration-team-folder-vflapVQHo.png"),srcHiRes:g("/static/images/empty_states/collaboration-team-folder@2x-vflsqkNUB.png"),alt:""}),f.div({className:"u-font-center u-font-meta"},h("Create a team folder to get started.")),f.a({href:"/help/986",target:"_blank"},h("What are team folders?"))):(this.props.isViewingTeamFolder?(this._logTeamAction("upload_files_displayed"),this.props.isInCdmMve?s=f.div({},f.h2({},h("Welcome to your team, %(name)s!").format({name:this.props.userFamiliarName})),f.div({},h("You don’t have any team files yet. Upload files here to instantly share them with your teammates. You can even drag and drop files from your desktop here."))):(o=g("/static/images/empty_states/team-folder-vflZkv0TQ.png"),n=g("/static/images/empty_states/team-folder@2x-vfloC8f3o.png"),s=h("This Team folder is empty. Upload files to this folder to share with your Team.")),t=f.div({className:"o-grid"},f.div({className:e({"o-grid__col--centered":!0,"u-pad-top-m":!this.props.isInCdmMve,"o-grid__col--1-of-3":!this.props.isInCdmMve,"o-grid__col--1-of-2":this.props.isInCdmMve})},f.div({},s),_(m,{onClick:function(e){return function(){return c.showModal(),e._logTeamAction("upload_files_clicked")}}(this)},h("Upload files"))))):(o=g("/static/images/empty_states/files-vflsVPyeo.png"),n=g("/static/images/empty_states/files@2x-vflvkuH8g.png"),u=f.h2({},h("This folder is empty.")),t=this.props.isBrowseInContentManager?f.div({},""):f.div({},h("Drag and drop files onto this window to upload."))),f.div({className:"u-font-center u-pad-top-xl"},o?_(i,{src:o,srcHiRes:n,alt:""}):void 0,u,f.div({className:e(r)},t)))}})})}.call(this),function(){define("modules/clean/react/browse/file_list_utils",["modules/clean/react/browse/constants"],function(e){var t,r,s;return t=e.DropTargetHighlightMode,s=e.FileTypes,r={shouldFileBeHighlightedDropTarget:function(e){var r,o,n,i;if(o=e.file,n=e.isSelected,r=e.dropTargetHighlightMode,r===t.NONE)return!1;if(!o.is_dir)return!1;if(o.is_read_only_mount)return!1;if(o.isDeleted)return!1;switch(r){case t.ALL_FOLDERS:return!0;case t.NONSELECTED_FOLDERS:return!n;case t.NONSELECTED_NONSHARED_FOLDERS:return!n&&o.type!==s.SHARED_FOLDER;case t.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:return!n&&(i=o.type)!==s.SHARED_FOLDER&&i!==s.TEAM_SHARED_FOLDER}return!1}},{FileListHelpers:r}})}.call(this),function(){define("modules/clean/react/browse/folder_list_row",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/clean/react/browse/actions","modules/clean/react/browse/name_input","modules/clean/react/flag","modules/clean/sharing/ui_util","modules/clean/static_urls"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m){var _,f,g,b,v,y,w,S;return b=i.NewFolderCreationState,_=a.BrowseContext,v=u._,f=h.GoldenGate,S=m.static_url,w=s.DOM,y=s.createElement,g=s.createClass({displayName:"NewFolderCreationListRow",mixins:[s.addons.PureRenderMixin],propTypes:{newFolderState:s.PropTypes.oneOf(o.values(b)),context:s.PropTypes.instanceOf(_),topOffsetPx:s.PropTypes.number,user:s.PropTypes.object},_handleCancel:function(){return c.cancelCreateFolder()},_handleSubmit:function(e){return c.createFolder({pathName:this.props.context.currentFQPath,folderName:e,nsId:this.props.context.rootNSID})},_renderIcon:function(){var e,t;return e=null!=this.props.user&&f.hasGoldenGateIconography(this.props.user.id),t=n.new_folder_icon(this.props.context.isInsideTeamFolderTree,e),y(l,{group:"web",name:S("/static/images/icons/icon_spacer-vflN3BYt2.gif"),className:"u-pad-right-xs sprite sprite_web browse-file-row__accessory "+t,alt:""})},_renderNewFolderCreationColumn:function(){var e,t;return e=this._renderIcon(),t=w.div({}),this.props.newFolderState===b.PENDING_INPUT?t=y(p,{defaultValue:"",label:v("Folder name"),onSubmit:this._handleSubmit,onCancel:this._handleCancel,className:"browse-file-row__input"}):this.props.newFolderState===b.SAVING_INPUT&&(t=w.div({className:"creating_folder_text",role:"status","aria-live":"polite"},v("Creating new folder…"))),w.div({className:"o-grid__col--1-of-2",role:"gridcell"},y(d,{leftAttachment:e},t))},_renderPlaceholder:function(){return w.div({role:"gridcell"})},render:function(){var e;return e={"browse-file-row":!0,"o-grid":!0,"o-grid--no-gutter":!0,"browse-file-row--is-selected":!0},w.li({className:t(e),role:"row",style:{position:"absolute",top:this.props.topOffsetPx}},this._renderPlaceholder(),this._renderNewFolderCreationColumn(),this._renderPlaceholder(),this._renderPlaceholder(),this._renderPlaceholder())}})})}.call(this),function(){define("modules/clean/react/browse/internal_drag_status",["external/immutable","external/react","jquery","modules/clean/react/sprite"],function(e,t,r,s){var o,n,i;return i=t.DOM,n=t.createElement,o=t.createClass({displayName:"InternalDragStatus",mixins:[t.addons.PureRenderMixin],propTypes:{files:t.PropTypes.array.isRequired},render:function(){return i.div({id:"drag-status",className:"active"},i.div({id:"drag-selection-status"},this.props.files.slice(0,4).map(function(e,t){return e.thumbnail_url_tmpl?i.img({key:t,src:e.thumbnail_url_tmpl,className:"icon icon"+t,alt:""}):n(s,{key:t,group:"web",name:e.icon,className:"icon icon"+t,alt:""})}),i.span({className:"badge"},this.props.files.length)))}}),{InternalDragStatus:o}})}.call(this),function(){define("modules/clean/react/browse/keyboard_shortcuts",["external/react","external/react-dom","jquery","modules/core/browser","modules/core/i18n","modules/clean/keycode","modules/clean/react/modal","modules/clean/react/flag"],function(e,t,r,s,o,n,i,a){var l,u,c,p,d,h;return p=o._,u=i.Modal,h=e.DOM,d=e.createElement,c=[{key:"↑",desc:p("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:p("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{windowsKey:"ctrl + a",macKey:"⌘ + a",desc:p("Select all files")},{key:"esc",desc:p("Deselect all files")},{key:"←",desc:p("Go up a folder")},{key:"/",desc:p("Search")},{key:"→",desc:p("Open folder")},{key:"enter",desc:p("Open file or folder")},{key:"alt + a",desc:p("Show action menu for selected file(s)")},{windowsKey:"ctrl + c",macKey:"⌘ + c",desc:p("Copy selected file(s)")},{windowsKey:"ctrl + v",macKey:"⌘ + v",desc:p("Paste selected file(s) into the current folder")},{key:"F2",desc:p("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:p("Delete selected file(s)")},{windowsKey:"ctrl + z",macKey:"⌘ + z",desc:p("Undo recent move/copy/rename/delete")},{key:"?",desc:p("Show keyboard shortcuts")}],l=e.createClass({displayName:"KeyboardShortcuts",componentDidMount:function(){var e;return e=t.findDOMNode(this.refs.shortcutsModal.refs.modal),r(e).on("keydown",this._handleQuestionMarkKeyDown)},componentWillUnmount:function(){var e;return e=t.findDOMNode(this.refs.shortcutsModal.refs.modal),r(e).off("keydown",this._handleQuestionMarkKeyDown)},_handleQuestionMarkKeyDown:function(e){return e.shiftKey&&e.which===n.FORWARD_SLASH?(e.stopPropagation(),this.refs.shortcutsModal.close()):void 0},_renderShortcutsItem:function(e){var t;return t=h.span({className:"keyboard-shortcuts__key"},e.key?e.key:s.mac?e.macKey:e.windowsKey),h.li({className:"keyboard-shortcuts__item u-mar-bottom-xs"},d(a,{leftAttachment:t,alignment:"top"},h.span({className:"keyboard-shortcuts__desc"},e.desc)))},render:function(){var e;return d(u,{ref:"shortcutsModal",acceptButtonText:"",className:"keyboard-shortcuts",onShow:this._setupKeyDown,title:p("Dropbox keyboard shortcuts"),width:750},h.ul({className:"keyboard-shortcuts__pane u-unlist u-trim-padding"},function(){var t,r,s;for(s=[],t=0,r=c.length;r>t;t++)e=c[t],s.push(this._renderShortcutsItem(e));return s}.call(this)))}})})}.call(this),function(){define("modules/clean/react/browse/name_input",["external/underscore","external/classnames","external/react","external/react-dom","modules/core/i18n","modules/clean/keycode","modules/core/notify","modules/clean/raf"],function(e,t,r,s,o,n,i,a){var l,u,c,p;return c=o._,p=r.DOM,u=r.PropTypes,l=r.createClass({mixins:[r.addons.PureRenderMixin],displayName:"NameInput",propTypes:{defaultValue:u.string.isRequired,label:u.string.isRequired,onSubmit:u.func,onCancel:u.func,className:u.string},getDefaultProps:function(){return{onSubmit:e.noop,onCancel:e.noop,className:""}},componentDidMount:function(){var e;return e=s.findDOMNode(this.refs.input),e.focus(),a.requestAnimationFrame(function(){var t,r;return t=e.value,r=t.lastIndexOf("."),-1===r&&(r=t.length),e.setSelectionRange(0,r)})},_checkValue:function(){var e;return e=s.findDOMNode(this.refs.input).value.trim(),e===this.props.defaultValue?(this.props.label===c("Folder name")&&i.error(c("Please provide a name for the new folder.")),this.props.onCancel()):this.props.onSubmit(e)},_onSubmit:function(e){return e.preventDefault(),this._checkValue()},_onKeyDown:function(e){return e.keyCode===n.ESC?(e.preventDefault(),this.props.onCancel()):void 0},_onBlur:function(e){return this._checkValue()},render:function(){var e;return e=p.input({ref:"input",defaultValue:this.props.defaultValue,className:t("c-input",this.props.className),onBlur:this._onBlur,onKeyDown:this._onKeyDown,onDragStart:function(e){return e.stopPropagation()},"aria-label":this.props.label}),p.form({className:"u-pad-right-xs",onSubmit:this._onSubmit},e)}})})}.call(this),function(){define("modules/clean/react/browse/settings_gear_menu",["external/react","external/underscore","modules/clean/react/browse/models","modules/clean/react/bubble_menu","modules/clean/react/sprite"],function(e,t,r,s,o){var n,i,a,l,u,c,p;return n=r.BrowseContext,l=r.File,i=s.BubbleMenu,a=s.BubbleMenuItem,p=e.DOM,c=e.createElement,u=e.createClass({displayName:"settingsGearMenuBubble",propTypes:{alt:e.PropTypes.string.isRequired,browseContext:e.PropTypes.instanceOf(n).isRequired,file:e.PropTypes.instanceOf(l).isRequired,isActionDisabled:e.PropTypes.bool,isShowing:e.PropTypes.bool.isRequired,menuItems:e.PropTypes.arrayOf(e.PropTypes.shape({label:e.PropTypes.string,action:e.PropTypes.func})).isRequired},render:function(){var e,r;return e=p.button({className:"sprite-button bubble-button"},c(o,{group:"web",name:"gear",alt:this.props.alt})),c(i,{position:i.POSITIONS.BOTTOM,targetButton:e,ref:"gearBubbleMenu",items:function(){var e,s,o,n;for(o=this.props.menuItems,n=[],e=0,s=o.length;s>e;e++)r=o[e],n.push(c(a,{onClick:t.partial(r.action,this.props.browseContext,this.props.file),disabled:this.props.isActionDisabled},r.label));return n}.call(this)})}}),{SettingsGearMenuBubble:u}})}.call(this),define("modules/clean/react/browse/util",["require","exports","modules/clean/em_string","modules/clean/filepath","modules/constants/browse","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,r,s,o,n,i,a){"use strict";function l(e){if(1===e.count()){var t=e.first(),o=s.filename(t.fq_path);return r.em_snippet(o,c)}if(e.count()>1){var n=function(e){return e.isDeleted},a=e.some(n)&&!e.every(n),l=e.toArray().filter(function(e){return e.is_dir}),u=e.toArray().filter(function(e){return!e.is_dir});if(a)return i._("No available actions");var p=[];if(u.length){var d=i.ungettext("%(num_files)d file","%(num_files)d files",u.length).format({num_files:u.length});p.push(d)}if(l.length){var d=i.ungettext("%(num_folders)d folder","%(num_folders)d folders",l.length).format({num_folders:l.length});p.push(d)}return 2===p.length?i._("%(x)s and %(y)s",{comment:'\n            The whole string is a phrase like "2 files and 3 folders". \'x\' is\n            a string containing a phrase like "2 files" and \'y\' is a string\n            containing a phrase like "3 folders".\n          '}).format({x:p[0],y:p[1]}):p[0]}return""}function u(e,t,r){return void 0===r&&(r={}),r[n.UID_PARAM_NAME]=String(t),o.REVISION_HISTORY_WEB?a({path:"/history"+e}).updateQuery(r):a({path:"/revisions"+e}).updateQuery(r)}var c=13.5;t.describeFiles=l,t.getRevisionsUri=u}),function(){define("modules/clean/react/context_menu_v2",["jquery","external/immutable","external/keymaster","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/sprite_div","modules/core/browser","modules/core/dom","modules/clean/react/browse/constants"],function(e,t,r,s,o,n,i,a,l,u,c,p,d){var h,m,_,f,g,b,v,y,w;return b=d.MouseEventButton,y=o.createElement,w=o.DOM,v="",_=t.Record({icon:null,text:"",shouldShow:!0,isDisabled:!1,onClick:i.noop,href:null,subMenuItems:null}),g=o.createClass({displayName:"GlobalContextMenu",propTypes:{alwaysOpenOnCapture:o.PropTypes.bool,ignoreSelectors:o.PropTypes.string,items:o.PropTypes.arrayOf(o.PropTypes.instanceOf(_)),onMenuOpen:o.PropTypes.func,onMenuClose:o.PropTypes.func},getDefaultProps:function(){return{alwaysOpenOnCapture:!1,ignoreSelectors:"a, input, button, textarea, select",onMenuOpen:i.noop,onMenuClose:i.noop}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("contextmenu.GlobalContextMenu",function(t){return function(r){return 0===e(r.target).closest(t.props.ignoreSelectors).size()?t.toggleMenu(r):t.closeMenu()}}(this)),e(document).on("click.GlobalContextMenu",function(t){return function(r){return r.button!==b.RIGHT&&0===e(r.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".GlobalContextMenu")},openMenuAtPosition:function(e,t,r){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(r)},closeMenu:function(){return this.state.isMenuOpen?(this.setState({isMenuOpen:!1}),this.props.onMenuClose()):void 0},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return w.span({},this.state.isMenuOpen?y(f,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0)}}),m=o.createClass({displayName:"ContextMenuHandler",propTypes:{alwaysOpenOnCapture:o.PropTypes.bool,className:o.PropTypes.string,items:o.PropTypes.arrayOf(o.PropTypes.instanceOf(_)),onMenuOpen:o.PropTypes.func,onMenuClose:o.PropTypes.func},getDefaultProps:function(){return{onMenuOpen:i.noop,onMenuClose:i.noop,alwaysOpenOnCapture:!1}},getInitialState:function(){return{isMenuOpen:!1}},componentDidMount:function(){return e(document).on("click.ContextMenuHandler",function(t){return function(r){return r.button!==b.RIGHT&&0===e(r.target).closest(".context-menu").size()?t.closeMenu():void 0}}(this))},componentWillUnmount:function(){return e(document).off(".ContextMenuHandler")},openMenuAtPosition:function(e,t,r){return this.setState({isMenuOpen:!0,left:e,top:t}),this.props.onMenuOpen(r)},closeMenu:function(){return this.setState({isMenuOpen:!1}),this.props.onMenuClose()},toggleMenu:function(e){return e.shiftKey?void 0:(e.preventDefault(),this.state.isMenuOpen&&!this.props.alwaysOpenOnCapture?this.closeMenu():this.openMenuAtPosition(e.clientX,e.clientY,e))},render:function(){return w.span({className:this.props.className},this.state.isMenuOpen?y(f,{initialLeft:this.state.left,initialTop:this.state.top,onMenuClose:this.closeMenu,items:this.props.items,ref:"contextMenu"}):void 0,w.span({"aria-haspopup":!0,onContextMenuCapture:this.toggleMenu,ref:"contextMenuTarget"},this.props.children))}}),h=o.createClass({displayName:"ContextMenu",propTypes:{initialLeft:o.PropTypes.number,initialTop:o.PropTypes.number,items:o.PropTypes.arrayOf(o.PropTypes.instanceOf(_)),onMenuClose:o.PropTypes.func,onCurrentMenuClose:o.PropTypes.func,level:o.PropTypes.number,shouldAutoSelect:o.PropTypes.bool},getDefaultProps:function(){return{initialLeft:null,initialTop:null,items:null,onMenuClose:i.noop,onCurrentMenuClose:i.noop,level:0,shouldAutoSelect:!1}},getInitialState:function(){return{selectedIndex:null,left:null,right:null,isSubMenuOpen:!1}},componentWillMount:function(){return this.setState({left:this.props.initialLeft,top:this.props.initialTop})},componentDidMount:function(){return v=key.getScope(),key.setScope("ContextMenu"),this.updateCoordinates(),n.findDOMNode(this.refs.contextMenu).focus(),this.props.shouldAutoSelect?this._selectNextItem():void 0},componentDidUpdate:function(e){return e.items!==this.props.items||e.initialLeft!==this.props.initialLeft||e.initialTop!==this.props.initialTop?(this.setState({selectedIndex:null}),this.updateCoordinates(),n.findDOMNode(this.refs.contextMenu).focus()):void 0},componentWillUnmount:function(){return key.setScope(v)},_getReachableIndices:function(){var e,t,r,s,o,n;for(o=[],n=this.props.items,e=r=0,s=n.length;s>r;e=++r)t=n[e],t.shouldShow&&!t.isDisabled&&o.push(e);return o},_selectNextItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+1)%e.length:0,null!=t?this.selectItem(e[t]):void 0},_selectPreviousItem:function(){var e,t;return e=this._getReachableIndices(),t=null!=this.state.selectedIndex?(e.indexOf(this.state.selectedIndex)+e.length-1)%e.length:e.length-1,null!=t?this.selectItem(e[t]):void 0},_handleKeyDown:function(e){var t,r,s,o,n,i,l,u;if(!this.state.isSubMenuOpen)switch(e.keyCode){case a.TAB:return e.preventDefault(),e.stopPropagation();case a.ESC:return this.props.onMenuClose();case a.SPACE:case a.ENTER:if(null!=this.state.selectedIndex)return l=this.props.items[this.state.selectedIndex],this.clickItem(l,e),this.openSubMenu(l,!0),e.preventDefault(),e.stopPropagation();break;case a.DOWN:return this._selectNextItem(),e.preventDefault(),e.stopPropagation();case a.UP:return this._selectPreviousItem(),e.preventDefault(),e.stopPropagation();case a.RIGHT:if(null!=this.state.selectedIndex)return this.openSubMenu(this.props.items[this.state.selectedIndex],!0);break;case a.LEFT:if(this.props.level>0)return this.props.onCurrentMenuClose(),e.preventDefault(),e.stopPropagation();break;default:for(u=String.fromCharCode(e.keyCode),n=this.props.items,i=[],t=s=0,o=n.length;o>s;t=++s)if(r=n[t],r.shouldShow&&!r.isDisabled){if(r.text[0].toUpperCase()===u){this.selectItem(t),e.preventDefault(),e.stopPropagation();break}i.push(void 0)}return i}},openSubMenu:function(e,t){var r;return(null!=(r=e.subMenuItems)?r.length:void 0)>0?this.setState({isSubMenuOpen:!0,shouldAutoSelectSubMenu:t}):void 0},closeSubMenu:function(){return n.findDOMNode(this.refs.contextMenu).focus(),this.setState({isSubMenuOpen:!1})},selectItemWithMouse:function(e){return n.findDOMNode(this.refs.contextMenu).focus(),this.selectItem(e,!0,!1)},selectItem:function(e,t,r){return this.setState({selectedIndex:e}),t?this.openSubMenu(this.props.items[e],r):void 0},clickItem:function(e,t){return null!=e.subMenuItems||e.isDisabled?void 0:(null!=e.href?c.redirect(e.href):e.onClick(t),this.props.onMenuClose())},updateCoordinates:function(){var t,r,s,o,i,a,l,u;return t=this.props.initialLeft,l=this.props.initialTop,null!=t&&null!=l&&null!=this.refs.contextMenu&&(u=p.viewport_dimensions(),a=15,i=e(n.findDOMNode(this.refs.contextMenu)).width(),o=e(n.findDOMNode(this.refs.contextMenu)).height(),r=u.width-a-i,t>r&&(t=r),s=u.height-a-o,l>s&&(l=s)),this.setState({left:t,top:l})},getSelectedItemDomId:function(){return null!=this.state.selectedIndex?"contextMenu"+this.props.level+"-item"+this.state.selectedIndex:""},_renderItem:function(e,t){var r,o,n,i,a;return n=this.state.selectedIndex===t,o=(null!=(a=e.subMenuItems)?a.length:void 0)>0,i="contextMenu"+this.props.level+"-item"+t,r={"context-menu-item":!0,"context-menu-item--has-submenu":o,"context-menu-item--selected":n,"context-menu-item--disabled":e.isDisabled},w.li({key:i,id:i,"data-action":e.text,className:s(r),role:"menuitem","aria-haspopup":o,"aria-disabled":e.isDisabled,onMouseEnter:function(r){return function(){return e.isDisabled?r.setState({selectedIndex:null}):r.selectItemWithMouse(t)}}(this),onClick:function(t){return function(r){return t.clickItem(e,r)}}(this)},null!=e.icon?y(u,{group:e.icon.group,name:e.icon.name,alt:"",text:e.text}):w.span({},e.text),o?w.span({className:"context-menu-item__accessory c-arrow--right"}):void 0,o&&n&&this.state.isSubMenuOpen?y(h,{initialLeft:null,initialTop:null,className:"context-menu--secondary",level:this.props.level+1,items:e.subMenuItems,onMenuClose:this.props.onMenuClose,onCurrentMenuClose:this.closeSubMenu,shouldAutoSelect:this.state.shouldAutoSelectSubMenu}):void 0)},render:function(){var e,t,r;return null!=this.state.left&&null!=this.state.top&&(r={left:this.state.left,top:this.state.top}),w.ul({id:"contextMenu"+this.props.level,ref:"contextMenu",className:s("no-padding","bubble-dropdown","context-menu",this.props.className),style:r,role:"menu",tabIndex:-1,"aria-activedescendant":this.getSelectedItemDomId(),onKeyDown:this._handleKeyDown},function(){var r,s,o,n;for(o=this.props.items,n=[],e=r=0,s=o.length;s>r;e=++r)t=o[e],t.shouldShow&&n.push(this._renderItem(t,e));return n}.call(this))}}),f=l(h,["/static/css/components/bubble_dropdown-vflbLryNB.css","/static/css/scooter/scooter-scoped-vflx8uhBs.css"]),{GlobalContextMenu:g,ContextMenuHandler:m,ContextMenu:h,ContextMenuItem:_}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/core/exception","modules/clean/react/browse/store","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/base64"],function(t,r,s,o,n,i,a,l){var u,c,p,d,h,m,_,f,g,b,v,y;return g=t._,b=r.assert,c=s.BrowseStore,v=n.file_extension,y=n.file_extension_for_logging,f=i.UploaderStore,m=i.UploaderActionTypes,p=i.FileStatus,d=i.FileUpload,h=i.UploadErrorType,u=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],_=function(){function t(){}return t.prototype.initPLU=function(){return a.isInitialized?void 0:(this.sendNS=!1,a.init(),a.onFilesAdded(function(t){return function(r){var s,n,i,a,l,c,p,d,_,f;for(n=function(){var e,t,s;for(s=[],e=0,t=r.length;t>e;e++)i=r[e],null==i.size&&s.push(i);return s}(),r=function(){var e,t,s;for(s=[],e=0,t=r.length;t>e;e++)i=r[e],null!=i.size&&s.push(i);return s}(),a=0,c=n.length;c>a;a++)s=n[a],o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:s,errorType:h.EMPTY_OR_FOLDER,errorMessage:g("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(d=function(t){var r;return r=y(t.name),e.call(u,r)>=0&&t.size%34===0},f=function(){var e,t,s;for(s=[],e=0,t=r.length;t>e;e++)i=r[e],d(i)&&s.push(i);return s}(),r=function(){var e,t,s;for(s=[],e=0,t=r.length;t>e;e++)i=r[e],d(i)||s.push(i);return s}(),l=0,p=f.length;p>l;l++)_=f[l],o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:_,errorType:h.PACKAGE_FILE,errorMessage:g("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return n.length&&t.cancelUploads({files:n}),f.length&&t.cancelUploads({files:f}),o.dispatch({type:m.QUEUE_UPLOADS,data:{files:r}}),t._frobPLU()}}(this)),a.onUploadProgress(function(e){var t,r,s,n,i;return f.isUploadCancelled(e.uploadId)?void 0:(n=e.percentUploaded,r=n*f.currentUpload().size/100,i=r+f.totalSizeOfCompletedUploads(),
t=a.bytesPerSec(),s=f.fileList().count(function(e){var t;return(t=e.status)===p.PENDING||t===p.UPLOADING}),o.dispatch({type:m.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:n,numSecondsLeft:(f.totalSize()-i)/t+s}}))}),a.onFileUploaded(function(e){return function(t,r){var s;return f.isUploadCancelled(t.uploadId)?void 0:(s=JSON.parse(r.response),"error"in s?(a.removeFiles({files:[t]}),"ignored"===s.error?o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:h.IGNORED,errorMessage:g("This file was skipped because it’s an internal system file.")}}):o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:h.GENERIC}})):(b("complete"===s.status),b(s.total_size===t.size),b(s.upload_id===t.uploadId),o.dispatch({type:m.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}})),e._frobPLU())}}(this)),a.onError(function(e){return function(t,r,s){return f.fileList().has(t.uploadId)?o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:r,errorMessage:s}}):o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:t,errorType:r,errorMessage:s}}),e._frobPLU()}}(this)))},t.prototype.setPath=function(e){var t,r,s;return r=e.path,t=null!=(s=e.hasPermissionToUploadToFolder)?s:!0,r!==f.path()||t!==f.hasPermissionToUploadToFolder()?o.dispatch({type:m.SET_PATH,data:{path:r,hasPermissionToUploadToFolder:t}}):void 0},t.prototype.setUser=function(e){var t;return t=e.user,o.dispatch({type:m.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,r,s;return r=e.numDraggingFiles,t=null!=(s=e.isInternalTransfer)?s:!1,o.dispatch({type:m.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:r,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t;return t=e.files,a.addFiles({files:t}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var r,s,n,i,a,l,c,p,d,_,b,v;for(s=t.directoryEntries,r=f.path(),i=[],p=0,a=function(e){return function(){var t;return(t=function(){var r,s,o;return i.length>0?(o=i.pop(),s=o.entry,r=o.dest,s.file(function(s){return e.setPath({path:r}),e.addFilesToPLU({files:[s]}),t()})):void 0})()}}(this),d=function(e){var t,s;return p+=1,s=e.createReader(),(t=function(){return s.readEntries(function(s){var o,n,l;if(s.length>0){for(o=0,n=s.length;n>o;o++)l=s[o],l.isDirectory?d(l):i.push({entry:l,dest:r+e.fullPath});return t()}return p-=1,0===p?a():void 0})})()},b=[],l=0,c=s.length;c>l;l++)v=s[l],_=y(v.name),e.call(u,_)>=0?(n=new File({name:v.name,dest:r}),b.push(o.dispatch({type:m.ADD_NEW_FAILED_FILE,data:{file:n,errorType:h.PACKAGE_FILE,errorMessage:g('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):b.push(d(v));return b},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,o.dispatch({type:m.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,o.dispatch({type:m.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.setSendNS=function(e){return this.sendNS=e},t.prototype.cancelUploads=function(e){var t;return t=e.files,a.removeFiles({files:t}),o.dispatch({type:m.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,r,s;return s=e.file,r=e.errorType,t=e.errorMessage,a.removeFiles({files:[s]}),o.dispatch({type:m.UPLOAD_ERROR,data:{uploadId:s.uploadId,errorType:r,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,r,s,n,i,l;return s=e.file,o.dispatch({type:m.START_UPLOAD,data:{file:s}}),l="url"===(i=v(s.name,r=!0))||"webloc"===i||"website"===i?0:1,t={dest:s.dest,reported_total_size:s.size,uploadId:s.uploadId,_subject_uid:s.userId,offset:0,overwrite:l},this.sendNS&&(t.ns_id=c.context().currentNSID,n="",c.path()!==s.dest&&(n=s.dest.replace(c.path(),"")),t.ns_path=c.context().currentNSPath+n+"/"+s.name),a.setAjaxParams(t),a.start(),!0},t.prototype._frobPLU=function(){var e;return e=f.nextUpload(),null!=e&&null==f.currentUpload()?(b(e instanceof d),this._startUpload({file:e})):void 0},t}(),{UploaderDispatcher:o,UploaderActions:new _}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["jquery","modules/core/exception","external/plupload_dev","external/react","external/underscore","modules/clean/static_urls","modules/core/cookies","modules/clean/react/browse/action_logger","modules/clean/react/file_uploader/store","modules/constants/request","modules/constants/env","modules/core/i18n"],function(t,r,s,o,n,i,a,l,u,c,p,d){var h,m,_,f,g,b,v,y,w,S,T,P;return S=r.assert,v=i.UrlConstants,h=l.BrowseLogger,b=u.UploaderStore,m=u.FileUpload,g=u.UploadErrorType,T=u.generateUploadId,y=d._,P=window.plupload,w=function(e,t){var r,s;return null==t&&(t={}),r=n.extend({},t,e),new m({uploadId:r.uploadId,dest:r.dest,name:r.name,size:r.size,userId:r.userId,percentUploaded:null!=(s=r.percent)?s:0})},f=function(){function r(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1}return r.prototype.idToUploadIdMap={},r.prototype.PLU_CONTAINER_ID="flash-upload-container",r.prototype.init=function(){var e;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=t("<button>").addClass("secret-file-uploader-button").hide().appendTo(t("body")),this.$pluContainer=t("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(t("body")),this.$currentExternalBrowseButton=t(),e={url:"https://"+p.BLOCK_CLUSTER+"/chunked_upload",file_data_name:"file",runtimes:this._runtimes,multipart_params:{},multipart:!1,max_file_size:"50000mb",chunk_size:"8mb",max_retries:2,browse_button:this.$secretBrowseButton[0],container:this.PLU_CONTAINER_ID,flash_swf_url:v.MOXIE_SWF_URL,init:{ChunkUploaded:function(e){return function(t,r,s){var o,n;return n=e.idToUploadIdMap[r.id],S(JSON.parse(s.response).upload_id===n),o=b.fileList().get(n),e.setAjaxParams({dest:o.dest,reported_total_size:o.size,uploadId:n,_subject_uid:o.userId,offset:s.offset,overwrite:1})}}(this)}},this.uploader=new P.Uploader(e),this.uploader.init()},r.prototype._runtimes=function(){var e,t,r,s,o;s={"MSIE 8.0":"flash","MSIE 9.0":"flash"},r="html5";for(e in s)o=s[e],-1!==(null!=(t=navigator.userAgent)?t.indexOf(e):void 0)&&(r=o);return r}(),r.prototype.addFiles=function(e){var t;return t=e.files,this.isInitialized||this.init(),this.uploader.addFile(t)},r.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},r.prototype.setAjaxParams=function(e){var t,r,s,o,n,i,l,u;if(l=e.reported_total_size,r=e.dest,u=e.uploadId,n=e.offset,t=e._subject_uid,i=e.overwrite,s=e.ns_id,o=e.ns_path,this.isInitialized||this.init(),null==l||null==r||null==u||null==n||null==t||null==i)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:a.read(c.JS_CSRF_COOKIE),reported_total_size:l,dest:r,upload_id:u,offset:n,_subject_uid:t,overwrite:i,ns_id:s,ns_path:o}},r.prototype.setBrowseButton=function(e){var r;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.length?(t("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),r=t("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),r[0].style.top="0px",r[0].style.left="0px",r[0].style.width="100%",r[0].style.height="100%"):t("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=t(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",function(e){return function(){return e.$secretBrowseButton.click()}}(this)))},r.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",function(t){return function(r,s){var o;return h.logUploadFile({uid:b.user().id,num_files:s.length,uploader_type:"enhanced",upload_method:"chooser"}),o=s.map(function(e){var r;return r=T(),t.idToUploadIdMap[e.id]=r,w(e,{uploadId:r,dest:b.path(),userId:b.user().id})}),e(o)}}(this))},r.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",function(t){return function(r,s){var o,n;return n=t.idToUploadIdMap[s.id],o=b.fileList().get(n),e(o.set("percentUploaded",s.percent))}}(this))},r.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",function(t){return function(r,s,o){var n,i;return i=t.idToUploadIdMap[s.id],n=b.fileList().get(i),e(n,o)}}(this))},r.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",function(t){return function(r,s){var o,n,i,a;if(null==s.file)throw new Error("PLU error without an associated file.");return n=function(){switch(s.code){case P.FILE_SIZE_ERROR:return g.FILE_SIZE_ERROR;case P.HTTP_ERROR:return 0===s.status?g.CONNECTION_ERROR:507===s.status?g.OVER_QUOTA_ERROR:g.HTTP_ERROR;default:return g.GENERIC}}(),o=function(){switch(n){case g.OVER_QUOTA_ERROR:return y("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case g.FILE_SIZE_ERROR:return y("This file is too large to upload using the Dropbox website. Please use the desktop client.");case g.HTTP_ERROR:return y("Something went wrong while uploading this file. There was a server error during the upload request. If the problem persists, please try the basic uploader.");case g.CONNECTION_ERROR:return y("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return y("Something went wrong while uploading this file. If the problem persists, please try the basic uploader.")}}(),a=t.idToUploadIdMap[s.file.id],i=b.fileList().has(a)?b.fileList().get(a):w(s.file,{uploadId:T(),dest:b.path()}),e(i,n,o)}}(this))},r.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},r.prototype.removeFiles=function(e){var t,r,s,o,i;for(r=e.files,this.isInitialized||this.init(),s=0,o=r.length;o>s;s++)t=r[s],i=n.find(this.uploader.files,function(e){return function(r){return e.idToUploadIdMap[r.id]===t.uploadId}}(this)),this.uploader.removeFile(i);return this.uploader.stop(),this.uploader.start()},r}(),_=new f})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/uploader",["jquery","external/immutable","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/browse_interface","modules/clean/browse/browse_drag_utils","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react/button","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/env","modules/constants/request","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N,A,R,x,M,O,L,k){var B,U,H,q,G,W,j,V,z,Q,K,Y,X,$,J,Z,ee,te,re,se,oe,ne,ie,ae,le,ue,ce,pe,de,he,me,_e,fe,ge,be,ve,ye;return ue=a.get_browse_root_name,re=a.browse_uri_for_fq_path,se=m.button,de=m.link_button,U=f.BrowseLogger,B=f.BrowseLogEventSources,H=g.BrowseStore,$=b.UploaderActions,J=v.UploaderStore,G=v.FileUpload,q=v.FileStatus,X=v.UploadErrorType,V=v.INTERNAL_FILE_DATA_TRANSFER_TYPE,Q=T.Modal,_e=P.reactFormat,K=E.Tooltip,Y=E.TooltipPosition,be=I.static_url,Z=O._,ye=O.ungettext,oe=o.createElement,fe=o.DOM,ie=fe.div,te=fe.a,ve=fe.ul,he=fe.ol,pe=fe.li,ge=fe.span,ce=fe.input,le=fe.form,me=fe.p,ne=o.DOM,ee=function(e){var t,r,s,o,n,i,a,l;return null==e&&(e={}),a=e.user,s=e.path,r=null!=(o=e.maxLength)?o:1e3,l=C.get_viewer(),l.is_paired&&a.is_team&&(i=p.em_snippet(l.team_name,r)),n="/"===s?l.is_paired?a.is_team?Z(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:i}):Z(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):Z(" upload to your Dropbox"):(t=p.em_snippet(d.filename(s),r),l.is_paired?a.is_team?Z(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:i}):Z(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):Z(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},j=o.createClass({displayName:"FileUploaderModal",mixins:[h(J)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:o.PropTypes.bool,shouldShowDestinationLink:o.PropTypes.bool,onModalDismissed:o.PropTypes.func,clickOutToClose:o.PropTypes.bool,sendNS:o.PropTypes.bool,isTeamOnboarding:o.PropTypes.bool},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,isTeamOnboarding:!1}},getInitialState:function(){return{isBasicOverquotaUser:!1,isLimitedTeamOverquotaUser:!1,usingBasicUploader:!1,basicUploaderFile:null}},_get_state_from_stores:function(){return{path:J.path(),ns_id:H.context().currentNSID,ns_path:H.context().currentNSPath,user:J.user(),fileList:J.fileList(),numDraggingFiles:J.numDraggingFiles(),currentUpload:J.currentUpload(),numSecondsLeft:J.numSecondsLeft(),hasPermissionToUploadToFolder:J.hasPermissionToUploadToFolder()}},componentDidMount:function(){var e;return this._setBrowseButton(),t(window).on("resize.uploaderModal",function(e){return function(){return e._setBrowseButton()}}(this)),e=A.quota_fraction>1&&0===this.state.user.paid,this.setState({isBasicOverquotaUser:this.state.user.role===A.ROLE_PERSONAL&&e}),this.state.user.role===A.ROLE_WORK?(H.add_change_listener(this._handleBrowseStoreChanged),this._handleBrowseStoreChanged()):void 0},_handleBrowseStoreChanged:function(){var e,t,r;return e=H.context(),e.cdmMveQuotaStats&&e.isInsideTeamFolderTree?(r=e.cdmMveQuotaStats,t=r.quotaRawBytesUsed>r.quotaRawBytes):t=A.quota_fraction>1&&0===this.state.user.paid,this.setState({isLimitedTeamOverquotaUser:t})},componentDidUpdate:function(e,r){var s,o,i,a,l;return this._setBrowseButton(),this.state.numDraggingFiles?this.state.usingBasicUploader?L.error("You can‖t drag and drop upload right now."):(s=t(n.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+this.DROPZONE_ID),s.length||t("#"+this.DROPZONE_ID).clone().prependTo(t(n.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):t(n.findDOMNode(this.refs.modal)).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>r.fileList.count()&&(a=t(n.findDOMNode(this.refs.uploadFilesList)),o=null!=(l=a.find(".upload-file"))?l.eq(r.fileList.count()):void 0,o.length&&a.scrollTop(a.scrollTop()+o.position().top)),i=t(n.findDOMNode(this)),i.find(".basic-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!0})}}(this)),i.find(".enhanced-uploader-link").off("click.switchUploader").on("click.switchUploader",function(e){return function(t){return t.preventDefault(),e.setState({usingBasicUploader:!1})}}(this))},componentWillUnmount:function(){return y.setBrowseButton(null),t(window).off("resize.uploaderModal"),this.state.user.role===A.ROLE_WORK?H.remove_change_listener(this._handleBrowseStoreChanged):void 0},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_setBrowseButton:function(){return y.setBrowseButton(n.findDOMNode(this.refs.pluFileChooseButton))},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===q.PENDING||t===q.UPLOADING}),t||$.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),$.setIsUploadModalOpen({isUploadModalOpen:!1}),Q.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return $.cancelUploads({files:[e]})},_handleBasicChooseButtonMouseClick:function(e){return null!=this.refs.fileInput?t(n.findDOMNode(this.refs.fileInput)).click():void 0},_handleBasicFileInputChange:function(e){var t,r,s,o,i,a;return U.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"basic",upload_method:"chooser"}),s=n.findDOMNode(this.refs.fileInput),r=null!=(o=s.files)&&"function"==typeof o.item?o.item(0):void 0,a=s.value,null!=r?(i={name:r.name,size:r.size,userId:this.state.user.id,percentUploaded:100,status:q.UPLOADING},this.props.sendNS?(i.ns_id=this.state.ns_id,i.ns_path=this.state.ns_path+"/"+r.name):i.dest=this.state.path,this.setState({basicUploaderFile:new G(i)},function(e){return function(){return n.findDOMNode(e.refs.basicUploadForm).submit()}}(this))):null!=a?(t="C:\\fakepath\\",0===a.indexOf(t)?this.setState({basicUploaderFile:new G({name:a.slice(t.length),size:null,dest:this.state.path,userId:this.state.user.id,percentUploaded:100,status:q.UPLOADING})},function(e){return function(){return n.findDOMNode(e.refs.basicUploadForm).submit()}}(this)):n.findDOMNode(this.refs.basicUploadForm).submit()):void 0},_renderIntroModalButtons:function(){var e,t,r;return e=ne.div({className:"u-font-small"},this.state.isBasicOverquotaUser?_e(Z("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:ne.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}):this.state.isLimitedTeamOverquotaUser?_e(Z("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:ne.a({className:"overquota-uploader-link",href:"/team/upgrade?_tk=over_quota&_camp=upload_modal&oqa=upl"})}):null!=this.state.basicUploaderFile?Z("This may take a while depending on the size of the file."):this.state.usingBasicUploader?_e(Z("Uploading multiple files? Try our <enhancedUploaderLink>enhanced uploader</enhancedUploaderLink>."),{enhancedUploaderLink:ne.a({href:"#",className:"enhanced-uploader-link"})}):_e(Z("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:ne.a({href:"#",className:"basic-uploader-link"})})),t=null,r=null,this.state.isBasicOverquotaUser?t=oe(de,{className:"dbmodal-button c-btn c-btn--primary",href:"/pro/buy?oqa=upl_b"},Z("Upgrade to Upload")):this.state.isLimitedTeamOverquotaUser?t=oe(de,{className:"dbmodal-button c-btn c-btn--primary",href:"/team/upgrade?_tk=over_quota&_camp=upload_modal&oqa=upl_b"},Z("Upgrade to Upload")):this.state.usingBasicUploader?null==this.state.basicUploaderFile&&(t=ne.button({className:"dbmodal-button c-btn c-btn--primary",onClick:this._handleBasicChooseButtonMouseClick},Z("Choose a file"))):t=ne.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},Z("Choose files")),null==this.state.basicUploaderFile&&(r=ne.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},Z("Cancel"))),this.state.isBasicOverquotaUser||this.state.isLimitedTeamOverquotaUser?ne.div({className:"u-mar-vertical-l clearfix"},ne.div({className:"u-l-fr"},t,r,ne.div({id:"upload-overquota-banner",className:"c-banner c-banner--warning"},e))):ne.div({className:"u-mar-top-l"},oe(w,{spacing:"s",rightAttachment:ne.div({},t,r)},e))},_renderFileListModalButtons:function(){var e,t,r,s;return r=this.state.fileList.find(function(e){var t;return(t=e.status)===q.PENDING||t===q.UPLOADING}),t=r?"tertiary":"primary",s=ne.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},Z("Add more files")),e=ne.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},Z(r?"Hide":"Done")),ne.div({className:"u-mar-top-s"},oe(w,{leftAttachment:s,rightAttachment:e,spacing:"s"},ne.div({className:"u-font-small"},r?void 0:_e(Z("Having problems? Try the <basicUploaderLink>basic uploader</basicUploaderLink>."),{basicUploaderLink:ne.a({href:"#",className:"basic-uploader-link"})}))))},_renderIntroMessage:function(){var e,t,r,s;return r=ee({user:this.state.user,path:this.state.path}),ne.span({},this.state.isBasicOverquotaUser||this.state.isLimitedTeamOverquotaUser?Z("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.state.usingBasicUploader?Z("Choose a file to %(upload_folder_name)s. The basic uploader can only upload one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):this.props.isTeamOnboarding?(s=C.get_viewer(),e=1e3,t=p.em_snippet(s.team_name,e),Z("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:t})):this.props.dragAndDropEnabled?Z("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):Z("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}))},_renderDropzone:function(){return ne.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},ne.div({},ye("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:ee({user:this.state.user,path:this.state.path,maxLength:20})})))},_renderFileListRowStatus:function(e){var t;return ne.div({className:"status-col"},e.status===q.UPLOADING&&100===e.percentUploaded?oe(S,{src:be("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:be("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===q.PENDING||t===q.UPLOADING?ne.button({className:"button-as-link",onClick:function(t){return function(r){return r.preventDefault(),t._handleCancel(e)}}(this)},oe(D,{group:"web",name:"xclose",alt:Z("Cancel")})):e.status===q.COMPLETE?oe(D,{group:"web",name:"s_check",alt:Z("Upload successful")}):e.status===q.CANCELLED?oe(S,{src:be("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:be("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:Z("Upload cancelled")}):e.status===q.FAILED?oe(S,{src:be("/static/images/nosync-vfl18cuTS.png"),srcHiRes:be("/static/images/nosync@2x-vflgS4F07.png"),alt:Z("Error")}):void 0)},_renderFileListRowError:function(e){var t,r;return t=(null!=(r=e.errorMessage)?r.length:void 0)>0?e.errorMessage:Z("Something went wrong while uploading this file. If the problem persists, please try the basic uploader."),ne.div({className:"error-col"},ne.span({className:"error-msg"},Z(e.errorType===X.FILE_SIZE_ERROR?"File too large":"Upload Error")),ne.span({className:"error-details"},oe(K,{position:Y.RIGHT,tooltip_contents:ne.div({},t),tooltip_classname:"upload-error-tooltip"},oe(D,{group:"web",name:"information",alt:Z("More information")}))))},_renderFileListRowDest:function(e){var t,r;return ne.div({className:"dest-col"},e.status===q.CANCELLED?Z("Canceled"):(r=C.get_viewer().get_user_by_id(e.userId),t=ue(r),ne.a({href:re(r,e.dest).toString()},p.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(e,t){var r,o;return r=e.status===q.UPLOADING?e.percentUploaded:e.status===q.PENDING?0:100,o={"upload-file":!0,complete:e.status===q.COMPLETE,cancelled:e.status===q.CANCELLED,error:e.status===q.FAILED},ne.li({className:s(o),key:e.uploadId},ne.div({className:"upload-progress-bar",style:{width:r+"%"}}),ne.div({className:"upload-file-info",style:{overflow:"hidden"}},ne.div({className:"filename-col"},oe(D,{group:"web",name:d.file_icon(e.name),alt:""}),ne.span({className:"filename"},p.em_snippet(e.name,this.FILENAME_SNIPPET_LENGTH)),null!=e.size?ne.span({className:"size"}," - ",c.format_bytes(e.size)):void 0),e.status!==q.FAILED?t?this._renderFileListRowDest(e):void 0:this._renderFileListRowError(e),this._renderFileListRowStatus(e)))},_renderFileList:function(e,t){var r,s,o;return o=null!=(s=(null!=t?t:{}).shouldShowDestinationLink)?s:!0,ne.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,s,n;for(n=[],t=0,s=e.length;s>t;t++)r=e[t],n.push(this._renderFileListRow(r,o));return n}.call(this))},_renderTimeLeft:function(){var e;return e=this.state.currentUpload,null!=e&&e.status===q.UPLOADING?ne.div({style:{marginTop:8,textAlign:"right"}},Z("%(time_left)s left").format({time_left:u.format_time(this.state.numSecondsLeft)})):void 0},_renderBasicUploaderForm:function(){return ne.form({id:"basic-upload-form",ref:"basicUploadForm",encType:"multipart/form-data",noValidate:"novalidate",method:"post",action:"https://"+F.BLOCK_CLUSTER+"/upload"},ne.input({type:"hidden",name:"t",value:x.read(N.JS_CSRF_COOKIE)}),ne.input({type:"hidden",name:"_subject_uid",value:this.state.user.id}),ne.input({type:"hidden",name:"plain",value:"yes"}),ne.input({type:"hidden",name:"dest",value:this.state.path}),this.props.sendNS?[ne.input({type:"hidden",name:"ns_id",value:this.state.ns_id}),ne.input({type:"hidden",name:"ns_path",value:this.state.ns_path})]:void 0,ne.input({type:"file",name:"file","aria-label":Z("Upload file"),tabIndex:"-1",style:{display:"none"},ref:"fileInput",onChange:this._handleBasicFileInputChange}))},render:function(){var e;return e=Z(this.props.isTeamOnboarding?"Which files would you like to add?":"Upload to Dropbox"),ne.div({ref:"container"},this._renderDropzone(),oe(Q,{ref:"modal",title:e,showX:!1,clickOutToClose:this.props.clickOutToClose,buttonComponent:0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:function(e){return function(t){return null!=e.state.basicUploaderFile?void t.preventDefault():$.setIsUploadModalOpen({isUploadModalOpen:!1})}}(this)},this.state.usingBasicUploader?this._renderBasicUploaderForm():void 0,null!=this.state.basicUploaderFile?this._renderFileList([this.state.basicUploaderFile],{shouldShowDestinationLink:!1}):0===this.state.fileList.count()||this.state.usingBasicUploader?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()))}}),z=o.createClass({displayName:"InlineUploadStatus",propTypes:{fileList:o.PropTypes.instanceOf(r.OrderedMap).isRequired,currentUpload:o.PropTypes.instanceOf(G),numSecondsLeft:o.PropTypes.number,onViewDetails:o.PropTypes.func},FILENAME_SNIPPET_LENGTH:30,_getOverallUploadState:function(){return this.props.fileList.find(function(e){var t;return(t=e.status)===q.PENDING||t===q.UPLOADING})?"uploading":this.props.fileList.find(function(e){return e.status===q.FAILED})?"error":"complete"},_getProgressBarWidth:function(){var e;return e=this._getOverallUploadState(),"uploading"===e&&null!=this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},_getNumPendingFiles:function(){return this.props.fileList.count(function(e){return e.status===q.PENDING})},_getNumCompletedFiles:function(){return this.props.fileList.count(function(e){return e.status===q.COMPLETE})},_getNumNoncancelledFiles:function(){return this.props.fileList.count(function(e){return e.status!==q.CANCELLED})},_getNumErrors:function(){return this.props.fileList.count(function(e){return e.status===q.FAILED})},_renderIcon:function(){var e;return e=this._getOverallUploadState(),"uploading"===e?oe(D,{group:"web",name:"s_sync",alt:Z("Uploading")}):"complete"===e?oe(D,{group:"web",name:"s_check",alt:Z("Upload successful")}):oe(S,{src:be("/static/images/nosync-vfl18cuTS.png"),srcHiRes:be("/static/images/nosync@2x-vflgS4F07.png"),alt:Z("Error")})},_renderCloseButton:function(){return ne.button({className:"button-as-link",onClick:function(e){return e.preventDefault(),$.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})}},oe(D,{group:"web",name:"xclose",alt:Z("Close")}))},_renderViewDetailsLink:function(){var e;return e=this._getNumPendingFiles(),ne.span({className:"details"}," - ",ne.button({className:"view-details button-as-link",onClick:function(e){return function(t){var r;return t.preventDefault(),"function"==typeof(r=e.props).onViewDetails?r.onViewDetails():void 0}}(this)},e>0?ye("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e}):Z("View details")))},_renderFileDescription:function(){var e,t,r,s;return s=this._getOverallUploadState(),r=this._getNumNoncancelledFiles(),t=this._getNumErrors(),ne.span({className:"file-desc"},null!=this.props.currentUpload?Z("Uploading %(filename)s").format({filename:p.em_snippet(this.props.currentUpload.name,this.FILENAME_SNIPPET_LENGTH)}):"uploading"===s?Z("Starting upload..."):"complete"===s?r>1?Z("Uploaded %(num_files)d files").format({num_files:r}):Z("Uploaded %(filename)s").format({filename:p.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):"error"===s?r>1?[Z("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this._getNumCompletedFiles(),num_files:r})," ",ne.span({className:"num-errors"},ye("- %d error","- %d errors",t).format(t))]:(e=this.props.fileList.last().errorType,e===X.GENERIC?Z("Unable to upload %(filename)s").format({filename:p.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH)}):Z("Unable to upload %(filename)s: %(reason)s").format({filename:p.em_snippet(this.props.fileList.last().name,this.FILENAME_SNIPPET_LENGTH),reason:function(){switch(e){case X.OVER_QUOTA_ERROR:return Z("over quota");case X.FILE_SIZE_ERROR:return Z("file too large");case X.CONNECTION_ERROR:return Z("lost connection");case X.HTTP_ERROR:return Z("server error");case X.EMPTY_OR_FOLDER:return Z("can’t upload folders or empty files");case X.PACKAGE_FILE:return Z("OSX package file")}}()})):void 0)},render:function(){var e,t;return e=this._getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e},ne.div({id:"inline-upload-status",className:s(t)},ne.div({className:"inline-upload-info"},ne.div({className:"icon"},this._renderIcon()),ne.div({className:"files-info"},this._renderFileDescription(),ne.span({className:"num-errors"}),this._renderViewDetailsLink()),ne.div({
className:"status"},"uploading"===e&&null!=this.props.numSecondsLeft?Z("%(time_left)s left").format({time_left:u.format_time(this.props.numSecondsLeft)}):this._renderCloseButton())),ne.div({className:"inline-upload-bar"},ne.div({className:"inline-upload-progress",style:{width:this._getProgressBarWidth()+"%"}})))}}),ae=null,W=o.createClass({displayName:"FileUploader",mixins:[h(J)],propTypes:{dragAndDropEnabled:o.PropTypes.bool,shouldShowDestinationLink:o.PropTypes.bool,onFileUploadComplete:o.PropTypes.func,onAllFileUploadsComplete:o.PropTypes.func,onModalDismissed:o.PropTypes.func,clickOutToClose:o.PropTypes.bool,sendNS:o.PropTypes.bool},statics:{showModal:function(){return ae?ae.showModal():void console.warn("Tried to show the file upload modal, but no FileUploader component has been instantiated on the page yet.")},showModalWithTeamOnboarding:function(){return ae?ae.setState({isTeamOnboarding:!0},ae.showModal):void 0}},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onFileUploadComplete:function(){},onAllFileUploadsComplete:function(){},onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1}},getInitialState:function(){return{isTeamOnboarding:!1}},_get_state_from_stores:function(){return{path:J.path(),ns_id:H.context().currentNSID,ns_path:H.context().currentNSPath,user:J.user(),fileList:J.fileList(),numDraggingFiles:J.numDraggingFiles(),isInternalTransfer:J.isInternalTransfer(),currentUpload:J.currentUpload(),isUploadModalOpen:J.isUploadModalOpen(),numSecondsLeft:J.numSecondsLeft(),isInlineStatusDismissed:J.isInlineStatusDismissed(),hasPermissionToUploadToFolder:J.hasPermissionToUploadToFolder()}},INLINE_STATUS_CONTAINER_CLASS:"inline-upload-status-container",showModal:function(){return Q.showInstance(oe(j,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,isTeamOnboarding:this.state.isTeamOnboarding,sendNS:this.props.sendNS})),$.setIsUploadModalOpen({isUploadModalOpen:!0})},componentWillMount:function(){if(ae)throw new Error("Only one FileUploader component may be rendered to the page at any time. You have tried to instantiate multiple uploaders.");return ae=this},componentDidMount:function(){var r;return $.initPLU(),$.setSendNS(this.props.sendNS),this.dragEnterCount=0,this.lastEnteredElement=null,r=t(document),r.on("dragover.fileUploader",function(e){return e.preventDefault(),e.stopPropagation()}).on("dragenter.fileUploader",function(t){return function(r){var s,o,n,a;return r.preventDefault(),r.stopPropagation(),r.target!==t.lastEnteredElement?(t.lastEnteredElement=r.target,t.dragEnterCount+=1,n=function(){var e;try{return null!=(e=r.originalEvent.dataTransfer.mozItemCount)?e:Object.keys(r.originalEvent.dataTransfer.items).length}catch(e){return 1}}(),a=r.originalEvent.dataTransfer.types,s=["Files","application/x-moz-file",V,"text/x-moz-url","text/uri-list","Url"],null!=a&&(null!=a.indexOf&&i.intersection(a,s).length>0||a instanceof DOMStringList&&(a.contains("Files")||a.contains("text/x-moz-url")||a.contains(V)||R.msie&&(a.contains("Text")||a.contains("text/plain"))))?(o=e.call(a,V)>=0||e.call(a,"text/plain")>=0||a instanceof DOMStringList&&(a.contains("Text")||a.contains("text/plain")),$.setNumDraggingFiles({numDraggingFiles:n,isInternalTransfer:o})):void 0):void 0}}(this)).on("dragleave.fileUploader",function(e){return function(t){return t.preventDefault(),t.stopPropagation(),e.lastEnteredElement=null,e.dragEnterCount-=1,e.dragEnterCount<1?(e.dragEnterCount=0,$.setNumDraggingFiles({numDraggingFiles:0})):void 0}}(this)).on("drop.fileUploader",this._handleFileDrop),t("<div>").addClass(this.INLINE_STATUS_CONTAINER_CLASS).prependTo(t("#page-content")),t(window).on("beforeunload.fileUploader",function(e){return function(t){var r,s;return r=null!=e.state.fileList.find(function(e){var t;return(t=e.status)===q.PENDING||t===q.UPLOADING}),r&&e.state.fileList.count()>0?(s=Z("Leaving this page will cancel your uploads."),t.returnValue=s,s):void 0}}(this))},updateInlineStatus:function(){var e,r,s,o;return o=null!=this.state.fileList.find(function(e){var t;return(t=e.status)===q.PENDING||t===q.UPLOADING}),s=!this.state.isUploadModalOpen&&(o||this.state.fileList.count()>0&&!o&&!this.state.isInlineStatusDismissed),e=t("."+this.INLINE_STATUS_CONTAINER_CLASS),s?n.render(oe(z,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this._handleInlineStatusViewDetails,numSecondsLeft:this.state.numSecondsLeft}),e[0]):(r=e[0])?n.unmountComponentAtNode(r):void 0},componentWillUpdate:function(e,t){var r,s,o;return null==t.currentUpload&&null!=this.state.currentUpload&&"function"==typeof(r=this.props).onFileUploadComplete&&r.onFileUploadComplete(this.state.currentUpload),t.fileList!==this.state.fileList&&(o=null!=t.fileList.find(function(e){var t;return(t=e.status)===q.PENDING||t===q.UPLOADING}),!o&&t.fileList.count()>0)&&"function"==typeof(s=this.props).onAllFileUploadsComplete?s.onAllFileUploadsComplete(this.state.fileList):void 0},componentDidUpdate:function(e,r){var s,o;return s=t(".external-drop-indicator"),this.state.numDraggingFiles&&!this.state.isInternalTransfer?(r.numDraggingFiles||s.css("opacity",0).fadeTo(500,.6),this.state.hasPermissionToUploadToFolder?s.removeClass("external-drop-indicator--uploads-disabled"):s.addClass("external-drop-indicator--uploads-disabled"),this.state.isUploadModalOpen||(this.state.hasPermissionToUploadToFolder?(o=Z("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:ee({user:this.state.user,path:this.state.path})}),L.success(o,60)):L.error(Z("You don’t have permission to add to this folder.")))):!this.state.numDraggingFiles&&r.numDraggingFiles&&(s.hide().removeClass("external-drop-indicator--uploads-disabled"),L.clear()),this.updateInlineStatus()},componentWillUnmount:function(){return t(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),t("."+this.INLINE_STATUS_CONTAINER_CLASS).remove(),t(window).off("beforeunload.fileUploader"),ae=null},_handleFileDrop:function(e){var t,r,s,o,n,i,a,u,c,p,d,h,m,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N;if(e.preventDefault(),e.stopPropagation(),this.dragEnterCount=0,this.lastEnteredElement=null,$.setNumDraggingFiles({numDraggingFiles:0}),t=e.originalEvent.dataTransfer,r=R.msie?"text":"application/x-dropbox-file-list",g=t.getData(r),null!=g)try{if(I=JSON.parse(g),N=I.userId,m=I.fromPath,p=I.filePaths,(null!=p?p.length:void 0)>0&&null!=m&&null!=N)return this.state.hasPermissionToUploadToFolder?N!==this.state.user.id?void L.error(Z("You can’t move or copy files here from another Dropbox.")):(F=e.ctrlKey||e.altKey,F?_.copyFiles({files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path}):m!==this.state.path&&(U.logMoveFiles({uid:N,path:m,files:p,newPath:this.state.path,source:B.DRAG}),_.moveFiles({path:m,files:p.map(function(e){return{fq_path:e}}),newPath:this.state.path})),void $.setPath({path:H.path()})):void L.error(Z("You don’t have permission to add to this folder."))}catch(e){}if(this.state.hasPermissionToUploadToFolder){if(o=l.getDraggedLink(t),null!=o)return E=l.buildUrlLinkfileContents(o),D=new Blob([E],{type:"text/plain"}),P=k.parse(o).getAuthority(),D.name=P+".url",D.overwrite=!1,U.logUploadFile({uid:this.state.user.id,num_files:1,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),void $.addFilesToPLU({files:[D]});if(v=t.items,d=t.files,null!=(null!=v&&null!=(C=v[0])?C.webkitGetAsEntry:void 0)){for(i=function(){var e,t,r;for(r=[],f=e=0,t=v.length;t>=0?t>e:e>t;f=t>=0?++e:--e)r.push(v[f].webkitGetAsEntry());return r}(),u=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)n=i[e],(null!=n?n.isFile:void 0)&&r.push(n);return r}(),s=function(){var e,t,r;for(r=[],e=0,t=i.length;t>e;e++)n=i[e],(null!=n?n.isDirectory:void 0)&&r.push(n);return r}(),U.logUploadFile({uid:this.state.user.id,num_files:u.length,num_dirs:s.length,uploader_type:"drag",upload_method:"drag"}),y=0,S=u.length;S>y;y++)c=u[y],c.file(function(e){return $.addFilesToPLU({files:[e]})});if(s.length>0)return $.addDirectoriesToPLU({directoryEntries:s})}else if(null!=(null!=d?d.length:void 0)){for(b=function(e){return null!=e&&null!=e.type&&null!=e.size&&""===e.type&&e.size%4096===0},d=function(){var e,t,r;for(r=[],f=e=0,t=d.length;t>=0?t>e:e>t;f=t>=0?++e:--e)r.push(d.item(f));return r}(),h=function(e){return function(){var t;return b(a)?(t=new FileReader,t.onerror=function(){var t,r;return t=null!=(r=e.state.fileList.find(function(e){var t;return((t=e.status)===q.PENDING||t===q.UPLOADING)&&e.name===a.name}))?r.toJS():void 0,null!=t?$.manuallySetInErrorState({file:t,errorType:X.EMPTY_OR_FOLDER,errorMessage:Z("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}):void 0},t.readAsArrayBuffer(a)):void 0}}(this),w=0,T=d.length;T>w;w++)a=d[w],h();return U.logUploadFile({uid:this.state.user.id,num_files:d.length,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),$.addFilesToPLU({files:d})}}},_handleInlineStatusViewDetails:function(){return this.showModal()},render:function(){return ne.div({})}}),{FileUploader:W}})}.call(this),function(){define("modules/clean/react/maestro_feedback",["external/react","external/react-dom","modules/clean/ajax","modules/clean/react/modal","modules/core/i18n","modules/core/notify"],function(e,t,r,s,o,n){var i,a,l,u,c,p;return u=r.WebRequest,l=s.Modal,c=o._,p=e.DOM,i=e.createClass({displayName:"MaestroFeedback",openModal:function(){return l.showInstance(e.createElement(a))},render:function(){return p.div({className:"c-card feedback-card"},p.h2({},c("Help make Dropbox better")),p.button({className:"c-btn c-btn--tertiary u-font-center u-mar-top-s u-mar-bottom-xs",onClick:this.openModal},c("Give Feedback")))}}),a=e.createClass({displayName:"MaestroFeedbackModal",closeModal:function(){return this.refs.modal?this.refs.modal.close():void 0},submitFeedback:function(){var e;return e=t.findDOMNode(this.refs.feedback).value,""===e?n.error(c("You haven't entered any feedback.")):(u({url:"/log/maestro_feedback",data:{feedback_text:e},success:function(){return n.info(c("Thanks for your feedback!"))}}),this.closeModal())},render:function(){var t;return t=p.button({className:"button-primary",onClick:this.submitFeedback},c("Send")),p.div({},e.createElement(l,{ref:"modal",title:c("Feedback"),onDismiss:this.closeModal,buttonComponent:t,className:"maestro-feedback-modal"},e.createElement("textarea",{ref:"feedback",className:"c-input feedback",rows:14,placeholder:"Tell us what you think of Dropbox on the web"})))},componentDidMount:function(){var e;return null!=(e=t.findDOMNode(this.refs.feedback))?e.focus():void 0}}),i})}.call(this),function(){define("modules/clean/react/maestro/top_menu_container",["external/react","modules/clean/viewer","modules/clean/react/css","modules/clean/react/account_menu/account_menu","modules/clean/search/search_bar","modules/clean/react/user_notifications/dropdown","modules/clean/react/browse/constants","modules/core/browser","modules/core/uri","modules/clean/react/browse/models"],function(e,t,r,s,o,n,i,a,l,u){var c,p,d,h,m,_;return d=i.SEARCH_PREFIX,c=u.File,p=u.Paper,_=e.DOM,m=e.createElement,h=e.createClass({displayName:"TopMenuContainer",propTypes:{user:e.PropTypes.object,viewer:e.PropTypes.object,user_id:e.PropTypes.number,showSearchBar:e.PropTypes.bool,currentPath:e.PropTypes.string,onSearch:e.PropTypes.func,onFileOrFolderOpen:e.PropTypes.func,limitedTeamBannerUpsell:e.PropTypes.bool,trademarkBusiness:e.PropTypes.string},getInitialState:function(){return{user:this.props.user||t.get_viewer().get_user_by_id(this.props.user_id),viewer:this.props.viewer||t.get_viewer()}},getDefaultProps:function(){return{showSearchBar:!0,currentPath:"/"}},role:function(){return this.state.user.role},onSearch:function(e){var t;return t=l({path:d+"/"+this.role()}),e?a.open_tab(t.updateQuery({path:this.props.currentPath,query:e})):a.open_tab(t.updateQuery({path:this.props.currentPath}))},onFileOrFolderOpen:function(e){var t,r;return e instanceof c?(t=e.fq_path.substring(1),r=l({path:"/"+this.role()}).updateQuery({preview:t}),a.open_tab(r)):e instanceof p?a.open_tab(e.url):void 0},render:function(){return _.div({className:"top-menu-container"},this.props.showSearchBar?m(o,{user:this.state.user,currentPath:this.props.currentPath,isPagelet:!0,isSearchActive:!1,onSearch:this.props.onSearch||this.onSearch,onFileOrFolderOpen:this.props.onFileOrFolderOpen||this.onFileOrFolderOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}):void 0,_.div({className:"notifications-widget-container"},m(n,{isPagelet:!0})),_.div({className:"account-menu-widget-container"},m(s,{user:this.state.user,viewer:this.state.viewer,onSelectUser:function(e,t){return ensemble.switchAccount(t)},showAccountSwitcher:!0,showNameOnButton:!1,arrowPosition:"top-right",openLinksInNewTab:!0,showProGiftingLink:!0,showProUpgradeLink:!0,isPagelet:!0})))}}),h=r(h,["/static/css/pagelet-vflGPSoo_.css"],[o,n]),{TopMenuContainer:h}})}.call(this),function(){define("modules/clean/react/pro/pro_onboarding_tour_modal",["external/react","jquery","external/classnames","modules/clean/ajax","modules/clean/react/button","modules/clean/react/css","modules/clean/react/image","modules/clean/react/modal"],function(e,t,r,s,o,n,i,a){var l,u,c,p,d,h,m,_;return l=a.Modal,m=e.createElement,_=r,h=e.addons.CSSTransitionGroup,d=e.createClass({displayName:"ProOnboardingWelcomeScreen",propTypes:{tourPaths:e.PropTypes.array,onTourPathChange:e.PropTypes.func,contentSource:e.PropTypes.object},getInitialState:function(){return{tourPath:null}},setTourPathState:function(e){return this.setState({tourPath:e}),this.props.onTourPathChange(e)},renderMainText:function(t){var r;return t instanceof Array?(r=t.map(function(r,s){return e.createElement("li",{key:s,className:"onboarding-panel__checkmark"},t[s])}),e.createElement("ul",{className:"onboarding-panel__list"},r)):e.createElement("p",null,t)},render:function(){var t;return t=this.props.tourPaths.map(function(t){return function(r,s){var n,a,l,u,c;return c=t.props.contentSource[r].welcome,n=c["image-path"],a=null!=c["image-path-retina"]?c["image-path-retina"]:n,l=s<t.props.tourPaths.length-1,u=_({"onboarding-panel__column":!0,"onboarding-panel__column--rb":l}),e.createElement("div",{key:s,className:u},e.createElement("h2",{className:"onboarding-panel__title"},c.title),e.createElement("div",{className:"onboarding-panel__image"},e.createElement(i,{src:n,srcHiRes:a})),e.createElement("div",{className:"onboarding-panel__content"},t.renderMainText(c["main-text"])),e.createElement(o.link_button,{onClick:t.setTourPathState.bind(t,r),className:"onboarding-panel__button c-btn c-btn--primary"},c["button-text"]))}}(this)),e.createElement("div",{className:"onboarding-panel onboarding-panel--welcome"},t)}}),u=e.createClass({displayName:"ProOnboardingFeatureContent",propTypes:{tourStep:e.PropTypes.number,className:e.PropTypes.string,contentSource:e.PropTypes.object.isRequired,handleFeatureLinkClick:e.PropTypes.func},render:function(){var t,r,s;return t=_({"onboarding-panel__image":!0,"onboarding-panel__image--center":!0,"onboarding-panel__image--b":!0}),r=this.props.contentSource["image-path"],s=null!=this.props.contentSource["image-path-retina"]?this.props.contentSource["image-path-retina"]:r,e.createElement("div",{key:this.props.tourStep,className:"onboarding-panel__column"},e.createElement("h2",{className:"onboarding-panel__title"},this.props.contentSource.title),e.createElement("div",{className:t},e.createElement(i,{src:r,srcHiRes:s})),e.createElement("div",{className:"onboarding-panel__text"},this.props.contentSource["main-text"]),e.createElement(o.link_button,{className:"onboarding-panel__button c-btn c-btn--primary",href:this.props.contentSource["button-href"],target:"_blank",onClick:this.props.handleFeatureLinkClick},this.props.contentSource["button-text"]))}}),c=e.createClass({displayName:"ProOnboardingNavigation",propTypes:{handleTourForward:e.PropTypes.func,handleTourBackward:e.PropTypes.func,handleTourEnd:e.PropTypes.func,atTourEnd:e.PropTypes.bool},render:function(){var t,r;return r=e.createElement("div",{className:"onboarding-panel__nav--next",onClick:this.props.handleTourForward}),this.props.atTourEnd&&(t=_({"c-btn":!0,"c-btn--secondary":!0,"c-btn--big":!0,"c-btn--full":!0,"onboarding-panel__button":!0,"onboarding-panel__nav--fin":!0}),r=e.createElement("button",{onClick:this.props.handleTourEnd,className:t},"Go to my Dropbox")),e.createElement("div",{className:"onboarding-panel__nav"},e.createElement("div",{className:"onboarding-panel__nav--prev",onClick:this.props.handleTourBackward}),r)}}),p=e.createClass({displayName:"ProOnboardingTourModal",propTypes:{className:e.PropTypes.string,modalId:e.PropTypes.string.isRequired,onboardingPaths:e.PropTypes.array.isRequired,contentSource:e.PropTypes.object.isRequired},statics:{renderWithProps:function(e){var r,s,o;return r=n(p,["/static/css/payments/pro_trial_onboarding_tour-vfl8U7rsY.css"]),o={style:"lightbox",onDismiss:t("#pro-trial-tour-header-bubble").removeClass("force-hidden")},s=m(r,e),l.showInstance(m(l,o,s))}},getInitialState:function(){return{tourStep:0,tourPath:null,tourPathNumStep:null,atTourStart:!0,atTourEnd:!1}},onTourPathChange:function(e){var t;return t={selected_path:e},this._log("pro_onboarding_path_selected",t),this.setState({tourPath:e,atTourStart:!1,tourPathNumStep:this.props.contentSource[e].features.length-1})},tourForward:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_forward",e),this.setState({tourStep:this.state.tourStep+1,atTourStart:!1,atTourEnd:this.state.tourStep===this.state.tourPathNumStep-1})},tourBackward:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_backward",e),0===this.state.tourStep?this.setState({atTourStart:!0}):this.setState({tourStep:this.state.tourStep-1,atTourEnd:!1})},tourEnd:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_finish",e),l.close()},logLinkClick:function(){var e;return e={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_link_click",e)},_log:function(e){return function(e,t){return s.WebRequest({url:"/pro/trial_onboarding_tour_log",data:{evt:e,extra_data:JSON.stringify(t)}})}}(this),render:function(){var t,r;return r=[],this.state.atTourStart?(t={selected_path:this.state.tourPath,tour_step:this.state.tourStep},this._log("pro_onboarding_tour_start",t),r.push(e.createElement(d,{key:"onboardingWelcome",contentSource:this.props.contentSource,tourPaths:this.props.onboardingPaths,onTourPathChange:this.onTourPathChange}))):r.push(e.createElement(h,{component:"div",transitionName:"fade",transitionLeave:!1},e.createElement(u,{key:this.state.tourPath+"-"+this.state.tourStep,tourStep:this.state.tourStep,handleFeatureLinkClick:this.logLinkClick,contentSource:this.props.contentSource[this.state.tourPath].features[this.state.tourStep]})),e.createElement(c,{key:"onboardingNav",atTourEnd:this.state.atTourEnd,handleTourForward:this.tourForward,handleTourBackward:this.tourBackward,handleTourEnd:this.tourEnd})),e.createElement("div",{id:this.props.modalId,className:this.props.className},r)}}),{ProOnboardingTourModal:p,ProOnboardingFeatureContent:u,ProOnboardingNavigation:c,ProOnboardingWelcomeScreen:d}})}.call(this),function(){define("modules/clean/react/prompt/react_ha",["external/react","external/react-dom","modules/clean/upsell/prompt_event_emitter"],function(e,t,r){var s,o;return o=e.DOM,s=e.createClass({displayName:"ReactHA",getInitialState:function(){return{ha:null}},componentDidMount:function(){var e;return e=function(e){return function(t){return e.setState({ha:t})}}(this),r.Emitter.addListener(r.Events.HA_LOADED,e),this.setState({ha:document.querySelector("#ha-silo .ha")})},componentDidUpdate:function(){var e,s;return s=t.findDOMNode(this.refs.haContainer),e=s.querySelector(".ha"),r.Emitter.emit(r.Events.REACT_HA_DID_UPDATE,e)},render:function(){return o.div({id:"ha-container",ref:"haContainer",dangerouslySetInnerHTML:{__html:this.state.ha&&this.state.ha.outerHTML}})}})})}.call(this),function(){define("modules/clean/react/sharing/shared_with_view",["external/classnames","external/react","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/react/browse/models","modules/clean/sharing/member_avatars","modules/clean/sharing/ui_util","modules/clean/static_urls","modules/clean/viewer","modules/constants/viewer","modules/core/i18n"],function(e,t,r,s,o,n,i,a,l,u,c,p,d){var h,m,_,f,g,b,v,y,w,S,T,P;return m=s.AVATAR_DIMENSION_BY_SIZE,f=i.File,g=l.GoldenGate,P=u.static_url,w=d._,T=t.DOM,S=t.createElement,b=5,h=m.SMALL,_=12,v="--",y=t.createClass({displayName:"SharedWithView",mixins:[a],propTypes:{user:t.PropTypes.object.isRequired,file:t.PropTypes.instanceOf(f),onOverflowCountClick:t.PropTypes.func,onAvatarClick:t.PropTypes.func,groups:t.PropTypes.array,invitations:t.PropTypes.array,joinedMembers:t.PropTypes.array,numUndisplayableUsersAndInvites:t.PropTypes.number,numInheritedMembers:t.PropTypes.number,parentFolderName:t.PropTypes.string,animation:t.PropTypes.bool,titleButtonDirection:t.PropTypes.string,avatarDimension:t.PropTypes.number,maxVisibleAvatars:t.PropTypes.number,sharedLinkInfo:t.PropTypes.object,onSharedLinkClick:t.PropTypes.func,isPagelet:t.PropTypes.bool,isInAudienceBox:t.PropTypes.bool,audienceDescription:t.PropTypes.string,hasSharedDataLoaded:t.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:"south",avatarDimension:h,maxVisibleAvatars:b,file:null}},render:function(){return this.props.isInAudienceBox&&g.hasAudienceBox(this.props.user.id)?T.div({className:this.getClassName()},this.props.hasSharedDataLoaded?this.renderAudienceBoxAvatars():S(o,{style:o.LoadingIndicatorStyle.DOTS})):this.props.isPagelet&&g.hasAudienceBox(this.props.user.id)?T.div({className:this.getClassName()},this.props.sharedLinkInfo?this.renderSharedLinkInColumn():void 0,this.renderAudienceDescription()):T.div({className:this.getClassName()},this.renderAvatars())},getClassName:function(){return e({"shared-with-members":!0,"shared-with-members--golden-gate":g.hasNewMembershipUI(this.props.user.id),clearfix:!0})},renderSharedLinkInColumn:function(){var e;return e=this.props.onSharedLinkClick,S(n,{key:"shared_link",text:this.getDescriptionForSharedLinkInfo(this.props.sharedLinkInfo),direction:this.props.titleButtonDirection,className:"shared-with-members--audience-box"},T.img({src:P("/static/images/avatar/shared-link-icon-vflHCU_m6.svg"),alt:this.props.alt||w("Shared link"),width:_,onClick:function(t){return e(),t.stopPropagation()}}))},renderAudienceDescription:function(){var e,t,r,s,o,i,a,l;return t=this.props.audienceDescription?this.props.audienceDescription:this.props.hasSharedDataLoaded?w("Only you"):v,a=this.props.onAvatarClick,e=T.div({onClick:function(e){return a(),e.stopPropagation()}},t),s=this.props.joinedMembers?this.props.joinedMembers:[],this.props.joinedMembers&&this.props.joinedMembers.length>0&&(l=this.props.joinedMembers.slice(0,5),i=function(){var e,t,r;for(r=[],e=0,t=l.length;t>e;e++)o=l[e],r.push(o.display_name);return r}(),this.props.joinedMembers.length>5&&i.push(w("and more...")),r=i.join("\n")),r?S(n,{key:"membership_column_bubble",respectLineBreaks:!0,text:r,direction:this.props.titleButtonDirection},e):e},renderAudienceBoxAvatars:function(){var e,t,r,s,o,n,i,a;return e=[],s=this.props.joinedMembers?this.props.joinedMembers:[],t=this.props.groups?this.props.groups.slice():[],r=this.props.invitations?this.props.invitations.slice():[],this.props.sharedLinkInfo&&e.push(this.renderSharedLink(this.props.sharedLinkInfo)),a=[],i=this.findOwnerAndMeInJoinedMembers(s),n=i[0],o=i[1],null!=o&&(a.push(o.user_id),e.push(this.renderJoinedMember(o))),this.addGroupsMembersInvitations(e,t,s,r),this.renderAvatarList(e,"audience-box-avatar-padding")},renderAvatars:function(){var e,t,r,s,o,n,i,a,l,u;return(null!=(a=this.props.file)?a.isDeleted:void 0)?T.span({"aria-hidden":!0},w("deleted")):(o=this.props.joinedMembers?this.props.joinedMembers:[],r=this.props.groups?this.props.groups.slice():[],s=this.props.invitations?this.props.invitations.slice():[],e=[],this.props.sharedLinkInfo&&e.push(this.renderSharedLink(this.props.sharedLinkInfo)),u=[],l=this.findOwnerAndMeInJoinedMembers(o),i=l[0],n=l[1],g.hasNewMembershipUI(this.props.user.id)||(null!=i&&i===n&&(i=null),null!=i&&(u.push(i.user_id),e.push(this.renderJoinedMember(i)))),null!=n&&u.push(n.user_id),this.addGroupsMembersInvitations(e,r,o,s,u),t=0===e.length&&(0===this.props.numInheritedMembers||!g.hasNewMembershipUI(this.props.user.id)),t?T.span({"aria-hidden":!0},v):this.renderAvatarList(e))}}),{SharedWithView:y}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/search/actions",["external/immutable","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/react/browse/models","modules/clean/search/api","modules/clean/search/constants","modules/clean/search/store","modules/constants/viewer","modules/core/uri"],function(t,r,s,o,n,i,a,l,u,c){var p,d,h,m,_;return p=n.File,h=a.SearchActionTypes,_=a.SearchLoadingStates,d=u.ROLE_WORK,new(m=function(){function t(){this._loadDeletedResults=e(this._loadDeletedResults,this),this.loadMoreResults=e(this.loadMoreResults,this),this.searchApi=new i}return t.prototype.focusSearchBar=function(){return s.dispatch({type:h.FOCUS_SEARCH_BAR})},t.prototype.blurSearchBar=function(){return s.dispatch({type:h.BLUR_SEARCH_BAR})},t.prototype.setSearchQuery=function(e){var t,r,o,n,i;return r=e.nsid,o=e.path,n=e.query,i=e.user,t=e.groupByType,n!==l.rawQuery()?(s.dispatch({type:h.SET_SEARCH_QUERY,data:{query:n}}),l.isSearchBarLoading()?this.searchApi.loadSuggestions({user:i,nsid:r,path:o,query:l.normalizedQuery(),onSuccess:function(e){return function(r){var s;return s=r.searchResults,e.setSearchSuggestions({searchResults:s,groupByType:t})}}(this)}):void 0):void 0},t.prototype.setSearchSuggestions=function(e){var t,r;return r=e.searchResults,t=e.groupByType,s.dispatch({type:h.SET_SEARCH_SUGGESTIONS,data:{searchResults:r,groupByType:t}})},t.prototype.setHighlightedRow=function(e){var t;return t=e.index,s.dispatch({type:h.SET_HIGHLIGHTED_ROW,data:{index:t}})},t.prototype.highlightPreviousRow=function(){return s.dispatch({type:h.HIGHLIGHT_PREVIOUS_ROW})},t.prototype.highlightNextRow=function(){return s.dispatch({type:h.HIGHLIGHT_NEXT_ROW})},t.prototype.runSearch=function(e){var t,r,o;return o=e.user,t=e.path,r=e.query,s.dispatch({type:h.START_SEARCH,data:{query:r}}),this.searchApi.loadResults({user:o,path:t,query:r,loadDeleted:!1,start:0,onSuccess:function(e){return function(r){var s,n;return n=r.searchResults,s=r.context,e._setSearchResults({searchResults:n,context:s}),e._loadDeletedResults({path:t,user:o})}}(this)})},t.prototype.loadMoreResults=function(e){var t,r,o;if(t=e.path,o=e.user,l.loadingState()===_.LOADED){if(l.hasMoreResults())r=!1;else{if(!l.hasMoreResults(!0))return;r=!0}return s.dispatch({type:h.CONTINUE_SEARCH,data:{didLoadDeletedResults:r}}),this.searchApi.loadResults({user:o,path:t,query:l.latestQuery(),loadDeleted:r,start:r?l.numDeletedResults():l.searchResults().size,onSuccess:function(e){return function(r){var s,n,i;return i=r.searchResults,s=r.context,n=r.deleted,e._appendSearchResults({searchResults:i,context:s,deleted:n}),e._loadDeletedResults({path:t,user:o})}}(this)})}},t.prototype._setSearchResults=function(e){var t,r;return r=e.searchResults,t=e.context,s.dispatch({type:h.SET_SEARCH_RESULTS,data:{searchResults:r,context:t}})},t.prototype._appendSearchResults=function(e){var t,r,o;return o=e.searchResults,t=e.context,r=e.deleted,s.dispatch({type:h.APPEND_SEARCH_RESULTS,data:{searchResults:o,context:t,deleted:r}})},t.prototype._loadDeletedResults=function(e){var t,r;return t=e.path,r=e.user,l.hasMoreResults()||l.didLoadDeletedResults()?void 0:this.loadMoreResults({path:t,user:r})},t.prototype.setSearchSelection=function(e){var t;return t=e.selection,s.dispatch({type:h.SET_SEARCH_SELECTION,data:{selection:t}})},t.prototype.applyUpdatesFromNotserver=function(e){var t,o,n,i,a,u,c,d,m,_,f,g,b,v,y,w,S,T,P,D;for(y=e.payload,v=e.path,t=y.added,g=y.moved,T=y.removed,i=[],D=l.searchResults(),u=0,m=t.length;m>u;u++)o=t[u],o.fq_path.startsWith(v)&&(n=D.find(function(e){return r.paths_are_equal(e.fq_path,o.fq_path)}),n&&n.isDeleted&&(a=n.filename_highlights,b=p.fromServerObject(o).set("filename_highlights",a),i.push({before:n.fq_path,after:b})),n||i.push({before:null,after:p.fromServerObject(o)}));for(c=0,_=g.length;_>c;c++)S=g[c],w=S[0],o=S[1],w.startsWith(v)&&(n=D.find(function(e){return r.paths_are_equal(e.fq_path,w)}),n&&(a=n.filename_highlights,b=p.fromServerObject(o).set("filename_highlights",a),i.push({before:n.fq_path,after:null}),i.push({before:null,after:b})));for(d=0,f=T.length;f>d;d++)P=T[d],P.startsWith(v)&&(n=D.find(function(e){return r.paths_are_equal(e.fq_path,P)}),n&&!n.isDeleted&&(a=n.filename_highlights,b=n.set("isDeleted",!0).set("filename_highlights",a),i.push({before:n.fq_path,after:b})));return s.dispatch({type:h.CHANGE_FILES,data:{fileDeltas:i}})},t.prototype.removeSearchResults=function(e){var t,r;return r=e.fq_paths,t=r.map(function(e){return{before:e,after:null}}).toArray(),s.dispatch({type:h.CHANGE_FILES,data:{fileDeltas:t}})},t.prototype.clearSearch=function(){return s.dispatch({type:h.CLEAR_SEARCH})},t}())})}.call(this),function(){define("modules/clean/search/api",["modules/clean/analytics","modules/clean/ajax","modules/clean/react/browse/models","modules/clean/search/constants","modules/clean/search/search_type","modules/clean/search/store","modules/constants/browse"],function(e,t,r,s,o,n,i){var a,l,u,c;return c=e.SearchClientActivityLogger,a=r.BrowseContext,l=s.MaxResults,u=function(){function e(){this._activeRequest=null}return e.prototype.loadSuggestions=function(e){var t,r,s,o,a,u,c;return c=e.user,t=e.nsid,o=e.path,a=e.query,s=e.onSuccess,r=e.onError,u={query:a,fq_path:o,filename_only:!0,max_results:l.MAX_SEARCH_SUGGESTIONS,show_paper_results:i.SHOW_PAPER_SEARCH_RESULTS,show_unmounted_results:!0,ns_id:t,is_admin_console:n.browseContext().isNonUserRelativeContext},this._fetchResults(u,c,!1,s,r)},e.prototype.loadResults=function(e){var t,r,s,o,n,a,u,c;return c=e.user,o=e.path,n=e.query,t=e.loadDeleted,u=e.start,s=e.onSuccess,r=e.onError,a={query:n,fq_path:o,filename_only:!1,max_results:l.MAX_SEARCH_RESULTS,deleted:t,start:u,show_paper_results:i.SHOW_PAPER_SEARCH_RESULTS,show_unmounted_results:!0},this._fetchResults(a,c,t,s,r)},e.prototype.getUpdatesForResults=function(e){var r,s,o,n,i,a,l,u;return i=e.query,r=e.namespaceToJournalIdMap,a=e.showDeleted,u=e.user,o=e.onSuccess,n={all_terms:i,ns_map:function(){var e;e=[];for(s in r)l=r[s],e.push(s+"_"+l);return e}().join(","),show_deleted:a},t.WebRequest({url:"/update/list_search",data:n,dataType:"json",subject_user:u,success:function(e){return o(e)}})},e.prototype._extractBrowseContext=function(e){return new a({isInFolderMode:e.inside_dir,inactiveNSIDByFQPath:e.old_path_to_ns_id,permanentDeletionDisabledStateByNSID:e.permanent_delete_is_disabled_by_ns_id})},e.prototype._fetchResults=function(e,r,s,n,i){var a,l,u;return null!=(l=this._activeRequest)&&l.abort(),a={firefly:!0,path_scoped:!1,search_type:o.COMPLETION,query_string:e.query,infinite_scroll:e.start>0},c.log("query_started",r.id,a),u=(new Date).getTime(),this._activeRequest=t.WebRequest({
url:"/ajax_fulltext_search",data:e,dataType:"json",subject_user:r,success:function(t){return function(o,i,l){var p,d,h,m,_,f,g,b;for(p=t._extractBrowseContext(o),g=o.search_results,_=l.getResponseHeader("x-dropbox-request-id"),b=!1,h=0,m=g.length;m>h;h++)f=g[h],f.request_id=_,"FILE"===f.search_result_type&&f.used_spellcorrect===!0&&(b=!0);return n({context:p,searchResults:g,loadDeleted:s}),d=g.length>0?g[0]:null,a=c.create_completion_log_dict(a,b,_,u,e.query,!0,g.length,null,d),c.log("query_completed",r.id,a)}}(this),error:function(e,t,s){var o;return"abort"!==t&&"function"==typeof i&&i(s),o=e.getResponseHeader("x-dropbox-request-id"),a=c.create_completion_log_dict(a,null,o,u,null,null,null,t),c.log("query_failed",r.id,a)},complete:function(){return this._activeRequest=null}})},e}()})}.call(this),function(){define("modules/clean/search/constants",["modules/clean/flux/action_type"],function(e){var t,r;return r=e.withActionNamespace,t={},t.MaxResults={MAX_SEARCH_SUGGESTIONS:8,MAX_SEARCH_RESULTS:100},t.SearchActionTypes=r("search",{SET_USER:"SET_USER",FOCUS_SEARCH_BAR:"FOCUS_SEARCH_BAR",BLUR_SEARCH_BAR:"BLUR_SEARCH_BAR",SET_SEARCH_QUERY:"SET_SEARCH_QUERY",SET_SEARCH_SUGGESTIONS:"SET_SEARCH_SUGGESTIONS",SET_HIGHLIGHTED_ROW:"SET_HIGHLIGHTED_ROW",HIGHLIGHT_PREVIOUS_ROW:"HIGHLIGHT_PREVIOUS_ROW",HIGHLIGHT_NEXT_ROW:"HIGHLIGHT_NEXT_ROW",START_SEARCH:"START_SEARCH",SET_SEARCH_RESULTS:"SET_SEARCH_RESULTS",CONTINUE_SEARCH:"CONTINUE_SEARCH",APPEND_SEARCH_RESULTS:"APPEND_SEARCH_RESULTS",CLEAR_SEARCH:"CLEAR_SEARCH",SET_SEARCH_SELECTION:"SET_SEARCH_SELECTION",CHANGE_FILES:"CHANGE_SEARCH_FILES"}),t.SearchLoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_ADDITIONAL_PAGE:"LOADING_ADDITIONAL_PAGE"},t})}.call(this),function(){define("modules/clean/search/search_bar",["jquery","external/purify","external/classnames","external/react","external/react-dom","external/underscore","modules/core/uri","modules/clean/analytics","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/keycode","modules/clean/react/browse/models","modules/clean/react/button","modules/clean/react/css","modules/clean/react/input","modules/clean/react_format","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/search/search_helpers","modules/clean/search/store","modules/clean/search/util","modules/core/accessible_announce","modules/core/browser","modules/core/i18n"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T){var P,D,E,I,C,F,N,A,R,x,M,O,L,k,B,U,H,q,G;return M=a.TeamsWebActionsLogger,P=p.File,D=p.Paper,q=_.reactFormat,U=y.isSuggestionFolder,B=y.isSuggestionFile,H=y.isSuggestionPaper,O=T._,G=T.ungettext,L=s.createElement,k=s.DOM,E=s.createClass({displayName:"SearchBar",mixins:[u(v)],propTypes:{user:s.PropTypes.object.isRequired,currentPath:s.PropTypes.string.isRequired,onSearch:s.PropTypes.func.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,isPagelet:s.PropTypes.bool,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string,currentNSID:s.PropTypes.number},_get_state_from_stores:function(){return{isFocused:v.isSearchBarFocused(),isActive:v.isSearchBarActive(),isSearchActive:!!v.latestQuery(),rawQuery:v.rawQuery(),normalizedQuery:v.normalizedQuery(),suggestions:v.searchSuggestions(),searchBarLoading:v.isSearchBarLoading(),isAdminConsole:v.browseContext().isNonUserRelativeContext}},_handleInputChange:function(e){return g.setSearchQuery({nsid:this.props.currentNSID,path:this.props.currentPath,query:e.target.value,user:this.props.user,groupByType:this.props.isPagelet})},_handleInputKeydown:function(e){return e.keyCode===c.ESC?void this.props.onSearch(""):(e.stopPropagation(),e.keyCode===c.UP?(e.preventDefault(),g.highlightPreviousRow()):e.keyCode===c.DOWN?(e.preventDefault(),g.highlightNextRow()):void 0)},_handleInputSubmit:function(e,t){return e.preventDefault(),0===t?this.props.onSearch(this.state.normalizedQuery):this.props.onFileOrFolderOpen(v.searchSuggestions()[t-1])},_handleHighlightDropdownItem:function(e){return g.setHighlightedRow({index:e})},render:function(){var e;return e=n.extend({onInputChange:this._handleInputChange,onInputKeydown:this._handleInputKeydown,onInputSubmit:this._handleInputSubmit,onSearchBarFocus:g.focusSearchBar,onSearchBarBlur:g.blurSearchBar,onHighlightDropdownItem:this._handleHighlightDropdownItem,ref:"searchBarView",highlightedRow:v.highlightedSearchRow()},this.state,this.props),L(x,e)}}),x=s.createClass({displayName:"SearchBarView",propTypes:{isSearchActive:s.PropTypes.bool.isRequired,isActive:s.PropTypes.bool.isRequired,isFocused:s.PropTypes.bool.isRequired,isPagelet:s.PropTypes.bool.isRequired,searchBarLoading:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onInputChange:s.PropTypes.func.isRequired,onInputKeydown:s.PropTypes.func.isRequired,onInputSubmit:s.PropTypes.func.isRequired,onSearch:s.PropTypes.func.isRequired,onSearchBarBlur:s.PropTypes.func.isRequired,onSearchBarFocus:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,highlightedRow:s.PropTypes.number.isRequired,suggestions:s.PropTypes.array.isRequired,rawQuery:s.PropTypes.string,normalizedQuery:s.PropTypes.string,limitedTeamBannerUpsell:s.PropTypes.bool,trademarkBusiness:s.PropTypes.string,isAdminConsole:s.PropTypes.bool},getDefaultProps:function(){return{rawQuery:"",normalizedQuery:"",isAdminConsole:!1}},handleNavigation:function(){var e;return e=o.findDOMNode(this.refs.searchBarInput.refs.searchBarTextInput),e.blur()},_renderUpsellBar:function(){return this.props.limitedTeamBannerUpsell?k.div({className:"search-bar__upsell"},k.div({className:"search-bar__upsell__message"},O("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness})),k.div({className:"search-bar__upsell__action"},L(d.button,{className:"search-bar__upsell__cta-button",onMouseDown:function(e){return e.stopPropagation(),e.preventDefault(),S.redirect(i({path:"/team/upgrade",query:{tk:"search_upsell_bar",camp:"web"}}))}},O("Upgrade")))):void 0},render:function(){var e,t,s;return e={"search-bar":!0,"is-expanded":this.props.isSearchActive,"is-focused":this.props.isFocused,"is-active":this.props.isActive},k.div({className:"search-bar--container u-l-fr"},k.div({className:r(e)},s=L(R,{isActive:this.props.isActive,isFocused:this.props.isFocused,isPagelet:this.props.isPagelet,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onInputChange:this.props.onInputChange,onInputKeydown:this.props.onInputKeydown,onInputSubmit:this.props.onInputSubmit,onSearchBarBlur:this.props.onSearchBarBlur,onSearchBarFocus:this.props.onSearchBarFocus,rawQuery:this.props.rawQuery,highlightedRow:this.props.highlightedRow,ref:"searchBarInput"}),(null!=(t=this.props.normalizedQuery)?t.length:void 0)?L(I,{onFileOrFolderOpen:function(e){return function(t){return e.props.onFileOrFolderOpen(t),e.handleNavigation()}}(this),onSearch:function(e){return function(t){return e.props.onSearch(t),e.handleNavigation()}}(this),currentPath:this.props.currentPath,highlightedRow:this.props.highlightedRow,isOpen:this.props.isFocused,isPagelet:this.props.isPagelet,normalizedQuery:this.props.normalizedQuery,onHighlightDropdownItem:this.props.onHighlightDropdownItem,ref:"searchBarDropdown",suggestions:this.props.suggestions,bottomBanner:this._renderUpsellBar(),searchBarLoading:this.props.searchBarLoading,isAdminConsole:this.props.isAdminConsole}):void 0))}}),R=s.createClass({displayName:"SearchBarInput",propTypes:{isActive:s.PropTypes.bool.isRequired,isFocused:s.PropTypes.bool.isRequired,isPagelet:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onInputChange:s.PropTypes.func.isRequired,onInputKeydown:s.PropTypes.func.isRequired,onInputSubmit:s.PropTypes.func.isRequired,onSearchBarBlur:s.PropTypes.func.isRequired,onSearchBarFocus:s.PropTypes.func.isRequired,rawQuery:s.PropTypes.string,highlightedRow:s.PropTypes.number.isRequired},componentDidMount:function(){return e(o.findDOMNode(this.refs.searchBarTextInput)).on("keydown.SearchBarInput",this._onKeydown),e(o.findDOMNode(this.refs.searchBarTextInput)).on("focusout.SearchBarInput",this.props.onSearchBarBlur)},componentWillUnmount:function(){return e(o.findDOMNode(this.refs.searchBarTextInput)).off(".SearchBarInput")},_onKeydown:function(e){return e.keyCode===c.ESC&&o.findDOMNode(this.refs.searchBarTextInput).blur(),this.props.onInputKeydown(e)},_onSubmit:function(e){var t;return t=v.highlightedSearchRow(),o.findDOMNode(this.refs.searchBarTextInput).blur(),this.props.onInputSubmit(e,t)},render:function(){return k.form({className:"search-bar__input",onSubmit:this._onSubmit},k.input({"aria-activedescendant":"search-dropdown-suggestion"+this.props.highlightedRow,"aria-autocomplete":"list","aria-expanded":this.props.isFocused&&this.props.isActive,"aria-label":O("Search"),"aria-owns":"search-bar__suggestions",className:"search-bar__text-input",onChange:this.props.onInputChange,onFocus:this.props.onSearchBarFocus,placeholder:O("Search"),ref:"searchBarTextInput",role:"combobox",value:this.props.rawQuery}),k.input({"aria-label":O("Search"),className:"search-bar__button",ref:"searchBarSearchButton",type:"submit",value:""}))}}),I=s.createClass({displayName:"SearchBarDropdown",propTypes:{isOpen:s.PropTypes.bool.isRequired,isPagelet:s.PropTypes.bool.isRequired,onFileOrFolderOpen:s.PropTypes.func.isRequired,onSearch:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,normalizedQuery:s.PropTypes.string.isRequired,suggestions:s.PropTypes.array.isRequired,searchBarLoading:s.PropTypes.bool.isRequired,bottomBanner:s.PropTypes.element,isAdminConsole:s.PropTypes.bool},getDefaultProps:function(){return{isAdminConsole:!1}},componentDidMount:function(){return this.props.searchBarLoading?this._announceLoading():void 0},componentDidUpdate:function(e){return this.props.searchBarLoading&&!e.searchBarLoading&&this._announceLoading(),this.props.normalizedQuery&&e.searchBarLoading&&!this.props.searchBarLoading?w.polite(G("Found %(num)s search result","Found %(num)s search results",this.props.suggestions.length).format({num:this.props.suggestions.length})):void 0},_announceLoading:function(){return w.polite(O("Loading search…"))},render:function(){return!this.props.searchBarLoading&&this.props.isOpen&&this.props.bottomBanner&&!this._banner_view_logged&&(this._banner_view_logged=!0,M.log("banner_search_displayed",{location:"search_bar",item_count:this.props.suggestions.length})),this.props.isPagelet?this._renderForMaestro():this._renderForDefault()},_renderForMaestro:function(){var e,t,s,o,n,i,a,l,u,c,p;for(l=function(e){return k.h3({className:"search-bar__filetype-title"},O(e))},c=[],s=!1,t=!1,o=!1,u=this.props.suggestions,n=i=0,a=u.length;a>i;n=++i)p=u[n],U(p)&&!s?(c.push(l("Folders")),s=!0):B(p)&&!t?(c.push(l("Files")),t=!0):H(p)&&!o&&(c.push(l("Paper Documents")),o=!0),p instanceof P?c.push(L(C,{resultObject:p,isPagelet:!0,key:p.fq_path,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:n,highlightedRow:this.props.highlightedRow})):p instanceof D&&c.push(L(F,{resultObject:p,isPagelet:!0,key:p.pad_id,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:n,highlightedRow:this.props.highlightedRow}));return e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},k.div({className:r(e),"aria-hidden":!this.props.isOpen},k.div({className:"search-bar__suggestions",id:"search-bar__suggestions"},L(N,{isPagelet:!0,onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),this.props.suggestions.length?k.hr({className:"search-bar__title-items-divider"}):void 0,c),this.props.searchBarLoading?k.div({className:"search-bar__loading"},k.span({className:"ax-visually-hidden"},O("Loading search..."))):this.props.bottomBanner)},_renderForDefault:function(){var e,t,s,o,n;return e={"search-bar__dropdown":!0,"is-expanded":this.props.isOpen},k.div({className:r(e),"aria-hidden":!this.props.isOpen},k.ul({className:"search-bar__suggestions",id:"search-bar__suggestions",role:"listbox"},this.props.isAdminConsole?void 0:L(N,{isPagelet:!1,onSearch:this.props.onSearch,onHighlightDropdownItem:this.props.onHighlightDropdownItem,currentPath:this.props.currentPath,normalizedQuery:this.props.normalizedQuery,highlightedRow:this.props.highlightedRow}),function(){var e,r,i,a;if(this.props.suggestions.length){for(i=this.props.suggestions,a=[],o=e=0,r=i.length;r>e;o=++e)n=i[o],t=null,s=null,n instanceof P?(t=C,s=n.fq_path):n instanceof D&&(t=F,s=n.pad_id),t?a.push(L(t,{resultObject:n,isPagelet:!1,key:s,onFileOrFolderOpen:this.props.onFileOrFolderOpen,onHighlightDropdownItem:this.props.onHighlightDropdownItem,rank:o,highlightedRow:this.props.highlightedRow})):a.push(void 0);return a}}.call(this)),this.props.searchBarLoading?k.div({className:"search-bar__loading"},k.span({className:"ax-visually-hidden"},O("Loading search..."))):this.props.bottomBanner)}}),N=s.createClass({displayName:"SearchBarDropdownSearchItem",propTypes:{isPagelet:s.PropTypes.bool.isRequired,onSearch:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,currentPath:s.PropTypes.string.isRequired,normalizedQuery:s.PropTypes.string.isRequired,highlightedRow:s.PropTypes.number.isRequired},render:function(){var e,t,s;return s=0===this.props.highlightedRow,t=this.props.isPagelet?q(O("Display all results for <strong>%(query)s</strong> in a page"),{query:this.props.normalizedQuery,strong:k.strong()}):q(O("Search for ‘<strong>%(query)s</strong>’ in %(current_path)s"),{current_path:l.filename(this.props.currentPath),query:this.props.normalizedQuery,strong:k.strong()}),e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":s},k.div({className:r(e),id:"search-dropdown-suggestion0",onMouseDown:function(e){return function(){return e.props.onSearch(e.props.normalizedQuery)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(0)}}(this),role:"option","aria-selected":s},k.div({className:"search-bar__suggestion-icon--search"}),k.div({className:r({"search-bar__suggestion-name":!this.props.isPagelet,"search-bar__suggestion-first-row-name":this.props.isPagelet})},t))}}),F=s.createClass({displayName:"SearchBarDropdownPaperSuggestion",propTypes:{resultObject:s.PropTypes.instanceOf(D).isRequired,isPagelet:s.PropTypes.bool.isRequired},render:function(){var t,r;return r=this.props.resultObject,t={icon:"paper_white_32",title:b.highlightMatchString(r.title,r.title_highlights),location:"Paper"},L(A,e.extend(t,this.props))}}),C=s.createClass({displayName:"SearchBarDropdownFileSuggestion",propTypes:{resultObject:s.PropTypes.instanceOf(P).isRequired,isPagelet:s.PropTypes.bool.isRequired},render:function(){var t,r,s,o,n,i,a;return o=this.props.resultObject,n=l.filename(o.fq_path),i=l.parent_dir(o.fq_path),s=i,this.props.isPagelet&&(s="Dropbox",r=i.split("/"),r.shift(),o.is_unmounted&&r.length>0&&(s=r.shift()),a=r[r.length-1],r.length>=2&&(s+="/..."),(null!=a?a.length:void 0)&&(s+="/"+a)),t={icon:o.icon,title:b.highlightMatchString(n,o.filename_highlights),location:s,isUnmounted:o.is_unmounted},L(A,e.extend(t,this.props))}}),A=s.createClass({displayName:"SearchBarDropdownSuggestion",propTypes:{resultObject:s.PropTypes.oneOfType([s.PropTypes.instanceOf(P),s.PropTypes.instanceOf(D)]).isRequired,isPagelet:s.PropTypes.bool.isRequired,icon:s.PropTypes.string,title:s.PropTypes.string,location:s.PropTypes.string,isUnmounted:s.PropTypes.bool,onFileOrFolderOpen:s.PropTypes.func.isRequired,onHighlightDropdownItem:s.PropTypes.func.isRequired,rank:s.PropTypes.number.isRequired,highlightedRow:s.PropTypes.number.isRequired},render:function(){var e,s,o,n,i;return o=this.props.rank+1,s=o===this.props.highlightedRow,e={"search-bar__suggestion":!0,"search-bar__suggestion--is-highlighted":s},n=this.props.isPagelet?this.props.isUnmounted?q(O("not added yet, in <locationSpan>%(location)s</locationSpan>",{comment:"Describes the mountable directory of a file in a list of search results."}),{location:this.props.location,locationSpan:k.span({title:this.props.location})}):q(O("<locationSpan>%(location)s</locationSpan>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:this.props.location,locationSpan:k.span({title:this.props.location})}):q(O("<locationSpan>in %(location)s</locationSpan>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:this.props.location,locationSpan:k.span({title:this.props.location})}),i=[k.div({className:"search-bar__suggestion-name"},k.span({dangerouslySetInnerHTML:{__html:t.sanitize(this.props.title)}}),!this.props.isPagelet&&this.props.isUnmounted?[k.br({}),k.span({className:"u-font-meta"},O("Not added yet"))]:void 0),k.div({className:"search-bar__suggestion-desc"},n)],k.li({className:r(e),id:"search-dropdown-suggestion"+o,role:"option","aria-selected":s,onMouseDown:function(e){return function(){return e.props.onFileOrFolderOpen(e.props.resultObject)}}(this),onMouseEnter:function(e){return function(){return e.props.onHighlightDropdownItem(o)}}(this)},L(f,{group:"web",name:this.props.icon,className:"search-bar__suggestion-icon",alt:""}),this.props.isPagelet?k.div({},i):i)}}),E=h(E,["/static/css/search/search_bar_react-vfl7DGFi1.css"])})}.call(this),function(){var e=function(e,r){function s(){this.constructor=e}for(var o in r)t.call(r,o)&&(e[o]=r[o]);return s.prototype=r.prototype,e.prototype=new s,e.__super__=r.prototype,e},t={}.hasOwnProperty;define("modules/clean/search/store",["external/immutable","modules/clean/ajax","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/selectable_list","modules/clean/search/constants","modules/clean/search/util","modules/clean/viewer"],function(t,r,s,o,n,i,a,l,u,c){var p,d,h,m,_,f,g,b,v,y,w,S,T,P;return p=n.BrowseActionTypes,h=i.File,d=i.BrowseContext,_=i.Paper,y=a.createSelection,m=l.MaxResults,f=l.SearchActionTypes,g=l.SearchLoadingStates,S=u.isSuggestionFile,T=u.isSuggestionFolder,P=u.isSuggestionPaper,w=u.groupSuggestionsByType,b={FILE:"FILE",PAPER:"PAPER"},new(v=function(r){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,r),o.prototype._init=function(){return this._resetSearchBar(),this._resetSearchResults()},o.prototype._resetSearchBar=function(){return this._isSearchBarFocused=!1,this._isSearchBarLoading=!1,this._rawQuery="",this._normalizedQuery="",this._searchSuggestions=[],this._highlightedSearchRow=0},o.prototype._resetSearchResults=function(){return this._browseContext=new d,this._latestQuery="",this._loadingState=g.LOADED,this._searchResults=t.List(),this._selection=y(),this._hasMoreLiveResults=!0,this._numDeletedResults=0,this._hasMoreDeletedResults=!0,this._didLoadDeletedResults=!1},o.prototype.isSearchBarFocused=function(){return this._isSearchBarFocused},o.prototype.isSearchBarActive=function(){return!!this._rawQuery},o.prototype.isSearchBarLoading=function(){return this._isSearchBarLoading},o.prototype.rawQuery=function(){return this._rawQuery},o.prototype.normalizedQuery=function(){return this._rawQuery.trim().replace(/\ +/g," ")},o.prototype.searchSuggestions=function(){return this._searchSuggestions},o.prototype.highlightedSearchRow=function(){return this._highlightedSearchRow},o.prototype.highlightedSuggestion=function(){var e,t;return t=this._highlightedSearchRow-1,e=this._searchSuggestions[t],this._searchSuggestions[t]},o.prototype.browseContext=function(){return this._browseContext},o.prototype.latestQuery=function(){return this._latestQuery},o.prototype.loadingState=function(){return this._loadingState},o.prototype.searchResults=function(){return this._searchResults},o.prototype.hasMoreResults=function(e){return null==e&&(e=!1),this._hasMoreLiveResults||e&&this._hasMoreDeletedResults},o.prototype.numDeletedResults=function(){return this._numDeletedResults},o.prototype.didLoadDeletedResults=function(){return this._didLoadDeletedResults},o.prototype.selection=function(){return this._selection},o.prototype.selectedFiles=function(){return this._searchResults.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},o.prototype._focusSearchBar=function(){return this._isSearchBarFocused=!0,this._highlightedSearchRow=0,this.emit_change()},o.prototype._blurSearchBar=function(){return this._isSearchBarFocused=!1,this._highlightedSearchRow=0,this.emit_change()},o.prototype._setSearchQuery=function(e){var t;return t=e.query,this._rawQuery=t,this._searchSuggestions=[],this._highlightedSearchRow=0,this._isSearchBarLoading=!!this.normalizedQuery(),this.emit_change()},o.prototype._parseSearchResultsToList=function(e){var t,r,s,o,n;for(n=e.searchResults,o=[],t=0,r=n.length;r>t;t++)switch(s=n[t],s.search_result_type){case b.FILE:o.push(h.fromServerObject(s));break;case b.PAPER:o.push(_.fromServerObject(s))}return o},o.prototype._setSearchSuggestions=function(e){var t,r;return r=e.searchResults,t=e.groupByType,this._isSearchBarLoading=!1,this._searchSuggestions=this._parseSearchResultsToList({searchResults:r}),t&&(this._searchSuggestions=w(this._searchSuggestions)),this.emit_change()},o.prototype._setHighlightedSearchRow=function(e){var t;return t=e.index,this._highlightedSearchRow=t,this.emit_change()},o.prototype._highlightPreviousSearchRow=function(){return this._highlightedSearchRow=Math.max(0,this._highlightedSearchRow-1),this.emit_change()},o.prototype._highlightNextSearchRow=function(){return this._highlightedSearchRow=Math.min(this._searchSuggestions.length,this._highlightedSearchRow+1),this.emit_change()},o.prototype._startSearch=function(e){var t;return t=e.query,this._resetSearchResults(),this._rawQuery=t,this._latestQuery=this.normalizedQuery(),this._loadingState=g.LOADING_FIRST_PAGE,this.emit_change()},o.prototype._setSearchResults=function(e){var r,s;return s=e.searchResults,r=e.context,this._searchResults=t.List(this._parseSearchResultsToList({searchResults:s})),this._loadingState=g.LOADED,this._browseContext=r,this._updateMoreResults(s),this.emit_change()},o.prototype._continueSearch=function(e){var t;return t=e.didLoadDeletedResults,t&&(this._didLoadDeletedResults=!0),this._loadingState=g.LOADING_ADDITIONAL_PAGE,this.emit_change()},o.prototype._appendSearchResults=function(e){var t,r,s;return r=e.deleted,s=e.searchResults,t=e.context,r&&(this._numDeletedResults+=s.length),this._searchResults=this._searchResults.concat(this._parseSearchResultsToList({searchResults:s})),this._loadingState=g.LOADED,this._browseContext=t,this._updateMoreResults(s),this.emit_change()},o.prototype._clearSearch=function(){return this._resetSearchBar(),this._resetSearchResults(),this.emit_change()},o.prototype._updateMoreResults=function(e){var t;return t=e.length===m.MAX_SEARCH_RESULTS,this._hasMoreLiveResults?this._hasMoreLiveResults=t:this._hasMoreDeletedResults?this._hasMoreDeletedResults=t:void 0},o.prototype._setSearchSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},o.prototype._applyFileDeltas=function(e){var t,r,o,n,i,a,l;if(n=e.fileDeltas){for(i=0,a=n.length;a>i;i++)l=n[i],r=l.before,t=l.after,!r&&t?this._searchResults=this._searchResults.push(t):r&&!t?(o=this._searchResults.findIndex(function(e){return s.paths_are_equal(e.fq_path,r)}),this._searchResults=this._searchResults.delete(o)):r&&t&&(o=this._searchResults.findIndex(function(e){return s.paths_are_equal(e.fq_path,r)}),o>-1?this._searchResults=this._searchResults.set(o,t):this._searchResults=this._searchResults.push(t));return this.emit_change()}},o.prototype._updateContext=function(e){return this._browseContext=e.context},o.prototype._new_payload=function(e){switch(e.action.type){case f.FOCUS_SEARCH_BAR:return this._focusSearchBar();case f.BLUR_SEARCH_BAR:return this._blurSearchBar();case f.SET_SEARCH_QUERY:return this._setSearchQuery(e.action.data);case f.SET_SEARCH_SUGGESTIONS:return this._setSearchSuggestions(e.action.data);case f.SET_HIGHLIGHTED_ROW:return this._setHighlightedSearchRow(e.action.data);case f.HIGHLIGHT_PREVIOUS_ROW:return this._highlightPreviousSearchRow();case f.HIGHLIGHT_NEXT_ROW:return this._highlightNextSearchRow();case f.START_SEARCH:return this._startSearch(e.action.data);case f.SET_SEARCH_RESULTS:return this._setSearchResults(e.action.data);case f.CONTINUE_SEARCH:return this._continueSearch(e.action.data);case f.APPEND_SEARCH_RESULTS:return this._appendSearchResults(e.action.data);case f.SET_SEARCH_SELECTION:return this._setSearchSelection(e.action.data);case f.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case f.CLEAR_SEARCH:return this._clearSearch();case p.SET_URL:return this._clearSearch();case p.LOAD_PATH:return this._updateContext(e.action.data)}},o}(o))})}.call(this),function(){define("modules/clean/search/util",["modules/clean/react/browse/models"],function(e){var t,r,s,o,n,i,a;return r=e.File,t=e.BrowseContext,s=e.Paper,i=function(e){return e instanceof r&&e.is_dir},n=function(e){return e instanceof r&&!e.is_dir},a=function(e){return e instanceof s},o=function(e){var t,r,s,o;return r=function(){var t,r,s;for(s=[],t=0,r=e.length;r>t;t++)o=e[t],i(o)&&s.push(o);return s}(),t=function(){var t,r,s;for(s=[],t=0,r=e.length;r>t;t++)o=e[t],n(o)&&s.push(o);return s}(),s=function(){var t,r,s;for(s=[],t=0,r=e.length;r>t;t++)o=e[t],a(o)&&s.push(o);return s}(),r.concat(t).concat(s)},{isSuggestionFolder:i,isSuggestionFile:n,isSuggestionPaper:a,groupSuggestionsByType:o}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/member_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/inherited_count_avatar","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/photo_avatar","modules/clean/avatar/shared_link_avatar","modules/clean/avatar/viewer_avatar","modules/clean/avatar/list","modules/clean/components/title_bubble","modules/clean/datetime","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/viewer","modules/constants/viewer","modules/core/i18n","modules/clean/static_urls"],function(t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g){var b,v,y,w,S,T,P,D,E;return P=p.nice_date_with_month_name,y=d.SHMODEL_LINK_TOKEN_VISIBILITY,b=h.GoldenGate,w=f._,E=f.ungettext,D=g.static_url,S=t.createElement,T=t.DOM,v={getInitialState:function(){return{paired_users_in_sf:!1}},componentWillMount:function(){var e;return e=this.arePairedUsersInSf(this.props.joinedMembers),this.setState({paired_users_in_sf:e,paired_users_in_sf:e})},componentWillReceiveProps:function(e){var t;return t=this.arePairedUsersInSf(e.joinedMembers),this.setState({paired_users_in_sf:t,paired_users_in_sf:t})},_wrap_with_avatar_type_and_data:function(e,t,r){return function(s){return e(t,r),s.stopPropagation()}},arePairedUsersInSf:function(t){var r,s,o,n,i,a,l;return t?(l=m.get_viewer(),!!(l.is_paired&&(a=l.get_user_ids(r=!0),s=function(){var e,r,s;for(s=[],e=0,r=t.length;r>e;e++)o=t[e],s.push(o.user_id);return s}(),n=a[0],e.call(s,n)>=0&&(i=a[1],e.call(s,i)>=0)))):!1},findOwnerAndMeInJoinedMembers:function(e){var t,r,s,o,n,i;for(i=null,o=null,t=r=0,s=e.length;s>r&&(n=e[t],"owner"===n.access_type&&(i=n),n.user_id===this.props.user.id&&(o=n),null==i||null==o);t=++r);return[i,o]},addGroupsMembersInvitations:function(t,r,s,o,n){var i,a,l,u,c,p,d,h,m,_,f;for(null==n&&(n=[]),l=0,p=r.length;p>l;l++)i=r[l],t.push(this.renderGroup(i));for(u=0,d=s.length;d>u;u++)m=s[u],_=m.user_id,e.call(n,_)<0&&t.push(this.renderJoinedMember(m));for(f=[],c=0,h=o.length;h>c;c++)a=o[c],f.push(t.push(this.renderInvitedPerson(a)));return f},renderAvatarList:function(e,t){var r;return null==t&&(t=""),b.hasNewMembershipUI(this.props.user.id)&&(r=function(e){return function(t){var r,s,n;return r=99,n=E("%(count)s more member","%(count)s more members",t).format({count:t}),s=t>=r?r+"+":""+t,S(o,{alt:n,dimension:e.props.avatarDimension,initials:s,color:"#7B8994",shape:"CIRCLE",onClick:e.props.onOverflowCountClick})}}(this)),S(u,{avatars:e,avatarDimension:this.props.avatarDimension,maxVisible:this.props.maxVisibleAvatars,undisplayableCount:this.props.numUndisplayableUsersAndInvites||0,onOverflowCountClick:this.props.onOverflowCountClick,overflowCountRenderer:r,animation:this.props.animation,inheritedCountAvatar:this.renderInheritedCount(e.length),className:t,isInAudienceBox:b.hasAudienceBox(this.props.user.id),reverseAvatars:b.hasNewMembershipUI(this.props.user.id)})},renderJoinedMember:function(t){var s,o,i,a,u,p,d,h,f,g,b,v;return b=m.get_viewer(),g=t.user_id,d=e.call(b.get_user_ids(o=!0),g)>=0,u=null,d&&this.state.paired_users_in_sf?(p=t.user_id,f=b.get_user_by_role(_.ROLE_PERSONAL,!0),v=b.get_user_by_role(_.ROLE_WORK,!0),p===f.id?u="Personal":p===v.id&&null!=b.team_name&&(u=b.team_name)):u=t.display_name,s=this.individualAccessTypeString(u,t.access_type,d,this.state.paired_users_in_sf),h=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"member",t),a={alt:s,dimension:this.props.avatarDimension,onPhotoClick:h,photoUrl:t.photo_url,defaultAvatar:S(n,{alt:s,dimension:this.props.avatarDimension,name:t.display_name,initials:t.initials,shape:"CIRCLE",onClick:h})},i=d?S(l,a):S(r,a),S(c,{key:"user:"+t.user_id+":"+t.photo_url,text:s,direction:this.props.titleButtonDirection},i)},renderGroup:function(e){var t,r,s;return r=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"group",e),e.is_automatic?(s=this.teamAccessTypeString(e.name,e.access_type),t=S(i,{alt:s,dimension:this.props.avatarDimension,photoUrl:D("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",onClick:r})):(s=this.groupAccessTypeString(e.name,e.access_type,e.num_users),t=S(n,{alt:s,dimension:this.props.avatarDimension,name:e.name,shape:"SQUARE",initials:this.getInitials(e.name),onClick:r})),S(c,{key:"group:"+e.gid+":"+e.name,text:s,direction:this.props.titleButtonDirection},t)},renderInvitedPerson:function(e){var t,r;return r=this._wrap_with_avatar_type_and_data(this.props.onAvatarClick,"invited",e),t=this.individualAccessTypeString(e.email_or_fbname,"pending",!1),S(c,{key:"invitation:"+e.invitation_id,text:t,direction:this.props.titleButtonDirection},S(o,{alt:t,dimension:this.props.avatarDimension,color:"#aaa",initials:this.getInitials(e.email_or_fbname),shape:"CIRCLE",onClick:r}))},renderInheritedCount:function(e){var t;return b.hasNewMembershipUI(this.props.user.id)&&this.props.numInheritedMembers>0?(t=E("%(inherited_count)s inherited member from %(parent_folder)s folder","%(inherited_count)s inherited members from %(parent_folder)s folder",this.props.numInheritedMembers).format({inherited_count:this.props.numInheritedMembers,parent_folder:this.props.parentFolderName}),T.div({},S(c,{text:t,direction:"south"},S(s,{inheritedMemberCount:this.props.numInheritedMembers,key:"count",onClick:this.props.onAvatarClick})),e>0?T.span({className:"members-column__plus-sign u-pad-left-xxs"},"+"):void 0)):void 0},getInitials:function(e){var t,r,s;return null!=e&&e.length>0?(s=e.split(" "),t=function(){var e,t,o;for(o=[],e=0,t=s.length;t>e;e++)r=s[e],o.push(r.charAt(0).toLowerCase());return o}(),t.length>2&&(t=t.splice(0,2)),t.join("")):""},teamAccessTypeString:function(e,t){var r;return r=w("editor"===t?"%(team_group_name)s can edit":"%(team_group_name)s can view"),r.format({team_group_name:e})},groupAccessTypeString:function(e,t,r){var s;return s="editor"===t?E("%(num_users)s person in %(group_name)s can edit","%(num_users)s people in %(group_name)s can edit",r):E("%(num_users)s person in %(group_name)s can view","%(num_users)s people in %(group_name)s can view",r),
s.format({group_name:e,num_users:r})},individualAccessTypeString:function(e,t,r,s){var o,n,i,a;return null==s&&(s=!1),o={viewer:w("You can view"),editor:w("You can edit"),owner:w("You’re the owner"),team:w("You’re a member of this team folder"),default:w("You")},a={viewer:w("%(name)s can view"),editor:w("%(name)s can edit"),owner:w("%(name)s is the owner"),pending:w("%(name)s hasn’t added this to their Dropbox yet"),team:w("%(name)s is a member of this team folder"),default:w("%(name)s"),"no access":w("No access")},n={viewer:w("You (%(name)s) can view"),editor:w("You (%(name)s) can edit"),owner:w("You (%(name)s) are the owner")},i=r?s&&null!=e?n:o:a,i[t].format({name:e})},renderSharedLink:function(e){var t,r,s,o;return t=this.getDescriptionForSharedLinkInfo(e),r=S(a,{alt:t,dimension:this.props.avatarDimension,onClick:function(t){return function(r){return t.props.onSharedLinkClick(e),r.stopPropagation()}}(this)}),e.allow_download===!1?(s="sharing-icon-bubble-title u-font-center",o=!0):o=!1,S(c,{key:"shared_link",text:t,direction:"south",className:s,respectLineBreaks:o},r)},getDescriptionForSharedLinkInfo:function(e){var t,r,s,o,n,i,a,l,u,c,p,d;if(d=e.visibility_type,o=e.expires_posix,c=e.shared_folder_link_policy,s="",o){if(l=(new Date).getTime()/1e3,u=o-l,r=Math.floor(u/86400),0>u)return w("Link Disabled");t=new Date(1e3*o),p=!1,i=!0,n=r>180,t=P(t,n,p,i)}if(e.allow_download===!1&&(s=". "+w("(Downloading is turned off.)",{comment:'This follows a description of link visibility. For example: "Anyone with the link can view this file. (Downloading is turned off.)"'})),a="MEMBERS_ONLY"===c,t){if(d===y.PUBLIC)return e.is_editable?a?w("Folder members with the link can edit until %(date)s").format({date:t}):w("People with the link can edit until %(date)s").format({date:t}):a?w("Folder members with the link can view until %(date)s").format({date:t})+s:w("People with the link can view until %(date)s").format({date:t})+s;if(d===y.PASSWORD)return e.is_editable?a?w("Folder members with the password can edit until %(date)s").format({date:t}):w("People with the password can edit until %(date)s").format({date:t}):a?w("Folder members with the password can view until %(date)s").format({date:t})+s:w("People with the password can view until %(date)s").format({date:t})+s;if(d===y.TEAM_ONLY)return e.is_editable?a?w("Folder members at %(team_name)s can edit until %(date)s").format({team_name:m.get_viewer().team_name,date:t}):w("People at %(team_name)s can edit until %(date)s").format({team_name:m.get_viewer().team_name,date:t}):a?w("Folder members at %(team_name)s can view until %(date)s").format({team_name:m.get_viewer().team_name,date:t})+s:w("People at %(team_name)s can view until %(date)s").format({team_name:m.get_viewer().team_name,date:t})+s}else{if(d===y.PUBLIC)return e.is_editable?w(a?"Folder members with the link can edit":"People with the link can edit"):a?w("Folder members with the link can view")+s:w("People with the link can view")+s;if(d===y.PASSWORD)return e.is_editable?w(a?"Folder members with the password can edit":"People with the password can edit"):a?w("Folder members with the password can view")+s:w("People with the password can view")+s;if(d===y.TEAM_ONLY)return e.is_editable?a?w("Folder members at %(team_name)s with the link can edit").format({team_name:m.get_viewer().team_name}):w("People at %(team_name)s with the link can edit").format({team_name:m.get_viewer().team_name}):a?w("Folder members at %(team_name)s with the link can view").format({team_name:m.get_viewer().team_name})+s:w("People at %(team_name)s with the link can view").format({team_name:m.get_viewer().team_name})+s}}}})}.call(this),function(){define("modules/clean/sharing/models/file",["modules/clean/react/browse/constants","modules/constants/legacy"],function(e,t){var r,s;return r=e.FileTypes,s=function(e,s){var o;return e.type!==r.FOLDER?!1:(s.config.isPublicFolderEnabled||null!=s.config.publicAppToken)&&(o=e.fq_path.toLowerCase(),"/public"===o||o.startsWith("/public/"))?!1:s.isCurrentPathWriteable()?!(e.ns_id!==t.root_ns&&!s.currentNSAllowsNesting):!1},{canConvertToSharedFolder:s}})}.call(this),function(){define("modules/clean/teams/cdm_mve_quota_usage",["external/react","modules/clean/react/browse/models","modules/clean/teams/cdm_mve_util","modules/core/i18n"],function(e,t,r,s){var o,n,i,a,l,u;return n=t.QuotaStats,a=r.calculateQuotaClass,i=s._,u=s.format_percent,l=e.DOM,o=e.createClass({displayName:"CdmMveQuotaUsage",propTypes:{quotaStats:e.PropTypes.instanceOf(n).isRequired},mixins:[e.addons.PureRenderMixin],render:function(){var e,t,r,s,o,n,c;return c=this.props.quotaStats,s=c.quotaRawBytes,o=c.quotaRawBytesUsed,e=c.formattedQuota,n=o/s,r="cdm_mve_quota_percent_used "+a(n),t=u(Math.floor(100*n)),l.span({},l.span({className:"u-mar-horizontal-xs"},"•"),l.span({className:r},i("%(used_percent)s of %(available_quota)s used").format({used_percent:t,available_quota:e})))}})})}.call(this),function(){define("modules/clean/teams/cdm_mve_util",[],function(){return{calculateQuotaClass:function(e){return e>=1?"quota-status-overquota":e>=.9?"quota-status-nearquota":""}}})}.call(this),function(){define("modules/clean/teams/limited_team_invite_modal",["external/underscore","external/react","modules/core/html","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/contacts/data","modules/clean/react/modal","modules/clean/teams/limited_team_invite_form","modules/clean/viewer","modules/clean/analytics"],function(e,t,r,s,o,n,i,a,l,u,c,p){var d,h,m,_,f,g,b,v,y;return f=o._,v=o.ungettext,d=a.Contact,m=l.Modal,_=p.TeamsWebActionsLogger,g=t.DOM,b=t.PropTypes,y=c.get_viewer(),h=t.createClass({displayName:"LimitedTeamInviteModal",propTypes:{onInvited:b.func,onDismiss:b.func,populatedCustomMessage:b.string,populatedContacts:b.arrayOf(b.instanceOf(d)),memberInviteLimit:b.number,maxTeamSize:b.number},getInitialState:function(){return{canProceed:!1,submitting:!1}},_canProceed:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onClickInvite:function(t){return t.preventDefault(),this.refs.members.getFinalData(function(t){return function(o){var a,l,u;return u=o.emails,l=o.custom_message,a=t._canProceed(),t.setState({canProceed:a}),a?(t.setState({submitting:!0}),i.WebRequest({url:"/account/team/add_users",subject_user:y.work_user,data:{emails:u,custom_message:l,team_id:y.team_id},complete:function(){return t.isMounted()?t.setState({submitting:!1}):void 0},success:function(o){var i,a,l,u,c,p;return o=JSON.parse(o),a=e.values(o.users),a.length>0?(null!=t.props.memberInviteLimit?(l=t.props.memberInviteLimit-a.length,l>0&&(c={tk:t.props.memberInviteLimit,_camp:"flash"},p=s({path:"/team/upgrade",query:c}),u=v('Members invited. You can invite %(num_rem)s more member before you need to upgrade to Dropbox Business. <a href="%(upsell_url)s">Upgrade now.</a>','Members invited. You can invite %(num_rem)s more members before you need to upgrade to Dropbox Business. <a href="%(upsell_url)s">Upgrade now.</a>',l).format({num_rem:l,upsell_url:p.toString()}),n.success(new r(u)))):n.success(v("Member invited.","Members invited.",a.length)),"function"==typeof(i=t.props).onInvited&&i.onInvited(),t.refs.modal.close()):n.error()},error:function(e){return"rate-limit"===e.getResponseHeader("x-dropbox-app-error")?n.error(new r(f('%(team_name)s has reached the maximum number of team members allowed on Dropbox Basic. Please <a href="/business/contact">contact sales</a> to add more members to your team.').format({team_name:y.team_name}))):n.error()}})):void 0}}(this))},onDismissModal:function(){var e;return _.log("canceled_invite_team_members"),"function"==typeof(e=this.props).onDismiss?e.onDismiss():void 0},onMembersFormChange:function(){return this.setState({canProceed:this._canProceed()})},_getAcceptButtonText:function(){var e;return v("Send invite","Send invites",(null!=(e=this.refs.members)?e.getContacts().length:void 0)||0)},render:function(){return t.createElement(m,{title:f("Invite team members"),acceptButtonText:this._getAcceptButtonText(),dismissButtonText:f("Cancel"),onAccept:this.onClickInvite,onDismiss:this.onDismissModal,acceptButtonDisabled:!this.state.canProceed,submitting:this.state.submitting,className:"limited-team-invite-modal",ref:"modal"},t.createElement(u,{ref:"members",user:y.work_user,onChange:this.onMembersFormChange,errorMessageSpaceFixed:!0,populatedCustomMessage:this.props.populatedCustomMessage,populatedContacts:this.props.populatedContacts,autofocusTokenizer:!0,memberInviteLimit:this.props.memberInviteLimit,maxTeamSize:this.props.maxTeamSize}))}})})}.call(this),function(){define("modules/clean/teams/suggest_invites_modal",["external/underscore","external/react","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/react/modal","modules/clean/teams/limited_team_invite_form","modules/clean/viewer"],function(e,t,r,s,o,n,i,a){var l,u,c,p,d,h;return c=r._,l=n.Modal,p=t.createElement,d=t.DOM,h=a.get_viewer(),u=t.createClass({displayName:"SuggestInvitesModal",getInitialState:function(){return{canProceed:!1,submitting:!1}},_canProceed:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onClickInvite:function(e){return e.preventDefault(),this.refs.members.getFinalData(function(e){return function(t){var r,n;return n=t.emails,r=e._canProceed(),e.setState({canProceed:r}),r?(e.setState({submitting:!0}),o.WebRequest({url:"/team/manage/suggest-members",data:{emails:n},complete:function(){return e.setState({submitting:!1})},success:function(){return s.success(c("Thanks for your suggestions! We’ve sent them to the team admin.")),e.refs.modal.close()}})):void 0}}(this))},onMembersFormChange:function(){return this.setState({canProceed:this._canProceed()})},render:function(){return p(l,{className:"no-scroll-modal",title:c("Suggest %(team_name)s team members").format({team_name:h.team_name}),acceptButtonText:c("Send suggestions"),dismissButtonText:c("Cancel"),onAccept:this.onClickInvite,acceptButtonDisabled:!this.state.canProceed,submitting:this.state.submitting,ref:"modal"},d.div({className:"suggest_invite_modal_notice"},c("We’ll email your suggestions to your team admin, so they can send out invitations.")),p(i,{ref:"members",user:h.work_user,onChange:this.onMembersFormChange,errorMessageSpaceFixed:!1,includeCustomMessage:!1,emailPlaceholder:c("Email addresses"),autofocusTokenizer:!0}))}})})}.call(this),function(){define("modules/clean/teams/team_promo_banner",["external/classnames","external/react","modules/clean/react/button"],function(e,t,r){var s,o,n,i;return n=t.DOM,o=t.createElement,i=t.PropTypes,s=t.createClass({displayName:"TeamPromoBanner",propTypes:{className:i.string,title:i.string,description:i.node,buttons:i.arrayOf(i.shape({text:i.string,handler:i.func}))},render:function(){var t,s;return n.div({className:e("team-promo-banner",this.props.className)},n.div({className:"team-promo-banner-contents"},n.div({className:"team-promo-banner-body"},n.div({className:"team-promo-banner-title"},this.props.title),n.div({className:"team-promo-banner-description"},this.props.description)),n.div({className:"team-promo-banner-buttons"},function(){var e,i,a,l;for(a=this.props.buttons,l=[],s=e=0,i=a.length;i>e;s=++e)t=a[s],l.push(n.span({className:"team-promo-banner-button",key:"button-"+s},o(r.button,{importance:"tertiary",onClick:t.handler},t.text)));return l}.call(this))))}})})}.call(this),define("modules/clean/tokenized_autocompleter",["require","exports","jquery"],function(e,t,r){"use strict";function s(e){for(var t=function(e){r("#"+e.dom_id).on("click",function(t){r("#"+e.text_input_dom_id).focus()})},s=0,o=e.instances;s<o.length;s++){var n=o[s];t(n)}}t.initialize_module=s}),function(){define("modules/clean/unity_browse_interface",["jquery","modules/clean/unity/check_file_cache","modules/clean/unity/features"],function(e,t,r){var s;if(null!=t&&null!=r)return s=function(){function e(){}return e.BATCH_SIZE_LIMIT=100,e.CHECK_FILES_PADDING=50,e.check_file_callback=function(e){return t.set_batch(e)},e.browse_visible_change_callback=function(t,s,o,n){var i,a,l,u,c,p;if(t.length&&(u=Math.max(0,o-e.CHECK_FILES_PADDING),p=Math.min(t.length-1,n+e.CHECK_FILES_PADDING),a=t.slice(u,+p+1||9e9),l=e._get_files_to_check(a),l.length)){for(e._remove_unneeded_items_from_cache(a),c=[];l.length;)i=l.splice(0,e.BATCH_SIZE_LIMIT),c.push(r.check_file_batch(i,s,e.check_file_callback));return c}},e._get_files_to_check=function(e){var r;return function(){var s,o,n;for(n=[],s=0,o=e.length;o>s;s++)r=e[s],r.bytes>=0&&t.is_cached_and_locally_available(r.ns_id,r.ns_path)!==!0&&n.push(r);return n}()},e._remove_unneeded_items_from_cache=function(e){var s,o,n,i,a;for(o={},i=0,a=e.length;a>i;i++)n=e[i],t.is_cached_and_locally_available(n.ns_id,n.ns_path)===!0&&(s=t.get(n.ns_id,n.ns_path),o[r.server_path(n.ns_id,n.ns_path)]=s);return t.clear(),t.set_batch(o)},e}()})}.call(this),function(){define("modules/clean/upsell/prompt_loader",["jquery","modules/clean/uirequest"],function(e,t){var r,s,o,n;return r={init:function(r,s,o,n,i){var a;if(r)return a=e(i?"#prompt-silo .ha-silo":"#ha-container"),new t(a,"/prompt/ha",{data:{ref_controller:s,ref_action:o,campaign_id:n,is_maestro:i},subject_user:r})}},s={init:function(r,s,o,n,i,a,l){var u;return null==l&&(l={}),u=e(a?"#prompt-silo .main-silo":"#outer-frame"),new t(u,"/prompt/main_campaign",{data:{ref_controller:s,ref_action:o,in_app:n,sprite_group:i,skip_main_campaign:l.skip_main_campaign,is_maestro:a},dataType:"json",subject_user:r,success:function(t){return e(".db-modal-overlay").is(":visible")||e("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal"),"function"==typeof l.success?l.success(t):void 0}})}},n={init:function(r,s){return new t(e("#page-header"),"/prompt/top_notification_bar",{data:{ref_controller:r,ref_action:s},success:function(t){return e("body").addClass(e("[data-body-class]").data("body-class"))}})}},o={_didCampaignLoad:function(e,t,r){var s,o,n,i,a,l,u;for(null==r&&(r=null),a=e.actions||[],l=0,u=a.length;u>l;l++)if(s=a[l],i=s[0],o=s[1],n=s[2],n===t&&o)return r?o.indexOf(r)>=0:!0;return!1},_didHeaderBubbleLoad:function(e){return this._didCampaignLoad(e,"^body #notification-feed-nav-link","header-bubble-container")||this._didCampaignLoad(e,"^body #prompt-silo .account-header-silo","header-bubble-container")},_didHeaderLinkLoad:function(e){return!this._didHeaderBubbleLoad(e)&&this._didCampaignLoad(e,"^body #notification-feed-nav-link","header-link")||this._didCampaignLoad(e,"^body #prompt-silo .account-header-silo","header-link")},didMainCampaignLoad:function(e){return this._didHeaderBubbleLoad(e)||this._didCampaignLoad(e,"^body #outer-frame")||this._didCampaignLoad(e,"^body #prompt-silo .main-silo")},didAccountHeaderCampaignLoad:function(e){return this._didHeaderBubbleLoad(e)||this._didHeaderLinkLoad(e)},didTopNotificationLoad:function(){return!!e("#top-notification-bar-container").length},init:function(e,t,o,n,i,a){var l;return l=this.didTopNotificationLoad()?{skip_main_campaign:!0,success:function(s){return function(n){return s.didAccountHeaderCampaignLoad(n)?void 0:r.init(e,t,o,null,a)}}(this)}:{success:function(s){return function(n){return s.didMainCampaignLoad(n)?void 0:r.init(e,t,o,null,a)}}(this)},s.init(e,t,o,n,i,a,l)}},{HALoader:r,MainAndAccountHeaderLoader:s,MutuallyExclusiveLoader:o,TopNotificationBarLoader:n,initialize_module:function(e){var t;return e.mutually_exclusive_loading?t=o:(t=s,r.init(e.user_id,e.controller,e.action,null,e.is_maestro)),t.init(e.user_id,e.controller,e.action,e.in_app,e.sprite_group,e.is_maestro)}}})}.call(this),function(){define("modules/clean/web_user_action_logger",["modules/clean/ajax"],function(e){var t,r,s,o;return o={DOWNLOAD:"download",MOVE:"move",OPEN_MOVE_MODAL:"open_move_modal",RENAME:"rename",ADD_COMMENT:"add_comment",OPEN_COPY_MODAL:"open_copy_modal",COPY:"copy",DELETE:"delete",PERMANENT_DELETE:"permanent_delete",VERSIONS:"versions",SORT_RECORDS:"sort_records",SELECT_ROW:"select_row",OPEN_ROW:"open_row",UPLOAD_FILE:"upload_file",CREATE_FOLDER:"create_folder",VIEW_SHARE_MODEL:"view_share_model",TOGGLE_DELETED_FILES:"toggle_deleted_files",NAV_NEW_PAGE:"nav_new_page"},r=3,t=6e5,s=function(){function s(){}return s.prototype.error_count=0,s.prototype.last_error=Date.now(),s.prototype.should_report=!0,s.prototype.log=function(s,o,n){return this.should_report&&(this.error_count<r||Date.now()-this.last_error>t)?e.SilentBackgroundRequest({url:"/log/web_user_action",data:{_subject_uid:s,event_type:o,extra_params:JSON.stringify(n)},error:function(e){return function(){return e.error_count+=1,e.last_error=Date.now()}}(this),success:function(e){return function(t){var r,s,o;try{return r=JSON.parse(t),(null!=r?r.continue_sending:void 0)||(e.should_report=!1),e.error_count=0}catch(t){throw s=t,e.error_count+=1,e.last_error=Date.now(),s}}}(this)}):void 0},s}(),{WebUserActionLog:new s,WebUserActionLogEvents:o,WebUserActionLogClass:s,MAX_ERRORS:r}})}.call(this),function(){define("modules/constants/maestro_feedback",[],function(){return window.MaestroFeedbackConstants})}.call(this),function(){define("modules/dirty/browse/copy_public_url",["jquery","dropbox"],function(e,t){var r,s;return r=t.BrowseActions,s=t.Modal,{initialize_module:function(t){return e("#"+t.copy_link_dom_id).on("click",function(e){return r.shortenPublicLink(),!1}),e("#"+t.cancel_button_dom_id).on("click",function(e){return s.hide(e)})}}})}.call(this),function(){define("modules/dirty/browse/show_share_buttons",["jquery","modules/core/browser","modules/clean/browse_events","modules/clean/viewer"],function(e,t,r,s){var o,n;return n=function(t){return null==t&&(t=!1),t?e(document).one(r.RENDER,function(){return o()}):o()},o=function(){var r,s;return s=e(".browse-file-row"),0===s.length?void t.redirect("?upload=1"):(s.addClass("browse-file-row--enabled-by-progressbar"),r=e(".inline-share-button"),s?(r.hasClass("pulse")&&(r.removeClass("pulse"),r[0].offsetWidth=r[0].offsetWidth),r.addClass("pulse"),r.on("click.removePulse",function(){return r.css("display","").removeClass("pulse")}),r.off(".removePulse")):void 0)},n})}.call(this),function(){define("modules/dirty/react/browse/browse",["jquery","external/immutable","external/react","external/underscore","external/classnames","modules/clean/account/email","modules/clean/browse_interface","modules/clean/contacts/cache","modules/clean/contacts/data","modules/clean/em_string","modules/clean/flux/store_mixin","modules/clean/history","modules/clean/notserver","modules/clean/pagination_manager","modules/clean/react/app_actions_view","modules/clean/react/browse/api","modules/clean/react/browse/cdm_mve_work_usage_banner","modules/clean/react/browse/constants","modules/dirty/react/browse/file_actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/uploader","modules/clean/react/file_uploader/store","modules/clean/react/maestro/top_menu_container","modules/clean/search/actions","modules/clean/search/search_bar","modules/clean/search/search_helpers","modules/clean/search/store","modules/clean/sharing/ui_util","modules/clean/viewer","modules/clean/web_timing_logger","modules/clean/zendesk_feedback","modules/constants/comments_panel","modules/constants/contacts","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/react/browse/actions","modules/clean/react/browse/browse_location","modules/clean/react/browse/comment_status","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/global_actions","modules/dirty/react/browse/item_list","modules/dirty/react/browse/selection_actions","modules/dirty/react/browse/preview_sf_members","modules/dirty/react/browse/pinned_team_folder","modules/dirty/react/browse/shared_with","modules/clean/react/file_viewer/controller","modules/dirty/search/search_results","modules/dirty/sharing/browse_ui_util","require"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N,A,R,x,M,O,L,k,B,U,H,q,G,W,j,V,z,Q,K,Y,X,$,J,Z,ee){var te,re,se,oe,ne,ie,ae,le,ue,ce,pe,de,he,me,_e,fe,ge,be,ve,ye,we,Se,Te,Pe,De,Ee,Ie,Ce,Fe,Ne,Ae,Re,xe,Me,Oe,Le,ke,Be,Ue,He,qe,Ge,We;return _e=n.EmailVerification,he=a.DefaultContactsCache,pe=l.Contact,de=l.ContactTypes,De=d.NotClients,Fe=g.REACT_FILE_VIEWER_ELEMENT_ID,me=g.DropTargetHighlightMode,be=g.FileTypes,Te=g.LoadingStates,Pe=g.NameSpaceAccess,Ae=g.ShareFolderModalTypes,Ne=g.SEARCH_PREFIX,ae=g.BrowseSortField,ne=v.BrowseLogger,oe=v.BrowseLogEventSources,fe=y.File,re=y.BrowseContext,Ee=y.Paper,le=w.BrowseStore,ge=T.FileModalController,ve=P.FileUploader,Me=D.UploaderStore,xe=E.TopMenuContainer,we=A.GoldenGate,Ge=A.showZendeskFlyoutIfAllowed,Ue=M.showQualitativeFeedbackForm,Oe=B._,We=B.ungettext,se=j.BrowseContextMenu,ye=V.GlobalActions,Be=V.getGlobalActions,Se=z.ItemListController,ie=Q.BrowseSelectionMenu,Ce=K.PreviewSFMembersPanel,Ie=Y.PinnedTeamFolder,Re=X.SharedWithController,qe=Z.showTiburonUIIfAllowed,He=Z.showSharedContentLinkSyncModal,ke=r.DOM,Le=r.createElement,te=r.createClass({displayName:"BrowseAppController",mixins:[c(le,Me,N)],propTypes:{"from-scl-sync-modal":r.PropTypes.bool,"init-data":r.PropTypes.object,"limited-team-banner-upsell":r.PropTypes.bool,"notify-path-does-not-exist":r.PropTypes.string,"notify-path-is-deleted":r.PropTypes.string,"share-link":r.PropTypes.bool,"share-prefill-email":r.PropTypes.string,"trademark-business":r.PropTypes.string,"email-just-verified":r.PropTypes.bool,"email-just-verified-and-changed":r.PropTypes.bool,"send-verification-email":r.PropTypes.bool,"show-qualitative-feedback-form":r.PropTypes.bool,"is-pagelet":r.PropTypes.bool,"account-photo-url":r.PropTypes.string},_get_state_from_stores:function(){var e;return e=le.path(),{context:le.context(),files:le.files(),filesWithoutTeamFolders:"/"===e?le.filesWithoutTeamFolders():t.List(),teamFolders:le.teamFolders(),loadingState:le.loadingState(),path:e,selection:le.selection(),selectedFiles:le.selectedFiles(),fileRename:le.fileRename(),user:le.user(),shouldShowDeletedFiles:le.shouldShowDeletedFiles(),isDraggingInternalFiles:Me.numDraggingFiles()>0&&Me.isInternalTransfer(),isDraggingExternalFiles:Me.numDraggingFiles()>0&&!Me.isInternalTransfer(),activeDropTarget:le.activeDropTarget(),isUploadModalOpen:Me.isUploadModalOpen(),isTextSelectable:!!le.fileRename(),inCopyMode:le.inCopyMode(),createNewFolderState:le.newFolderCreationState(),isSearchMode:!!N.latestQuery(),currentSort:le.currentSort()}},_preloadLargeModules:function(){return ee(["dropbox"])},componentWillMount:function(){var e,t,r,s,o,n,a,l,u,c,d,m,_,f,g,b,v,y,w,S;return this.previousHistoryCallbackPath=null,this.hasLoadedFilesForTheVeryFirstTime=!1,S=R.get_viewer().get_user_by_id(this.props["user-id"]),w=i.get_browse_root(S),t=p.deconstruct_url(),f=this.props["init-fq-path"]||"/",g=Boolean(this.props["should-show-deleted-files"]),o=Boolean(this.props["search-query"]),o||this._setupFileEventListener(S.id),a=this.props["init-data"],a?(e=re.fromServerObject(a),c=Boolean(a.paginated)?Te.LOADING_REMAINING_PAGES:Te.LOADED,l=c===Te.LOADING_REMAINING_PAGES,r=l?[]:a.file_info,d=a.ns_id_to_mount_point,s=this.props["select-fq-paths"],v=a.team_folders_js_info,q.initializeEverything({user:S,path:f,files:r,urlPrefix:w,context:e,mountPoints:d,fqPathsToSelect:s,loadingState:c,shouldShowDeletedFiles:g,teamFolders:v}),l&&(_=new h,m=function(e,t){return q.add({path:f,files:t}),e.areAllItemsReady()?(q.setLoadingState({loadingState:Te.LOADED,path:f}),e.stopAutoFetching()):void 0},_.initialize(a.first_page,"sjid","/browse_get_next",S.id,m),"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||_.startAutoFetching())):(q.setUrlPrefix({prefix:w}),q.setUser({user:S}),q.setShouldShowDeletedFiles({shouldShowDeletedFiles:g,shouldReloadFolder:!1}),s=this.props["select-fq-paths"],q.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:s}),this.hasTTIBeenLogged=!1,this.props["search-query"]||this.navigateToPath(f)),this.props["search-query"]||(u=this.props["share-link"],n=Boolean(this.props["preview-file-info"]),u||n||(y=this._getUrlForFQPath(f),this._sanitizeBrowserLocation(y))),b=!o,p.add_callback(w,this.handleFileLocationChange,!0),p.add_callback(Ne,this.handleSearchLocationChange,b),p.add_exit_callback(Ne,I.clearSearch),this.setState(this._get_state_from_stores()),L.PREFETCH_ALLOWED?he.load_contacts():void 0},componentDidMount:function(){var e,t,r,s,o,n,i,a,l,c,d,h;return this.props["init-data"]&&(this.hasTTIBeenLogged||(x.mark_time_to_view(),x.mark_time_to_interactive(),this.hasTTIBeenLogged=!0,this._preloadLargeModules())),this._mountFileViewerTarget(),this.props["from-scl-sync-modal"]&&Ge("tiburon_receive",Oe("You just received a folder with Dropbox")),this.props["show-qualitative-feedback-form"]&&Ue(t=!0),r=this.props["initial-share-modal-type"],a=this.props["preview-file-info"],Boolean(this.props["loaded-with-explicit-preview"])&&!a&&(c=p.deconstruct_url(),h=c.url,o=c.path,l=c.qargs,delete l.preview,p.replace_state(o,l)),a?(i=fe.fromServerObject(a),q.openPreviewForFile({file:i,onCloseViewer:this._restoreUrlAfterFileViewClose}),r&&(d=this.props["share-prefill-email"],d?(s="GRANT_ACCESS",n=[new pe({type:de.EMAIL,email:d})]):(s="DESKTOP_CLIENT",n=[]),qe(this.state.user,i,{origin:s,prefillContacts:n}))):r&&this._showShareModal(r,this.state.path,this.state.user),null!=this.props["notify-path-is-deleted"]?(e=Oe("The folder ‘%(folder_name)s’ is deleted.").format({folder_name:u.em_snippet(this.props["notify-path-is-deleted"],15)}),U.error(e)):null!=this.props["notify-path-does-not-exist"]&&(e=Oe("The folder ‘%(folder_name)s’ doesn’t exist.").format({folder_name:u.em_snippet(this.props["notify-path-does-not-exist"],15)}),U.error(e)),this.props["email-just-verified"]?_e.getForRole(this.state.user.role).show_verified_modal():this.props["email-just-verified-and-changed"]?_e.getForRole(this.state.user.role).show_verified_and_changed_modal():this.props["send-verification-email"]&&_e.getForRole(this.state.user.role).show_sent_modal(),W.setup()},componentWillUpdate:function(e,t){return t.isSearchMode&&!this.state.isSearchMode?De[this.state.user.id].unsubscribe(this.handlerId):!t.isSearchMode&&this.state.isSearchMode&&this._setupFileEventListener(this.state.user.id),t.files.equals(this.state.files)?void 0:setTimeout(function(e){return function(){return e.handleFileListUpdated()}}(this),0)},componentWillUnmount:function(){return W.teardown()},_restoreUrlAfterFileViewClose:function(){var e,t;return t=this._getUrlForFQPath(this.state.path),Boolean(this.props["loaded-with-explicit-preview"])?(e=p.deconstruct_url().qargs,e=s.omit(e,"preview","select")):e={},p.replace_state(t,e)},_getUrlForFQPath:function(e){var t;return t="/"===e?"":H.encode_parts(e),le.urlPrefix()+t},_sanitizeBrowserLocation:function(e){var t,r;return t=p.deconstruct_url().qargs,r=s.pick(t,"d","select","preview"),p.replace_state(e,r)},_mountFileViewerTarget:function(){var e;return e=document.getElementById(Fe),e?void 0:(e=document.createElement("div"),e.id=Fe,document.body.insertBefore(e,document.body.children[0]))},_showShareModal:function(e,t,r){var s,o,n;return n=this.props["share-prefill-email"],n?(s="GRANT_ACCESS",o=[new pe({type:de.EMAIL,email:n})]):(s="DESKTOP_CLIENT",o=[]),qe(r,{fqPath:this.props["init-fq-path"],isFolder:!0,nsId:this.props["ns-id"]&&this.props["ns-path"]?this.props["ns-id"]:null,origin:s,targetNsId:this.props["ns-id"]&&!this.props["ns-path"]?this.props["ns-id"]:null,prefillContacts:o})?void 0:ee(["dropbox"],function(s){var o;switch(o=s.SharingModals,e){case Ae.ShareExisting:return o.show_share_existing_modal(t,r);case Ae.EditShared:return o.show_shared_folder_options_modal(t,r);case Ae.EditSharedSubFolder:return o.show_shared_subfolder_modal(t,r)}})},_setupFileEventListener:function(e){var t;return t=De[e],this.handlerId=t.subscribe_sfj({name:"BrowseEventDispatcher",handler:function(r){return function(){var s;return s=r.state.path,_.getChangesForDirectory({path:s,userId:e,namespaceToJournalIdMap:t.get_ns_map(),includeDeletedFiles:r.state.shouldShowDeletedFiles,onSuccess:function(e){return q.computeAndApplyDeltasFromNotServer({payload:e,path:s}),t.handler_success(r.handlerId,{ns_map:e.ns_map})}})}}(this)})},_ensureFileViewerIsOpenedOrClosedIfNeeded:function(e){var t,r;if(null==e&&(e={}),t=$.isShown(),e.preview&&!t){if(r=le.getFileByFilename(e.preview))return q.navigateToFileOrFolder({file:r})}else if(t&&!e.preview)return q.closeFileViewer()},handleFileLocationChange:function(e,t){return e="undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?this.props["init-fq-path"]||"/":"/"+H.decode(e),this._ensureFileViewerIsOpenedOrClosedIfNeeded(t),e!==this.previousHistoryCallbackPath?(this.previousHistoryCallbackPath=e,e!==le.path()?this.navigateToPath(e):void 0):void 0},handleSearchLocationChange:function(e,t){var r,s,o;if(t&&(r=t.query||t.query_unnormalized,e=t.path||t.last_fq_path||"/",r&&(e!==this.state.path||r!==N.latestQuery())))return o=null!=(s=this.state.user)?s:R.get_viewer().get_user_by_id(this.props["user-id"]),this.previousHistoryCallbackPath=e,e!==le.path()&&q.setPath({path:e}),I.runSearch({user:o,path:e,query:r})},navigateToPath:function(e){var t;return t=function(e){return function(){return e.hasTTIBeenLogged?void 0:(x.mark_time_to_view(),x.mark_time_to_interactive(),e.hasTTIBeenLogged=!0,e._preloadLargeModules())}}(this),q.setPath({path:e,onPathLoaded:t})},handleFileListUpdated:function(){var e,t;return $.isShown()?this.state.files.isEmpty()?q.closeFileViewer():q.updatePreview({files:this.state.files.toJS()}):(e=null!=(t=p.deconstruct_url())?t.qargs:void 0,this._ensureFileViewerIsOpenedOrClosedIfNeeded(e))},handleDelete:function(){var e,t;return e=we.canDeepNest(this.state.user.id)&&this.state.selectedFiles.toArray().some(function(e){return fe.isTeamSharedFolder(e)}),this.state.context.isCurrentPathWriteable()&&!e?(t=this.state.selectedFiles.toArray(),ge.showDelete(this.state.user,t,this.state.context,function(){return q.selectRowsFromNotServer(t)})):e?U.error(Oe("Team folders can’t be deleted.")):U.warning(Oe("You don’t have permission to delete files in this folder."))},handleRestoreMulti:function(){return ge.showRestore(this.state.user,this.state.selectedFiles.toArray())},handlePermanentDelete:function(){var e;return e=function(){return q.reloadCurrentPath()},ge.showPermanentlyDelete(this.state.user,this.state.selectedFiles.toArray(),e)},render:function(){var e,t;return e=this.props["sync-vars"],e.sync_user_role=this.state.user.role,t=s.extend({},{isPagelet:this.props["is-pagelet"],syncVars:e,limitedTeamBannerUpsell:this.props["limited-team-banner-upsell"],trademarkBusiness:this.props["trademark-business"],shouldOpenUploadModal:this.props["should-open-upload-modal"],actionHandlers:{onDelete:this.handleDelete,onRestoreMulti:this.handleRestoreMulti,onPermanentDelete:this.handlePermanentDelete}},this.state),Le(ce,t)}}),ue=r.createClass({displayName:"BrowseView",mixins:[r.addons.PureRenderMixin],propTypes:{context:r.PropTypes.instanceOf(re).isRequired,files:r.PropTypes.instanceOf(t.List).isRequired,filesWithoutTeamFolder:r.PropTypes.instanceOf(t.List),teamFolders:r.PropTypes.object,path:r.PropTypes.string.isRequired,shouldShowDeletedFiles:r.PropTypes.bool.isRequired,isUploadModalOpen:r.PropTypes.bool.isRequired,isTextSelectable:r.PropTypes.bool.isRequired,inCopyMode:r.PropTypes.bool.isRequired,user:r.PropTypes.object.isRequired,selection:r.PropTypes.object,loadingState:r.PropTypes.oneOf(s.values(Te)),selectedFiles:r.PropTypes.instanceOf(t.OrderedSet),isDraggingInternalFiles:r.PropTypes.bool,isDraggingExternalFiles:r.PropTypes.bool,activeDropTarget:r.PropTypes.instanceOf(fe),isSearchMode:r.PropTypes.bool,isPagelet:r.PropTypes.bool,
syncVars:r.PropTypes.object,limitedTeamBannerUpsell:r.PropTypes.bool,trademarkBusiness:r.PropTypes.string,actionHandlers:r.PropTypes.object},getDefaultProps:function(){return{selectedFiles:t.OrderedSet(),selection:void 0}},getInitialState:function(){return{currentMultiColumnSortField:ae.SHARED_WITH}},componentDidMount:function(){return this._maybeRenderSyncFolderModal(),this._maybeOpenUploaderOnMount(),this._maybeSetUrl()},componentWillUnmount:function(){return this._unmountFileViewerTarget()},_maybeSetUrl:function(){var e;return this.props.isPagelet&&this.props.isSearchMode?(e={path:this.props.path,query:N.latestQuery()},q.setUrl({prefix:Ne,qargs:e})):void 0},_maybeRenderSyncFolderModal:function(){var e;return(null!=(e=this.props.syncVars)?e.sync_ns_id:void 0)?ee(["dropbox"],function(e){return function(t){var r;return r=t.SharingModel,r.show_shared_content_sync_modal("can_edit",e.props.syncVars.sync_ns_id,e.props.syncVars.sync_folder_name,e.props.syncVars.sync_folder_size,e.props.syncVars.sync_user_role,e.props.syncVars.sync_out_of_quota)}}(this)):void 0},_maybeOpenUploaderOnMount:function(){return this.props.shouldOpenUploadModal?this.showFileUploader():void 0},_unmountFileViewerTarget:function(){var e;return e=document.getElementById(Fe),e?document.body.removeChild(e):void 0},_getCurrentDropTargetHighlightMode:function(){var e;return!this.props.context.isInsideSharedFolder||(e=this.props.context.currentSharedFolderPermissionRole)!==Pe.ACCESS_NO_ACCESS&&e!==Pe.ACCESS_READER&&e!==Pe.ACCESS_READER_NO_COMMENT?this.props.isDraggingInternalFiles?this.props.selectedFiles.count(function(e){return e.isDeleted})?me.NONE:this.props.selectedFiles.count(function(e){return e.type===be.TEAM_SHARED_FOLDER})?me.NONSELECTED_NONSHARED_NONTEAM_FOLDERS:this.props.selectedFiles.count(function(e){return e.type===be.SHARED_FOLDER})?me.NONSELECTED_NONSHARED_FOLDERS:me.NONSELECTED_FOLDERS:this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen?me.ALL_FOLDERS:me.NONE:me.NONE},_getCurrentAppActionsProps:function(){var e,t,r,s,o;return s=this.props.selectedFiles.count(),o=s>0?We("%(count)d Item Selected","%(count)d Items Selected",s).format({count:s}):"",r=ke.div({}),s>0?(e=b.getActionsForFileCollection({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0,actionHandlers:this.props.actionHandlers,isPagelet:this.props.isPagelet,source:this.props.isPagelet?oe.MAESTRO_RIGHT_SIDEBAR:oe.LEGACY_HEADER_ACTIONS}),1===s&&this.props.isPagelet&&we.hasAudienceBox(this.props.user.id)&&(r=Le(Re,{file:this.props.selectedFiles.toArray()[0],browseContext:this.props.context,tabIndex:-1,isInAudienceBox:!0,isPagelet:this.props.isPagelet}))):(e=Be({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,isPagelet:this.props.isPagelet,isContextMenu:!1}),this.props.isPagelet&&we.hasAudienceBox(this.props.user.id)&&(r=Le(Re,{browseContext:this.props.context,tabIndex:-1,isInAudienceBox:!0,isPagelet:this.props.isPagelet}))),t=e.map(function(e,t){var r;return r={displayName:e.label,handleClick:e.performAction},t>0&&(r.iconName=e.spriteName),r}),{key:"maestro-app-actions",headerText:o,primaryMenuItem:t[0],primarySubnode:r,secondaryMenuItems:t.slice(1)}},showFileUploader:function(){var e;return this.props.isPagelet||this.refs.contextMenu.closeMenu(),null!=(e=this.refs.fileUploader)?e.showModal():void 0},openContextMenuAtPosition:function(e,t,r){return null==r&&(r=null),this.props.isPagelet?void 0:this.refs.contextMenu.openMenuAtPosition(e,t,r)},handleSelectionChange:function(e){var t;return t=le.getFileByFullPath(e.selected.first()),t&&ne.logSelectRow({uid:this.props.user.id,entity_type:t.is_dir?"folder":"file"}),q.setSelection({selection:e})},handleFileListSortChange:function(e,t){return ne.logSortRecords({uid:this.props.user.id,sort_by:e,sort_direction:t}),q.sortFiles({sortField:e,direction:t})},_handleSearch:function(e){return e?q.setUrl({prefix:Ne,qargs:{path:le.path(),query:e}}):q.setUrl({path:le.path()})},_handleSearchSuggestionOpen:function(e){return e instanceof fe?e.is_unmounted?He(this.props.user,e):(F.logSearchAction(e,this.props.user,e.is_dir?"folder_open":"file_view","dropdown-view"),q.navigateToFileOrFolder({file:e})):e instanceof Ee?k.open_tab(e.url):void 0},_shouldShowPinnedTeamFolder:function(){var e;return e=this.props.loadingState===Te.LOADED,this.props.context.showPinnedTeamFolder&&null!=this.props.teamFolders.first()&&e},_renderSearchResults:function(e){return Le(J,{path:this.props.path,user:this.props.user,topMenuItems:e,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness,isPagelet:this.props.isPagelet,onFullSearch:function(e){var t;return e.preventDefault(),t={path:"/",query:N.latestQuery()},q.setUrl({prefix:Ne,qargs:t})}})},render:function(){var e,t,r,s,n,i,a,l,u,c,p,d,h;return h=this.props.isPagelet?Le(xe,{user:this.props.user,viewer:R.get_viewer(),showSearchBar:!0,currentPath:this.props.path,onSearch:this._handleSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}):Le(C,{user:this.props.user,currentPath:this.props.path,isPagelet:this.props.isPagelet,isSearchActive:this.props.isSearchMode&&!this.props.isPagelet,onSearch:this._handleSearch,onFileOrFolderOpen:this._handleSearchSuggestionOpen,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,trademarkBusiness:this.props.trademarkBusiness}),this.props.isSearchMode?this._renderSearchResults(h):(c=this.props.loadingState!==Te.LOADING_FIRST_PAGE&&!this.props.context.isInsideDeletedFolder,r=c&&this.props.context.isInFolderMode&&this.props.context.isInsideSharedFolder,t=c&&this.props.context.isInFolderMode&&"/"!==this.props.context.currentFQPath,e=c&&this.props.context.cdmMveQuotaStats&&"work"===this.props.user.role&&!this.props.context.isInsideSharedFolder,a=r&&!we.hasNewMembershipUI(this.props.user.id)&&!(this.props.isPagelet&&we.hasAudienceBox(this.props.user.id)),i=t&&we.hasNewMembershipUI(this.props.user.id)&&!(this.props.isPagelet&&we.hasAudienceBox(this.props.user.id)),u=a||i,n=this.props.context.showSharedFolderCreateTeamPromo,s={"browse-box":!0,list_view:!0,"file-browse":!0,"has-preview-sf-members":a,"has-preview-sf-members--golden-gate":i,"has-preview-sf-members--with-team-promo":r&&n,"has-pinned-team-folder":this._shouldShowPinnedTeamFolder(),"has-cdm-mve-banner":e},ke.div({id:"browse-box",className:o(s)},ke.header({},ke.div({id:"browse-header",className:"browse-header"},ke.div({id:"browse-global-actions-bar",className:"browse__global-actions clearfix u-mar-bottom-m"},Le(G,{path:this.props.path,user:this.props.user,selectedFiles:this.props.selectedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,shouldHighlightDropTargets:this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles&&!this.props.isUploadModalOpen}),h,ke.div({id:"browse-rightmenu",className:"u-l-fr"},l=null!=this.props.context.currentFQPath,this.props.user&&l?[Le(ve,{ref:"fileUploader",key:1})]:void 0,!this.props.isPagelet&&this.props.user&&l?[Le(ye,{shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isActionsBarDisabled:this.props.loadingState===Te.LOADING_FIRST_PAGE,context:this.props.context,user:this.props.user,onFileUpload:this.showFileUploader,key:0})]:void 0)),u?Le(Ce,{context:this.props.context,user:this.props.user,isPagelet:this.props.isPagelet}):e?Le(f,{userQuota:this.props.context.cdmMveQuotaStats}):void 0,this._shouldShowPinnedTeamFolder()?Le(Ie,{teamFolder:this.props.teamFolders.first(),context:this.props.context,user:this.props.user,selection:this.props.selection,loadingState:this.props.loadingState,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isTextSelectable:this.props.isTextSelectable}):void 0)),ke.main({},this.props.isPagelet?void 0:[Le(ie,{onActionButtonClick:function(e){return function(){return e.refs.itemListController.getWrappedComponent().focusSelectedRow()}}(this),selectedFiles:this.props.selectedFiles,user:this.props.user,context:this.props.context,actionHandlers:this.props.actionHandlers,key:"browse-selection-menu"})],Le(Se,{ref:"itemListController",items:this.props.context.showPinnedTeamFolder?this.props.filesWithoutTeamFolders:this.props.files,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.handleSelectionChange,fileRename:this.props.fileRename,user:this.props.user,path:this.props.path,context:this.props.context,loadingState:this.props.loadingState,isTextSelectable:this.props.isTextSelectable,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isPagelet:this.props.isPagelet,activeDropTarget:this.props.activeDropTarget,dropTargetHighlightMode:this._getCurrentDropTargetHighlightMode(),createNewFolderState:this.props.createNewFolderState,openContextMenuAtPosition:this.openContextMenuAtPosition,activeSortField:null!=(p=this.props.currentSort)?p.sortField:void 0,activeSortDirection:null!=(d=this.props.currentSort)?d.direction:void 0,onSortChange:this.handleFileListSortChange,initialMultiColumnSortField:this.state.currentMultiColumnSortField,actionHandlers:this.props.actionHandlers}),this.props.isPagelet?void 0:Le(se,{user:this.props.user,selectedFiles:this.props.selectedFiles,context:this.props.context,shouldShowDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.showFileUploader,actionHandlers:this.props.actionHandlers,ref:"contextMenu"}),this.props.isPagelet?[Le(m,this._getCurrentAppActionsProps())]:void 0)))}}),ce=S(ue,["/static/css/browse/browse-vflrH05S2.css"]),{BrowseApp:te,BrowseView:ue}})}.call(this),function(){define("modules/dirty/react/browse/context_menu",["external/immutable","external/react","external/underscore","modules/dirty/react/browse/file_actions","modules/dirty/react/browse/global_actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/models","modules/clean/react/context_menu_v2"],function(e,t,r,s,o,n,i,a){var l,u,c,p,d,h,m,_;return m=s.getActionsForFileCollection,_=o.getGlobalActions,c=n.BrowseLogEventSources,l=i.BrowseContext,d=a.GlobalContextMenu,p=a.ContextMenuItem,h=t.createElement,u=t.createClass({displayName:"BrowseContextMenu",propTypes:{context:t.PropTypes.instanceOf(l).isRequired,isSearchMode:t.PropTypes.bool,selectedFiles:t.PropTypes.instanceOf(e.OrderedSet).isRequired,shouldShowDeletedFiles:t.PropTypes.bool,shouldShowGlobalActions:t.PropTypes.bool,user:t.PropTypes.object.isRequired,onFileUpload:t.PropTypes.func,actionHandlers:t.PropTypes.object},getDefaultProps:function(){return{onFileUpload:function(){},actionHandlers:{},isSearchMode:!1,shouldShowDeletedFiles:!1,shouldShowGlobalActions:!0}},openMenuAtPosition:function(e,t,r){return null==r&&(r=null),this.refs.contextMenu.openMenuAtPosition(e,t),null!=r?this.elemToFocusAfterClose=r:void 0},closeMenu:function(){return this.refs.contextMenu.closeMenu()},toggleMenu:function(e){return this.refs.contextMenu.toggleMenu(e)},render:function(){var e,t,s,o,n,i,a,l,u,f;if(o=[],this.props.shouldShowGlobalActions&&this.props.selectedFiles.isEmpty())s=_({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload,isContextMenu:!0});else{if(this.props.selectedFiles.isEmpty())return null;s=m({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,actionHandlers:this.props.actionHandlers,isSearchMode:this.props.isSearchMode,source:c.LEGACY_CONTEXT_MENU})}for(e=function(e){return p({text:e.label,icon:{group:"web",name:e.spriteName},onClick:e.performAction,href:e.href,isDisabled:e.disabled})},n=0,a=s.length;a>n;n++)t=s[n],l=e(t),(null!=(u=t.subItems)?u.length:void 0)&&(f=r.map(t.subItems,e),l=l.set("subMenuItems",f)),o.push(l);return i=["a:not(.filename-link)","input","button","textarea","select","#notify-wrapper",".db-modal-wrapper",".react-file-viewer",".bubble-dropdown",".pinned-team-folder__file-row"],h(d,{alwaysOpenOnCapture:!0,ignoreSelectors:i.join(),items:o,onMenuClose:function(e){return function(t){var r;return null!=e.elemToFocusAfterClose?("function"==typeof(r=e.elemToFocusAfterClose).focus&&r.focus(),e.elemToFocusAfterClose=null):void 0}}(this),ref:"contextMenu"},this.props.children)}}),{BrowseContextMenu:u}})}.call(this),function(){define("modules/dirty/react/browse/file_actions",["external/underscore","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/action_logger","modules/clean/react/browse/util","modules/clean/react/file_modal_controller","modules/clean/search/search_helpers","modules/clean/sharing/ui_util","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/clean/viewer","modules/constants/browse","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/dirty/react/browse/sharing_shims","modules/dirty/sharing/browse_ui_util","require"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v){var y,w,S,T,P,D,E,I,C,F,N,A,R,x,M;return T=o.FileTypes,y=n.BrowseLogger,N=i.getRevisionsUri,S=a.FileModalController,P=u.GoldenGate,D=f._,A=g.hasMultipleSharingOptions,x=g.showShareFolderModal,M=g.showShareLinkModal,w={showTiburonShare:!1,showLegacyShareFolder:!1,showLegacyShareLink:!1,showCopyPublicFolderFileLink:!1,showOpen:!1,showDownload:!1,showComment:!1,showDelete:!1,showArchive:!1,showRemove:!1,showRename:!1,showRenameTeamFolder:!1,showMove:!1,showCopy:!1,showPhotos:!1,showVersions:!1,showRestore:!1,showReadd:!1,showPermanentDelete:!1,showRemoveAccess:!1},R=function(e){return e.isDeleted||e.is_unmounted},F=function(t){var r,s,o,n,i,a;return a=t.user,s=t.context,o=t.files,r=e.clone(w),i=o.every(function(e){return!R(e)}),n=!i&&o.every(R),i?I({actions:r,files:o,context:s,user:a}):n?E({actions:r,files:o,context:s}):r},I=function(e){var t,r,s,o,n,i,a,l,u,h,m,_,f,g,v,y;return t=e.actions,o=e.files,r=e.context,y=e.user,h=1===o.count(),m=h&&o.first().is_dir,_=h&&!o.first().is_dir,u=o.some(function(e){return e.type===T.SHARED_FOLDER||e.type===T.TEAM_SHARED_FOLDER}),f=o.some(function(e){return e.type===T.TEAM_SHARED_FOLDER}),i=o.every(function(e){return e.in_root_coll}),l=y.id===(null!=(v=d.get_viewer().photos_user)?v.id:void 0),g=!1,t.showCopy=!f,f||(h&&u&&!r.isInsideTeamFolderTree?t.showRemove=!0:t.showDelete=!0,t.showRename=r.isInFolderMode&&h,t.showMove=!0),y.is_team_admin&&P.hasContentManagerAndSuperAdmin(y.id)&&h&&f&&(t.showArchive=!0,t.showRenameTeamFolder=!0),h&&(s=o.first(),a=b.fileIsInPublicFolder(r,s),a||(b.isTiburonUIAllowed(y,s,r.isInFolderMode?r:null)?t.showTiburonShare=!0:(n=A(y,s,r),t.showLegacyShareLink=!f,t.showLegacyShareFolder=f||n)),g=null!=p&&(null!=c?c.is_cached_and_locally_available(s.ns_id,s.ns_path):void 0),g&&(t.showOpen=!0)),_&&!r.isNonUserRelativeContext&&(t.showComment=!0,t.showVersions=!0,r.isInFolderMode?t.showCopyPublicFolderFileLink=a:t.showCopyPublicFolderFileLink=!1),t.showPhotos=i&&l,g||(t.showDownload=r.isInFolderMode||_),t},E=function(e){var t,r,s,o,n,i,a,l;return t=e.actions,n=e.files,r=e.context,n.some(function(e){return e.is_unmounted})?t:(a=1===n.count()&&n.first().is_dir,l=a?(s=n.first(),r.inactiveNSIDByFQPath[s.fq_path.toLowerCase()]):!1,l?t.showReadd=!0:t.showRestore=!0,r.isInFolderMode?i=r.permanentDeletionDisabledStateByNSID[r.currentNSID]:(o=n.map(function(e){return e.ns_id}),i=o.some(function(e){return r.permanentDeletionDisabledStateByNSID[e]})),i||(l?t.showRemoveAccess=!0:t.showPermanentDelete=!0),t)},C=function(o){var n,i,a,u,c,h,m,f,g,w,T,P,E,I,C,A,R,O,L,k,B,U,H,q,G,W,j,V,z,Q,K,Y,X,$,J,Z,ee,te;return h=o.files,u=o.context,te=o.user,i=o.actionHandlers,Z=null!=(Q=o.skipSharing)?Q:!1,G=null!=(K=o.isPagelet)?K:!1,W=null!=(Y=o.isSearchMode)?Y:!1,ee=null!=(X=o.source)?X:void 0,k=function(){return x(te,h.first(),u)},B=function(){return M(te,h.first(),u,"file_row_sharing_menu")},U=function(){return b.showTiburonUIIfAllowed(te,h.first(),{browseContext:u,origin:"BROWSE_FILE_ROW"})},C=function(){var e;return e=b.getLegacyPublicFolderShareURI(te,h.first(),u),e?v(["dropbox"],function(t){var r;return r=t.BrowseActions,r.showCopyPublicUrlModal(e)}):void 0},E=function(){var e;return e=h.first(),W&&l.logSearchAction(e,te,"open"),p.open_file(e.ns_id,e.ns_path,te.id,p.standard_open_file_handler,function(e){return p.standard_open_file_handler(!1)})},T=function(){return W&&l.logSearchAction(h.first(),te,"download"),y.logDownload({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),r.downloadFiles({files:h,context:u,user:te})},f=function(){var e;return e=h.first(),W&&l.logSearchAction(e,te,"comment"),y.logAddComment({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),r.navigateToFileOrFolder({file:e,shouldFocusComment:!0})},R=function(){var e;return e=h.first(),W&&l.logSearchAction(e,te,"rename"),y.logRenameFiles({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),r.showFileRename({file:e})},O=function(){return S.showContentManagerBridge(h.toArray(),"rename",d.get_viewer().team_is_limited)},m=function(){return S.showContentManagerBridge(h.toArray(),"archive",d.get_viewer().team_is_limited)},P=function(){return W&&l.logSearchAction(h.first(),te,"move"),y.logOpenMoveModal({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),S.showMove(te,h.toArray(),u.currentFQPath,{onSuccess:function(e){var t;return t=e.path,y.logMoveFiles({uid:te.id,path:u.currentFQPath,files:h.toArray(),newPath:t,source:ee})},onUndo:function(){return r.selectRowsFromNotServer(h.toArray())},onRequestNotSent:function(){var e;return r.selectFilesByFqPath({fqPathsToSelect:function(){var t,r,s,o;for(s=h.toArray(),o=[],t=0,r=s.length;r>t;t++)e=s[t],o.push(e.fq_path);return o}()})}})},g=function(){return W&&l.logSearchAction(h.first(),te,"copy"),y.logOpenCopyModal({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),S.showCopy(te,h.toArray(),{onSuccess:function(e){var t;return t=e.files,y.logCopyFiles({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),r.selectRowsFromNotServer(t)},onUndo:function(){return r.selectRowsFromNotServer(h.toArray())},onRequestNotSent:function(){var e;return r.selectFilesByFqPath({fqPathsToSelect:function(){var t,r,s,o;for(s=h.toArray(),o=[],t=0,r=s.length;r>t;t++)e=s[t],o.push(e.fq_path);return o}()})}})},L=function(){var e,t;return W&&l.logSearchAction(h.first(),te,"restore"),e=1===h.size&&h.first().is_dir,e?(t=s.getRestoreFileUrl({fqPath:h.first().fq_path,userId:te.id}),_.redirect(t)):i.onRestoreMulti()},A=function(){var e,r,s,o;return e=h.first(),s=e.fq_path.toLowerCase(),o=u.inactiveNSIDByFQPath[s],r=t.filename(e.fq_path),o?v(["dropbox"],function(e){var t;return t=e.SharingModel,t.sync_shared_folder(o,te.role,"BROWSE_FILE_ACTIONS",!1,null,!0)}):void 0},q=function(){return W&&l.logSearchAction(h.first(),te,"view_in_photos"),r.viewInPhotos({files:h,user:te})},c=!u.isCurrentPathWriteable(),$=!u.isCurrentPathWriteable(),V=!u.isCurrentPathWriteable(),a=F({files:h,context:u,user:te}),j=[],H=function(){var e;return W&&l.logSearchAction(h.first(),te,"revisions"),y.logVersions({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),e=N(h.first().fq_path,te).toString(),_.redirect(e)},w=function(e){return W&&l.logSearchAction(h.first(),te,"delete"),y.logDeleteFiles({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),i.onDelete(e)},I=function(e){return W&&l.logSearchAction(h.first(),te,"purge"),y.logPermanentDeleteFiles({uid:te.id,path:u.currentFQPath,files:h.toArray(),source:ee}),i.onPermanentDelete(e)},n=function(t,r,s,o){var n;return n={label:t,spriteName:r,performAction:s},e.extend(n,o)},G?(a.showTiburonShare&&j.push(n(D("Share"),"s_rainbow",U)),a.showCopyPublicFolderFileLink&&j.push(n(D("Copy Public Link"),"world_link",C)),a.showOpen&&j.push(n(D("Open"),"open",E)),a.showDownload&&j.push(n(D("Download"),"download",T)),a.showComment&&j.push(n(D("Add Comment"),"s_file_comment",f)),a.showVersions&&j.push(n(D("Previous Versions"),"previous_versions",H)),a.showRename&&(z={ref:"rename",disabled:$},j.push(n(D("Rename"),"rename",R,z))),a.showMove&&(z={disabled:V},j.push(n(D("Move"),"move_16",P,z))),a.showCopy&&j.push(n(D("Copy"),"copy",g)),a.showDelete&&(z={disabled:c},j.push(n(D("Delete"),"delete_16",w,z))),j):(Z||(a.showTiburonShare?j.push(n(D("Share…"),"s_rainbow",U)):(a.showLegacyShareFolder||a.showLegacyShareLink)&&(J=[],a.showLegacyShareFolder&&J.push(n(D("Invite people to collaborate…"),"user_add",k)),a.showLegacyShareLink&&J.push(n(D("Send link…"),"s_link",B)),j.push(n(D("Sharing…"),"s_rainbow",null,{subItems:J})))),a.showCopyPublicFolderFileLink&&j.push(n(D("Copy public link…"),"world_link",C)),a.showOpen&&j.push(n(D("Open"),"open",E)),a.showDownload&&j.push(n(D("Download"),"download",T)),a.showComment&&j.push(n(D("Comment"),"s_file_comment",f)),a.showDelete&&(z={disabled:c},j.push(n(D("Delete..."),"delete_16",w,z))),a.showRemove&&(z={disabled:c},j.push(n(D("Remove..."),"delete_16",w,z))),a.showArchive&&j.push(n(D("Archive"),"delete_16",m)),a.showRename&&(z={ref:"rename",disabled:$},j.push(n(D("Rename"),"rename",R,z))),a.showRenameTeamFolder&&j.push(n(D("Rename"),"rename",O)),a.showMove&&(z={disabled:V},j.push(n(D("Move..."),"move_16",P,z))),a.showCopy&&j.push(n(D("Copy..."),"copy",g)),a.showPhotos&&j.push(n(D("View in Photos"),"s_photo",q)),a.showVersions&&(z={href:N(h.first().fq_path,te).toString()},j.push(n(D("Previous versions"),"previous_versions",null,z))),a.showRestore&&j.push(n(D("Restore…"),"restore",L)),a.showReadd&&j.push(n(D("Re-add shared folder"),"restore",A)),a.showPermanentDelete&&j.push(n(D("Permanently delete…"),"cancel",I)),a.showRemoveAccess&&j.push(n(D("Remove my access"),"cancel",I)),j)},{getActionsForFileCollection:C}})}.call(this),function(){define("modules/dirty/react/browse/global_actions",["jquery","external/classnames","external/react","external/underscore","modules/clean/react/title_bubble","modules/clean/payments/pro_trial_onboarding_tour","modules/clean/css","modules/clean/filepath","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/dirty/sharing/browse_ui_util","modules/dirty/sharing/wizard_modals","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/constants/browse","modules/clean/react/bubble_menu","modules/core/browser","modules/core/i18n","modules/core/uri","require"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D){var E,I,C,F,N,A,R,x,M,O,L,k,B,U,H,q,G,W,j;return M=n.ProOnboardingTooltips,I=l.BrowseLogger,j=c.showTiburonUIIfAllowed,W=p.showShareAFolderWizardModal,x=h.NameSpaceAccess,E=m.BrowseContext,H=g.genContentManagerBridgeUri,R=g.GoldenGate,C=w.BubbleMenu,F=w.BubbleMenuItem,O=T._,U=r.DOM,k=r.createElement,B=t,A={INLINE:0,INLINE_WITH_TEXT:1},L=function(e,t){var r,s,o;return r="/"===e.currentFQPath,t?(o=v.get_viewer(),s=e.isInsideAutoTeamFolder&&o.team_is_limited&&"/"===a.parent_dir(e.currentFQPath),O(s?o.work_user.is_team_admin?"Folder Settings":"Invite Members":r?"New Shared Folder":"Share Folder")):O(e.isInsideAutoTeamFolder?"Team folder options…":e.isInsideSharedFolder?"Shared folder options…":r?"Share a folder…":"Share this folder…")},G=function(e){var t,r,s,o,n,i,a,l,c,p,d,h,m,_,f,g,b,v,w;return t=e.context,w=e.user,g=e.showDeletedFiles,h=e.onFileUpload,p=null!=(m=e.isPagelet)?m:!1,c="/"===t.currentFQPath,r=A.INLINE,f=A.INLINE,n=function(e){return e.preventDefault(),h(e)},i=function(e){return e.preventDefault(),u.nameNewFolder()},a=function(e){return e.preventDefault(),c?W(w):j(w,t,{origin:"BROWSE_GLOBAL_ACTIONS"})},l=function(e){return e.preventDefault(),u.setShouldShowDeletedFiles({shouldShowDeletedFiles:!g})},d=[],v=O("Upload…"),b={label:v,spriteName:"upload_16",performAction:n,style:r},o=r,s={label:O(p?"New Folder":"New folder"),spriteName:"folder_add",performAction:i,style:o},_={label:L(t,p),spriteName:"rainbow_16",performAction:a,style:f},d=d.concat([b,s,_]),d=d.filter(function(e){return null!=e}),y.HIDE_TRASH_CAN_BUTTON||p||d.push({label:O(g?"Hide deleted files":"Show deleted files"),spriteName:g?"trash-can-open":"trash-can",performAction:l,style:r}),d},q=function(e){var t,r,s,o,n,i,l,c,p,h,m,_,f,g,b,w,T,P,E,C,F,N,k,B,U,q,G,V,z,Q,K,Y,X;return t=e.context,X=e.user,Q=e.showDeletedFiles,G=e.onFileUpload,B=e.isPagelet,N=e.isContextMenu,k="/"===t.currentFQPath,C=X.is_team_admin&&k&&R.hasContentManager(X.id),F=t.isInsideSharedFolder&&t.currentSharedFolderPermissionRole===x.ACCESS_READER,r=A.INLINE,z=A.INLINE,q=y.SUBGROWTH_PRO_ONBOARDING_LAST_SEEN_STEP,c="V1"===y.SUBGROWTH_PRO_ONBOARDING_UPLOAD&&0===q,l="V1"===y.SUBGROWTH_PRO_ONBOARDING_SHARING&&1===q,h=O("Getting started?\nClick here to upload your files to Dropbox"),p=O("Have you tried using Dropbox to collaborate with others?\nClick here to share a project folder"),f=function(e){return e.preventDefault(),c&&M.setUserOnboardingAttribute(e.currentTarget,q+1),G(e)},g=function(e){return e.preventDefault(),I.logCreateFolder({uid:X.id}),u.nameNewFolder()},T=function(e){return e.preventDefault(),l&&M.setUserOnboardingAttribute(e.currentTarget,q+1),k?W(X):j(X,t,{origin:"BROWSE_GLOBAL_ACTIONS"})},P=function(e){var t;return t=H(v.get_viewer().team_is_limited),S.open_tab(t.toString())},E=function(e){return e.preventDefault(),I.logToggleDeletedFiles({uid:X.id,show_deleted_files:!Q}),u.setShouldShowDeletedFiles({shouldShowDeletedFiles:!Q})},w=function(e){var r;return e.preventDefault(),r=d.getRestoreFileUrl({fqPath:t.currentFQPath,userId:X.id}),S.redirect(r)},b=function(e){var r,s,o;return e.preventDefault(),s=t.currentFQPath.toLowerCase(),o=t.inactiveNSIDByFQPath[s],r=a.filename(t.currentFQPath),o?D(["dropbox"],function(e){var t;return t=e.SharingModel,t.sync_shared_folder(o,X.role,"BROWSE_GLOBAL_ACTIONS")}):void 0},o={label:O("Folder"),sublabel:O("For private files"),spriteName:N?"folder":"folder_32",performAction:g,disabled:F},n={label:O("Shared folder"),sublabel:O("For collaborating on a project"),spriteName:N?"folder_user":"folder_user_32",performAction:T},i={label:O("Team Folder"),sublabel:O("For sharing with an entire department or team"),sublabelLine2:O("This will take you to the Admin Console"),spriteName:N?"folder_team":"folder_team_32",performAction:P},Y=O(B?k?"Upload File":"Upload Files":"Upload…"),K={label:Y,tooltip:c?h:void 0,spriteName:"upload_16",performAction:f,disabled:F,active_onboarding_step:c,style:r},s={label:O(Q?"Hide deleted files":"Show deleted files"),spriteName:Q?"trash-can-open":"trash-can",performAction:E,style:r},U=[],t.isInsideDeletedSharedFolder?U.push({label:O("Re-add shared folder"),spriteName:"restore",performAction:b,style:r}):t.isInsideDeletedFolder||t.isInsideDeletedNestedSharedFolder?U.push({label:O("Restore folder"),spriteName:"restore",performAction:w,style:r}):!B&&C?N?U=U.concat([K,o,n,i,s]):U.push({label:O("New folder"),spriteName:"folder_add",dropdownItems:[o,n,i],disabled:F,style:A.INLINE_WITH_TEXT}):(_=C?A.INLINE_WITH_TEXT:r,m={label:O(B?"New Folder":"New folder"),spriteName:"folder_add",performAction:g,disabled:F,style:_},V={label:L(t,B),tooltip:l?p:void 0,spriteName:"rainbow_16",performAction:T,active_onboarding_step:l,style:z},U=B?k?U.concat([K,V,m]):U.concat([V,K,m]):U.concat([K,m,V]),U=U.filter(function(e){return null!=e}),y.HIDE_TRASH_CAN_BUTTON||B||U.push(s)),U},N=r.createClass({displayName:"GlobalActions",propTypes:{shouldShowDeletedFiles:r.PropTypes.bool.isRequired,context:r.PropTypes.instanceOf(E).isRequired,user:r.PropTypes.instanceOf(b).isRequired,onFileUpload:r.PropTypes.func.isRequired,isActionsBarDisabled:r.PropTypes.bool.isRequired},getInitialState:function(){return{isHeaderFixed:!0}},componentDidMount:function(){return this._handleWindowResize(),e(window).on("resize.globalActionButtons",s.throttle(this._handleWindowResize,30))},componentWillUnmount:function(){return e(window).off("resize.globalActionButtons")},_renderButton:function(e){var t,r,s,o,n,i;return r=e.buttonClasses,o=e.message,i=e.spriteName,n=e.onClick,s=e.disabled,t=U.button({className:B(r),disabled:s,onClick:n},k(_,{className:"global-actions__button-sprite",group:"web",name:i,alt:o})),s||(t=this._wrapWithTitleBubble(t,o)),t},_renderButtonWithText:function(e){var t,r,s,o,n;return t=e.buttonClasses,s=e.message,n=e.spriteName,o=e.onClick,r=e.disabled,U.button({className:B(t,"button-as-link"),disabled:r,onClick:o},k(f,{className:"global-actions__button-sprite",group:"web",name:n,text:s,alt:"",spritePosition:"left"}))},_handleWindowResize:function(){var t;return t="fixed"===e(".browse-header").css("position"),this.setState({isHeaderFixed:t})},_wrapWithTitleBubble:function(e,t){return k(o,{content:t,position:o.POSITIONS.BOTTOM,distanceFromTarget:-3,isTargetPositionFixed:this.state.isHeaderFixed},e)},_wrapInlineButton:function(e,t){return U.li({className:"global-actions__action",key:t},e)},_renderInlineItem:function(e){var t,r,s,o;switch(r={"global-actions__button":!0,"sprite-button":!0,"global-actions__button--onboarding":null!=e.active_onboarding_step},s={buttonClasses:r,message:e.tooltip||e.label,spriteName:e.spriteName,onClick:e.performAction,disabled:e.disabled||this.props.isActionsBarDisabled},e.style){case A.INLINE_WITH_TEXT:t=this._renderButtonWithText(s);break;default:t=this._renderButton(s)}return null!=e.dropdownItems&&(o=e.style===A.INLINE_WITH_TEXT?4:8,t=this._renderDropdownButton(t,e.dropdownItems,o)),t},_renderDropdownButton:function(e,t,r){return k(C,{className:"global-actions__dropdown",targetButton:e,targetFixed:this.state.isHeaderFixed,items:this._renderDropdownItems(t),position:C.POSITIONS.BOTTOM_RIGHT,verticalDisplacement:r})},_renderDropdownItems:function(e){var t,r,s,o,n;for(t=[],s=0,n=e.length;n>s;s++)o=e[s],r=o.disabled||this.props.isActionsBarDisabled,t.push(k(F,{onClick:o.performAction,disabled:r},U.div({className:"sprite-div"},U.div({className:B(["sprite-frame","small","icon-left"])},k(_,{alt:"",group:"web",name:o.spriteName})),U.div({className:B(["sprite-text"])},U.h3({className:B(["global-actions__dropdown__item-label","u-trim-margin","u-font-strong"])},o.label),U.p({className:B(["global-actions__dropdown__item-sublabel","u-font-meta"])},o.sublabel),o.sublabelLine2?U.p({className:B(["global-actions__dropdown__item-sublabel-line2","u-font-meta"])},o.sublabelLine2):void 0))));return t},render:function(){var e,t,r,s,o,n;return n=this.props.context.isNonUserRelativeContext?G({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload}):q({context:this.props.context,user:this.props.user,showDeletedFiles:this.props.shouldShowDeletedFiles,onFileUpload:this.props.onFileUpload,isContextMenu:!1}),t=function(){var e,t,r;for(r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(this._renderInlineItem(o));return r}.call(this),r={"global-actions":!0,"u-mar-top-xs":!0},U.div({className:B(r)},U.ul({className:"horizontal"},function(){var r,o,n;for(n=[],s=r=0,o=t.length;o>r;s=++r)e=t[s],n.push(this._wrapInlineButton(e,s));return n}.call(this)))}}),{getGlobalActions:q,GlobalActions:N}})}.call(this),function(){define("modules/dirty/react/browse/item_list",["jquery","external/classnames","external/immutable","external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/components/loading_indicator","modules/clean/filepath","modules/clean/keycode","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/file_list_empty_folder","modules/clean/react/browse/internal_drag_status","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models","modules/clean/react/browse/file_list_utils","modules/clean/react/columnheader","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/store","modules/clean/react/helpers","modules/clean/react/modal","modules/clean/react/outside_event","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/actions","modules/clean/sharing/ui_util","modules/clean/undo","modules/clean/viewer","modules/core/accessible_announce","modules/core/browser","modules/core/i18n","modules/core/notify","modules/dirty/react/browse/item_list_row","modules/clean/react/browse/folder_list_row","modules/clean/react/file_viewer/controller","modules/clean/react/browse/file_jump","modules/clean/unity_browse_interface"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N,A,R,x,M,O,L,k,B,U){
var H,q,G,W,j,V,z,Q,K,Y,X,$,J,Z,ee,te,re,se,oe,ne,ie,ae,le,ue,ce,pe,de,he,me,_e,fe,ge,be,ve,ye,we,Se,Te,Pe,De;return z=p.CulledListConstants,Q=p.Direction,W=p.BrowseSortField,K=p.DropTargetHighlightMode,ee=p.FileTypes,ae=p.ItemTypes,le=p.LoadingStates,ce=p.NewFolderCreationState,oe=h.InternalDragStatus,Y=_.File,de=_.Paper,G=_.BrowseContext,Z=_.FileRename,$=f.FileListHelpers,j=g.ColumnHeader,V=g.ColumnTypes,me=g.SortDirections,J=v.FileModalController,_e=y.UploaderActions,re=w.INTERNAL_FILE_DATA_TRANSFER_TYPE,Pe=S.shallowCompareStateAndProps,ue=T.Modal,ge=P.addOutsideEventHandling,ve=D.createSelectableList,ye=D.createSelection,te=C.GoldenGate,fe=x._,X=O.FileItemRow,he=O.PaperItemRow,we=o.DOM,be=o.createElement,se="ItemList",pe="",Se={},q="undefined"!=typeof window&&null!==window?e(window):null,H="undefined"!=typeof document&&null!==document?e(document.documentElement):null,ne=ve(o.createClass({displayName:"ItemList",propTypes:{user:o.PropTypes.object.isRequired,context:o.PropTypes.instanceOf(G).isRequired,path:o.PropTypes.string.isRequired,rowHeight:o.PropTypes.number,isPagelet:o.PropTypes.bool,selectedFiles:o.PropTypes.instanceOf(r.OrderedSet),isBrowseInContentManager:o.PropTypes.bool,isRenaming:o.PropTypes.bool,itemListLength:o.PropTypes.number,openContextMenuAtPosition:o.PropTypes.func,onFocus:o.PropTypes.func,focusSelectedRow:o.PropTypes.func,className:o.PropTypes.string,actionHandlers:o.PropTypes.object},getDefaultProps:function(){return{rowHeight:z.ITEM_ROW_HEIGHT_PX,isPagelet:!1,selectedFiles:r.OrderedSet(),isDraggingExternalFiles:!1,activeDropTarget:!1,isRenaming:!1,onFocus:i.noop,isBrowseInContentManager:!1,className:null,actionHandlers:{}}},componentWillMount:function(){return this.isFocused=!1},componentDidMount:function(){return e(document).on("keydown.ItemList",this.handleKeyDown).on("keypress.ItemList",this.handleKeyPress).on("keyup.ItemList",this.handleKeyUp),this._setupFocusHandler(),this._setupExternalDragHandler(),this._setupKeyboardShortcuts()},componentWillUnmount:function(){return key.clearScope(se),key.setScope(pe),e(document).off(".ItemList"),e(n.findDOMNode(this)).off(".ItemList")},_setupFocusHandler:function(){var t;return t=e(n.findDOMNode(this)),t.on("focusin.ItemList",function(e){return function(){return e.isFocused=!0,e.props.onFocus(),!0}}(this)),t.on("focusout.ItemList",function(e){return function(){return e.isFocused=!1,!0}}(this))},_setupExternalDragHandler:function(){return e(document).on("dragenter.ItemList",function(t){return function(r){return(t.props.isDraggingExternalFiles||t.props.isDraggingInternalFiles)&&!e(r.target).closest(".browse-file-row").length&&t.props.activeDropTarget?(c.setDropTarget({target:null}),_e.setPath({path:t.props.path,hasPermissionToUploadToFolder:t.props.context.isCurrentPathWriteable()})):void 0}}(this))},_setupKeyboardShortcuts:function(){var t,r,s,o,i,a,l,u,p,d,h,_,f;return pe=key.getScope(),key.setScope(se),i=function(e){return function(t){return e.isFocused&&"BUTTON"!==t.target.tagName}}(this),o=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||n.findDOMNode(e).contains(t.target)}}(this),s=function(e,t){var r;return r=function(r){return e(r)?(r.preventDefault(),"function"==typeof t?t(r):void 0):void 0}},u=function(e){return function(){return 1===e.props.selectedFiles.size&&e.props.selectedFiles.first().is_dir?c.navigateToFileOrFolder({file:e.props.selectedFiles.first()}):void 0}}(this),l=function(e){return function(){return 1===e.props.selectedFiles.size?c.navigateToFileOrFolder({file:e.props.selectedFiles.first(),onFileViewerUnmount:e.props.focusSelectedRow}):void 0}}(this),d=function(e){return function(){var t;return 1===e.props.selectedFiles.size?e.props.context.isCurrentPathWriteable()?(t=e.props.selectedFiles.first(),t.isDeleted?M.error(fe("Deleted files can’t be renamed.")):c.showFileRename({file:t})):M.warning(fe("You don’t have permission to rename files in this folder.")):void 0}}(this),t=function(){return c.copySelectedFilesToClipboard()},p=function(){return c.pasteClipboardFilesToCurrentPath()},f=function(){return F.perform_undo()},_=function(){var e;return e=be(m),ue.showInstance(e)},a=function(){return c.navigateToParentFolder()},h=function(t){return function(r){var s,o,n,i,a,l;return t.props.selectedFiles.size?(l=e(r.target).closest(".browse-file-row--is-selected").first(),l.length?(i=l[0].offsetLeft+200,a=l[0].offsetTop+5,n=l.get(0),"function"==typeof(s=t.props).openContextMenuAtPosition?s.openContextMenuAtPosition(i,a,n):void 0):void 0):"function"==typeof(o=t.props).openContextMenuAtPosition?o.openContextMenuAtPosition(10,10):void 0}}(this),r=function(){return e(".search-bar__text-input").focus()},key("right",se,s(i,u)),key("enter",se,s(i,l)),key("f2",se,s(i,d)),key("left",se,s(o,a)),key("/",se,s(o,r)),key("alt+a",se,s(o,h)),key("shift+/",se,s(o,_)),R.mac?(key("command+c",se,s(i,t)),key("backspace",se,s(i,this.props.actionHandlers.onDelete)),key("command+v",se,s(o,p)),key("command+z",se,s(o,f))):(key("ctrl+c",se,s(i,t)),key("delete",se,s(i,this.props.actionHandlers.onDelete)),key("ctrl+v",se,s(o,p)),key("ctrl+z",se,s(o,f)))},handleKeyDown:function(e){var t,r;return t=null!=(r=e.which)?r:e.keyCode,t===u.CONTROL||t===u.ALT?c.setCopyMode({copyMode:!0}):void 0},handleKeyPress:function(e){return key.getScope()===se?B.handleKeyPress(e):void 0},handleKeyUp:function(e){var t,r;return t=null!=(r=e.which)?r:e.keyCode,t===u.CONTROL||t===u.ALT?c.setCopyMode({copyMode:!1}):void 0},getFocusHandler:function(e){return function(t){return function(){return t.isFocused=e,!0}}(this)},render:function(){var e;return e=t(this.props.className,{"browse-files o-list-ui":!this.props.isBrowseInContentManager,"browse-files__content-manager":this.props.isBrowseInContentManager,"browse-files--single-selection":1===this.props.selectedFiles.size}),we.div({},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER?we.ul({className:e,role:"presentation"},this.props.children):we.ul({className:e,role:"presentation",style:{display:"block",position:"relative",height:this.props.itemListLength*this.props.rowHeight}},this.props.children))}})),ie=o.createClass({displayName:"ItemListController",propTypes:{context:o.PropTypes.instanceOf(G).isRequired,items:o.PropTypes.instanceOf(r.List).isRequired,user:o.PropTypes.object.isRequired,path:o.PropTypes.string.isRequired,isPagelet:o.PropTypes.bool,isSearchMode:o.PropTypes.bool,selection:o.PropTypes.shape({selected:o.PropTypes.instanceOf(r.OrderedSet),anchor:o.PropTypes.string}),selectedFiles:o.PropTypes.instanceOf(r.OrderedSet),createNewFolderState:o.PropTypes.oneOf(i.values(ce)),customEmptyFolderView:o.PropTypes.func,dropTargetHighlightMode:o.PropTypes.oneOf(function(){var e;e=[];for(Te in K)De=K[Te],e.push(De);return e}()),fileRename:Z.propTypes,isArchiveState:o.PropTypes.bool,isBrowseInContentManager:o.PropTypes.bool,isSyncColumnVisible:o.PropTypes.bool,isTextSelectable:o.PropTypes.bool,loadingState:o.PropTypes.oneOf(i.values(le)),mostRecentlyDraggedOverFile:o.PropTypes.instanceOf(Y),openContextMenuAtPosition:o.PropTypes.func,isDraggingExternalFiles:o.PropTypes.bool,isDraggingInternalFiles:o.PropTypes.bool,activeDropTarget:o.PropTypes.object,onSelectionChange:o.PropTypes.func,showFilenameHighlights:o.PropTypes.bool,disableColumnDetail:o.PropTypes.bool,enableDoubleClickTraversal:o.PropTypes.bool,onFocus:o.PropTypes.func,settingsGearMenuAlt:o.PropTypes.string,settingsGearMenuItems:o.PropTypes.arrayOf(o.PropTypes.shape({label:o.PropTypes.string,action:o.PropTypes.func})),activeSortField:o.PropTypes.oneOf(i.values(W)),activeSortDirection:o.PropTypes.oneOf(i.values(me)),onSortChange:o.PropTypes.func,initialMultiColumnSortField:o.PropTypes.string,actionHandlers:o.PropTypes.object},getDefaultProps:function(){return{isPagelet:!1,isSearchMode:!1,selection:ye(),selectedFiles:r.OrderedSet(),createNewFolderState:ce.CREATE_FOLDER_INACTIVE,customEmptyFolderView:null,dropTargetHighlightMode:K.NONE,fileRename:null,isArchiveState:!1,isColumnHeaderVisible:!0,isMultiColumnGroupVisible:!0,isBrowseInContentManager:!1,isPaginating:!1,isSyncColumnVisible:!1,isTextSelectable:!0,mostRecentlyDraggedOverFile:null,shouldHighlightDropTargets:!1,shouldHighlightNonselectedDropTargets:!1,showFilenameHighlights:!1,disableColumnDetails:!1,enableDoubleClickTraversal:!0,isDraggingExternalFiles:!1,isDraggingInternalFiles:!1,onFocus:i.noop,activeSortField:null,activeSortDirection:null,onSortChange:i.noop,initialMultiColumnSortField:null}},getInitialState:function(){var e;return{activeMultiColumnField:this.props.initialMultiColumnSortField,viewportHeight:("undefined"!=typeof document&&null!==document&&null!=(e=document.documentElement)?e.clientHeight:void 0)||0,rowHeight:this.getRowHeight(this.props),scrollPosition:0,lastSelectedItemIndex:-1,arrowingDown:!1}},componentDidMount:function(){return window.addEventListener("scroll",this.updateOnScroll),window.addEventListener("resize",this.updateOnResize),this.props.selection.selected.size&&!k.isShown()?this.scrollItemRowsIntoView():void 0},componentWillUnmount:function(){return window.removeEventListener("scroll",this.updateOnScroll),window.removeEventListener("resize",this.updateOnResize)},shouldComponentUpdate:Pe,componentDidUpdate:function(e){var t;return e.items!==this.props.items&&U.browse_visible_change_callback(this.props.items.toArray(),this.props.user.id,0,this.props.items.size-1),t=this.props.selection.selected.subtract(e.selection.selected),(t.size&&!k.isShown()||this.props.createNewFolderState!==ce.CREATE_FOLDER_INACTIVE)&&this.scrollItemRowsIntoView(),e.loadingState!==this.props.loadingState&&this.props.loadingState===le.LOADED?A.polite(fe("Finished loading files")):void 0},componentWillReceiveProps:function(e){var t,r,s,o,n,i;return null!=(null!=(i=e.selection)?i.selected:void 0)?(o=this.props.selection.selected.last(),n=this.getIndexOfItem(o),t=e.selection.selected.last(),r=this.getIndexOfItem(t,e.items),s={lastSelectedItemIndex:r,arrowingDown:!1},r-n===1&&(s.arrowingDown=!0),this.setState(s)):this.setState({lastSelectedItemIndex:-1}),this.setState({rowHeight:this.getRowHeight(e)})},focusSelectedRow:function(){var t,r,s;return r=this.props.selectedFiles.first(),r&&(s=this.getIndexOfItem(r.fq_path),t=e(n.findDOMNode(this)).find(".browse-files .browse-file-row:eq("+s+")"),!t.is(":focus"))?t.focus():void 0},getRowHeight:function(e){var t;return t=z.ITEM_ROW_HEIGHT_PX,e.isPagelet?t=e.isSearchMode?z.MAESTRO_SEARCH_ROW_HEIGHT_PX:z.MAESTRO_ITEM_ROW_HEIGHT_PX:e.isSearchMode&&(t=z.SEARCH_ROW_HEIGHT_PX),t},getIndexOfItem:function(e,t){var r;return null==t&&(t=this.props.items),r=t.findIndex(function(t){return t instanceof Y?l.paths_are_equal(t.fq_path,e):t instanceof de?t.pad_id===e:void 0})},scrollItemRowsIntoView:function(){var t,r,s,o,n,i,a,l;if(o=this.state.lastSelectedItemIndex,s=1,o>=0){if(r="fixed"===e(".browse-header").css("position"),l=r?parseInt(e(".browse-files").css("marginTop"))||z.DEFAULT_HEADER_HEIGHT_PX:0,t=this.state.viewportHeight-l-this.state.rowHeight-s,n=o*this.state.rowHeight-s,a=this.state.scrollPosition,i=this.state.scrollPosition+t,n>=a&&i>=n)return;return a>n?q.scrollTop(n):this.state.arrowingDown?q.scrollTop(n-t+s):q.scrollTop(n-Math.round(t/2)+s)}},getSharedWithTitle:function(){return fe(te.hasAudienceBox(this.props.user.id)||te.hasNewMembershipUI(this.props.user.id)?"Members":this.props.context.isInsideSharedFolder?"Additional sharing":"Shared with")},_getColumns:function(){return[{type:V.STATIC,label:fe("Row selection"),headerClassName:"ax-visually-hidden"},{type:V.SINGLE,label:fe("Name"),headerClassName:"o-grid__col o-grid__col--6-of-12",sortField:W.FILENAME},{type:V.SINGLE,label:fe("Modified"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:W.MODIFIED},{type:V.MULTI,columns:[{label:this.getSharedWithTitle(),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:W.SHARED_WITH},{label:fe("Kind"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:W.CATEGORY},{label:fe("Extension"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:W.EXTENSION},{label:fe("Size"),headerClassName:"o-grid__col o-grid__col--3-of-12",sortField:W.SIZE}]},{type:V.STATIC,label:fe("Actions"),headerClassName:"ax-visually-hidden"}]},handleDragStart:function(e,t,r){var s,o,i,a,l;return null==t&&(t=[]),null==r&&(r=!0),l=r?this.props.selectedFiles.union(t).toArray():t,te.canDeepNest(this.props.user.id)&&(o=l.some(function(e){return Y.isTeamSharedFolder(e)}))?void M.error(fe("Team Folders can’t be moved.")):(i={userId:this.props.user.id,fromPath:this.props.path,filePaths:function(){var e,t,r;for(r=[],e=0,t=l.length;t>e;e++)a=l[e],r.push(a.fq_path);return r}()},null!=e.dataTransfer?("function"==typeof(s=e.dataTransfer).setDragImage&&s.setDragImage(n.findDOMNode(this.refs.dragIcon),-10,-10),e.dataTransfer.setData(re,JSON.stringify(i)),e.dataTransfer.effectAllowed="copyMove"):void 0)},_renderPaperRow:function(e,t,r){var s;return s=this.state.rowHeight*t,be(he,{paper:e,key:e.pad_id,topOffsetPx:s,rowIndex:t,totalRowCount:r,showTitleHighlights:!0,isPagelet:this.props.isPagelet})},_renderFileRow:function(e,t,r){var s,o,n,i,a,l,u,c,p;return o=$.shouldFileBeHighlightedDropTarget({file:e,isSelected:this.props.selection.selected.has(e.fq_path),dropTargetHighlightMode:this.props.dropTargetHighlightMode}),i=e===this.props.activeDropTarget,(null!=(l=this.props.fileRename)?l.file:void 0)===e&&(c=null!=(u=this.props.fileRename)?u.state:void 0),a=this.props.selection.selected.last()===e.fq_path||!this.props.selection.selected.size&&0===t,n=[e.hashCode(),t,c,o,i,a,this.props.selectedFiles.count()>0].join("_"),n in Se?Se[n]:(p=this.state.rowHeight*t,s=be(X,{selectableListId:e.fq_path,key:encodeURI(e.fq_path),file:e,user:this.props.user,isTabbable:a,enableDoubleClickTraversal:this.props.enableDoubleClickTraversal,isPagelet:this.props.isPagelet,isSearchMode:this.props.isSearchMode,topOffsetPx:p,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:o,isActiveDropTarget:i,isArchiveState:this.props.isArchiveState,isModifiedColumnVisible:this.props.isModifiedColumnVisible,isSyncColumnVisible:this.props.isSyncColumnVisible,isMultiColumnGroupVisible:this.props.isMultiColumnGroupVisible,isTextSelectable:this.props.isTextSelectable,context:this.props.context,renameState:c,loadingState:this.props.loadingState,rowIndex:t,totalRowCount:r,settingsGearMenuAlt:this.props.settingsGearMenuAlt,settingsGearMenuItems:this.props.settingsGearMenuItems,showColumnDetail:!this.props.isColumnHeaderVisible&&!this.props.disableColumnDetails,showFilenameHighlights:this.props.showFilenameHighlights,showCheckboxes:this.props.selectedFiles.count()>0,onDragStart:this.handleDragStart}),Se[n]=s,s)},_renderLoadingIndicator:function(e,r){var s,o;return s=["u-font-center item-list-loading-indicator-wrapper",{"u-pad-top-m":!this.props.isPagelet}],o={className:t(s),key:"loadingIndicator"},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||(o.style={position:"absolute",top:r*this.state.rowHeight||0,width:"100%"}),we.li(o,be(a,{style:a.LoadingIndicatorStyle.BLUE_SPINNER,startMessage:e}))},_renderEmptyFolder:function(){var e;return e=this.props.context.isInsideAutoTeamFolder&&1===this.props.path.match(/\//g).length,be(d,{currentSharedFolderPermissionRole:this.props.context.currentSharedFolderPermissionRole,isArchiveState:this.props.isArchiveState,isBrowseInContentManager:this.props.isBrowseInContentManager,isInsideSharedFolder:this.props.context.isInsideSharedFolder,isViewingTeamFolder:e,isInCdmMve:Boolean(this.props.context.cdmMveQuotaStats),userId:this.props.user.id,userFamiliarName:this.props.user.familiar_name})},_getPerformanceHackColumnClassName:function(){switch(this.state.activeMultiColumnField){case W.SHARED_WITH:return"is-sharedwith-column-visible";case W.CATEGORY:return"is-kind-column-visible";case W.EXTENSION:return"is-extension-column-visible";case W.SIZE:return"is-size-column-visible"}},_renderItemList:function(e){var t,r,s,o;return s=this.props.items.toArray(),o=0,e&&(o+=1),this.props.loadingState===le.LOADING_REMAINING_PAGES&&(o+=1),t=this.props.loadingState===le.LOADING_FIRST_PAGE?0:s.length+o,be(ne,{ref:"itemList",allItemIds:this.props.items.map(function(e){return e.fq_path}),user:this.props.user,path:this.props.path,context:this.props.context,rowHeight:this.state.rowHeight,isPagelet:this.props.isPagelet,selectedFiles:this.props.selectedFiles,isBrowseInContentManager:this.props.isBrowseInContentManager,isRenaming:!!this.props.fileRename,openContextMenuAtPosition:this.props.openContextMenuAtPosition,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isDraggingInternalFiles:this.props.isDraggingInternalFiles,itemListLength:t,activeDropTarget:this.props.activeDropTarget,keyScope:se,linkedOutsideClasses:[".bubble-menu-item-wrapper",".browse-menu",".context-menu",".react-file-viewer",".db-modal"],selection:this.props.selection,onFocus:this.props.onFocus,onSelectionChange:this.props.onSelectionChange,focusSelectedRow:this.focusSelectedRow,className:this._getPerformanceHackColumnClassName(),actionHandlers:this.props.actionHandlers,isCheckboxes:this.props.isPagelet},this.props.loadingState===le.LOADING_FIRST_PAGE?this._renderLoadingIndicator(fe("Loading files…")):s.length||e?this._renderItemRows(s,e):("function"==typeof(r=this.props).customEmptyFolderView?r.customEmptyFolderView():void 0)||this._renderEmptyFolder())},_renderCreateFolderUI:function(){return be(L,{newFolderState:this.props.createNewFolderState,context:this.props.context,user:this.props.user,topOffsetPx:0})},_renderItemRows:function(e,t){var r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N,A;if(E=[],D=function(e){return function(t,r,s){return t instanceof Y?E.push(e._renderFileRow(t,r,s)):t instanceof de?E.push(e._renderPaperRow(t,r,s)):void 0}}(this),"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER){for(i=n=0,h=e.length;h>n;i=++n)a=e[i],D(a,i+1,e.length);return this.props.loadingState===le.LOADING_REMAINING_PAGES&&E.push(this._renderLoadingIndicator(fe("Loading files…"),e.length)),E}for(w=0,y=0,t&&(w=1),this.props.loadingState===le.LOADING_REMAINING_PAGES&&(y=1),P=e.length,A=P+w+y,c=P*this.state.rowHeight,b=Math.ceil(this.state.viewportHeight/this.state.rowHeight)+2*z.ITEM_BUFFER_SIZE,S=Math.min(A,b),N=Math.max(0,this.state.scrollPosition-z.ITEM_BUFFER_SIZE*this.state.rowHeight),F=Math.min(Math.floor(N/this.state.rowHeight),A-S),s=Math.min(F+S-1,A-1),r=e.slice(F,+s+1||9e9),d=this.state.lastSelectedItemIndex,l=[],u=[],d>=0&&(F>d?(o=Math.max(0,d-1),p=Math.min(d+1,F-1),l=function(){I=[];for(var e=o;p>=o?p>=e:e>=p;p>=o?e++:e--)I.push(e);return I}.apply(this)):d>s&&(o=Math.max(s+1,d-1),p=Math.min(d+1,P-1),u=function(){C=[];for(var e=o;p>=o?p>=e:e>=p;p>=o?e++:e--)C.push(e);return C}.apply(this))),g=0,m=l.length;m>g;g++)i=l[g],a=e[i],D(a,i+w,A);for(v=0,_=r.length;_>v;v++)a=r[v],D(a,F+w,A),F+=1;for(p=F,T=0,f=u.length;f>T;T++)i=u[T],a=e[i],D(a,i+w,A);return t&&E.unshift(this._renderCreateFolderUI()),this.props.loadingState===le.LOADING_REMAINING_PAGES&&E.push(this._renderLoadingIndicator(fe("Loading files…"),p)),E},updateOnResize:function(){var e;return e=document.documentElement.clientHeight,this.state.viewportHeight!==e?this.setState({viewportHeight:e}):void 0},updateOnScroll:function(){var e;return e=q.scrollTop(),(0!==e||"fixed"!==H.css("position"))&&null!=e&&this.state.scrollPosition!==e?this.setState({scrollPosition:e}):void 0},handleMultiColumnChange:function(e){return this.setState({activeMultiColumnField:e.sortField})},renderColumnHeader:function(){var e;return e=["browse-file-list-header o-grid o-grid--no-gutter",{"ax-visually-hidden":!this.props.isPagelet&&this.props.selection.selected.size||this.props.isPagelet&&!this.props.items.size}],be(j,{columns:this._getColumns(),className:t(e),tabbable:!this.props.selection.selected.size,disabled:this.props.loadingState!==le.LOADED,activeSortField:this.props.activeSortField,initialMultiColumnSortField:this.state.activeMultiColumnField,activeSortDirection:this.props.activeSortDirection,onSortChange:this.props.onSortChange,onMultiColumnChange:this.handleMultiColumnChange})},render:function(){var e;return e=this.props.createNewFolderState!==ce.CREATE_FOLDER_INACTIVE,we.div({role:"grid","aria-readonly":"true"},this.props.isColumnHeaderVisible?this.renderColumnHeader():void 0,this._renderItemList(e),we.div({className:"offscreen-drag-icon",ref:"dragIcon"},this.props.selectedFiles.count()?be(oe,{files:this.props.selectedFiles.toArray()}):void 0))}}),{ItemListController:b(ie,["/static/css/scooter/scooter-scoped-vflx8uhBs.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/browse/browse-vflrH05S2.css"]),ItemList:ne}})}.call(this),function(){define("modules/dirty/react/browse/item_list_row",["jquery","external/underscore","external/classnames","external/immutable","external/react","external/react-dom","modules/clean/analytics","modules/clean/browse_interface","modules/clean/css","modules/clean/filepath","modules/clean/keycode","modules/clean/viewer","modules/clean/react/browse/action_logger","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/name_input","modules/clean/react/browse/settings_gear_menu","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/browse/render_partials","modules/clean/react/file_uploader/actions","modules/clean/react_format","modules/clean/react/selectable_list","modules/clean/react/sprite","modules/clean/search/search_helpers","modules/clean/sharing/ui_util","modules/constants/env","modules/core/browser","modules/core/dom","modules/core/i18n","modules/core/uri","modules/dirty/react/browse/share_button","modules/dirty/react/browse/shared_with","modules/dirty/sharing/browse_ui_util","modules/clean/react/flag","modules/clean/react/helpers"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N,A,R,x,M,O){var L,k,B,U,H,q,G,W,j,V,z,Q,K,Y,X,$,J,Z,ee,te,re,se,oe,ne,ie,ae,le;return X=i.TeamsWebActionsLogger,ee=a.browse_uri_for_fq_path,oe=a.get_browse_root_name,k=d.BrowseLogger,z=m.RenameStates,G=m.FileTypes,Q=f.SettingsGearMenuBubble,U=g.File,L=g.BrowseContext,j=g.Paper,B=b.BrowseStore,H=v.FileIcon,$=y.UploaderActions,ie=w.reactFormat,re=S.createSelection,W=D.GoldenGate,J=E.WEBSERVER,Z=F._,K=A.ShareButton,Y=R.SharedWithController,ne=x.isShareButtonEnabled,le=x.showSharedContentLinkSyncModal,ae=O.shallowCompareStateAndProps,se=o.DOM,te=o.createElement,q=o.createClass({displayName:"FileItemRow",propTypes:{context:o.PropTypes.instanceOf(L).isRequired,file:o.PropTypes.instanceOf(U).isRequired,user:o.PropTypes.object,columnClasses:o.PropTypes.string,isTabbable:o.PropTypes.bool,enableDoubleClickTraversal:o.PropTypes.bool,isPagelet:o.PropTypes.bool,isSearchMode:o.PropTypes.bool,topOffsetPx:o.PropTypes.number,isSelected:o.PropTypes.bool,isDraggingInternalFiles:o.PropTypes.bool,isDraggingExternalFiles:o.PropTypes.bool,isAvailableDropTarget:o.PropTypes.bool,isActiveDropTarget:o.PropTypes.bool,isArchiveState:o.PropTypes.bool,isTextSelectable:o.PropTypes.bool,isMultiColumnGroupVisible:o.PropTypes.bool,isSyncColumnVisible:o.PropTypes.bool,isModifiedColumnVisible:o.PropTypes.bool,renameState:o.PropTypes.oneOf(t.values(z)),rowIndex:o.PropTypes.number,showColumnDetail:o.PropTypes.bool,showFilenameHighlights:o.PropTypes.bool,showCheckboxes:o.PropTypes.bool,settingsGearMenuAlt:o.PropTypes.string,settingsGearMenuItems:o.PropTypes.arrayOf(o.PropTypes.shape({label:o.PropTypes.string,action:o.PropTypes.func})),totalRowCount:o.PropTypes.number,onMouseEnter:o.PropTypes.func,onMouseDown:o.PropTypes.func,onMouseUp:o.PropTypes.func,onDragStart:o.PropTypes.func,onToggleRowSelected:o.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",isPagelet:!1,isSearchMode:!1,isSelected:!1,isTabbable:!1,enableDoubleClickTraversal:!0,isDraggingInternalFiles:!1,isDraggingExternalFiles:!1,isAvailableDropTarget:!1,isActiveDropTarget:!1,isArchiveState:!1,isTextSelectable:!0,renameState:null,isMultiColumnGroupVisible:!0,isSyncColumnVisible:!1,isModifiedColumnVisible:!0,showColumnDetail:!1,showFilenameHighlights:!1,showCheckboxes:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null,onToggleRowSelected:null,onFocus:null,onDragStart:function(){}}},getInitialState:function(){return{hasThumbErrored:!1,wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}},componentDidMount:function(){return l.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css"),e(n.findDOMNode(this)).on("dragenter.fileRow",function(e){return function(t){var r;if(e.props.isDraggingExternalFiles||e.props.isDraggingInternalFiles){if(r=e.props.file.is_dir&&!(e.props.isSelected&&e.props.isDraggingInternalFiles)){if(e.props.isActiveDropTarget)return;return h.setDropTarget({target:e.props.file}),$.setPath({path:e.props.file.fq_path,hasPermissionToUploadToFolder:!e.props.file.is_read_only_mount&&e.props.context.isCurrentPathWriteable()})}return h.setDropTarget({target:null}),$.setPath({path:B.path(),hasPermissionToUploadToFolder:e.props.context.isCurrentPathWriteable()})}}}(this)).on("focusin.fileRow",function(e){return function(t){var r;return e.state.focusedIn?void 0:(e.setState({focusedIn:!0}),"function"==typeof(r=e.props).onFocus?r.onFocus(t):void 0)}}(this)).on("focusout.fileRow",function(e){return function(t){return e.setState({focusedIn:!1})}}(this)).on("mouseup.fileRow",this.handleMouseUp),this.props.isPagelet?void 0:this._setTabIndices()},componentWillReceiveProps:function(e){return this.props.isSelected&&!e.isSelected?this.setState({wasSelectedBeforeMostRecentMouseDown:!1,shouldShowSettingsBubble:!1}):void 0},shouldComponentUpdate:ae,componentDidUpdate:function(e){return this.props.isPagelet?void 0:this._setTabIndices()},componentWillUnmount:function(){return e(n.findDOMNode(this)).off(".fileRow")},_setTabIndices:function(){var e,t,r,s,o;for(t=C.getFocusableElementsIn(n.findDOMNode(this),!1),o=[],r=0,s=t.length;s>r;r++)e=t[r],"selection_checkbox"===e.className?o.push(e.tabIndex=-1):this.props.isTabbable?o.push(e.tabIndex=0):o.push(e.tabIndex=-1);return o},handleMouseEnter:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?void h.setDropTarget({target:this.props.file}):this.props.onMouseEnter(e)},handleMouseLeave:function(e){return this.props.isDraggingInternalFiles||this.props.isDraggingExternalFiles?h.setDropTarget({target:null}):void 0},handleMouseDown:function(e){return this.setState({wasSelectedBeforeMostRecentMouseDown:this.props.isSelected}),this.props.onMouseDown(e)},handleMouseUp:function(e){return this.handleSettingsGearMenuMouseUp(e),this.props.onMouseUp(e)},handleSettingsGearMenuMouseUp:function(t){if(null!=this.props.settingsGearMenuItems){if(this.state.shouldShowSettingsBubble)return this.setState({shouldShowSettingsBubble:!1});if(e.contains(n.findDOMNode(this.refs.settings),t.target))return this.setState({shouldShowSettingsBubble:!0})}},handleFilenameClick:function(e){return this.props.isTextSelectable||(k.logOpenRow({uid:this.props.user.id,entity_type:this.props.file.is_dir?"folder":"file"}),e.button>0||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey||(e.preventDefault(),e.stopPropagation(),this.props.file.type===G.TEAM_SHARED_FOLDER&&X.log("clicked_team_folder_web",{team_id:p.get_viewer().team_id}),this.props.isArchiveState))?void 0:this.props.isSearchMode&&this.props.file.is_unmounted?le(this.props.user,this.props.file):(this.props.isSearchMode&&P.logSearchAction(this.props.file,this.props.user,this.props.file.is_dir?"folder_open":"file_view"),h.navigateToFileOrFolder({file:this.props.file,onFileViewerUnmount:this._onViewerUnmount}))},_onViewerUnmount:function(){var e;return null!=(e=n.findDOMNode(this))?e.focus():void 0},handleDoubleClick:function(e){return this.props.enableDoubleClickTraversal?this.handleFilenameClick(e):void 0},handleRenameSubmit:function(e){return h.renameFile({file:this.props.file,newName:e})},handleRenameCancel:function(){return h.cancelFileRename({file:this.props.file})},handleDragStart:function(e){return this.props.isPagelet&&!this.props.isSelected?(this.toggleSelected(e),this.props.onDragStart(e,[this.props.file])):this.props.onDragStart(e)},toggleSelected:function(e){return e.stopPropagation(),this.props.onToggleRowSelected(e)},handleCheckboxKeyPress:function(e){var t;return t=e.which||e.keyCode,t===c.SPACE?(e.stopPropagation(),this.toggleSelected(e)):void 0},_renderSelectionToggleColumn:function(){return[this.props.isPagelet?se.div({className:r({"file-select-checkbox":!0,"show-boxes":this.props.showCheckboxes}),key:"selection_toggle_column",role:"gridcell",onDoubleClick:function(e){return e.stopPropagation()},onClick:function(e){return e.stopPropagation()},onMouseDown:function(e){return function(t){return t.stopPropagation(),e.props.onMouseDown(t)}}(this),onMouseUp:function(e){return function(t){return t.stopPropagation(),e.props.onMouseUp(t)}}(this),onKeyPress:this.handleCheckboxKeyPress},se.button({role:"checkbox","aria-checked":this.props.isSelected,"aria-label":Z("Select row"),onClick:function(e){return e.target.blur()},onMouseDown:function(e){return e.target.blur()},className:this.props.isSelected?"checkbox-button checked":"checkbox-button"})):se.div({className:"ax-visually-hidden",key:"selection_toggle_column",role:"gridcell"},se.input({className:"selection_checkbox",ref:"selectionToggleInput",type:"checkbox","aria-label":Z("Select row"),checked:this.props.isSelected,onChange:this.props.onToggleRowSelected,tabIndex:-1}))]},_renderPlaceholder:function(){return se.span({"aria-hidden":"true"},"--")},_renderScreenReaderExtraInfo:function(){var e,t;return e=[],this.props.file.isDeleted&&e.push(Z("Deleted")),this.props.isSelected&&e.push(Z("Selected")),this.props.file.is_dir&&(this.props.file.type===G.SHARED_FOLDER?this.props.file.is_read_only_mount?e.push(Z("Read-only shared folder")):e.push(Z("Shared folder")):this.props.file.type===G.TEAM_SHARED_FOLDER?this.props.file.is_read_only_mount?e.push(Z("Read-only team shared folder")):e.push(Z("Team shared folder")):e.push(Z("Folder"))),e.length>0?(t=" "+e.join(" "),se.span({className:"ax-visually-hidden"},t)):void 0},_renderFilename:function(){var e,s,o,n,i,a,l,c;return e=this.props.file,s=u.filename(e.fq_path),n=this.props.showFilenameHighlights?P.highlightMatchString(s,e.filename_highlights):t.escape(s),a=u.parent_dir(e.fq_path),l=ee(this.props.user,a),c="/"===a?oe(this.props.user):this.props.isPagelet?a.slice(1):a,this.props.renameState===z.PENDING_INPUT?(i=Z(e.is_dir?"Rename directory…":"Rename file…"),te(_,{ref:"nameInput",label:i,defaultValue:u.filename(e.fq_path),onSubmit:this.handleRenameSubmit,onCancel:this.handleRenameCancel,className:"browse-file-row__input"})):this.props.renameState===z.SAVING_INPUT?se.span({ref:"renameStatus",role:"status"},Z("Renaming…")):(o=e.is_dir?B.urlPrefix()+e.fq_path:e.href,se.div({className:"browse-file-row__name-location"},se.a({ref:"filenameLabel",className:r("filename-link u-ellip","browse-file-row__name",this.props.isArchiveState?"browse-file-row__name-archived":void 0),href:e.is_unmounted?void 0:o,onDragStart:function(e){return function(t){return e.props.isPagelet||(t.stopPropagation(),e.props.isArchiveState)?void 0:(h.setSelection({selection:re([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file],!1))}}(this),onMouseDown:function(e){return function(t){var r,s;if(!e.props.isPagelet)return s=2===t.button||2===t.buttons,r=t.button>0||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey,!e.props.file.is_dir&&!r||s?void 0:t.stopPropagation()}}(this),onClick:this.handleFilenameClick},se.span({dangerouslySetInnerHTML:{__html:n}}),this._renderScreenReaderExtraInfo()),this.props.showColumnDetail?se.div({className:r({"u-ellip":!0,"browse-file-row__location":!0,"u-font-meta":this.props.isPagelet})},this.props.isPagelet?e.is_unmounted?Z("not added yet, in %(location)s",{
comment:"Describes the parent directory of a file in a list of search results."}).format({location:c}):Z("in %(location)s",{comment:"Describes the parent directory of a file in a list of search results."}).format({location:c}):e.is_unmounted?ie(Z("not added yet, in <strong>%(location)s</strong>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:c,strong:se.strong()}):se.a({href:l,onClick:function(e){return function(t){return P.logSearchAction(e.props.file,e.props.user,"click_path_link"),h.setUrl({path:a}),t.preventDefault()}}(this)},ie(Z("in <strong>%(location)s</strong>",{comment:"Describes the parent directory of a file in a list of search results."}),{location:c,strong:se.strong()}))):void 0))},_renderFilenameColumn:function(e){var t,s,o;return s=te(H,{className:this.props.isPagelet?"u-pad-right-s":"u-pad-right-xs",ref:"icon",file:this.props.file,onClick:this.handleFilenameClick,onDragStart:function(e){return function(t){return e.props.isPagelet?void 0:(t.stopPropagation(),h.setSelection({selection:re([e.props.file.fq_path])}),e.props.onDragStart(t,[e.props.file],!1))}}(this),onMouseDown:function(e){return function(t){return e.props.file.is_dir?t.stopPropagation():void 0}}(this)}),o=this._renderFilename(),t=this.props.isPagelet&&!this.props.isMultiColumnGroupVisible?8:6,se.div({ref:"filenameColumn",className:r(""+this.props.columnClasses,"column--filename","u-ellip","o-grid__col--"+t+"-of-12"),key:"filename_column",role:"rowheader"},te(M,{leftAttachment:s},o))},_renderModifiedColumn:function(){var e,t,s;return e=this.props.file.last_modified_fname||"",t=this.props.file.ago||this._renderPlaceholder(),this.props.showColumnDetail&&!this.props.isPagelet&&(t=this.props.file.ago?Z("Modified %(ago)s").format({ago:this.props.file.ago}):""),se.div({className:r((s={},s[""+this.props.columnClasses]=!0,s["u-ellip"]=!0,s["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible||this.props.isPagelet,s["o-grid__col--6-of-12"]=!(this.props.isMultiColumnGroupVisible||this.props.isPagelet),s)),key:"modified_column",role:"gridcell"},this.props.isPagelet?se.span({className:"browse-file-row__modified-time"},t):t,e.length?se.span({className:"browse-file-row__modifier u-font-meta"},(this.props.isPagelet?"by ":"")+e):void 0)},_renderSyncColumn:function(){var e,t;return t="","sync"===this.props.file.default_sync_setting?t=Z("Sync by default"):"no_sync"===this.props.file.default_sync_setting&&(t=Z("Don’t sync by default")),se.div({className:r((e={},e[""+this.props.columnClasses]=!0,e["u-ellip"]=!0,e["o-grid__col--3-of-12"]=this.props.isMultiColumnGroupVisible||this.props.isPagelet,e["o-grid__col--6-of-12"]=!(this.props.isMultiColumnGroupVisible||this.props.isPagelet),e)),key:"sync_column",role:"gridcell"},t)},_renderMultiColumnGroup:function(){var e;return e=function(e){return function(t,r){return se.div({className:"column--multi "+e.props.columnClasses+" column--"+t+" o-grid__col--3-of-12",role:"gridcell",key:t},r)}}(this),[e("sharedwith",te(Y,{file:this.props.file,browseContext:this.props.context,tabIndex:this.props.isTabbable?0:-1,isPagelet:this.props.isPagelet})),e("kind",U.getCategoryDescription(this.props.file)),e("extension",U.getExtension(this.props.file)||this._renderPlaceholder()),e("size",this.props.file.size||this._renderPlaceholder())]},_renderActionsColumn:function(){return this.props.isSearchMode?void 0:se.div({className:"sharing__actions",key:"actions_column",role:"gridcell"},ne(this.props.user,this.props.file,this.props.context)?te(K,{ref:"shareButton",browseContext:this.props.context,file:this.props.file,user:this.props.user,isPagelet:this.props.isPagelet}):void 0)},_renderSettingsGearColumn:function(){return se.div({className:"settings-gear-button",key:"settings_gear_column",role:"gridcell"},te(Q,{ref:"settings",alt:this.props.settingsGearMenuAlt,isShowing:this.state.shouldShowSettingsBubble,menuItems:this.props.settingsGearMenuItems,browseContext:this.props.context,file:this.props.file,isActionDisabled:W.hasContentManagerActionsDisabled(this.props.user.id)}))},_renderEmptyColumns:function(){return se.div({className:r(""+this.props.columnClasses,"u-ellip","o-grid__col--3-of-12"),role:"gridcell",key:"empty_column"})},render:function(){var e,t,s,o;return e={"browse-file-row":!0,"browse-file-row--focused-in":this.state.focusedIn,"browse-file-row--is-selected":this.props.isSelected,"browse-file-row--is-archived":this.props.isArchiveState,"browse-file-row--is-deleted":this.props.file.isDeleted,"browse-file-row--is-drop-target":this.props.isAvailableDropTarget,"browse-file-row--file-dragged-over":this.props.isAvailableDropTarget&&this.props.isActiveDropTarget,"o-grid":!0,"o-grid--no-gutter":!0},o={className:r(e),"data-filename":this.props.file.fq_path.split("/").slice(-1),role:"row",tabIndex:this.props.isTabbable?0:-1,draggable:(this.props.isPagelet||this.props.isSelected&&this.state.wasSelectedBeforeMostRecentMouseDown)&&!((s=this.props.renameState)===z.PENDING_INPUT||s===z.SAVING_INPUT),onContextMenuCapture:this.handleContextMenu,onMouseEnter:this.handleMouseEnter,onMouseDown:function(e){return function(t){return e.props.isPagelet?t.stopPropagation():e.handleMouseDown(t)}}(this),onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseLeave,onClick:this.props.isPagelet?this.handleFilenameClick:this.props.onClick,onDoubleClick:this.handleDoubleClick,onDragStart:this.handleDragStart},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||null==this.props.topOffsetPx||(o.style={position:"absolute",top:this.props.topOffsetPx},o["aria-posinset"]=this.props.rowIndex+1,o["aria-setsize"]=this.props.totalRowCount),se.li(o,this._renderSelectionToggleColumn(),this._renderFilenameColumn(),this.props.isArchiveState?this._renderEmptyColumns():this.props.isSyncColumnVisible?this._renderSyncColumn():this.props.isModifiedColumnVisible?this._renderModifiedColumn():void 0,this.props.isMultiColumnGroupVisible?function(){var e,r,s,o;for(s=this._renderMultiColumnGroup(),o=[],e=0,r=s.length;r>e;e++)t=s[e],o.push(t);return o}.call(this):void 0,null!=this.props.settingsGearMenuItems?this._renderSettingsGearColumn():this._renderActionsColumn())}}),V=o.createClass({displayName:"PaperItemRow",propTypes:{paper:o.PropTypes.instanceOf(j).isRequired,topOffsetPx:o.PropTypes.number,columnClasses:o.PropTypes.string,rowIndex:o.PropTypes.number,showTitleHighlights:o.PropTypes.bool,totalRowCount:o.PropTypes.number,isPagelet:o.PropTypes.bool,onMouseEnter:o.PropTypes.func,onMouseDown:o.PropTypes.func,onMouseUp:o.PropTypes.func},getDefaultProps:function(){return{columnClasses:"browse-file-row__column o-grid__col o-grid__col--am",showTitleHighlights:!1,isPagelet:!1,onMouseEnter:null,onMouseDown:null,onMouseUp:null}},render:function(){var e,s,o,n,i,a,l,u,c;return l=te(T,{group:"web",name:"paper_white_32",ref:"icon",className:"u-pad-right-xs browse-file-row__accessory",alt:""}),c=this.props.paper.title,o=this.props.showTitleHighlights?P.highlightMatchString(c,this.props.paper.title_highlights):t.escape(c),a=N({scheme:"https",authority:J,path:"/paper"}),e=se.div({className:"browse-file-row__name-location"},se.a({className:"filename-link u-ellip browse-file-row__name",href:this.props.paper.url},se.span({dangerouslySetInnerHTML:{__html:o}})),se.div({className:"u-ellip browse-file-row__location"},this.props.isPagelet?Z("in Paper",{comment:"The Dropbox Paper page"}):se.a({href:a},ie(Z("in <strong>Paper</strong>",{comment:"The Dropbox Paper page."}),{strong:se.strong()})))),i=this.props.paper.last_modified_date?Z("Modified %(date)s").format({date:this.props.paper.last_modified_date}):"",this.props.isPagelet?(s=8,n=3):(s=6,n=6),u={className:r("browse-file-row","o-grid","o-grid--no-gutter"),"data-filename":this.props.paper.title,role:"row",tabIndex:"-1"},"undefined"!=typeof RUNNING_IN_REACTSERVER&&null!==RUNNING_IN_REACTSERVER||null==this.props.topOffsetPx||(u.style={position:"absolute",top:this.props.topOffsetPx},u["aria-setsize"]=this.props.totalRowCount,u["aria-posinset"]=this.props.rowIndex+1),se.li(u,se.div({className:r(""+this.props.columnClasses,"column--filename","u-ellip","o-grid__col--"+s+"-of-12"),role:"rowheader"},te(M,{leftAttachment:l},e)),se.div({className:r(""+this.props.columnClasses,"u-ellip","o-grid__col--"+n+"-of-12"),role:"gridcell"},i,se.span({className:"browse-file-row__modifier u-font-meta"},this.props.paper.creator_name)))}}),{FileItemRow:q,PaperItemRow:V}})}.call(this),function(){define("modules/dirty/react/browse/pinned_team_folder",["external/underscore","external/react","external/classnames","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/file_list_utils","modules/clean/react/css","modules/clean/react/tooltip","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/item_list_row"],function(e,t,r,s,o,n,i,a,l,u,c,p){var d,h,m,_,f,g,b,v,y,w,S,T,P,D;return h=o.DropTargetHighlightMode,g=o.LoadingStates,m=n.File,d=n.BrowseContext,f=i.FileListHelpers,v=l.Tooltip,y=l.TooltipPosition,w=c._,_=p.FileItemRow,T=t.DOM,S=t.createElement,b=t.createClass({displayName:"PinnedTeamFolder",propTypes:{teamFolder:t.PropTypes.instanceOf(m).isRequired,context:t.PropTypes.instanceOf(d).isRequired,user:t.PropTypes.object,selection:t.PropTypes.object,loadingState:t.PropTypes.oneOf(e.values(g)),activeDropTarget:t.PropTypes.instanceOf(m),dropTargetHighlightMode:t.PropTypes.oneOf(function(){var e;e=[];for(P in h)D=h[P],e.push(D);return e}()),isDraggingInternalFiles:t.PropTypes.bool,isDraggingExternalFiles:t.PropTypes.bool,isTextSelectable:t.PropTypes.bool},_renderTeamFolderHeader:function(e,t){return T.div({},T.span({className:"pinned-team-folder__header-text"},e),T.div({className:"pinned-team-folder__info-button"},S(v,{position:y.RIGHT,tooltip_contents:T.div({},t),tooltip_classname:"pinned-team-folder__tooltip"},S(u,{group:"web",name:"info",alt:w("File section information")}))))},render:function(){var e;return e=f.shouldFileBeHighlightedDropTarget({file:this.props.teamFolder,isSelected:this.props.selection.selected.has(this.props.teamFolder.fq_path),dropTargetHighlightMode:this.props.dropTargetHighlightMode}),T.div({className:"pinned-team-folder"},T.div({className:"u-pad-top-xs"},this._renderTeamFolderHeader(w("Team Folder"),w("Everything in a Team folder is automatically shared with your team. Team folders can also contain shared folders for collaborating with people outside your team."))),T.div({className:"pinned-team-folder__file-row u-pad-top-xs"},S(_,{selectableListId:this.props.teamFolder.fq_path,key:encodeURI(this.props.teamFolder.fq_path),file:this.props.teamFolder,user:this.props.user,context:this.props.context,shouldFocus:this.props.selection.selected.last()===this.props.teamFolder.fq_path,isDraggingInternalFiles:this.props.isDraggingInternalFiles,isDraggingExternalFiles:this.props.isDraggingExternalFiles,isAvailableDropTarget:e,isActiveDropTarget:this.props.teamFolder===this.props.activeDropTarget,isTextSelectable:this.props.isTextSelectable,isModifiedColumnVisible:!1,onDragStart:function(){},onMouseEnter:function(){},onMouseDown:function(){},onMouseUp:function(){}})),T.div({className:"u-pad-top-m"},this._renderTeamFolderHeader(w("Other Folders"),w("These folders help you organize your private work files."))))}}),{PinnedTeamFolder:a(b,["/static/css/scooter/scooter-scoped-vflx8uhBs.css","/static/css/browse/browse-vflrH05S2.css"])}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/preview_sf_members",["jquery","external/classnames","external/react","external/react-dom","modules/clean/ajax","modules/clean/analytics","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/components/loading_indicator","modules/clean/components/title_bubble","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/css","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/member_avatars","modules/clean/static_urls","modules/clean/sharing/action_types","modules/clean/sharing/api","modules/clean/sharing/ui_util","modules/clean/teams/cdm_mve_quota_usage","modules/clean/teams/limited_team_invite_modal","modules/clean/teams/suggest_invites_modal","modules/clean/viewer","modules/core/i18n","modules/dirty/sharing/browse_ui_util","require"],function(t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I,C,F,N,A,R,x){var M,O,L,k,B,U,H,q,G,W,j,V,z,Q,K,Y,X,$,J,Z,ee,te,re,se,oe,ne;return Q=i.SharedFolderActivityLogger,$=i.TeamsWebActionsLogger,L=l.AVATAR_DIMENSION_BY_SIZE,K=m.SharedWithActionTypes,k=_.BrowseContext,V=_.QuotaStats,G=v.Modal,re=w.reactFormat,oe=T.static_url,z=P.ShareModalActionTypes,Y=D.SharingApi,U=E.GoldenGate,J=A._,ne=A.ungettext,se=R.showTiburonUIIfAllowed,ee=s.createElement,te=s.DOM,q=15,B=10,O=L.MEDIUM,X="south",M=!0,W=s.createClass({displayName:"PreviewSFMembersPanel",propTypes:{context:s.PropTypes.instanceOf(k).isRequired,user:s.PropTypes.object.isRequired,viewer:s.PropTypes.instanceOf(N),isPagelet:s.PropTypes.bool},getInitialState:function(){return{hasPendingRequest:!0,sharedFolderData:{},sharedLinkData:void 0}},getDefaultProps:function(){return{viewer:N.get_viewer(),isPagelet:!1}},componentDidMount:function(){return this._fetchSharedFolderData(),this._log_event("preview_sf_members_shown"),t(document).on(Y.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken=h.register(this.onEventDispatched)},componentWillUnmount:function(){var e,r;return null!=(e=this._currentSFDataRequest)&&e.abort(),null!=(r=this._currentLinkDataRequest)&&r.abort(),t(document).off(Y.REQUEST_SUCCEEDED_EVENT,this._sharing_api_request_handler),this._dispatchToken?h.unregister(this._dispatchToken):void 0},componentDidUpdate:function(e){var t,r;return(null!=(t=e.context)?t.currentFQPath:void 0)!==(null!=(r=this.props.context)?r.currentFQPath:void 0)?(this._fetchSharedFolderData(),this._log_event("preview_sf_members_shown")):void 0},onEventDispatched:function(t){var r,s,o,n,i;return r=null!=t&&null!=(o=t.action)?o.type:void 0,n=[K.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,K.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,K.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE],r&&e.call(n,r)>=0?this._fetchSharedFolderData():r&&r===z.FETCH_LINK_METADATA_SUCCESS&&(s=this.props.context.currentNSPath?this.props.context.currentFQPath:this.props.context.currentNSID,i=this.props.user.id+":"+s,t.action.sharingKey===i)?this._fetchSharedLinkData():void 0},_canShareAsNestedSharedFolder:function(){return this.props.context.currentNSPath&&this.props.context.currentNSAllowsNesting},_isViewingTeamRootFolder:function(){return this.props.context.isInsideAutoTeamFolder&&"/"===d.parent_dir(this.props.context.currentFQPath)},_isViewingLimitedTeamRootFolder:function(){return this._isViewingTeamRootFolder()&&this.props.viewer.team_is_limited&&!this._isViewingCdmMveFolder()},_isViewingCdmMveFolder:function(){return this._isViewingTeamRootFolder()&&Boolean(this.props.context.cdmMveQuotaStats)},_cdmMveRootFolderShareButtonText:function(){return J(this._isViewingCdmMveFolderAndCanInvite()?"Invite members":"Suggest team members")},_isViewingCdmMveFolderAndCanInvite:function(){return this._isViewingCdmMveFolder()&&(this.props.viewer.team_is_limited||this.props.user.is_team_admin)},_sharing_api_request_handler:function(e,t){var r;return r=t.request_url,r.indexOf("/share_ajax/leave")>-1||r.indexOf("/share_ajax/unshare")>-1||!this.props.context.isInFolderMode||t.ns_id!==this.props.context.currentNSID?void 0:this._fetchSharedFolderData()},_getMaxVisibleAvatars:function(){return U.hasNewMembershipUI(this.props.user.id)?B:q},_fetchSharedFolderData:function(){return this._fetchSharedFolderMembers(),this._fetchSharedLinkData(),this._setHasPendingRequest()},_fetchSharedFolderMembers:function(){var e;if(this.props.context.currentMountPoint)return e="/share_ajax/preview_members/"+this.props.context.currentNSID,this._currentSFDataRequest=n.WebRequest({url:e,subject_user:this.props.user,data:{max_results:this._getMaxVisibleAvatars(),is_loading_cdm_mve_preview:this._isViewingCdmMveFolder(),sort_by_name:U.hasNewMembershipUI(this.props.user.id)},success:function(e){return function(t){var r;return t=JSON.parse(t),t.ns_id===e.props.context.currentNSID?(r={numUndisplayableUsersAndInvites:t.num_avatars_not_shown,numUsersAndInvites:t.num_users_and_invites,numUsersAndInvitesOutsideTeam:t.num_users_and_invites_outside_team,groups:t.groups,invitations:t.invitations,joinedMembers:t.joined_members},t.user_can_invite&&(e.props.context.isInsideSharedFolder&&!e.props.context.isInsideAutoTeamFolder||e._canShareAsNestedSharedFolder())&&(r.inviteButton=ee(H,{onClick:e.invite_button_click_handler})),e.setState({sharedFolderData:r})):void 0}}(this),complete:function(e){return function(){return e._currentSFDataRequest=null,e._setHasPendingRequest()}}(this)})},_fetchSharedLinkData:function(){var e,t;if(U.hasNewMembershipUI(this.props.user.id)&&(e=this.props.context.currentFQPath,null!=e&&"/"!==e))return t=[e],this._currentLinkDataRequest=n.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(t)},subject_user:this.props.user,success:function(e){return function(t){var r;return r=t.shmodels[0],(null!=r?r.disabled:0)||null!=(null!=r?r.path:void 0)&&r.path!==e.props.context.currentFQPath?void 0:e.setState({sharedLinkData:r})}}(this),complete:function(e){return function(){return e._currentLinkDataRequest=null,e._setHasPendingRequest()}}(this)})},_setHasPendingRequest:function(){try{return this.setState({hasPendingRequest:null!=this._currentSFDataRequest||null!=this._currentLinkDataRequest})}catch(e){}},settings_button_click_handler:function(){return this._isViewingCdmMveFolder()?this._show_invite_team_members_modal():(this._log_event("preview_sf_members_settings_button_clicked"),se(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})?void 0:this._show_shared_folder_members_modal())},invite_button_click_handler:function(){return this._log_event("preview_sf_members_invite_button_clicked"),this._show_add_people_modal()},_avatar_click_handler:function(e){return this._log_event(e),document.activeElement!==document.body&&document.activeElement.blur(),se(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})},avatar_click_handler:function(){return this._avatar_click_handler("preview_sf_members_avatar_clicked")},shared_link_click_handler:function(){return this._avatar_click_handler("preview_sf_members_shared_link_clicked")},overflow_click_handler:function(){return this._log_event("preview_sf_members_overflow_number_clicked"),se(this.props.user,this.props.context,{origin:"BROWSE_SHARED_FOLDER_BANNER"})?void 0:this._show_shared_folder_members_modal()},focus_sharing_options_modal_invite_form:function(){return x(["dropbox","modules/clean/dbmodal"],function(e){return function(r,s){var o,n;return n=r.ExistingSharedFolderOptionsContent,o=s.DBModalStack,o.unregister(n.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),t("#sharing-options-new-collab-input").focus()}}(this))},_show_invite_team_members_modal:function(){return $.log("preview_sf_members_cdm_mve_invite_button_clicked"),this._isViewingCdmMveFolderAndCanInvite()?G.showInstance(ee(C)):G.showInstance(ee(F))},_show_shared_folder_members_modal:function(){return x(["dropbox"],function(e){return function(t){var r;return r=t.SharingModals,e._canShareAsNestedSharedFolder()?r.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):r.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user,!0)}}(this))},_show_add_people_modal:function(){return x(["dropbox","modules/clean/dbmodal"],function(e){return function(t,r){var s,o,n;return o=t.ExistingSharedFolderOptionsContent,n=t.SharingModals,s=r.DBModalStack,e._canShareAsNestedSharedFolder()?n.show_share_existing_modal(e.props.context.currentFQPath,e.props.user):(s.register(o.CONTENT_LOADED_EVENT,e.focus_sharing_options_modal_invite_form),n.show_shared_folder_options_modal(e.props.context.currentMountPoint,e.props.user))}}(this))},_log_event:function(e,t){return null==t&&(t={}),t.ns_id=this.props.context.currentNSID,Q.log("web",e,this.props.user,t)},render:function(){var e;return e={folderName:this.props.context.getNameOfTargetFolder(),user:this.props.user,viewer:this.props.viewer,onSettingsButtonClick:this.settings_button_click_handler,onOverflowCountClick:this.overflow_click_handler,onAvatarClick:this.avatar_click_handler,maxVisibleAvatars:this._getMaxVisibleAvatars(),folderType:this.props.context.isInsideAutoTeamFolder?"TEAM":"SHARED",buttonText:this._isViewingCdmMveFolder()?this._cdmMveRootFolderShareButtonText():null,isViewingLimitedTeamRootFolder:this._isViewingLimitedTeamRootFolder(),cdmMveQuotaStats:this._isViewingCdmMveFolder()?this.props.context.cdmMveQuotaStats:void 0,showCreateTeamPromo:this.props.context.showSharedFolderCreateTeamPromo,onSharedLinkClick:this.shared_link_click_handler,sharedLinkData:this.state.sharedLinkData,hasPendingRequest:this.state.hasPendingRequest,isPagelet:this.props.isPagelet},e=t.extend(e,this.state.sharedFolderData),te.div({className:"PreviewSFMembersPanel"},ee(j,e))}}),Z=s.createClass({displayName:"PreviewSFMembersView",mixins:[S],propTypes:{folderName:s.PropTypes.string.isRequired,folderType:s.PropTypes.oneOf(["SHARED","TEAM"]).isRequired,user:s.PropTypes.object.isRequired,viewer:s.PropTypes.instanceOf(N).isRequired,onSettingsButtonClick:s.PropTypes.func.isRequired,onOverflowCountClick:s.PropTypes.func,onAvatarClick:s.PropTypes.func,inviteButton:s.PropTypes.element,buttonText:s.PropTypes.string,isViewingLimitedTeamRootFolder:s.PropTypes.bool,hasPendingRequest:s.PropTypes.bool,numUndisplayableUsersAndInvites:s.PropTypes.number,numUsersAndInvites:s.PropTypes.number,numUsersAndInvitesOutsideTeam:s.PropTypes.number,groups:s.PropTypes.array,invitations:s.PropTypes.array,joinedMembers:s.PropTypes.array,onSharedLinkClick:s.PropTypes.func,sharedLinkData:s.PropTypes.object,avatarDimension:s.PropTypes.number,cdmMveQuotaStats:s.PropTypes.instanceOf(V),titleButtonDirection:s.PropTypes.string,maxVisibleAvatars:s.PropTypes.number,showCreateTeamPromo:s.PropTypes.bool,isPagelet:s.PropTypes.bool},getDefaultProps:function(){return{titleButtonDirection:X,avatarDimension:O,maxVisibleAvatars:q,animation:M,isPagelet:!1}},renderCreateTeamPromo:function(){var e,t,r;return t="",r=this.props.viewer.personal_email,null!=this.props.joinedMembers&&(t=function(){var t,s,o,n;for(o=this.props.joinedMembers,n=[],t=0,s=o.length;s>t;t++)e=o[t],e.email!==r&&n.push(e.email);return n}.call(this).join()),te.div({className:"team-upsell-banner c-card c-card--arrow c-card--arrow-sw"},re(J("<createLink>Create a Team Dropbox</createLink> with the people in this folder"),{createLink:te.a({href:"/team?tk=sf_upsell&_camp=sf&invite_members="+t})}),te.span({className:"u-mar-left-xxs"},ee(c,{text:J("With teams you get access to a shared team folder, a separate work Dropbox, groups, and other tools and features."),direction:"north"},ee(y,{className:"team-upsell-banner__info-sprite",group:"web",name:"info",alt:J("More information about teams")}))))},_renderContent:function(){return[this.renderFolderInfo(),this.props.numUsersAndInvites?"SHARED"===this.props.folderType?this.renderAvatars():this.renderTeamFolder():this._renderLoadingIndicator()]},_renderCdmMveContent:function(){return this.props.numUsersAndInvites?te.div({className:"cdm-mve-sf-info-banner"},te.div({className:"shared-folder-info u-mar-bottom-xs"},te.span({className:"u-font-strong"},this._buildNumberOfMembersString()),this.props.viewer.team_is_limited?ee(I,{quotaStats:this.props.cdmMveQuotaStats}):void 0),this.renderAvatars()):this._renderLoadingIndicator()},_renderGoldenGateContent:function(){return this.props.hasPendingRequest?this._renderLoadingIndicator():ee(g,{rightAttachment:this.renderAvatars()},this.renderGoldenGateFolderInfo())},_renderLoadingIndicator:function(){return te.div({className:"loading-indicator-container"},ee(u,null))},render:function(){return te.div({className:"sf-member-preview-container"},this.props.showCreateTeamPromo?this.renderCreateTeamPromo():void 0,te.div({className:this.getClassName()},ee(g,{rightAttachment:this.renderButtons()},this.props.cdmMveQuotaStats?this._renderCdmMveContent():U.hasNewMembershipUI(this.props.user.id)?this._renderGoldenGateContent():this._renderContent())))},getClassName:function(){return r({"preview-sf-members--with-team-promo":this.props.showCreateTeamPromo,"c-banner c-banner--unpinned u-pad-s":!0,"team-folder":"TEAM"===this.props.folderType})},renderTeamFolder:function(){var e,t;return e=null,this.props.groups&&(t=this.props.groups[0],t&&t.is_automatic&&(e=J("editor"===t.access_type?"%(group_name)s can edit":"%(group_name)s can view"),e=e.format({group_name:t.name}))),e||(e=J("Shared with all members of %(team_name)s").format({team_name:this.props.viewer.team_name})),te.div({className:"team-folder-member-entry"},ee(a,{dimension:32,photoUrl:oe("/static/images/icons/team_32-vflk8mBzO.png"),shape:"SQUARE",optionalClass:"u-mar-right-xs"}),te.span({className:"u-l-ib u-l-ib--m"},e))},renderButtons:function(){var e,t,s;if((!this.props.isViewingLimitedTeamRootFolder||this.props.user.is_team_admin)&&!this.props.isPagelet)return t=U.hasNewMembershipUI(this.props.user.id),s=!this.props.isViewingLimitedTeamRootFolder,e=this.props.buttonText?this.props.buttonText:J(s?"Share":"Settings"),te.div(null,s?void 0:this.props.inviteButton,te.button({className:r(["c-btn","settings-button",t?"c-btn--primary":"c-btn--secondary"]),onClick:this.props.onSettingsButtonClick,title:e},e))},renderFolderInfo:function(){return te.div({className:"shared-folder-info u-mar-bottom-xs"},te.strong({className:"shared-folder-name"},p.em_snippet(this.props.folderName,18)),this.props.numUsersAndInvites?te.span({className:"u-mar-horizontal-xs"},"•"):void 0,this.props.numUsersAndInvites?te.span({className:"members-string u-font-meta"},this._buildNumberOfMembersString()):void 0)},renderGoldenGateFolderInfo:function(){var e,t;return this.props.numUsersAndInvites?(t=ne("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}).format({num_total:this.props.numUsersAndInvites}),this.props.numUsersAndInvitesOutsideTeam&&(e=ne("%(num_outside)s outside your Dropbox team","%(num_outside)s outside your Dropbox team",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside your Dropbox team)"'}).format({num_outside:this.props.numUsersAndInvitesOutsideTeam}))):t=this.props.sharedLinkData?this.getDescriptionForSharedLinkInfo(this.props.sharedLinkData):J("Not shared"),te.div({className:"u-l-ib shared-folder-info__members"},te.strong({},t),null!=e?te.div({className:"u-font-meta"},e):void 0)},_buildNumberOfMembersString:function(){var e,t;return t=ne("%(num_total)s member","%(num_total)s members",this.props.numUsersAndInvites,{comment:'Another pluralized string MAY be concatenated to this to make a string like: "15 members (4 outside of TechCorp Inc.)"'}),this.props.numUsersAndInvitesOutsideTeam?(t+=ne(" (%(num_outside)s outside your Dropbox team)"," (%(num_outside)s outside your Dropbox team)",this.props.numUsersAndInvitesOutsideTeam,{comment:'This will be concatenated to another string to make a string like: "15 members (4 outside your Dropbox team)"'}),e=t.format({num_total:this.props.numUsersAndInvites,num_outside:this.props.numUsersAndInvitesOutsideTeam,team_name:p.em_snippet(this.props.viewer.team_name,16)})):e=t.format({num_total:this.props.numUsersAndInvites}),e},renderAvatars:function(){var e,t,r,s,o,n;return e=[],n=[],this.props.sharedLinkData&&e.push(this.renderSharedLink(this.props.sharedLinkData)),this.props.numUsersAndInvites&&(U.hasNewMembershipUI(this.props.user.id)||(o=this.findOwnerAndMeInJoinedMembers(this.props.joinedMembers),s=o[0],r=o[1],null!=s&&(e.push(this.renderJoinedMember(s)),n.push(s.user_id)),null!=r&&r!==s&&(e.push(this.renderJoinedMember(r)),n.push(r.user_id))),t=this.props.cdmMveQuotaStats?[]:this.props.groups,this.addGroupsMembersInvitations(e,t,this.props.joinedMembers,this.props.invitations,n)),this.renderAvatarList(e,this.getAvatarListClassName())},getAvatarListClassName:function(){return r({"u-pad-right-m":U.hasNewMembershipUI(this.props.user.id)})}}),H=s.createClass({displayName:"InviteButton",propTypes:{onClick:s.PropTypes.func.isRequired},render:function(){return te.button({className:"c-btn c-btn--secondary u-mar-right-xs",onClick:this.props.onClick,title:J("Add members")},ee(b,{alt:J("Add members"),src:oe("/static/images/account_photo/icon-add-people-vfl6PECU8.png"),srcHiRes:oe("/static/images/account_photo/icon-add-people@2x-vflNPmgwH.png")}))}}),j=f(Z,["/static/css/avatar_list-vflo6SmYO.css","/static/css/components/loading_indicator-vflbadB1S.css","/static/css/scooter/scooter-scoped-vflx8uhBs.css","/static/css/shared_folder_members_preview/team_promo-vflu998jd.css","/static/css/shared_folder_members_preview/cdm_mve_banner-vflRBgSZE.css"]),{PreviewSFMembersPanel:W,PreviewSFMembersView:j}})}.call(this);var __assign=this&&this.__assign||Object.assign||function(e){for(var t,r=1,s=arguments.length;s>r;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e};define("modules/dirty/react/browse/selection_actions",["require","exports","external/immutable","external/react","external/classnames","modules/clean/react/browse/models","modules/clean/react/browse/util","modules/clean/react/bubble_menu","modules/clean/em_string","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/file_actions","modules/clean/react/browse/action_logger"],function(e,t,r,s,o,n,i,a,l,u,c,p,d){"use strict";var h=n.BrowseContext,m=a.BubbleMenu,_=a.BubbleMenuItem,f=d.BrowseLogEventSources;t.BrowseSelectionMenu=s.createClass({displayName:"BrowseSelectionMenu",mixins:[s.addons.PureRenderMixin],propTypes:{context:s.PropTypes.instanceOf(h).isRequired,selectedFiles:s.PropTypes.instanceOf(r.OrderedSet).isRequired,user:s.PropTypes.object.isRequired,onActionButtonClick:s.PropTypes.func,actionHandlers:s.PropTypes.object,isSearchMode:s.PropTypes.bool},getDefaultProps:function(){return{actionHandlers:{},onActionButtonClick:function(){},isSearchMode:!1}},componentDidUpdate:function(){this.refs.moreActionsBubbleMenu&&this.refs.moreActionsBubbleMenu.hideMenu()},_renderMenuButton:function(e){var t,r=this,n=e.label,i=e.spriteName,a=e.performAction,l=e.href,c=e.ref,p=e.disabled,d=void 0===p?!1:p;if(a){var h={ref:c,className:"button-as-link browse-menu__action-button",onClick:function(e){d||(r.props.onActionButtonClick(),a(e))},disabled:!1};d&&(h.disabled=!0),t=s.createElement("button",__assign({},h),s.createElement(u,{group:"web",name:i,alt:"",className:"browse-menu__action-button-sprite"}),s.createElement("span",{className:"browse-menu__action-button-label"},n))}else l&&(t=s.createElement("a",{ref:c,className:"browse-menu__action-button",href:l},s.createElement(u,{group:"web",name:i,alt:"",className:"browse-menu__action-button-sprite"}),s.createElement("span",{className:"browse-menu__action-button-label"},n)));var m=o({"browse-menu__action":!0,"browse-menu__action--disabled":d});return s.createElement("li",{key:n,className:m,"data-action":n},t)},_renderMoreActionsDropbdown:function(e){var t=c._("More")+" ",r=s.createElement("button",{className:"button-as-link browse-menu__action-button"},t,s.createElement(u,{group:"web",name:"arrow-down-blue",alt:"",className:"browse-menu__more-dropdown-arrow"})),o=e.map(function(e){var t=e.label,r=e.spriteName,o=e.performAction,n=e.href,i=e.disabled,a=void 0===i?!1:i;
return s.createElement(_,{href:n,onClick:function(){o&&o()},disabled:a},s.createElement(u,{group:"web",name:r,alt:"",className:"browse-menu__action-button-sprite"}),s.createElement("span",{className:"browse-menu__action-button-label"},t))});return s.createElement("li",{className:"browse-menu__action"},s.createElement(m,{ref:"moreActionsBubbleMenu",targetButton:r,targetFixed:!0,position:m.POSITIONS.BOTTOM_LEFT,items:o}))},render:function(){var e,t=i.describeFiles(this.props.selectedFiles);if(e=1!==this.props.selectedFiles.count()||this.props.selectedFiles.first().is_dir?"":this.props.selectedFiles.first().size,this.props.selectedFiles.isEmpty())return null;for(var r=p.getActionsForFileCollection({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,skipSharing:!0,isSearchMode:this.props.isSearchMode,actionHandlers:this.props.actionHandlers,source:f.LEGACY_HEADER_ACTIONS}),o=800,n=12,a=new l(t).length*n,u=new l(e).length*n,c=o-(a+u+10+20),d=0,h=[],m=0;m<r.length;m++){var _=r[m];if(d+=new l(_.label).length*n+16+3+8,d>c||m>=6){var g=m-1;h=r.slice(g),r=r.slice(0,g);break}}return s.createElement("div",{className:"c-column-header browse-menu browse-file-list-header"},s.createElement("span",{className:"browse-menu__description"},t),s.createElement("ul",{className:"browse-menu__actions"},r.map(this._renderMenuButton),h.length?this._renderMoreActionsDropbdown(h):null),s.createElement("span",{className:"browse-menu__filesize-label"},e))}})}),function(){define("modules/dirty/react/browse/share_button",["require","external/classnames","external/react","external/react-dom","modules/clean/css","modules/clean/keycode","modules/clean/react/button","modules/clean/react/browse/models","modules/clean/react/sprite","modules/core/i18n","modules/dirty/react/browse/sharing_shims"],function(e,t,r,s,o,n,i,a,l,u,c){var p,d,h,m,_,f,g,b,v;return _=i.button,p=a.BrowseContext,d=a.File,m=u._,v=c.initiateSharingFromUIElement,b=c.hasMultipleSharingOptions,g=r.DOM,f=r.createElement,h=r.createClass({displayName:"ShareButton",mixins:[r.addons.PureRenderMixin],propTypes:{browseContext:r.PropTypes.instanceOf(p).isRequired,file:r.PropTypes.instanceOf(d).isRequired,user:r.PropTypes.object.isRequired,isPagelet:r.PropTypes.bool},handleClick:function(e){var t,r,o,n,i;return o=this.props,i=o.user,r=o.file,t=o.browseContext,n=s.findDOMNode(this.refs.button),v(n,i,r,t,"BROWSE_FILE_ROW"),this.props.isPagelet?e.stopPropagation():void 0},handleDoubleClick:function(e){return e.stopPropagation(),this.handleClick()},render:function(){var e,r,s;return s=b(this.props.user,this.props.file,this.props.browseContext),r={"c-btn c-btn--tertiary":!0,"inline-button":!0,"inline-share-button":!0,"variant-DROPDOWN":!0,"extra-padding":!s},e=m(this.props.browseContext.isNonUserRelativeContext?"Manage access":"Share"),f(_,{className:t(r),onClick:this.handleClick,onDoubleClick:this.handleDoubleClick,ref:"button",importance:"secondary"},g.span({className:"inline-share-button-label"},e),s?f(l,{group:"web",name:"arrow-down-blue",alt:""}):void 0)}}),{ShareButton:h}})}.call(this),function(){var e=function(e,r){function s(){this.constructor=e}for(var o in r)t.call(r,o)&&(e[o]=r[o]);return s.prototype=r.prototype,e.prototype=new s,e.__super__=r.prototype,e},t={}.hasOwnProperty,r=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/browse/shared_with",["jquery","external/react","external/react-dom","external/underscore","modules/core/user_i18n","modules/clean/account/email","modules/clean/ajax","modules/clean/flux/base_store","modules/clean/flux/dispatcher","modules/clean/flux/store_mixin","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/sharing/shared_with_view","modules/clean/sharing/api","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/ui_util","modules/clean/file_events","modules/core/dom","modules/dirty/sharing/browse_ui_util","require"],function(t,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T){var P,D,E,I,C,F,N,A,R,x,M,O,L,k,B,U,H,q,G,W,j,V,z;return C=a.EmailVerification,D=d.BrowseActionTypes,B=d.SharedWithActionTypes,E=h.BrowseContext,F=h.File,I=m.BrowseStore,W=_.SharedWithView,j=f.SharingApi,N=g.FileShareApiClient,A=g.FolderShareApiClient,L=b.MemberCounts,z=S.showTiburonUIIfAllowed,V=s.createElement,O=5,R=3,P=6,x=100,k=100,M="file_row_sharing_menu",G=function(t){function r(){return r.__super__.constructor.apply(this,arguments)}return e(r,t),r.prototype._init=function(){return this._sharedFolderDataByTargetNs={},this._sharedFolderMemberCountsByTargetNs={},this._sharedLinkDataMapsByFolderFQPath={},this._filesWeHaveSharedLinkDataFor={},this._sharedFileDataByFileId={},this._hasSharedDataLoadedByNSID={}},r.prototype.hasLinkDataForFile=function(e){return e.fq_path in this._filesWeHaveSharedLinkDataFor},r.prototype.clearSharedLinkDataCache=function(){return this._filesWeHaveSharedLinkDataFor={}},r.prototype.getDataForFile=function(e){var t,r,s,o,n;return r=null,null!=e.target_ns&&(r=this._sharedFolderDataByTargetNs[e.target_ns]),this._canBeSharedFile(e)&&(r=this._sharedFileDataByFileId[null!=(s=e.file_id)?s:e.fq_path]),t=I.path(),n=this._sharedLinkDataMapsByFolderFQPath[t],n&&(o=n[this._sharedLinkKey(e)],o?(r||(r={}),r.sharedLinkInfo=o):null!=r&&delete r.sharedLinkInfo),r||(r={}),r.inheritedMemberCounts=this._getMemberCounts(),r.hasSharedDataLoaded=this._getHasSharedDataLoaded(),r},r.prototype.getDataForCurrentNSID=function(){var e;return e=this._sharedFolderDataByTargetNs[I.context().currentNSID],e||(e={}),e.inheritedMemberCounts=this._getMemberCounts(),e.hasSharedDataLoaded=this._getHasSharedDataLoaded(),e},r.prototype._sharedLinkKey=function(e){return e.fq_path+"_"+e.ns_id+"_"+e.sjid},r.prototype._new_payload=function(e){switch(e.action.type){case D.LOAD_PATH:return this._pathLoaded(e.action.data);case D.ADD_FILES:return this._filesAdded(e.action.data);case D.INITIALIZE_EVERYTHING:return this._browseInitializeEverything(e.action.data);case D.CHANGE_FILES:return this._filesChanged(e.action.data);case B.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:return this._signalSharedFileDataOutOfDate(e.action.data);case B.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:return this._signalSharedFolderDataOutOfDate(e.action.data);case B.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:return this._signalSharedLinkDataOutOfDate(e.action.data);case B.SET_SHARED_FOLDER_DATA:return this._setNSSharedWithData(e.action.data);case B.SET_MEMBER_COUNTS_FOR_NS:return this._setMemberCountsForNs(e.action.data);case B.SET_SHARED_LINK_DATA:return this._setSharedLinkData(e.action.data);case B.SET_SHARED_FILE_DATA:return this._setSharedFileData(e.action.data);case B.CLEAR_SHARED_FOLDER_DATA_FOR_NS:return this._clearSharedFolderDataForNs(e.action.data);case B.REMOVE_SHARED_LINK_DATA:return this._removeSharedLinkData(e.action.data)}},r.prototype._fillInMissingSharedLinkData=function(e){var t,r,s,o,n,i,a;for(a=e.parentPath,s=e.files,o=[],n=0,i=s.length;i>n;n++)r=s[n],this.hasLinkDataForFile(r)||(this._filesWeHaveSharedLinkDataFor[r.fq_path]=!0,o.push(r));return U.loadLinkDataForFiles({parentPath:a,fileFqPaths:function(){var e,r,s;for(s=[],e=0,r=o.length;r>e;e++)t=o[e],s.push(t.fq_path);return s}()})},r.prototype._getMemberCounts=function(){var e;return e=I.context().currentNSID,e in this._sharedFolderMemberCountsByTargetNs?this._sharedFolderMemberCountsByTargetNs[e]:new L},r.prototype._getHasSharedDataLoaded=function(){var e;return e=I.context().currentNSID,e in this._hasSharedDataLoadedByNSID?this._hasSharedDataLoadedByNSID[e]:!1},r.prototype._setHasSharedDataLoaded=function(e){var t;return t=I.context().currentNSID,this._hasSharedDataLoadedByNSID[t]=e},r.prototype._canBeSharedFile=function(e){return!(e.is_dir||e.isDeleted)},r.prototype._loadSharedFileData=function(e){var t,r,s,o,n,i,a;for(o=(null!=e?e:{invalidateCache:!1}).invalidateCache,a=I.user(),o&&(this._sharedFileDataByFileId={}),r=[],i=I.files().toArray(),s=0,n=i.length;n>s;s++)t=i[s],!this._canBeSharedFile(t)||t.file_id in this._sharedFileDataByFileId||r.push(t.file_id);return U.loadSharedFileDataForFiles({fileIds:r})},r.prototype._pathLoaded=function(e){var t,r;return t=e.files,r=e.path,this._setHasSharedDataLoaded(!1),U.loadMemberCountsForContainingNs(),U.loadSFDataForPath({parentPath:r}),this._loadSharedFileData({invalidateCache:!0}),this._filesAdded({files:t,path:r})},r.prototype._filesAdded=function(e){var t,r;return t=e.files,r=e.path,this._fillInMissingSharedLinkData({parentPath:r,files:t}),this._loadSharedFileData()},r.prototype._filesChanged=function(e){var t,r,s;return s=e.path,r=e.fileDeltas,s===I.path()&&null!=r&&r.length?(c.waitFor([I.dispatchToken]),U.loadSFDataForPath({parentPath:s}),this.clearSharedLinkDataCache(),t=I.files().toArray(),this._fillInMissingSharedLinkData({parentPath:s,files:t}),this._loadSharedFileData({invalidateCache:!0})):void 0},r.prototype._signalSharedFileDataOutOfDate=function(e){var t;return t=e.fileIds,U.loadSharedFileDataForFiles({fileIds:t})},r.prototype._signalSharedFolderDataOutOfDate=function(e){var t;return t=e.parentPath,null==t&&(t=I.path()),U.loadMemberCountsForContainingNs(),U.loadSFDataForPath({parentPath:t})},r.prototype._signalSharedLinkDataOutOfDate=function(e){var t,r;return r=e.parentPath,t=e.fileFqPaths,null==r&&(r=I.path()),U.loadLinkDataForFiles({parentPath:r,fileFqPaths:t})},r.prototype._setNSSharedWithData=function(e){var t;return t=e.sharedFolderData,this._setHasSharedDataLoaded(!0),this._sharedFolderDataByTargetNs=t,this.emit_change()},r.prototype._setMemberCountsForNs=function(e){var t,r;return r=e.targetNs,t=e.memberCounts,this._sharedFolderMemberCountsByTargetNs[r]=t,this.emit_change()},r.prototype._setSharedLinkData=function(e){var t,r,s,o,n,i,a,l;for(o=e.parentPath,i=e.sharedLinkData,l=this._sharedLinkDataMapsByFolderFQPath[o]||{},r=0,s=i.length;s>r;r++)n=i[r],t=n.file,a=n.sharedLinkToken,l[this._sharedLinkKey(t)]=a;return this._sharedLinkDataMapsByFolderFQPath[o]=l,this.emit_change()},r.prototype._setSharedFileData=function(e){var t;return t=e.sharedFileData,n.extend(this._sharedFileDataByFileId,t),this.emit_change()},r.prototype._clearSharedFolderDataForNs=function(e){var t;return t=e.targetNs,this._sharedFolderDataByTargetNs[t]=void 0,this.emit_change()},r.prototype._browseInitializeEverything=function(e){var t,r;return r=e.path,t=e.files,U.loadMemberCountsForContainingNs(),U.loadSFDataForPath({parentPath:r}),this._filesAdded({path:r,files:t})},r.prototype._removeSharedLinkData=function(e){var t,r,s,o,n,i;for(n=e.parentPath,r=e.files,i=this._sharedLinkDataMapsByFolderFQPath[n]||{},s=0,o=r.length;o>s;s++)t=r[s],i[this._sharedLinkKey(t)]=void 0;return this._sharedLinkDataMapsByFolderFQPath[n]=i,this.emit_change()},r}(u),q=new G,t(document).on(j.REQUEST_SUCCEEDED_EVENT,function(e,t){var r;return r=t.request_url,r.indexOf("/share_ajax/leave")>-1||r.indexOf("/share_ajax/unshare")>-1?c.dispatch({type:B.CLEAR_SHARED_FOLDER_DATA_FOR_NS,data:{targetNs:t.ns_id}}):c.dispatch({type:B.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{parentPath:I.path()}})}).on(y.LINKS_REMOVE,function(e,t){return c.dispatch({type:B.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:I.path(),fileFqPaths:[t.fq_path]}})}).on(y.LINKS_ADD,function(e,t){return c.dispatch({type:B.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{parentPath:I.path(),fileFqPaths:[t.fq_path]}})}),U=function(){function e(){}return e.loadSFDataForPath=function(e){var t,r;return t=e.parentPath,r=I.user(),l.WebRequest({url:"/share_ajax/shared_with",dataType:"json",subject_user:r,data:{max_results:O,fq_path_prefix:t,include_inherited:!1,admin_console:I.context().isNonUserRelativeContext?"true":void 0,sort_by_name:v.GoldenGate.hasNewMembershipUI(r.id)},success:function(e){var t,r,s,o,n;for(n={},t=0,r=e.length;r>t;t++)o=e[t],s={numUndisplayableUsersAndInvites:o.num_avatars_not_shown,groups:o.groups,invitations:o.invitations,joinedMembers:o.joined_members,audienceDescription:o.audience_description},n[o.ns_id]=s;return c.dispatch({type:B.SET_SHARED_FOLDER_DATA,data:{sharedFolderData:n}})}})},e.loadMemberCountsForContainingNs=function(){var e,t,r;return r=I.user(),t=I.context().isInsideSharedFolder?I.context().currentNSID:void 0,r.is_email_verified&&t?(e=new A({userId:r.id}),e.getMemberCounts({contentId:t}).then(function(e){return c.dispatch({type:B.SET_MEMBER_COUNTS_FOR_NS,data:{memberCounts:e,targetNs:t}})})):void 0},e.loadSharedFileDataForFiles=function(e){var t,r,s,o;return r=e.fileIds,o=I.user(),o.is_email_verified?(t=new N({userId:o.id}),(s=function(e){var r,o,n;if(0!==e.length)return n=e.slice(0,k),r=e.slice(k),o=t.listMembersBatch({contentIds:n,limit:O}),o.then(function(e){var t;return t={},e.forEach(function(e,r){return t[r]={numUndisplayableUsersAndInvites:0,groups:e.groups.valueSeq().map(v.apiGroupMemberToAvatarInfo).toArray(),invitations:e.invitees.valueSeq().map(v.apiInviteeMemberToAvatarInfo).toArray(),joinedMembers:e.users.valueSeq().map(v.apiUserMemberToAvatarInfo).toArray()}}),c.dispatch({type:B.SET_SHARED_FILE_DATA,data:{sharedFileData:t}}),r?s(r):void 0})})(r)):void 0},e.loadLinkDataForFiles=function(e){var t,s,o,n;return s=e.parentPath,t=e.fileFqPaths,n=I.user(),(o=function(e){var t,i;if(0!==e.length)return i=e.slice(0,x),t=e.slice(x),l.SilentBackgroundRequest({url:"/sm/get_token_info",dataType:"json",data:{paths:JSON.stringify(i)},subject_user:n,success:function(e){var n,a,l,u,p,d,h,m,_,f,g;for(l=I.filesMap(),_=[],h=e.shmodels,u=0,p=h.length;p>u;u++)g=h[u],g.disabled||(n=l.get(g.path),n&&_.push({file:n,sharedLinkToken:g}));return _.length&&c.dispatch({type:B.SET_SHARED_LINK_DATA,data:{parentPath:s,sharedLinkData:_}}),f=function(){var t,r,s,o;for(s=e.shmodels,o=[],t=0,r=s.length;r>t;t++)m=s[t],o.push(m.path);return o}(),a=function(){var e,t,s;for(s=[],e=0,t=i.length;t>e;e++)d=i[e],r.call(f,d)>=0||s.push(l.get(d));return s}().filter(function(e){return null!=e}),a.length&&c.dispatch({type:B.REMOVE_SHARED_LINK_DATA,data:{parentPath:s,files:a}}),t?o(t):void 0}})})(t)},e}(),H=s.createClass({displayName:"SharedWithController",mixins:[p(q)],propTypes:{browseContext:s.PropTypes.instanceOf(E).isRequired,file:s.PropTypes.instanceOf(F),isInAudienceBox:s.PropTypes.bool,isPagelet:s.PropTypes.bool,tabIndex:s.PropTypes.oneOf([0,-1])},_get_state_from_stores:function(e){var t,r,s,o,n,i,a,l;return t=e.file?q.getDataForFile(e.file):q.getDataForCurrentNSID(),{audienceDescription:null!=t?t.audienceDescription:void 0,numUndisplayableUsersAndInvites:null!=(r=null!=t?t.numUndisplayableUsersAndInvites:void 0)?r:0,numInheritedMembers:null!=(s=null!=t&&null!=(o=t.inheritedMemberCounts)?o.total_unique_users:void 0)?s:0,groups:null!=(n=null!=t?t.groups:void 0)?n:[],hasSharedDataLoaded:null!=t?t.hasSharedDataLoaded:void 0,invitations:null!=(i=null!=t?t.invitations:void 0)?i:[],joinedMembers:null!=(a=null!=t?t.joinedMembers:void 0)?a:[],sharedLinkInfo:null!=(l=null!=t?t.sharedLinkInfo:void 0)?l:null}},componentDidUpdate:function(){var e,t,r,s,n;if(t=w.getFocusableElementsIn(o.findDOMNode(this),!1),null!=this.props.tabIndex){for(n=[],r=0,s=t.length;s>r;r++)e=t[r],n.push(e.tabIndex=this.props.tabIndex);return n}},componentWillReceiveProps:function(e){return this.setState(this._get_state_from_stores(e))},_showSharingModal:function(){var e,t,r;return t=[I.user(),this.props.file?this.props.file:I.context()],r=t[0],e=t[1],z(r,e,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})?void 0:T(["dropbox"],function(t){var s;return s=t.ExistingSharedFolderOptionsModal,e.is_dir?new s(r,e.fq_path).show():void 0})},handleOverflowCountClick:function(){return this._showSharingModal()},handleAvatarClick:function(){return this._showSharingModal()},handleSharedLinkClick:function(){var e;return e=I.user(),C.get_for_user(e).verified_or_show()&&!z(e,this.props.file,{browseContext:this.props.browseContext,origin:"BROWSE_FILE_ROW"})?T(["dropbox"],function(t){return function(r){var s,o;return o=r.SharingShmodel,s=r.Browse,null==s.active_user&&(s.active_user=e),o.shmodel(t.props.file.fq_path,M)}}(this)):void 0},_getMaxVisibleAvatars:function(){return v.GoldenGate.hasAudienceBox(I.user().id)?P:v.GoldenGate.hasNewMembershipUI(I.user().id)?this.props.browseContext.isInsideSharedFolder?R:R+1:O},render:function(){return V(W,{user:I.user(),file:this.props.file,numUndisplayableUsersAndInvites:this.state.numUndisplayableUsersAndInvites,numInheritedMembers:this.state.numInheritedMembers,parentFolderName:I.context().getNameOfTargetFolder(),groups:this.state.groups,invitations:this.state.invitations,joinedMembers:this.state.joinedMembers,sharedLinkInfo:this.state.sharedLinkInfo,animation:!1,onOverflowCountClick:this.handleOverflowCountClick,onAvatarClick:this.handleAvatarClick,onSharedLinkClick:this.handleSharedLinkClick,maxVisibleAvatars:this._getMaxVisibleAvatars(),isPagelet:this.props.isPagelet,audienceDescription:this.state.audienceDescription,isInAudienceBox:this.props.isInAudienceBox,hasSharedDataLoaded:this.state.hasSharedDataLoaded})}}),{SharedWithActions:U,SharedWithController:H,SharedWithStore:q}})}.call(this),function(){define("modules/dirty/react/browse/sharing_shims",["modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/sharing/models/file","modules/dirty/sharing/browse_ui_util","require","external/rsvp"],function(e,t,r,s,o,n){var i,a,l,u,c,p,d,h,m,_,f,g,b;return u=e.ShmodelUILogger,a=t.NameSpaceAccess,i=t.FileTypes,p=r.canConvertToSharedFolder,b=s.showTiburonUIIfAllowed,_=s.isTiburonUIAllowed,l=n.Promise,m=function(e){return e.type===i.SHARED_FOLDER||e.type===i.TEAM_SHARED_FOLDER},c=function(e,t){var r;return r=u.TARGET_ITEMS,e.is_dir?m(e)?r.FOLDER_IS_SF:p(e,t)?r.FOLDER_CAN_SF:r.FOLDER_NO_SF:r.FILE},f=function(e,t,r){return b(e,t,{browseContext:r})?new l(function(e){return e()}):new l(function(e,t){return o(["dropbox"],function(t){return e(t)},function(e){return t(e)})}).then(function(s){var o,n,i,l,u;return o=s.Browse,n=s.BrowseSelection,null==o.active_user&&(o.active_user=e),l=c(t,r),r.isInsideSharedFolder?(u=r.currentSharedFolderPermissionRole,i=u===a.ACCESS_OWNER):i=!0,n.show_share_modal_if_email_verified(e,m(t),l,t.fq_path,i)})},g=function(e,t,r,s){return b(e,t,{browseContext:r})?new l(function(e){return e()}):new l(function(e,t){return o(["dropbox"],function(t){return e(t)},function(e){return t(e)})}).then(function(o){var n,i,a;return n=o.Browse,i=o.SharingShmodel,null==n.active_user&&(n.active_user=e),a=c(t,r),u.log("token_share",s,a),i.shmodel(t.fq_path,s)})},d=function(e,t,r){var s;return s=t.type===i.TEAM_SHARED_FOLDER,_(e,t,r)||s?!1:m(t)||p(t,r)},h=function(e,t,r,s,n){return new l(function(e,t){return o(["dropbox"],function(t){return e(t)},function(e){return t(e)})}).then(function(o){var a,l,u,p,h,_;return a=o.Browse,u=o.SharingGrowthExperimentsDropdown,l=o.ExistingSharedFolderOptionsModal,b(t,r,{browseContext:s,origin:n})?void 0:(null==a.active_user&&(a.active_user=t),p=r.type===i.TEAM_SHARED_FOLDER,h=c(r,s),d(t,r,s)?u.open(r.fq_path,m(r),e,t,h):p?(_=new l(t,r.fq_path),_.show()):g(t,r,s,"browse_file_row"))})},{hasMultipleSharingOptions:d,initiateSharingFromUIElement:h,showShareFolderModal:f,showShareLinkModal:g}})}.call(this),function(){define("modules/dirty/react/growth/experiments/onboarding_progress_bar",["external/classnames","external/react","external/react-dom","jquery","dropbox","modules/core/i18n","modules/core/uri","modules/clean/account/email_verify_reasons","modules/clean/react/button","modules/clean/react_format","modules/clean/ajax","modules/clean/viewer","modules/clean/account/email","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/growth/experiments/logger","modules/clean/react/file_uploader/uploader","modules/clean/static_urls","modules/constants/browse","modules/dirty/browse/show_share_buttons","modules/dirty/sharing/wizard_modals"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y){var w,S,T,P,D,E,I,C,F,N,A,R,x,M,O;return w=o.Browse,T=o.FileOps,I=o.SharingModals,C=n._,F=l.button,R=u.reactFormat,S=d.EmailVerification,E=m.ProfileServicesLinkingHandler,P=f.FileUploader,O=g.static_url,x=y.showShareAFolderWizardModal,A=t.DOM,N=t.createElement,M=function(){return b.BROWSE_IN_REACT?P.showModal():T.show_upload()},D=t.createClass({displayName:"GrowthOnboardingProgressBar",POLL_INTERVAL_SECS:5,MAX_NUMBER_OF_POLLS:60,ONBOARDING_PROGRESS_BAR_HEIGHT:230,ONBOARDING_PROGRESS_BAR_COLLAPSED_HEIGHT:60,TASK_INFO:{COMPLETE:{image:O("/static/images/cupcake-vflQp9omo.png"),title:C("Great job! You’re now a Dropbox expert!",{project:"growth-exps"}),shortTitle:C("Great job!",{project:"growth-exps"}),description:C("You now know how to add files to your Dropbox and share them with others. If you need help, just click the “Help” link at the lower left for more info.",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Got it!",{project:"growth-exps"}),ctaAction:function(e){return _.log("onboarding","close_progress_bar",{},"bar_view_time"),e.setState({showProgressbar:!1})}},ADD_CONTACTS:{image:O("/static/images/growth/experiments/progress_add_contacts-vflbBLwV1.png"),title:C("Add contacts",{project:"growth-exps"}),description:C("Sharing is easier when you add your contacts on Dropbox.",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Add Gmail contacts",{project:"growth-exps"}),ctaAction:function(e){var t;return t=new E,t.auth_service_with_user(h.GOOGLE,e.getUserID(),function(e){return E.show_import_notifications(e)},"progress_bar")}},CREATE_FOLDER:{image:O("/static/images/growth/experiments/progress_make_folder-vflprSZli.png"),title:C("Create a folder",{project:"growth-exps"}),description:C("Folders are a great way to organize your files. You can also invite people to a folder to work on the same files together.",{project:"growth-exps",comment:"Please keep underxz 230 characters"}),ctaText:C("Create a folder",{project:"growth-exps"}),ctaAction:function(){return w.new_folder()}},CREATE_SHARED_FOLDER:{image:O("/static/images/growth/experiments/progress_invite_shared_folder-vfliOdqGO.png"),title:C("Invite collaborators to a shared folder",{project:"growth-exps"}),shortTitle:C("Invite collaborators",{project:"growth-exps"}),description:C("Tired of emailing files back and forth? Invite people to a Dropbox shared folder instead. When someone makes changes to a file, everyone instantly gets the latest version.",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Share a folder",{project:"growth-exps"}),ctaAction:function(e){var t;return t=e.getUser(),S.get_for_user(t).verified_or_show(a.SHARE_FOLDER)?x(t):void 0}},CREATE_SHARED_LINK:{image:O("/static/images/growth/experiments/progress_share_file-vflRYw3o1.png"),title:C("Share a link to a file",{project:"growth-exps"}),shortTitle:C("Share a link",{project:"growth-exps"}),description:C("Need to send a large file, video, or a bunch of photos? Just copy the Dropbox link and paste it into an email, chat, text message…you name it. It’s that easy!",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Share a link",{project:"growth-exps"}),ctaAction:function(){return v()}},LINK_DESKTOP_CLIENT:{image:O("/static/images/growth/experiments/progress_link_client-vflgFQqAv.png"),title:C("Install Dropbox on your computer",{project:"growth-exps"}),shortTitle:C("Install Dropbox",{project:"growth-exps"}),description:C("Access your files faster by installing the Dropbox app on your computer.  %(referral_message)s",{project:"growth-exps",comment:"Please keep under 230 characters. Note that referral_message is another sentence."}),descriptionFill:function(e){return{referral_message:e.referralMessage}},ctaText:C("Download Dropbox",{project:"growth-exps"}),ctaAction:function(){return window.open("/downloading","_blank")}},LINK_MOBILE_CLIENT:{image:O("/static/images/growth/experiments/progress_link_mobile-vflx8ond7.png"),title:C("Take your docs anywhere",{project:"growth-exps"}),shortTitle:C("Get mobile app",{project:"growth-exps"}),description:C("Save files on your computer, then access them on your phone from the road.",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Download the Dropbox mobile app",{project:"growth-exps"}),ctaAction:function(){return window.open("/mobile","_blank")}},REFER_FRIENDS:{image:O("/static/images/growth/experiments/progress_invite_friends-vflcXvE1J.png"),title:C("Invite friends and earn space",{project:"growth-exps"}),shortTitle:C("Invite friends",{project:"growth-exps"}),description:C("For every friend who joins and installs Dropbox, we’ll give you both %(bonus)s of bonus space (up to %(max_bonus)s).",{project:"growth-exps",comment:"Please keep under 230 characters"}),descriptionFill:function(e){return{bonus:e.props.referralBonuses[0],max_bonus:e.props.referralBonuses[1]}},ctaText:C("Invite friends",{project:"growth-exps"}),ctaAction:function(e){var t;return t=S.get_for_user(e.getUser()),t.verified_or_send_and_show(a.REFER_FRIENDS,function(){return window.open("/referrals","_blank")})}},UPLOAD_FIRST_FILE:{image:O("/static/images/growth/experiments/progress_add_files-vflaza3My.png"),title:C("Add a file",{project:"growth-exps"}),titleFill:function(e){var t;return t=C("Add a file",{project:"growth-exps"}),"V1"===e.props.expSubgrowthBasicProgressBarVerifyImage&&(t=C("Keep your files safe",{project:"growth-exps"})),t},description:C("Any file you add to Dropbox is safely backed up so you’ll never lose another presentation or vacation memory.",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Add a file",{project:"growth-exps"}),ctaAction:function(){return M()}},UPLOAD_MORE_THAN_ONE_FILE:{image:O("/static/images/growth/experiments/progress_add_files-vflaza3My.png"),title:C("Add another file",{project:"growth-exps"}),description:C("The more, the merrier! Make sure all the files, photos, and videos you care about are safely backed up on Dropbox.",{project:"growth-exps",comment:"Please keep under 230 characters"}),ctaText:C("Add more files",{project:"growth-exps"}),ctaAction:function(){return M()}},VERIFY_EMAIL:{image:function(e){return e},imageFill:function(e){var t,r;return r=O("/static/images/growth/experiments/progress_verify_email-vflO7vE8i.png"),t="V1"===e.props.expSubgrowthBasicProgressbarVerifyImage,"V1"===e.props.expSubgrowthBasicProgressbarVerifyImage&&(r=O("/static/images/growth/experiments/exp_progress_verify_email_v1-vflNJCFVC.jpg")),{image:r,imageFillNeeded:t}},title:C("Verify your email",{project:"growth-exps"}),description:C("To start sharing and using all of Dropbox’s features, verify your account—we do this for your security. %(referral_message)s",{project:"growth-exps",comment:"Please keep under 230 characters. Note that referral_message is another sentence."}),ctaText:C("Verify my email",{project:"growth-exps"}),descriptionFill:function(e){return{referral_message:e.referralMessage}},ctaAction:function(e){var t;return t=S.get_for_user(e.getUser()),t.send_email(S.reason,function(){return t.email_sent(function(){})})}}},propTypes:{initialDataDict:t.PropTypes.object,userId:t.PropTypes.number,referralBonuses:t.PropTypes.array,expGrowthProgressBarCta:t.PropTypes.string,expGrowthProgressBarAddFile:t.PropTypes.string,expSubgrowthBasicProgressBarVerifyImage:t.PropTypes.string},getInitialState:function(){var e,t;return e=this.props.initialDataDict,this.pollID=0,{collapsed:(null!=(t=e.extra)?t.is_collapsed:void 0)||!1,dataDict:e,buttonDisabled:!1,currentIndex:this.getUpdatedIndex(e.tasks),showProgressbar:!0}},logViewTask:function(){return _.set_start_time("task_view_time"),_.log("onboarding","view_progress_bar_step",{object:"progress_bar_task_"+this.currentTaskName.toLowerCase(),collapsed:this.state.collapsed,tasks_left:this.state.dataDict.incompleteTaskCount},"bar_view_time")},componentDidUpdate:function(e,t){return t.currentIndex!==this.state.currentIndex?this.logViewTask():void 0},componentDidMount:function(){return _.set_start_time("bar_view_time"),_.log("onboarding","view_progress_bar",{collapsed:this.state.collapsed,tasks_left:this.state.dataDict.incompleteTaskCount}),this.logViewTask()},saveCollapsedState:function(e){return c.WebRequest({url:"/growth/progress_bar/set_collapsed_state",subject_user:this.getUserID(),dataType:"json",data:{is_collapsed:e},success:this.maybeUpdateStateFromServer})},getUpdatedIndex:function(e){var t,r,s,o,n;for(t=s=0,o=e.length;o>=0?o>s:s>o;t=o>=0?++s:--s)if(r=(t+((null!=(n=this.state)?n.currentIndex:void 0)||0))%e.length,"COMPLETE"!==e[r].status)return r;return-1},pollForTaskCompletion:function(e,t){var r;if(!(e!==this.pollID||t>=this.MAX_NUMBER_OF_POLLS||-1===(null!=(r=this.state)?r.currentIndex:void 0)))return window.setTimeout(function(r){return function(){return r.pollForTaskCompletion(e,t+1)}}(this),1e3*this.POLL_INTERVAL_SECS),c.WebRequest({url:"/growth/progress_bar/current_state",subject_user:this.getUserID(),dataType:"json",success:this.maybeUpdateStateFromServer})},maybeUpdateStateFromServer:function(e){return JSON.stringify(this.state.dataDict)!==JSON.stringify(e)?(this.state.dataDict.tasks[this.state.currentIndex].status!==e.tasks[this.state.currentIndex].status&&_.log("onboarding","complete_progress_bar_step",{object:"progress_bar_task_"+this.currentTaskName.toLowerCase()},"task_view_time"),this.setState({dataDict:e,currentIndex:this.getUpdatedIndex(e.tasks)})):void 0},getUserID:function(){return this.props.userId},getUser:function(){return p.get_viewer().get_user_by_id(this.getUserID())},collapseBar:function(){var e,t,o;return _.log("onboarding","collapse_progress_bar",{object:"progress_bar_task_"+this.currentTaskName.toLowerCase()},"task_view_time"),this.saveCollapsedState(!0),o=this.ONBOARDING_PROGRESS_BAR_HEIGHT,t=this.ONBOARDING_PROGRESS_BAR_COLLAPSED_HEIGHT,e=s(r.findDOMNode(this)),this.setState({collapsed:!0},function(){return e.find(".growth-onboarding-progress-bar__inner").hide().fadeIn(),e.css({height:o}).animate({height:t},function(){return e.css({height:""}),e.find(".growth-onboarding-progress-bar__inner").css({display:""})})})},expandBar:function(e){var t,o,n;return o=s(e.target).hasClass("growth-onboarding-progress-bar__step-description"),_.log("onboarding","expand_progress_bar",{object:"progress_bar_task_"+this.currentTaskName.toLowerCase(),action_detail:o?"click_link":"click_bar"},"task_view_time"),this.saveCollapsedState(!1),n=this.ONBOARDING_PROGRESS_BAR_HEIGHT,t=s(r.findDOMNode(this)),t.find(".growth-onboarding-progress-bar__inner").fadeOut(),t.animate({height:n},function(e){return function(){return e.setState({collapsed:!1},function(){return t.css({height:""}),t.find(".growth-onboarding-progress-bar__inner").css({display:""}),t.find(".growth-onboarding-progress-bar__close-x").css({display:""})})}}(this))},getExpTitle:function(){var e,t;return e="This is the header for a progress bar that teaches the user how to take important actions on Dropbox, like uploading a file or sharing a folder. This needs to fit into a small space, so a short translation is preferred.",t="growth-exps","V1"===this.props.expGrowthProgressBarCta?C("Become A Dropbox Master",{comment:e,project:t}):"V2"===this.props.expGrowthProgressBarCta?C("Get The Most Out Of Dropbox",{comment:e,project:t}):C("Dropbox Mastery",{comment:e,project:t})},render:function(){return this.state.showProgressbar?(s("body").toggleClass("has-top-onboarding-progress-bar",!this.state.collapsed),s("body").toggleClass("has-top-onboarding-progress-bar-collapsed",this.state.collapsed),this.currentTaskName=-1===this.state.currentIndex?"COMPLETE":this.state.dataDict.tasks[this.state.currentIndex].taskName,this.currentTaskInfo=this.TASK_INFO[this.currentTaskName],this.showCompleted=-1!==this.state.currentIndex&&"COMPLETE"===this.state.dataDict.tasks[this.state.currentIndex].status,this.referralMessage=this.showCompleted?"":this.state.dataDict.referralMessage,this.state.collapsed?this.renderCollapsed():this.renderExpanded()):A.div({})},renderExpanded:function(){
var e;return A.div({className:"growth-onboarding-progress-bar__outer expanded","data-task-name":this.currentTaskName},A.div({className:"growth-onboarding-progress-bar__close-x",onClick:this.collapseBar},C("Minimize",{comment:"Collapses a banner to take up less space",project:"growth-exps"})),A.div({className:"growth-onboarding-progress-bar__inner"},A.div({className:"growth-onboarding-progress-bar__header clearfix"},A.div({className:"growth-onboarding-progress-bar__title"},this.getExpTitle()),this.renderProgressIndicator()),A.div({className:"growth-onboarding-progress-bar__body clearfix"},A.div({className:"growth-onboarding-progress-bar__image "+(null!=this.currentTaskInfo.imageFill&&this.currentTaskInfo.imageFill(this).imageFillNeeded===!0?"growth-onboarding-progress-bar__image-fill":"")},null!=this.currentTaskInfo.imageFill?(e=this.currentTaskInfo.image(this.currentTaskInfo.imageFill(this).image),A.img({alt:"",src:e})):A.img({alt:"",src:this.currentTaskInfo.image})),A.div({className:"growth-onboarding-progress-bar__step"},A.div({className:"growth-onboarding-progress-bar__step-name"},null!=this.currentTaskInfo.titleFill?this.currentTaskInfo.titleFill(this):this.currentTaskInfo.title),A.div({className:"growth-onboarding-progress-bar__step-description"},null!=this.currentTaskInfo.descriptionFill?this.currentTaskInfo.description.format(this.currentTaskInfo.descriptionFill(this)):this.currentTaskInfo.description),A.div({className:"growth-onboarding-progress-bar__step-buttons"},"VERIFY_EMAIL"===this.currentTaskName&&this.showCompleted?void 0:N(F,{className:"growth-onboarding-progress-bar__step-cta",disabled:this.state.buttonDisabled,onClick:function(e){return function(){return _.log("onboarding","click_progress_bar_step",{object:"progress_bar_task_"+e.currentTaskName.toLowerCase()},"task_view_time"),e.setState({buttonDisabled:!0}),e.pollForTaskCompletion(++e.pollID,0),e.currentTaskInfo.ctaAction(e),window.setTimeout(function(){return e.setState({buttonDisabled:!1})},2e3)}}(this)},this.currentTaskInfo.ctaText),this.showCompleted?A.div({className:"onboarding-progress-bar__complete_text"},C("Complete!",{project:"growth-exps"})):"REFER_FRIENDS"===this.currentTaskName&&this.state.dataDict.showInvitationSent?A.div({className:"onboarding-progress-bar__invitation_sent",onClick:function(){return window.open("/account/bonus","_blank")}},C("Invitation sent!",{project:"growth-exps"})):void 0)))))},renderCollapsed:function(){return A.div({className:"growth-onboarding-progress-bar__outer collapsed","data-task-name":this.currentTaskName,onClick:this.expandBar},A.div({className:"growth-onboarding-progress-bar__inner clearfix"},A.div({className:"growth-onboarding-progress-bar__left"},A.div({className:"growth-onboarding-progress-bar__title"},this.getExpTitle()),this.renderProgressIndicator()),A.div({className:"growth-onboarding-progress-bar__right"},R(C("<label>Next step:</label> <description>%(step_description)s ▾</description>"),{step_description:this.currentTaskInfo.shortTitle||this.currentTaskInfo.title,label:A.span({className:"growth-onboarding-progress-bar__step-label"}),description:A.span({className:"growth-onboarding-progress-bar__step-description"})}))))},renderProgressIndicator:function(){var e,t;return A.div({className:"onboarding-progress-bar__progress-circles"},function(){var r,s,o,n;for(o=this.state.dataDict.tasks,n=[],e=r=0,s=o.length;s>r;e=++r)t=o[e],n.push(this.renderProgressIndicatorCircle(t,e));return n}.call(this))},renderProgressIndicatorCircle:function(t,r){return t.taskName in this.TASK_INFO?A.div({className:e({"onboarding-progress-bar__progress-circle":!0,"is-selected":this.state.currentIndex===r,"is-incomplete":"COMPLETE"!==t.status}),key:r,onClick:function(e){return function(){return e.state.currentIndex!==r?(e.setState({currentIndex:r}),e.pollForTaskCompletion(++e.pollID,0)):void 0}}(this)},A.div({className:"onboarding-progress-bar__progress-circle-container"},A.div({className:"onboarding-progress-bar__progress-circle-desc"},this.TASK_INFO[t.taskName].ctaText))):A.span({key:r})}}),{GrowthOnboardingProgressBar:D}})}.call(this),function(){define("modules/dirty/search/search_results",["external/immutable","external/react","external/react-dom","external/underscore","modules/clean/flux/store_mixin","modules/clean/notserver","modules/clean/react/css","modules/clean/react/file_modal_controller","modules/clean/search/actions","modules/clean/search/api","modules/clean/search/store","modules/dirty/search/search_results_view"],function(e,t,r,s,o,n,i,a,l,u,c,p){var d,h,m,_,f;return h=n.NotClients,d=a.FileModalController,f=t.DOM,_=t.createElement,m=t.createClass({displayName:"SearchResultsController",mixins:[o(c)],_get_state_from_stores:function(){return{context:c.browseContext(),hasMoreResults:c.hasMoreResults(),loadingState:c.loadingState(),latestQuery:c.latestQuery(),numDeletedResults:c.numDeletedResults(),searchResults:c.searchResults(),selection:c.selection(),selectedFiles:c.selectedFiles(),didLoadDeletedResults:c.didLoadDeletedResults()}},propTypes:{isPagelet:t.PropTypes.bool,limitedTeamBannerUpsell:t.PropTypes.bool,onFullSearch:t.PropTypes.func,onPathOpen:t.PropTypes.func,path:t.PropTypes.string,topMenuItems:t.PropTypes.element.isRequired,trademarkBusiness:t.PropTypes.string,user:t.PropTypes.object},componentWillMount:function(){return this._setupFileEventListener(this.props.user.id)},componentWillUnmount:function(){return h[this.props.user.id].unsubscribe(this.handlerId)},_setupFileEventListener:function(){var e;return this.searchApi=new u,e=h[this.props.user.id],this.handlerId=e.subscribe_sfj({name:"SearchEventDispatcher",handler:function(t){return function(){return t.state.latestQuery?t.searchApi.getUpdatesForResults({query:t.state.latestQuery,namespaceToJournalIdMap:e.get_ns_map(),showDeleted:t.state.didLoadDeletedResults,user:t.props.user,onSuccess:function(r){return l.applyUpdatesFromNotserver({payload:r,path:t.props.path}),e.handler_success(t.handlerId,{ns_map:r.ns_map})}}):void e.handler_success(t.handlerId,{ns_map:e.get_ns_map()})}}(this)})},_handleScroll:function(){var e;return e=r.findDOMNode(this).getBoundingClientRect(),e.bottom<=window.innerHeight?l.loadMoreResults({path:this.props.path,user:this.props.user}):void 0},handleSelectionChange:function(e){return l.setSearchSelection({selection:e})},handleDelete:function(){var e;return e=this.state.selectedFiles.toArray(),d.showDelete(this.props.user,e,this.state.context,s.noop)},handleRestoreMulti:function(){var e;return e=this.state.selectedFiles.toArray(),d.showRestore(this.props.user,e,function(){})},handlePermanentDelete:function(){var e,t;return e=this.state.selectedFiles,t=function(){return l.removeSearchResults({fq_paths:e.map(function(e){return e.fq_path})})},d.showPermanentlyDelete(this.props.user,e.toArray(),t)},render:function(){return _(p,s.extend({},{isPagelet:this.props.isPagelet,limitedTeamBannerUpsell:this.props.limitedTeamBannerUpsell,onFullSearch:this.props.onFullSearch,onScroll:s.throttle(this._handleScroll,200),onSelectionChange:this.handleSelectionChange,path:this.props.path,topMenuItems:this.props.topMenuItems,trademarkBusiness:this.props.trademarkBusiness,user:this.props.user,actionHandlers:{onDelete:this.handleDelete,onRestoreMulti:this.handleRestoreMulti,onPermanentDelete:this.handlePermanentDelete}},this.state))}}),m=i(m,["/static/css/browse/browse-vflrH05S2.css","/static/css/scooter/scooter-scoped-vflx8uhBs.css"])})}.call(this),function(){define("modules/dirty/search/search_results_view",["jquery","external/classnames","external/immutable","external/react","external/underscore","modules/clean/analytics","modules/clean/browse_interface","modules/clean/filepath","modules/clean/history","modules/clean/react/app_actions_view","modules/clean/react/browse/constants","modules/clean/react/file_viewer/controller","modules/clean/react/image","modules/clean/react/sprite","modules/clean/react/user_notifications/dropdown","modules/clean/search/constants","modules/clean/search/search_helpers","modules/clean/teams/team_promo_banner","modules/clean/static_urls","modules/constants/browse","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/core/uri","modules/dirty/react/browse/context_menu","modules/dirty/react/browse/file_actions","modules/dirty/react/browse/item_list","modules/dirty/react/browse/selection_actions"],function(e,t,r,s,o,n,i,a,l,u,c,p,d,h,m,_,f,g,b,v,y,w,S,T,P,D,E,I){var C,F,N,A,R,x,M,O,L,k,B,U,H,q,G,W,j;return B=n.TeamsWebActionsLogger,N=c.DropTargetHighlightMode,R=c.LoadingStates,x=c.NewFolderCreationState,O=c.SEARCH_PREFIX,L=_.SearchLoadingStates,W=b.static_url,M=y.ROLE_WORK,U=S._,j=S.ungettext,C=P.BrowseContextMenu,G=D.getActionsForFileCollection,A=E.ItemListController,F=I.BrowseSelectionMenu,q=s.DOM,H=s.createElement,k=s.createClass({displayName:"SearchResultsView",propTypes:{hasMoreResults:s.PropTypes.bool,isPagelet:s.PropTypes.bool,loadingState:s.PropTypes.oneOf(o.values(L)),latestQuery:s.PropTypes.string,limitedTeamBannerUpsell:s.PropTypes.bool,onFullSearch:s.PropTypes.func,onScroll:s.PropTypes.func,path:s.PropTypes.string,topMenuItems:s.PropTypes.element,searchResults:s.PropTypes.instanceOf(r.List),selection:s.PropTypes.object,selectedFiles:s.PropTypes.instanceOf(r.OrderedSet),trademarkBusiness:s.PropTypes.string,user:s.PropTypes.object,actionHandlers:s.PropTypes.object},componentDidMount:function(){return e(window).on("scroll.SearchResults",this.props.onScroll)},componentWillMount:function(){return l.add_callback(O,this._ensureFileViewerClosedIfNotPreviewing)},componentWillUnmount:function(){return e(window).off("scroll.SearchResults")},_ensureFileViewerClosedIfNotPreviewing:function(){var e,t,r;return t=null!=(r=l.deconstruct_url())?r.qargs:void 0,e=p.isShown(),!t.preview&&e?p.close():void 0},_getSelectionText:function(){var e;return e=this.props.selectedFiles.count(),e>0?j("%(count)d Item Selected","%(count)d Items Selected",e).format({count:e}):""},renderFullSearchLink:function(){var e,t;return t=this.props.user.role===M?i.WORK_ROOT:i.PERSONAL_ROOT,e=T.parse("/search"+t).setQuery({path:"/",query:this.props.latestQuery}).toString(),q.a({href:e,onClick:this.props.onFullSearch},U("Search all of my Dropbox instead"))},renderEmptyFolderView:function(){return q.div({className:"u-font-center u-pad-top-xl"},H(d,{src:W("/static/images/empty_states/search-vfl6DaX2I.png"),srcHiRes:W("/static/images/empty_states/search@2x-vflBsUhDE.png"),alt:""}),q.h2({className:"u-pad-top-l"},U("No results found")),q.div({},"/"===this.props.path?U("Please update your search and try again"):this.renderFullSearchLink()))},renderUpsellPromoBanner:function(){return this.props.loadingState!==R.LOADED||this.props.hasMoreResults||this._banner_view_logged||(this._banner_view_logged=!0,B.log("banner_search_displayed",{location:"search_results",item_count:this.props.searchResults.size})),H(g,{description:[U("Search through file contents in addition to file names with %(trademark_business)s").format({trademark_business:this.props.trademarkBusiness}),q.a({className:"upsell_info u-pad-xxs",href:"/help/6635",target:"_blank",key:"info-link"},H(h,{group:"web",name:"info",alt:"more info"}))],buttons:[{text:U("Upgrade"),handler:function(){return w.redirect(T({path:"/team/upgrade",query:{tk:"search_upsell_results",camp:"web"}}))}}]})},maybeRenderSearchResultsHeader:function(){var e;if(this.props.searchResults.size&&this.props.loadingState!==L.LOADING_FIRST_PAGE)return e="/"===this.props.path&&v.SHOW_PAPER_SEARCH_RESULTS?j("%(num_results)d result in files, folders, Paper docs, and content.","%(num_results)d results in files, folders, Paper docs, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}):j("%(num_results)d result in files, folders, and content.","%(num_results)d results in files, folders, and content.",this.props.searchResults.size).format({num_results:this.props.searchResults.size}),q.div({className:t({"search-results__info":!0,"o-grid--no-gutter":this.props.isPagelet})},this.props.hasMoreResults?e:[q.span({className:t({"o-grid__col":this.props.isPagelet,"o-grid__col--8-of-12":this.props.isPagelet})},e),this.props.isPagelet?q.span({},U("Modified")):"/"!==this.props.path?q.span({className:"u-pad-horizontal-xs"},this.renderFullSearchLink()):void 0])},renderLegacyActionsMenus:function(){return[H(C,{actionHandlers:this.props.actionHandlers,context:this.props.context,isSearchMode:!0,selectedFiles:this.props.selectedFiles,shouldShowGlobalActions:!1,user:this.props.user}),H(F,{actionHandlers:this.props.actionHandlers,context:this.props.context,isSearchMode:!0,selectedFiles:this.props.selectedFiles,user:this.props.user})]},render:function(){var e,r,s,n,i,l;return n=this.props.loadingState===L.LOADING_FIRST_PAGE?R.LOADING_FIRST_PAGE:this.props.loadingState===L.LOADING_ADDITIONAL_PAGE?R.LOADING_REMAINING_PAGES:R.LOADED,q.div({className:t({"search-results":!0,promo:this.props.limitedTeamBannerUpsell}),id:"browse-box"},q.div({className:"browse-header search-results__header"},q.h1({className:"search-results__title"},this.props.loadingState!==L.LOADED?U("Searching…"):this.props.isPagelet?U("Search results"):"/"===this.props.path?U("Results for ‘%(query)s’ in ‘%(path)s’",{comment:"Path is a folder name in the user's Dropbox"}).format({query:this.props.latestQuery,path:a.filename(this.props.path)}):void 0),this.props.topMenuItems,this.props.limitedTeamBannerUpsell?this.renderUpsellPromoBanner():void 0,this.props.isPagelet?void 0:this.maybeRenderSearchResultsHeader()),this.props.isPagelet?this.maybeRenderSearchResultsHeader():void 0,this.props.isPagelet?this.props.selectedFiles.size?(r=G({files:this.props.selectedFiles,context:this.props.context,user:this.props.user,actionHandlers:this.props.actionHandlers,isPagelet:this.props.isPagelet,isSearchMode:!0}),r.length>0?(i={displayName:r[0].label,handleClick:r[0].performAction},l=function(){var t,s,o,n;for(o=r.slice(1),n=[],t=0,s=o.length;s>t;t++)e=o[t],n.push({displayName:e.label,handleClick:e.performAction,iconName:e.spriteName});return n}(),s=this._getSelectionText(),H(u,{headerText:s,primaryMenuItem:i,secondaryMenuItems:l})):void 0):void 0:this.renderLegacyActionsMenus(),H(A,{context:this.props.context,items:this.props.searchResults,loadingState:n,isPagelet:this.props.isPagelet,isSearchMode:!0,isColumnHeaderVisible:!1,isMultiColumnGroupVisible:!1,isPaginating:!1,isTextSelectable:!1,isDragAndDropEnabled:!1,shouldShowDeletedFiles:!1,showContainingPaths:!0,showFilenameHighlights:!0,user:this.props.user,path:this.props.path,selection:this.props.selection,selectedFiles:this.props.selectedFiles,onSelectionChange:this.props.onSelectionChange,customEmptyFolderView:this.renderEmptyFolderView,actionHandlers:this.props.actionHandlers,onOutsideMouseUp:this.props.isPagelet?o.noop:void 0}))}})})}.call(this),function(){define("modules/dirty/sharing/restore_sandbox_modal",["jquery"],function(e){return{initialize_module:function(t){return require(["dropbox"],function(r){var s,o;return s=r.Apps,o=r.Modal,e("#"+t.submit_button_dom_id).on("click",function(e){return s.submit_restore_sandbox(e),!1}),e("#"+t.cancel_button_dom_id).on("click",function(e){return o.hide(e)})})}}})}.call(this),function(){define("modules/dirty/sharing/sf_access_type",["jquery","modules/core/controller_helpers","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/components/bubble_picker","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/groups/api","modules/clean/sharing/api","modules/clean/viewer"],function(e,t,r,s,o,n,i,a,l,u,c){var p,d,h,m,_,f;return f=r._,m=o.SharedFolderActivityLogger,p=i.DBModal,d=i.DBModalStack,_=u.SharingApi,h=function(){function r(e,r){this.$access_type_el=e,this.ajax_data=r,this.bubble_picker=t.get_controller(this.$access_type_el),this.$access_type_el.on(n.CHANGED,function(e){return function(t,r){var s,o,n,i,a,l;return n=r.old_val,o=r.clicked_val,Number(n)===Number(o)?!1:(e.ajax_data&&(l=c.get_viewer().get_user_by_id(e.ajax_data.user_id),i=e.ajax_data.params,s=e.ajax_data.access_types,a=e.$access_type_el.closest(".bs-row").find(".sf-display-name").text(),"owner"===s[o]?(e.show_make_owner_modal(l,i.member_uid,i.ns_id,a,o),e.bubble_picker.set_value(n)):e.update_access_type(l,i,a,o)),!1)}}(this))}return r.prototype.show_make_owner_modal=function(e,t,r,o,n){return require(["dropbox"],function(s){var i;return i=s.MakeOwnerModal,d.push(new i(e,{element_id:"make-owner-confirm-modal",member_uid:t,member_name:o,ns_id:r,access_type:n}))},function(){return s.error(s.DEFAULT_ERROR)})},r.prototype.update_access_type=function(e,t,r,o){var n,i,u;return n={ns_id:t.ns_id,access_type:o},u=function(o){return function(i){var l,u,c;if(c=JSON.parse(i.responseText),n.member_id=t.member_uid,"OK"===c.status){switch(n.succes=!0,c.access_type){case"viewer":u=f("%(name)s can only view now.").format({name:r});break;case"editor":u=f("%(name)s can edit now.").format({name:r});break;case"owner":u=f("%(name)s is the owner now.").format({name:r})}u&&s.success(u)}else"ERROR"===c.status&&(n.succes=!1,c.msg&&(n.message=c.msg,s.error(c.msg)),c.reload&&(l=p.get_containing_modal(o.$access_type_el),l&&l instanceof a&&l.fetch()));return m.log("web","invite_modal_change_callback",e,n)}}(this),i=new _(e),t.member_uid?(i.update_member_access_type(t.ns_id,t.member_uid,o,u),n.member_uid=t.member_uid,m.log("web","invite_modal_change_collaborator",e,n)):t.invite_id?(i.update_invite_access_type(t.invite_id,o,u),n.invite_id=t.invite_id,m.log("web","invite_modal_change_invite",e,n)):t?(l.change_group_access_type({ns_id:t.ns_id,group_id:t.group_gid,access_type:o},u),n.group_id=t.group_gid,m.log("web","invite_modal_change_group",e,n)):void 0},r.initialize_module=function(t){return t.instances.forEach(function(t){return new r(e("#"+t.dom_id),t.sf_data)})},r}()})}.call(this);
//# sourceMappingURL=pkg-ag.min.js-vflIxfqsd.map