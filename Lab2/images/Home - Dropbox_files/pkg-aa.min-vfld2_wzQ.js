(function(){define("modules/clean/accessibility/utils",[],function(){var e;return e=["#006AFF","#0073E1","#007BC3","#007F9B","#008578","#008750","#008928","#008800","#0573EB","#0579C3","#0580A0","#05857D","#058655","#058932","#05890A","#0A71F0","#0A78CD","#0A7FAA","#0A8487","#0A855F","#0A8737","#0A880F","#0F6EF5","#0F76D7","#0F7DB4","#0F818C","#0F8669","#0F8741","#0F8819","#146DFF","#1475DC","#147BBE","#14819B","#148473","#14864B","#148723","#1969FF","#1972E1","#1979C3","#1980A0","#198278","#198550","#198728","#198700","#1E70E6","#1E79C8","#1E7FA5","#1E837D","#1E8555","#1E8832","#1E880A","#236EEB","#2376D2","#237CAF","#238187","#23845F","#23883C","#238914","#286DF5","#2876D7","#287CB4","#28808C","#288469","#288541","#288619","#2D6AFA","#2D73DC","#2D7BB9","#2D8096","#2D836E","#2D8446","#2D8823","#3267FF","#3271E1","#3279C3","#327D9B","#328378","#328550","#328528","#328600","#376EE6","#3777C8","#377DA5","#37807D","#37855A","#378632","#37860A","#3C6CEB","#3C74CD","#3C7BAA","#3C8087","#3C835F","#3C8437","#3C8614","#416AF5","#4173D7","#4179B9","#417E91","#418069","#418341","#418419","#4667FA","#466FDC","#4676BE","#467B9B","#468073","#46824B","#468423","#4B63FF","#4B6DE1","#4B75BE","#4B7B9B","#4B8078","#4B8150","#4B8228","#4B8300","#5069E6","#5072C8","#5079A5","#507C7D","#50815A","#508232","#50830A","#5567F0","#556FD2","#5575AA","#557A87","#557E5F","#55823C","#558314","#5A65F5","#5A6DD7","#5A75B4","#5A7A91","#5A7D69","#5A7F41","#5A821E","#5F61FA","#5F69DC","#5F71BE","#5F779B","#5F7E50","#5F7F28","#5F8100","#6466E6","#646DC3","#6475A5","#647D55","#647E2D","#648005","#6964EB","#696BC8","#6972A5","#697C55","#697E2D","#697F05","#6E62EB","#6E6AC8","#6E71A5","#6E7C46","#6E7E1E","#7358FF","#7363E1","#736ABE","#7372A0","#785CEB","#7864CD","#786DAF","#7D53FF","#7D5EE1","#7D66C3","#7D6EA0","#8255F5","#825FD7","#8268B9","#826D91","#8756F0","#8760D2","#8766AA","#8C4AFF","#8C56E6","#8C60C8","#8C66A0","#914BF5","#9157DC","#9160BE","#916596","#964BEB","#9655D2","#965EAF","#966691","#9B47F0","#9B51D2","#9B5CB4","#9B6191","#A041F5","#A04EDC","#A058B9","#A06196","#A53BF5","#A548DC","#A553BE","#A55A96","#AA34FA","#AA42E6","#AA4FC8","#AA58A0","#AA5F78","#AA614B","#AA6623","#AF29FF","#AF38E6","#AF47D2","#AF52AF","#AF5782","#AF5E5A","#AF622D","#AF6400","#B42CF0","#B43CD7","#B447B4","#B45291","#B45864","#B45D37","#B45D05","#B919FF","#B92CE6","#B93BC8","#B94AAA","#B9547D","#B95B4B","#B95A14","#BE0CF0","#BE1FEB","#BE31CD","#BE41B4","#BE4C87","#BE5455","#BE561E","#C307EB","#C31AE1","#C32CC8","#C33DB4","#C3488C","#C34F5A","#C35428","#C803E1","#C816E1","#C826C3","#C836AF","#C8428C","#C8495F","#C84F32","#C85200","#CD11C8","#CD22C8","#CD31AF","#CD3B87","#CD4664","#CD4B37","#CD4D0A","#D20CC3","#D21CB4","#D229A0","#D23587","#D23E64","#D23F37","#D2430F","#D708AF","#D716A0","#D72291","#D73087","#D7355F","#D73A3C","#D73A14","#DC0596","#DC119B","#DC1D91","#DC256E","#DC2E5A","#DC343C","#DC3419","#E1027D","#E10C87","#E11882","#E11B5A","#E12755","#E12A37","#E12919","#E13200","#E6075F","#E60C4B","#E61655","#E61D46","#E62132","#E61B14","#E61A00","#EB0232","#EB0214","#EB0D30"],{accessibleColorPalette:e}})}).call(this),function(){define("modules/clean/account/change_email_modals",["jquery","external/react","external/react-dom","modules/core/notify","modules/core/i18n","modules/clean/form","modules/clean/account/email_verify","modules/clean/react/bubble_dropdown","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/viewer","modules/clean/ajax","modules/constants/viewer"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v,y,E,b,w,T,S,C,I;return w=i._,C=i.render_sentences,I=i.ungettext,y=u.Modal,S=t.DOM,T=t.createElement,a=t.createFactory(a),b=t.createFactory(l.text),E=t.createFactory(l.password),v=t.createClass({displayName:"ChangeEmailWarningModal",propTypes:{user:t.PropTypes.object,inboxCount:t.PropTypes.number,onContinue:t.PropTypes.func},render:function(){return T(y,{title:w("Warning!"),acceptButtonText:w("Continue anyway"),dismissButtonText:w("Cancel"),onAccept:this.showChange,ref:"modal"},this.getSSOWarning(),this.getInboxWarning())},getSSOWarning:function(){var e,t,n;return e=d.get_viewer().is_paired,n=e&&this.props.user.role===h.ROLE_WORK,t=this.props.user.sso_required,n&&t?S.div({},w("Your %(team)s Dropbox uses single sign-on. If you change your email address you may not be able to sign in.").format({team:d.get_viewer().team_name})):null},getInboxWarning:function(){var e;return e=d.get_viewer().is_paired,0===this.props.inboxCount?null:e&&this.props.user.role===h.ROLE_PERSONAL?I("Your %(num)d existing shared folder invitation in your personal Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your personal Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount}):e&&this.props.user.role===h.ROLE_WORK?I("Your %(num)d existing shared folder invitation in your %(team)s Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your %(team)s Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount,team:d.get_viewer().team_name}):I("Your %(num)d existing shared folder invitation will be removed if you change your email address.","Your %(num)d existing shared folder invitations will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount})},showChange:function(e){var t,n;return e.preventDefault(),n=this.refs.modal,n.close(),"function"==typeof(t=this.props).onContinue?t.onContinue():void 0}}),m=t.createClass({displayName:"ChangeEmailModal",propTypes:{user:t.PropTypes.object,onChange:t.PropTypes.func,onVerificationCheck:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return T(y,{title:w("Update '%(email)s'").format({email:this.props.user.email}),className:"change-email-modal",acceptButtonText:w("Update email"),dismissButtonText:w("Cancel"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},S.form({action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},S.div({},this.getPrompt()),S.div({className:"change-email-inputs"},b({name:"email",label:w("New email",{comment:"'email' refers to the email address"}),error:this.state.errors.email,autoComplete:"off"}),b({name:"confirm_email",label:w("Confirm email",{comment:"'email' refers to the email address"}),error:this.state.errors.confirm_email,autoComplete:"off"}),E({name:"password",label:w("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),S.input({type:"hidden",name:h.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(t){var o;return this.setState({submitting:!0,errors:{}}),o=e(n.findDOMNode(this.refs.form)),r.submit(o,this._success,this._error,this._complete)},_success:function(t){var o,i,r,s,a,l;return a=this.refs.modal,s=this.refs.form,r=e(n.findDOMNode(s)).find('input[name="email"]').val(),l="NEEDS_VERIFICATION"===t,a.close(),l?"function"==typeof(o=this.props).onVerificationCheck?o.onVerificationCheck(r):void 0:"function"==typeof(i=this.props).onChange?i.onChange(r):void 0},_error:function(e){return"string"==typeof e?o.error(e):e?this.setState({errors:e}):o.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=d.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&this.props.user.role===h.ROLE_PERSONAL?(t.push(w("Enter a new email address for your personal Dropbox.")),n&&t.push(w("You’ll need to verify your new email address in order to finish updating your personal email."))):e&&this.props.user.role===h.ROLE_WORK?(t.push(w("Enter a new email address for your %(team)s Dropbox.").format({team:d.get_viewer().team_name})),n&&t.push(w("You’ll need to verify your new email address in order to finish updating your %(team)s email.").format({team:d.get_viewer().team_name}))):n&&t.push(w("You’ll need to verify your new email address in order to finish updating your email.")),t.length?C(t):""}}),f=t.createClass({displayName:"ChangeEmailOptionsEntry",propTypes:{name:t.PropTypes.string.isRequired,type:t.PropTypes.string.isRequired,address:t.PropTypes.string,verified:t.PropTypes.bool,doChangeAddress:t.PropTypes.func,doMakePrimary:t.PropTypes.func,doCreateAlias:t.PropTypes.func,doDeleteAlias:t.PropTypes.func},render:function(){var e;return e=this.props.verified?"address verified":"address pending",S.div({className:"email-row bs-row clearfix clear","data-type":this.props.type},S.span({className:"type"},this.props.name),null!=this.props.address?S.span({className:e},this.props.address):void 0,null!=this.props.address?a({targetButton:S.button({className:"sprite-button"},T(c,{group:"web",name:"gear",alt:w("Options")})),arrow_position:"top-right",ref:"dropdown"},S.div({className:"list-menu list-menu-hover"},this.props.verified?void 0:S.div({className:"list-item",onClick:function(e){return function(){return e.refs.dropdown.hide(),o.info(w("Sending verification email...")),s.send_verification_email(e.props.user,e.props.email,"generic",function(){return o.success(w("Verification email sent to %(email)s").format({email:e.props.address}))})}}(this)},w("Resend verification")),"primary"===this.props.type?S.div({className:"list-item",onClick:this.props.doChangeAddress},w("Change email address")):(S.div({className:"list-item",onClick:this.props.doMakePrimary},w("Make primary",{comment:"Make [this email address] primary"})),S.div({className:"list-item",onClick:function(e){return function(){return e.props.doDeleteAlias(e.props.address)}}(this)},w("Delete email",{comment:"'email' refers to the email address"}))))):S.a({className:"address prompt",onClick:this.props.doCreateAlias},w("Add %(type_of_email)s email",{comment:"'email' refers to the email address"}).format({type_of_email:this.props.name.toLowerCase()})))}}),_=t.createClass({displayName:"AddRecoveryEmailModal",propTypes:{user:t.PropTypes.object,onSuccess:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return T(y,{title:w("Add recovery email"),className:"change-email-modal",acceptButtonText:w("Add recovery email"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},S.form({action:"/account/alias/add/recovery_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},S.div({},w("If you request a password reset, we’ll send a link to both your primary and recovery emails.")),S.div({className:"change-email-inputs"},b({name:"email_alias",label:w("New email"),error:this.state.errors.email_alias,autoComplete:"off",onChange:function(e){return function(t){return e.newAddress=t.target.value}}(this)}),E({name:"password",label:w("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),S.input({type:"hidden",name:h.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(t){var o;return this.setState({submitting:!0,errors:{}}),o=e(n.findDOMNode(this.refs.form)),r.submit(o,this._success,this._error,this._complete)},_success:function(e){var t,n,i,r;return i=this.refs.modal,n=this.refs.form,t=this.newAddress,r="ok:NEEDS_VERIFICATION"===e,r&&o.success(w("Please check your email to verify your recovery email.")),i.close(),this.props.onSuccess(t,!r)},_error:function(e){return"string"==typeof e?o.error(e):e?this.setState({errors:e}):o.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=d.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&this.props.user.role===h.ROLE_PERSONAL?(t.push(w("Enter a new email address for your personal Dropbox.")),n&&t.push(w("You'll need to verify your new email address in order to finish updating your personal email."))):e&&this.props.user.role===h.ROLE_WORK?(t.push(w("Enter a new email address for your %(team)s Dropbox.").format({team:d.get_viewer().team_name})),n&&t.push(w("You'll need to verify your new email address in order to finish updating your %(team)s email.").format({team:d.get_viewer().team_name}))):n&&t.push(w("You'll need to verify your new email address in order to finish updating your email.")),t.length?C(t):""}}),g=t.createClass({displayName:"ChangeEmailOptionsModal",propTypes:{initialAliases:t.PropTypes.array,user:t.PropTypes.object,onAliasChange:t.PropTypes.func,startChangePrimaryFlow:t.PropTypes.func},getInitialState:function(){return{aliases:this.props.initialAliases}},deleteAlias:function(e){return new p.WebRequest({url:"/account/alias/remove",type:"POST",subject_user:this.props.user,data:{alias_type:"recovery_email",alias:e},success:function(t){return function(n){var o,i,r;r=t.state.aliases.slice();for(i in r)if(o=r[i],o.alias===e){r.splice(i,1);break}return t.setState({aliases:r}),t.props.onAliasChange(r)}}(this)})},createAlias:function(){return y.showInstance(T(_,{user:this.props.user,onSuccess:function(e){return function(t,n){var o;return o=e.state.aliases.slice(),o.push({alias:t,type:"recovery_email",verified:n}),e.props.onAliasChange(o)}}(this)}))},render:function(){var e;return T(y,{title:w("Change %(role)s emails",{comment:"email refers to an email address"}).format({role:"personal"}),className:"change-email-options-modal",acceptButtonText:w("Close"),ref:"modal"},S.div({className:"email-list-container"},T(f,{user:this.props.user,name:w("Primary",{comment:"Primary email address"}),type:"primary",address:this.props.user.email,verified:this.props.user.is_email_verified,doChangeAddress:function(e){return function(){return e.props.startChangePrimaryFlow()}}(this)}),function(){var t,n,o,i;for(o=this.state.aliases,i=[],t=0,n=o.length;n>t;t++)e=o[t],"recovery_email"===e.type&&i.push(T(f,{user:this.props.user,name:w("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",address:e.alias,verified:e.verified,doDeleteAlias:this.deleteAlias}));return i}.call(this),0===this.state.aliases.length?T(f,{user:this.props.user,name:w("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",doCreateAlias:this.createAlias}):void 0))}}),{ChangeEmailWarningModal:v,ChangeEmailModal:m,ChangeEmailOptionsModal:g,AddRecoveryEmailModal:_}})}.call(this),function(){define("modules/clean/account/email",["jquery","external/classnames","external/react","modules/core/browser","modules/core/notify","modules/core/i18n","modules/core/uri","modules/clean/ajax","modules/clean/account/change_email_modals","modules/clean/account/email_verify","modules/clean/account/verify_email_modals","modules/clean/react/modal","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N;return P=r._,g=l.ChangeEmailModal,v=l.ChangeEmailOptionsModal,y=l.ChangeEmailWarningModal,m=l.AddRecoveryEmailModal,C=c.VerifyEmailModal,S=c.ResendVerifyEmailModal,I=c.VerifyEmailSentModal,w=c.EmailVerifiedModal,E=c.ChangedEmailVerifiedModal,T=d.Modal,A=n.createElement,b=function(){function e(e){var t;this.role=e,this.role?this.user=p.get_viewer().get_user_by_role(this.role,!0):this.user=p.get_viewer().deprecated_first_user_in_the_cookie,this.email_to_verify=null!=(t=this.user)?t.email:void 0,this.verify_for_change=!1}return e.prototype.polling=!1,e.prototype.show_resend=!1,e.shouldUseSimpleUI=!1,e.getForRole=function(t){return this.initalized||(this.legacy=new e(null),this.personal=new e("personal"),this.work=new e("work"),null!=this.reason&&this.propagate_reason(),this.initalized=!0),"personal"===t?this.personal:"work"===t?this.work:this.legacy},e.get_for_user=function(e){return this.getForRole(e.role)},e.set_should_use_simple_ui=function(e){return this.shouldUseSimpleUI=e},e.reset=function(){return this.shouldUseSimpleUI=!1,this.initalized=!1},e.set_reason=function(e){return this.reason=e,this.initalized?this.propagate_reason():void 0},e.propagate_reason=function(){var e,t,n,o,i;for(n=[this.legacy,this.personal,this.work],o=[],e=0,t=n.length;t>e;e++)i=n[e],o.push(i.reason=this.reason);return o},e.prototype.set_email_to_verify=function(e){return this.email_to_verify=e,this.verify_for_change=this.email_to_verify!==this.user.email},e.prototype.send_email=function(e,t){return u.send_verification_email(this.user,this.email_to_verify,e,t)},e.prototype.send_email_and_show_resend_modal=function(e,t){return this.send_email(e,function(n){return function(){return n.email_sent(t,e)}}(this))},e.prototype.flash_email_sent_notification=function(){return i.success(P("Verification email sent to %(email)s").format({email:this.email_to_verify}))},e.prototype.ensure_polling=function(e){return u.listen_for_verification(this.user,this.email_to_verify,function(t){return function(){return null!=e?(t.user.is_email_verified=!0,e()):o.reload()}}(this))},e.prototype.email_sent=function(e,t){return this.show_resend=!0,this.show(null,t),this.flash_email_sent_notification(),this.ensure_polling(e)},e.prototype.show=function(t,n){return null!=n&&e.set_reason(n),this.show_resend?this.show_resend_verify_modal(n):this.show_verify_modal(t,n)},e.prototype.show_verify_modal=function(t,n){return null==n&&(n=this.verify_for_change?"change_email":this.reason),T.showInstance(A(C,{user:this.user,reason:n,email:this.email_to_verify,onShowChange:function(e){return function(){return f.show(e.user)}}(this),onEmailSent:function(n){return function(){var o;return o=e.get_for_user(n.user),o.email_sent(t)}}(this),shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_resend_verify_modal=function(t){return null==t&&(t=this.verify_for_change?"change_email":this.reason),T.showInstance(A(S,{user:this.user,email:this.email_to_verify,reason:t,onShowChange:function(e){return function(){return f.show(e.user)}}(this),onEmailSent:function(t){return function(){var n;return n=e.get_for_user(t.user),n.email_sent()}}(this),shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.verified_or_send_and_show=function(e,t){return this.user.is_email_verified?("function"==typeof t&&t(),!0):(this.send_email(e,function(n){return function(){return n.email_sent(function(){return n.close(),"function"==typeof t?t():void 0},e)}}(this)),!1)},e.prototype.verified_or_show=function(e){return this.user.is_email_verified?!0:(this.show(null,e),!1)},e.prototype.show_sent_modal=function(){return T.showInstance(A(I,{email:this.email_to_verify,shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_verified_modal=function(){return T.showInstance(A(w,{reason:e.REASON,email:this.email_to_verify,shouldUseSimpleUI:e.shouldUseSimpleUI}))},e.prototype.show_verified_and_changed_modal=function(){return T.showInstance(A(E,{user:this.user,email:this.email_to_verify}))},e.prototype.close=function(){return T.close()},e}(),f={inbox_counts:{},set_inbox_counts:function(t){return e.extend(this.inbox_counts,t)},show_options:function(e){var t,n,o,i;return i=e.user_id,t=e.aliases,n=e.on_alias_change,o=p.get_viewer().get_user_by_id(i),o.role===h.ROLE_WORK?f.show(i):T.showInstance(A(v,{user:o,initialAliases:t,onAliasChange:n,startChangePrimaryFlow:function(e){return function(){return f.show(i)}}(this)}))},show:function(e){var t;return t=p.get_viewer().get_user_by_id(e),this._should_show_warning(t)?this._show_warning_modal(t):this._show_change_modal(t)},_should_show_warning:function(e){var t,n,o,i;return n=p.get_viewer().is_paired,i=n&&e.role===h.ROLE_WORK,o=i&&e.sso_required,t=this.inbox_counts[e.id]>0,o||t},_show_change_modal:function(e){return function(e){return T.showInstance(A(g,{user:e,onChange:function(t){return f.trigger_change(e,t),"/account"!==s.parse(o.get_href()).path?o.redirect("/home?send_verification_email=1"):t!==e.email?o.reload():void 0},onVerificationCheck:function(t){var n;return f.trigger_change(e,t,e.is_email_verified),n=b.get_for_user(e),n.set_email_to_verify(t),n.email_sent()}}))}}(this),_show_warning_modal:function(e){return T.showInstance(A(y,{user:e,inboxCount:this.inbox_counts[e.id],onContinue:function(t){return function(){return t._show_change_modal(e)}}(this)}))},listen_for_change:function(t,n){var o;return o=this._email_change_event_for_user(t),e(document).on(o,n)},trigger_change:function(t,n,o){var i;return i=this._email_change_event_for_user(t),e(document).trigger(i,[n,o])},_email_change_event_for_user:function(e){return"db:email_changed:"+e.id}},N=n.DOM,_=n.createClass({displayName:"AccountPageEmailBlock",propTypes:{userId:n.PropTypes.number,emailName:n.PropTypes.string,emailIsInvalid:n.PropTypes.bool,initialPendingEmail:n.PropTypes.string,initialAliases:n.PropTypes.array,openChangeEmailModal:n.PropTypes.bool,showRecoveryEmailsGui:n.PropTypes.bool,showAliasGui:n.PropTypes.bool,showChangeEmail:n.PropTypes.bool},getInitialState:function(){return{pendingEmail:this.props.initialPendingEmail,aliases:void 0!==this.props.initialAliases?this.props.initialAliases:[]}},pendingVerifyLinkClick:function(e){return e.preventDefault(),b.get_for_user(this.user).show(),!1},pendingVerifyCancelClick:function(e){return e.preventDefault(),a.WebRequest({url:"/cancelpendingemailchange",success:function(e){return function(){return e.setState({pendingEmail:void 0})}}(this),subject_user:this.user.id}),!1},onAliasChange:function(e){return this.setState({aliases:e})},onUserAddressChange:function(e,t,n){return n?this.setState({pendingEmail:t}):(this.user.email=t,this.forceUpdate())},componentWillMount:function(){return this.user=p.get_viewer().get_user_by_id(this.props.userId),this.props.initialPendingEmail?b.get_for_user(this.user).set_email_to_verify(this.props.initialPendingEmail):void 0},componentDidMount:function(){return f.listen_for_change(this.user,this.onUserAddressChange),this.props.emailIsInvalid&&this.props.openChangeEmailModal?f.show(this.props.userId,this.state.aliases):void 0},render:function(){var e;return N.div({className:"fieldset user-info"},N.div({},N.h3({},this.props.emailName,this.props.showRecoveryEmailsGui&&this.props.showChangeEmail&&this.user.is_email_verified?N.button({className:"button-as-link inline-change",onClick:function(e){return function(t){t.preventDefault(),f.show_options({user_id:e.props.userId,aliases:e.state.aliases,on_alias_change:e.onAliasChange})}}(this)},P("Change",{comment:"Change the user's contact methods (primary email, recovery email, maybe phone?)"})):void 0),this.props.showRecoveryEmailsGui?N.h4({className:"email-type-header"},P("Primary",{comment:"Primary email address"})):void 0,N.div({className:t({"invalid-email":this.props.emailIsInvalid})},this.user.email),this.user.is_email_verified||this.props.emailIsInvalid?this.props.showChangeEmail?!this.props.showRecoveryEmailsGui||this.props.emailIsInvalid?N.button({className:"button-as-link",onClick:function(e){return function(t){t.preventDefault(),f.show(e.props.userId,e.state.aliases)}}(this)},P("Change email")):void 0:N.a({href:"/account#work"},P("Contact your team admin to change email")):N.div({},N.button({className:"button-as-link",onClick:function(e){return function(t){t.preventDefault(),"work"===e.user.role?b.getForRole(h.ROLE_WORK).verified_or_show():b.getForRole(h.ROLE_PERSONAL).verified_or_show()}}(this)},P("Verify email"))),this.props.showAliasGui&&"work"!==this.user.role?N.div({},N.button({className:"button-as-link",onClick:function(e){e.preventDefault()}},P("Other ways to contact you"))):void 0),this.state.pendingEmail?N.div({className:"pending-unverified-email-container"},N.br({}),N.div({}),"work"===this.user.role?N.h3({},P("Pending %(team_name)s email change").format({team_name:p.get_viewer().team_name})):"personal"===this.user.role?N.h3({},P("Pending personal email change")):N.h3({},P("Pending email change")),N.div({className:"pending-unverified-email"},this.state.pendingEmail),N.div({},N.button({className:"button-as-link",onClick:this.pendingVerifyLinkClick},P("Verify email"))),N.div({}),N.button({className:"button-as-link",onClick:this.pendingVerifyCancelClick},P("Cancel"))):void 0,this.props.showRecoveryEmailsGui&&"work"!==this.user.role&&this.user.is_email_verified?N.div({},N.br({}),N.h4({className:"email-type-header"},P("Recovery",{comment:"Recovery email address; 'backup email'"})),function(){var t,n,o,i;if(0!==this.state.aliases.length){for(o=this.state.aliases,i=[],t=0,n=o.length;n>t;t++)e=o[t],"recovery_email"===e.type&&i.push(N.div({},N.span({},e.alias),e.verified?void 0:N.span({},P(" (pending)"))));return i}return N.button({className:"button-as-link",onClick:function(e){return function(t){t.preventDefault(),T.showInstance(A(m,{user:e.user,onSuccess:function(t,n){var o;return o=e.state.aliases.slice(),o.push({alias:t,type:"recovery_email",verified:n}),e.setState({aliases:o})}}))}}(this)},P("Add a recovery email"))}.call(this)):void 0)}}),{EmailVerification:b,ChangeEmail:f,AccountPageEmailBlock:_,initialize_module:function(e){return b.set_reason(e.reason),f.set_inbox_counts(e.inbox_counts)}}})}.call(this),function(){define("modules/clean/account/email_verify",["jquery","modules/clean/ajax","modules/core/exception"],function(e,t,n){var o;return o={_POLLING:{},send_verification_email:function(e,o,i,r){return null==i&&n.raiseAndReport("Debugging T53160: reason should not be null",{severity:n.SEVERITY.NONCRITICAL,tags:["email_verify:null_reason"]}),t.WebRequest({url:"/sendverifyemail",data:{email:o,reason:i},success:function(){return r()},subject_user:e})},check_verification:function(e,n,o,i){return t.SilentBackgroundRequest({url:"/isemailverified",data:{email:n},success:function(e){return"ok"===e?o():i()},subject_user:e})},listen_for_verification:function(e,t,n){var o;return o=e.id+":"+t,this._POLLING[o]?void 0:(this._POLLING[o]=!0,this._poll_for_verification(e,t,n))},_poll_for_verification:function(e,t,n){var o;return o=4e3,this.check_verification(e,t,n,function(i){return function(){return setTimeout(function(){return i._poll_for_verification(e,t,n)},o)}}(this))}}})}.call(this),function(){define("modules/clean/account/email_verify_reasons",[],function(){var e;return e={SHARE_FOLDER:"share_folder",CREATE_API_APP:"create_api_app",PUBLIC_FOLDER:"public_folder",GENERIC:"generic",SHMODAL:"shmodal",MOBILE_SHARE_FOLDER:"mobile_share_folder",EMAIL_ALIAS:"email_alias",CHANGE_EMAIL:"change_email",PROMPT_CAMPAIGN:"prompt_campaign",ADD_COMMENT:"add_comment",SUBSCRIBE_TO_COMMENTS:"subscribe_to_comments",CREATE_FILE_COLLECTOR:"create_file_collector",JOIN_DISCOVERED_TEAM:"join_discovery",CREATE_TEAM:"create_team",NEW_DFB_TEAM_TRY:"new_dfb_team_try",NEW_DFB_TEAM_BUY:"new_dfb_team_buy",GIFT_BUY:"gift_buy",REFER_FRIENDS:"refer_friends"}})}.call(this),function(){define("modules/clean/account/verify_email_modals",["external/react","modules/core/i18n","modules/clean/account/email_verify","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/react/button","modules/clean/react/modal","modules/clean/viewer","modules/clean/react_format","modules/constants/viewer"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y,E,b,w;return y=t._,m=i.UserActivityLogger,c=r.Button,h=s.Modal,w=l.reactFormat,E=e.createElement,b=e.DOM,g={getStyle:function(){return this.props.shouldUseSimpleUI?"simple":"default"},renderChangeEmail:function(){return this.props.shouldUseSimpleUI?void 0:b.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},y("Update email address"))}},f=e.createClass({displayName:"VerifyEmailModal",mixins:[g],propTypes:{user:e.PropTypes.object,reason:e.PropTypes.string,email:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func,shouldUseSimpleUI:e.PropTypes.bool},render:function(){var e;return e={reason:this.props.reason},m.log("web","email_verify_shown",e),E(h,{title:y("Verify your email address"),className:"verify-email",acceptButtonText:y("Send email"),dismissButtonText:y("Cancel"),onAccept:this.sendEmail,ref:"modal",style:this.getStyle()},b.div({},b.div({},this.getPrompt()),this.renderChangeEmail()))},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},close:function(){var e;return null!=(e=this.refs.modal)?e.close():void 0},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},showChangeEmail:function(e){var t,n;return n={reason:this.props.reason},m.log("web","email_verify_change_first",n),e.preventDefault(),this.close(),"function"==typeof(t=this.props).onShowChange?t.onShowChange():void 0},getPrompt:function(){var e;switch(this.props.reason){case o.ADD_COMMENT:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can add comments. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.SUBSCRIBE_TO_COMMENTS:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can subscribe. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.SHARE_FOLDER:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to share folders. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.NEW_DFB_TEAM:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to add members to your team. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.SHMODAL:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to share links. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.CREATE_API_APP:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can register an API app. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.PUBLIC_FOLDER:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to enable your Public folder. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.CHANGE_EMAIL:return e=a.get_viewer().is_paired,e&&this.props.user.role===u.ROLE_PERSONAL?w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your personal email. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email}):e&&this.props.user.role===u.ROLE_WORK?w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your %(team)s email. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email,team:a.get_viewer().team_name}):w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your email. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.CREATE_FILE_COLLECTOR:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> to create file requests. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.GIFT_BUY:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can send gifts to your friends. It’s as simple as clicking the link in the verification email we send to you."),{
strong:b.strong(),email:this.props.email});case o.REFER_FRIENDS:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can invite friends. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});case o.CREATE_TEAM:return w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can create or join a team. It’s as simple as clicking the link in the verification email we send to you."),{strong:b.strong(),email:this.props.email});default:return w(y("Verify your email address at <strong>%(email)s</strong> to share folders and ensure your account can be recovered."),{strong:b.strong(),email:this.props.email})}}}),_=e.createClass({displayName:"ResendVerifyEmailModal",mixins:[g],propTypes:{user:e.PropTypes.object,email:e.PropTypes.string,reason:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func,shouldUseSimpleUI:e.PropTypes.bool},render:function(){var e;return e={reason:this.props.reason},m.log("web","email_verify_resend_shown",e),E(h,{title:y("Verify your email address"),buttonComponent:this.renderButtons(),ref:"modal",style:this.getStyle()},b.div({},b.div({},this.getPrompt()),this.renderChangeEmail()))},renderButtons:function(){return b.div({className:"db-modal-buttons"},E(c,{key:"primary",className:"dbmodal-button",importance:"primary",disabled:!1,onClick:this.close},y("Done")),E(c,{key:"tertiary",className:"dbmodal-button",importance:"tertiary",disabled:!1,onClick:this.sendEmail},y("Resend email")))},close:function(){var e;return null!=(e=this.refs.modal)?e.close():void 0},showChangeEmail:function(e){var t,n;return n={reason:this.props.reason},m.log("web","email_verify_resend_change_first",n),e.preventDefault(),this.close(),"function"==typeof(t=this.props).onShowChange?t.onShowChange():void 0},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},getPrompt:function(){var e;return e=a.get_viewer().is_paired,this.props.reason===o.REFER_FRIENDS?w(y("Dropbox needs to verify your email address <strong>%(email)s</strong> before you can invite friends. Check your inbox and click the link in the email to verify your address. If you can’t find it, check your spam folder."),{strong:b.strong(),email:this.props.email}):this.props.reason!==o.CHANGE_EMAIL?w(y("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),{strong:b.strong(),email:this.props.email}):e&&this.props.user.role===u.ROLE_PERSONAL?w(y("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your personal email. If you can't find it, check your spam folder or click the button to resend the email."),{strong:b.strong(),email:this.props.email}):e&&this.props.user.role===u.ROLE_WORK?w(y("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your %(team)s email. If you can't find it, check your spam folder or click the button to resend the email."),{strong:b.strong(),email:this.props.email,team:a.get_viewer().team_name}):w(y("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your email. If you can't find it, check your spam folder or click the button to resend the email."),{strong:b.strong(),email:this.props.email})}}),v=e.createClass({displayName:"VerifyEmailSentModal",propTypes:{email:e.PropTypes.string},render:function(){var e;return e=w(y("Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),{strong:b.strong(),email:this.props.email}),E(h,{title:y("Verification email sent!"),acceptButtonText:y("Done")},b.div({},e))}}),p=e.createClass({displayName:"EmailVerifiedModal",propTypes:{reason:e.PropTypes.string,email:e.PropTypes.string},render:function(){return E(h,{title:y("Your email address is now verified"),acceptButtonText:y("Done")},b.div({},this.getPrompt()))},getPrompt:function(){switch(this.props.reason){case o.CREATE_TEAM:return w(y("Thanks for verifying your email address: <strong>%(email)s</strong>. Now you can invite members to your team."),{strong:b.strong(),email:this.props.email});case o.SHARE_FOLDER:return w(y("Thanks for verifying your email address: <strong>%(email)s</strong>. You can now share and receive files on Dropbox."),{strong:b.strong(),email:this.props.email});case o.CREATE_API_APP:return w(y("Thanks for verifying your email address: <strong>%(email)s</strong>. You can now register API apps."),{strong:b.strong(),email:this.props.email});case o.PUBLIC_FOLDER:return w(y("Thanks for verifying your email address. You can now enable the Public folder for your <strong>%(email)s</strong> Dropbox."),{strong:b.strong(),email:this.props.email});default:return w(y("Thanks for verifying your email address: <strong>%(email)s</strong>."),{strong:b.strong(),email:this.props.email})}}}),d=e.createClass({displayName:"ChangedEmailVerifiedModal",propTypes:{email:e.PropTypes.string,user:e.PropTypes.object},render:function(){return E(h,{title:y("Your email address is now verified"),acceptButtonText:y("Done")},b.div({},this.getPrompt()))},getPrompt:function(){var e;return e=a.get_viewer().is_paired,e&&this.props.user.role===u.ROLE_PERSONAL?w(y("Thanks for verifying your email address <strong>%(email)s</strong>. Your personal account has successfully been changed."),{strong:b.strong(),email:this.props.email}):e&&this.props.user.role===u.ROLE_WORK?w(y("Thanks for verifying your email address <strong>%(email)s</strong>. Your %(team)s account has successfully been changed."),{strong:b.strong(),email:this.props.email,team:a.get_viewer().team_name}):w(y("Thanks for verifying your email address <strong>%(email)s</strong>. Your account has successfully been changed."),{strong:b.strong(),email:this.props.email})}}),{VerifyEmailModal:f,ResendVerifyEmailModal:_,VerifyEmailSentModal:v,EmailVerifiedModal:p,ChangedEmailVerifiedModal:d}})}.call(this);var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=3>r?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(3>r?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};define("modules/clean/activity/activity_user",["require","exports","external/deep-freeze","modules/clean/comments/lib/type_check","modules/clean/immutability_helper","modules/core/types","modules/core/i18n","modules/core/user_i18n","modules/clean/em_string"],function(e,t,n,o,i,r,s,a,l){"use strict";var u=function(){function e(e){var t=void 0===e?{}:e,o=t.id,i=void 0===o?null:o,r=t.fname,s=void 0===r?null:r,a=t.lname,l=void 0===a?null:a,u=t.display_name,c=void 0===u?null:u,d=t.email,p=void 0===d?null:d,h=t.photo_url,_=void 0===h?null:h,m=t.photo_circle_url,f=void 0===m?null:m,g=t.initials,v=void 0===g?null:g,y=t.is_email_verified,E=void 0===y?!1:y,b=t.is_signed_in,w=void 0===b?!1:b;this.id=i,this.fname=s,this.lname=l,this.display_name=c,this.email=p,this.photo_url=_,this.photo_circle_url=f,this.initials=v,this.is_email_verified=E,this.is_signed_in=w,n(this)}return e.fromDict=function(t){var n=i.merge(t,{initials:a.getInitials(t.display_name),is_signed_in:!!t.id});return new e(n)},e.fromUser=function(t){var n=i.merge(t,{initials:a.getInitials(t.display_name),is_signed_in:!0});return new e(n)},e.fromEmail=function(t){return new e({email:t})},Object.defineProperty(e,"anonymous",{get:function(){return e.__anonymous},enumerable:!0,configurable:!0}),e.prototype.getDisplayIdentity=function(){var e=22;return null!=this.display_name?l.em_snippet(this.display_name,e):null!=this.email?l.em_snippet(this.email,e):s._("Anonymous user")},e.__anonymous=new e,__decorate([o.takes({id:Number,fname:String,lname:String,display_name:String,email:String,photo_url:r.Maybe(String),photo_circle_url:r.Maybe(String)})],e,"fromDict",null),e}();t.ActivityUser=u}),define("modules/clean/activity/constants",["require","exports"],function(e,t){"use strict";!function(e){e[e.SHARED_LINK_VIEW=1]="SHARED_LINK_VIEW",e[e.BROWSE_FILE_VIEWER=3]="BROWSE_FILE_VIEWER",e[e.SHARED_CONTENT_LINK_VIEW=7]="SHARED_CONTENT_LINK_VIEW"}(t.ActivityContext||(t.ActivityContext={}));t.ActivityContext}),function(){define("modules/clean/annotations/annotation",["external/underscore"],function(e){var t,n,o;return o={MARKER:0,HIGHLIGHT:1,REGION:2},n={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}},t=function(){function e(e,t,n){null==e&&(e=null),null==t&&(t=null),null==n&&(n=null),this.type=e,this.subtype=t,this.pdf_coordinates=null,this.image_coordinates=null,this.text_highlight=null,this.viewportCoordinates=[],this.BUBBLE_WIDTH=320,this.annotationSize=n}return e.createAnnotationFromDict=function(t){var n,o;return n=new e,n.revision=t.revision,n.zoom=t.zoom,n.type=t.type,n.subtype=t.subtype,n.pdf_coordinates=t.pdf_coordinates,n.image_coordinates=t.image_coordinates,n.text_highlight=t.text_highlight,n.viewportCoordinates=null!=(o=t.viewportCoordinates)?o:[],n.thumbnail_url=t.thumbnail_url,n.annotationSize=28,n},e.prototype.toMetadataDict=function(){var e;return e={type:this.type,subtype:this.subtype},this.pdf_coordinates?e.pdf_coordinates=this.pdf_coordinates:this.image_coordinates&&(e.image_coordinates=this.image_coordinates),this.type===o.HIGHLIGHT&&(e.text_highlight=this.text_highlight),e},e.getCenterPosition=function(e){return{x:(e.left+e.right)/2,y:(e.top+e.bottom)/2}},e.prototype.getBoundingBox=function(){var e;switch(this.type){case o.MARKER:return e=this.getFirstViewportCoordinates(),{top:e.y-this.annotationSize/2,right:e.x+this.annotationSize/2,bottom:e.y+this.annotationSize/2,left:e.x-this.annotationSize/2};case o.HIGHLIGHT:return this._getViewportBoundingRectangle();case o.REGION:return this._getViewportBoundingRectangle()}},e.prototype.getClampedBoundingBox=function(e,t,n,o){var i;return null==n&&(n=0),null==o&&(o=0),i=this.getBoundingBox(),i.left=i.left-n,i.right=i.right-n,i.top=i.top-o,i.bottom=i.bottom-o,i.top=Math.min(Math.max(i.top,0),t-1),i.right=Math.min(Math.max(i.right,0),e-1),i.bottom=Math.min(Math.max(i.bottom,0),t-1),i.left=Math.min(Math.max(i.left,0),e-1),i},e.prototype._getViewportBoundingRectangle=function(){var e,t,n,o,i,r,s,a,l,u,c;for(l=s=this.getFirstViewportCoordinates().x,u=a=this.getFirstViewportCoordinates().y,c=this.viewportCoordinates,n=0,i=c.length;i>n;n++)for(e=c[n],o=0,r=e.length;r>o;o++)t=e[o],l=Math.min(l,t.x),s=Math.max(s,t.x),u=Math.min(u,t.y),a=Math.max(a,t.y);return{top:u,right:s,bottom:a,left:l}},e.prototype.isPdfAnnotation=function(){return null!=this.pdf_coordinates},e.prototype.isImageAnnotation=function(){return null!=this.image_coordinates},e.prototype.getFirstCoordindates=function(){return this.isPdfAnnotation()?this.getFirstPdfCoordinates():this.isImageAnnotation()?this.getFirstImageCoordinates():void 0},e.prototype.getFirstViewportCoordinates=function(){return this.viewportCoordinates[0][0]},e.prototype.getFirstImageCoordinates=function(){var e,t;return null!=(e=this.image_coordinates)&&null!=(t=e[0].coordinates)?t[0]:void 0},e.prototype.getFirstPdfCoordinates=function(){var e;return this.isOldCoordinatesFormat()?this.pdf_coordinates:null!=(e=this.pdf_coordinates[0].coordinates)?e[0]:void 0},e.prototype.getFirstPdfPage=function(){var e;return this.isOldCoordinatesFormat()?null!=(e=this.pdf_coordinates)?e.page:void 0:this.pdf_coordinates[0].page},e.prototype.isOldCoordinatesFormat=function(){return!(null!=this.pdf_coordinates&&null!=this.pdf_coordinates[0])},e.prototype.getSize=function(){return this.type===o.MARKER?this.annotationSize:null},e}(),{Annotation:t,AnnotationTypes:o,AnnotationSubtypes:n}})}.call(this),function(){define("modules/clean/annotations/annotation_controller",["external/react","external/react-dom","modules/clean/annotations/annotation","modules/clean/annotations/annotation_marker","modules/clean/annotations/annotation_highlight","modules/clean/annotations/annotation_region","jquery"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h;return a=n.Annotation,c=n.AnnotationTypes,u=n.AnnotationSubtypes,h=e.DOM,p=e.addons.CSSTransitionGroup,d="ephemeral-annotation-container",l=e.createClass({displayName:"AnnotationController",propTypes:{controllerEventHandlers:e.PropTypes.object,onAnnotationPlacedCallback:e.PropTypes.func,onAnnotationHiddenCallback:e.PropTypes.func,onAnnotationStartDragCallback:e.PropTypes.func,onAnnotationEndDragCallback:e.PropTypes.func,onAnnotationScrollCallback:e.PropTypes.func,onAnnotationScaleChangeCallback:e.PropTypes.func,onAnnotationEnterCallback:e.PropTypes.func,onAnnotationLeaveCallback:e.PropTypes.func,isAnnotationMarkerEnabled:e.PropTypes.bool,isAnnotationHighlightEnabled:e.PropTypes.bool,isAnnotationRegionEnabled:e.PropTypes.bool,isAnnotationCreationEnabled:e.PropTypes.bool,parentContainerOffset:e.PropTypes.object},getInitialState:function(){return{activeAnnotationType:null}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},hasVisibleActiveAnnotation:function(){return null!=this.refs.activeAnnotation},componentWillMount:function(){return this.allowAnnotationTypeSwitch=!0,this.isMouseDown=!1,this.positionAtLastMouseDown={}},componentDidMount:function(){var e,t,n,o,i,r;return null!=(e=this.props.controllerEventHandlers)&&(e.onHideAnnotation=this.onHideAnnotation),null!=(t=this.props.controllerEventHandlers)&&(t.onMouseMoveCallback=this.onMouseMoveCallback),null!=(n=this.props.controllerEventHandlers)&&(n.onMouseDownCallback=this.onMouseDownCallback),null!=(o=this.props.controllerEventHandlers)&&(o.onMouseUpCallback=this.onMouseUpCallback),null!=(i=this.props.controllerEventHandlers)&&(i.onScrollCallback=this.onScrollCallback),null!=(r=this.props.controllerEventHandlers)?r.onScaleChangeCallback=this.onScaleChangeCallback:void 0},_getViewerX:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageX:void 0)||0},_getViewerY:function(){var e;return(null!=(e=this.state.currentMouseEvent)?e.pageY:void 0)||0},_getEventPosition:function(e){return{x:e.pageX,y:e.pageY}},_allowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!0},_disallowAnnotationTypeSwitch:function(){return this.allowAnnotationTypeSwitch=!1},_trySetActiveAnnotationType:function(e,t){return e!==this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(e)?(this.setState({activeAnnotationType:e},function(e){return function(){return"function"==typeof t?t():void 0}}(this)),!0):("function"==typeof t&&t(),!1)},_isOnRegion:function(e){var n;return n=t.findDOMNode(this.refs.activeAnnotation),null!=n&&(e.target===n||s.contains(n,e.target))},_isAnnotationTypeCreationEnabled:function(e){if(!this.props.isAnnotationCreationEnabled)return!1;switch(e){case c.MARKER:return this.props.isAnnotationMarkerEnabled;case c.HIGHLIGHT:return this.props.isAnnotationHighlightEnabled;case c.REGION:return this.props.isAnnotationRegionEnabled;default:return!1}},_isOnText:function(e){var t,n,o,i,r,a,l,u;if(o=s(e.target),t=o.contents(),n=(null!=(u=o.css("cursor"))?u:"").split(","),n=n[n.length-1].trim(),"text"===n||"vertical-text"===n||o.is("a")&&0===t.length)return!0;if("auto"!==n)return!1;for(r=!1,a=0,l=t.length;l>a;a++)i=t[a],i.nodeType===Node.TEXT_NODE&&(r=!0);return r},_deselectAllText:function(){var e,t;return null!=(t=document.selection)&&"function"==typeof t.empty&&t.empty(),"function"==typeof window.getSelection&&"function"==typeof(e=window.getSelection()).removeAllRanges?e.removeAllRanges():void 0},onHideAnnotation:function(){var e;return null!=(e=this.refs.activeAnnotation)?e.hideAnnotation():void 0},onMouseDownCallback:function(e){var t,n;if(!this.isMouseDown)return this.isMouseDown=!0,this.positionAtLastMouseDown={x:e.pageX,y:e.pageY},this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,!this._isOnRegion(e)&&this._isOnText(e)?(t=c.HIGHLIGHT,this._trySetActiveAnnotationType(t,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0}}(this))):void 0):null!=(n=this.refs.activeAnnotation)?n.onMouseDownCallback(e):void 0},onMouseMoveCallback:function(e){var t,n;if(this.isMouseDown)return null===this.state.activeAnnotationType&&this.props.isAnnotationCreationEnabled&&this._deselectAllText(),this.allowAnnotationTypeSwitch?(t=this.state.activeAnnotationType,this.isMouseDown&&null===t&&(t=c.REGION),this._trySetActiveAnnotationType(t,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0}}(this))):null!=(n=this.refs.activeAnnotation)?n.onMouseMoveCallback(e):void 0},onMouseUpCallback:function(e){var t,n,o,i,r,s;if(this.isMouseDown){if(this.isMouseDown=!1,this.allowAnnotationTypeSwitch){if(r=this.state.activeAnnotationType,null===r){if(this._isAnnotationTypeCreationEnabled(c.MARKER))r=c.MARKER;else if(this._isAnnotationTypeCreationEnabled(c.REGION))return void this._trySetActiveAnnotationType(c.REGION,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)&&"function"==typeof n.createDefaultRegion?n.createDefaultRegion(e):void 0}}(this))}else r===c.REGION&&this._isAnnotationTypeCreationEnabled(c.MARKER)&&(t={x:e.pageX,y:e.pageY},n=t.x-this.positionAtLastMouseDown.x,o=t.y-this.positionAtLastMouseDown.y,i=Math.sqrt(n*n+o*o),34>=i&&(r=c.MARKER));return this._trySetActiveAnnotationType(r,function(t){return function(){var n;return null!=(n=t.refs.activeAnnotation)?n.onMouseUpCallback(e):void 0}}(this))}return null!=(s=this.refs.activeAnnotation)?s.onMouseUpCallback(e):void 0}},onScrollCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScrollCallback(e):void 0},onScaleChangeCallback:function(e){var t;return null!=(t=this.refs.activeAnnotation)?t.onScaleChangeCallback(e):void 0},onAnnotationHiddenCallback:function(){var e;return this.setState({activeAnnotationType:null}),this._allowAnnotationTypeSwitch(),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback():void 0},onAnnotationPlacedCallback:function(e){var t;return this._disallowAnnotationTypeSwitch(),"function"==typeof(t=this.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e):void 0},onAnnotationStartDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(e):void 0},onAnnotationEndDragCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(e):void 0},onAnnotationScrollCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScrollCallback?t.onAnnotationScrollCallback(e):void 0},onAnnotationScaleChangeCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationScaleChangeCallback?t.onAnnotationScaleChangeCallback(e):void 0},onAnnotationEnterCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(e):void 0},onAnnotationLeaveCallback:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(e):void 0},_renderActiveAnnotation:function(){if(null!=this.state.activeAnnotationType&&this._isAnnotationTypeCreationEnabled(this.state.activeAnnotationType))switch(this.state.activeAnnotationType){case c.MARKER:return e.createElement(o,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case c.HIGHLIGHT:return e.createElement(i,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback});case c.REGION:return e.createElement(r,{ref:"activeAnnotation",parentContainerOffset:this.props.parentContainerOffset,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback})}return""},render:function(){return h.div({className:""+d},this._renderActiveAnnotation())}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight",["jquery","external/react","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o){var i,r,s,a,l;return i=o.Annotation,a=o.AnnotationTypes,s=o.AnnotationSubtypes,l=t.DOM,r=t.createClass({displayName:"AnnotationHighlight",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return{isShown:!1}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return this.type=a.HIGHLIGHT,this.subtype=s.HIGHLIGHT.HIGHLIGHT,this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER=8,this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER=30},hideAnnotation:function(){return this._hideAnnotation()},_updateViewportBoundaries:function(){var e,t,n;return e=window.getSelection(),e.rangeCount>0?(t=this._isBrowserIE()?this._extractViewportClientRectanglesIEHack(e.getRangeAt(0)):this._extractViewportClientRectangles(e.getRangeAt(0)),n=this._consolidateClientRectangles(t),this._setViewportCoordinatesFromRectangles(n)):void 0},_extractViewportClientRectangles:function(e){var t,n,o,i;for(t=[],n=e.endContainer,o=e.endOffset,i=e.cloneRange();n!==e.commonAncestorContainer;)i.setStart(n,0),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),o=Array.prototype.indexOf.call(n.parentNode.childNodes,n),n=n.parentNode;return i=e.cloneRange(),i.setEnd(n,o),Array.prototype.push.apply(t,i.getClientRects()),t},_extractViewportClientRectanglesIEHack:function(e){var t,n,o;if("canvasWrapper"===e.startContainer.className&&e.setStart(e.startContainer.nextSibling.children[0].childNodes[0],0),e.startContainer===e.commonAncestorContainer)return e.getClientRects();for(t=[],o=e.cloneRange(),o.setEnd(e.startContainer,e.startContainer.length),Array.prototype.push.apply(t,o.getClientRects()),n=e.startContainer.parentNode.nextSibling;n!==e.endContainer.parentNode;)Array.prototype.push.apply(t,n.getClientRects()),n=n.nextSibling;return o.setStart(e.endContainer,0),o.setEnd(e.endContainer,e.endOffset),Array.prototype.push.apply(t,o.getClientRects()),t},_isBrowserIE:function(){var e,t,n;return n=window.navigator.userAgent,t=n.indexOf("Trident/"),e=n.indexOf("Edge/"),t>0||e>0},_consolidateClientRectangles:function(e){var t,n,o,i,r,s;for(n=[],o=0,i=e.length;i>o;o++)s=e[o],0!==s.width&&0!==s.height&&(n.length>0&&(r=n[n.length-1],this._isWithinConsolidationVerticalBuffer(r,s)&&this._isWithinConsolidationHorizontalBuffer(r,s))?(t=this._calculateBoundingBox(r,s),r.top=t.top,r.right=t.right,r.bottom=t.bottom,r.left=t.left):n.push({top:s.top,right:s.right,bottom:s.bottom,left:s.left}));return n},_isWithinConsolidationVerticalBuffer:function(e,t){return Math.abs(e.top-t.top)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER&&Math.abs(e.bottom-t.bottom)<this.CONSOLIDATE_RECTANGLE_VERTICAL_BUFFER},_isWithinConsolidationHorizontalBuffer:function(e,t){var n,o,i;return n=this._calculateBoundingBox(e,t),o=n.right-n.left,i=t.width+(e.right-e.left),o-i<this.CONSOLIDATE_RECTANGLE_HORIZONTAL_BUFFER},_calculateBoundingBox:function(e,t){return{top:Math.min(e.top,t.top),right:Math.max(e.right,t.right),bottom:Math.max(e.bottom,t.bottom),left:Math.min(e.left,t.left)}},_setViewportCoordinatesFromRectangles:function(e){var t,n,o,i,r;for(r=[],n=0,o=e.length;o>n;n++)i=e[n],t=[],t.push({x:i.left,y:i.top}),t.push({x:i.right,y:i.bottom}),r.push(t);return this.annotation.viewportCoordinates=r},_getPositionRelativeToParentContainer:function(e){return{x:e.x-this.props.parentContainerOffset.left,y:e.y-this.props.parentContainerOffset.top}},_updateHighlightedText:function(){return this.annotation.text_highlight={snippet_before:this._getTextBeforeHighlight(),text:this._getHighlightedText(),snippet_after:this._getTextAfterHighlight()}},_generateAnnotation:function(){return this.annotation=new i(this.type,this.subtype),this._updateViewportBoundaries(),this._updateHighlightedText()},_hideAnnotation:function(){return this._isBrowserIE()&&this.state.isShown&&this.setState({isShown:!1,viewportCoordinates:null}),this.annotation=null,this.props.onAnnotationHiddenCallback()},_updateViewportCoordinatesFromUI:function(){var t,n,o,i,r,s,a,l;if(this.state.isShown){for(r=[],l=e(".annotation-highlight"),o=0,i=l.length;i>o;o++)s=l[o],n=[],t=e(s),a=t.offset(),n.push({x:a.left,y:a.top}),n.push({x:a.left+t.width(),y:a.top+t.height()}),r.push(n);return this.annotation.viewportCoordinates=r}},_getHighlightedText:function(){var e;return e=window.getSelection().toString().trim(),e=e.replace(/\s+/g," ")},_getTextBeforeHighlight:function(){return""},_getTextAfterHighlight:function(){return""},_isTextSelected:function(){return""!==this._getHighlightedText()},onMouseDownCallback:function(e){return{}},onMouseMoveCallback:function(e){return{}},onMouseUpCallback:function(e){return setTimeout(function(e){return function(){var t,n,o,i,r,s,a,l;if(!e._isTextSelected())return e._hideAnnotation();if(e._generateAnnotation(),e.props.onAnnotationPlacedCallback(e.annotation),e._isBrowserIE()){for(l=[],s=e.annotation.viewportCoordinates,o=0,r=s.length;r>o;o++)t=s[o],n=[],i=e._getPositionRelativeToParentContainer(t[0]),a=e._getPositionRelativeToParentContainer(t[1]),n.push({x:i.x,y:i.y}),n.push({x:a.x,y:a.y}),l.push(n);return e.setState({isShown:!0,viewportCoordinates:l})}}}(this),0)},onScrollCallback:function(){var e;return null!=this.annotation?(this._isBrowserIE()?this._updateViewportCoordinatesFromUI():this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return null!=this.annotation?(this._updateViewportBoundaries(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseUp:function(e){return{}},render:function(){var e,t,n,o,i,r,s;return l.div({className:"annotation-highlight-container",ref:"highlightContainer"},function(){var a,u,c;if(this.state.isShown){for(t=[],c=this.state.viewportCoordinates,a=0,u=c.length;u>a;a++)o=c[a],n=o[0].x,s=o[0].y,i=o[1].x,e=o[1].y,r={left:n,top:s,width:i-n,height:e-s},t.push(l.div({className:"annotation-highlight",style:r}));return t}}.call(this))}})})}.call(this),function(){define("modules/clean/annotations/annotation_highlight_ui",["jquery","external/classnames","external/react","external/react-dom","modules/clean/annotations/annotation"],function(e,t,n,o,i){var r,s,a,l,u,c;return r=i.Annotation,l=i.AnnotationTypes,a=i.AnnotationSubtypes,c=n.DOM,u=18,s=n.createClass({displayName:"AnnotationHighlightUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{isHover:!1}},componentWillMount:function(){return this.initialViewport=this.props.annotation.viewportCoordinates,this.annotation=r.createAnnotationFromDict(this.props.annotation)},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onHighlightClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseEnter:function(e){var t;return this.setState({isHover:!0}),clearTimeout(this.mouseLeaveTimeout),this._updateViewportCoordinates(),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}):void 0},_onHighlightMouseOver:function(e){return{}},_onHighlightMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback&&t.onAnnotationLeaveCallback({annotation:this.annotation,commentActivity:this.props.commentActivity}),this.mouseLeaveTimeout=setTimeout(function(e){return function(){return e.setState({isHover:!1})}}(this),100)},_updateViewportCoordinates:function(){var t,n,i,r,s,a,l,u;for(t=e(o.findDOMNode(this.refs.highlightContainer)),l=[],r=t.children(),s=0,a=r.length;a>s;s++)i=r[s],n=[],u=e(i).offset(),n.push({x:u.left,y:u.top}),n.push({x:u.left+e(i).width(),y:u.top+e(i).height()}),l.push(n);return this.annotation.viewportCoordinates=l},render:function(){var e,n,o,i,r,s,a,l,d,p,h,_,m,f,g,v,y,E;for(a=[],d=null!=(m=this.props.commentActivity)&&null!=(f=m.comment)?f.resolved:void 0,e=t({"annotation-highlight":!0,"annotation-highlight--ui":!0,"annotation-highlight--resolved":d,"highlight-hover":this.state.isHover,"annotation-highlight--ghost":this._isGhostAnnotation()}),r=-1,g=this.initialViewport,l=0,h=g.length;h>l;l++)_=g[l],p=_[0].x,E=_[0].y,v=_[1].x,s=_[1].y,(-1===r||r>E)&&(o=p,r=E),y={left:p,top:E,width:v-p,height:s-E},a.push(c.div({className:e,style:y,onClick:this._onHighlightClick,onMouseEnter:this._onHighlightMouseEnter,onMouseOver:this._onHighlightMouseOver,onMouseLeave:this._onHighlightMouseLeave}));return c.div({className:"annotation-highlight-container",ref:"highlightContainer"},a,this.props.options.isAnnotationNumberingEnabled?(i={left:o-u/2,top:r-u/2},n=t({"annotation-number":!0,"annotation-number--resolved":d,"annotation-number--hover":this.state.isHover}),c.div({className:n,style:i},this.props.options.annotationNumber)):void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker",["jquery","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o,i){
var r,s,a,l,u,c;return r=i.Annotation,l=i.AnnotationTypes,a=i.AnnotationSubtypes,c=t.DOM,u=t.addons.CSSTransitionGroup,s=t.createClass({displayName:"AnnotationMarker",propTypes:{onAnnotationPlacedCallback:t.PropTypes.func,onAnnotationHiddenCallback:t.PropTypes.func,onAnnotationStartDragCallback:t.PropTypes.func,onAnnotationEndDragCallback:t.PropTypes.func,onAnnotationOverCallback:t.PropTypes.func,onAnnotationScrollCallback:t.PropTypes.func,onAnnotationScaleChangeCallback:t.PropTypes.func,onAnnotationEnterCallback:t.PropTypes.func,onAnnotationLeaveCallback:t.PropTypes.func,parentContainerOffset:t.PropTypes.object},getInitialState:function(){return this.type=l.MARKER,this.subtype=a.MARKER.CIRCLE,this.size=28,this.isInDragMode=!1,this._resetPositionDelta(),{isToolVisible:!1,viewerX:0,viewerY:0}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},componentWillMount:function(){return{}},hideAnnotation:function(){return this._hideAnnotation()},_getSelectionText:function(){var e;return e="",window.getSelection&&(e=window.getSelection().toString()),e},_hasSelectedText:function(){return""!==this._getSelectionText()},_resetPositionDelta:function(){return this.positionDelta={x:0,y:0}},_getOffsetPosition:function(e){var t,n,o,i,r,s,a,l;return t=e.offsetX||(null!=(o=e.nativeEvent)?o.offsetX:void 0)||(null!=(i=e.nativeEvent)&&null!=(r=i.originalEvent)?r.layerX:void 0),n=e.offsetY||(null!=(s=e.nativeEvent)?s.offsetY:void 0)||(null!=(a=e.nativeEvent)&&null!=(l=a.originalEvent)?l.layerY:void 0),{x:t-this.annotation.getSize()/2,y:n-this.annotation.getSize()/2}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_calculateMarkerPos:function(e){var t,n;return n=this._getPositionRelativeToParentContainer(e),t=this.size/2,{x:n.x-t-this.positionDelta.x,y:n.y-t-this.positionDelta.y}},_generateAnnotation:function(e){return this.annotation=new r(this.type,this.subtype,this.size),this._updateViewportCoordinatesFromEvent(e),this.annotation},_updateViewportCoordinatesFromEvent:function(e){var t;return t={x:e.clientX-this.positionDelta.x,y:e.clientY-this.positionDelta.y},this.annotation.viewportCoordinates[0]=[t]},_hideAnnotation:function(e){var t;return this.annotation=null,this.setState({isToolVisible:!1,viewerX:null!=e?e.pageX:void 0,viewerY:null!=e?e.pageY:void 0}),"function"==typeof(t=this.props).onAnnotationHiddenCallback?t.onAnnotationHiddenCallback():void 0},_placeAnnotation:function(e){return this.setState({isToolVisible:!0,viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y},function(t){return function(){var n;return t._generateAnnotation(e),"function"==typeof(n=t.props).onAnnotationPlacedCallback?n.onAnnotationPlacedCallback(t.annotation):void 0}}(this))},updateViewportCoordinatesFromMarker:function(){var t,o,i,r;return this.state.isToolVisible&&(r=n.findDOMNode(this.refs.annotationMarker),r&&(t=e(r),o=t.offset(),i={x:o.left+this.annotation.getSize()/2,y:o.top+this.annotation.getSize()/2},this.annotation.viewportCoordinates[0]=[i])),null},_startAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!0,this.positionDelta=this._getOffsetPosition(e),this._updateViewportCoordinatesFromEvent(e),"function"==typeof(t=this.props).onAnnotationStartDragCallback?t.onAnnotationStartDragCallback(this.annotation):void 0},_endAnnotationDrag:function(e){var t;return e.preventDefault(),this.isInDragMode=!1,this._updateViewportCoordinatesFromEvent(e),this._resetPositionDelta(),"function"==typeof(t=this.props).onAnnotationEndDragCallback?t.onAnnotationEndDragCallback(this.annotation):void 0},_isOnMarker:function(t){var o;return this.state.isToolVisible?(o=n.findDOMNode(this.refs.annotationMarker),null!=o?t.target===o||e.contains(o,t.target):!1):void 0},onMouseDownCallback:function(e){return this.state.isToolVisible&&this._isOnMarker(e)?(this._startAnnotationDrag(e),e.preventDefault()):void 0},onMouseMoveCallback:function(e){return this.isInDragMode&&this.state.isToolVisible?(this.setState({viewerX:this._calculateMarkerPos(e).x,viewerY:this._calculateMarkerPos(e).y}),e.preventDefault()):void 0},onMouseUpCallback:function(e){return this.state.isToolVisible?this.isInDragMode?this._endAnnotationDrag(e):this._hideAnnotation(e):this._hasSelectedText()?void 0:(this._placeAnnotation(e),e.preventDefault())},onScrollCallback:function(){var e;return this.state.isToolVisible?(this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return this.updateViewportCoordinatesFromMarker(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onMarkerMouseDown:function(e){return{}},_onMarkerMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onMarkerMouseUp:function(e){return{}},_onMarkerMouseEnter:function(e){var t;return"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},render:function(){var e;return e=[],this.state.isToolVisible&&(e=[c.div({key:"annotationMarker",ref:"annotationMarker",className:"annotation-marker annotation-marker--blue",onMouseDown:this._onMarkerMouseDown,onMouseUp:this._onMarkerMouseUp,onMouseOver:this._onMarkerMouseOver,onMouseEnter:this._onMarkerMouseEnter,onMouseLeave:this._onMarkerMouseLeave,style:{left:this.state.viewerX,top:this.state.viewerY}},c.div({className:"annotation-maker-inner"}))]),c.div({className:"annotation-marker-container"},this.state.isToolVisible?e:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_marker_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,o){var i,r;return r=n.DOM,i=n.createClass({displayName:"AnnotationMarkerUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{}},getDefaultProps:function(){return{options:{}}},componentWillMount:function(){return this.initialViewport=this.props.annotation.getFirstViewportCoordinates()},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onMarkerClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseEnter:function(t){var n,i,r;return n=e(o.findDOMNode(this.refs.annotationMarker)),i=this.props.annotation,null==i.viewportCoordinates&&(i.viewportCoordinates=[]),i.viewportCoordinates[0]=[{x:n.offset().left+i.annotationSize/2,y:n.offset().top+i.annotationSize/2}],"function"==typeof(r=this.props).onAnnotationEnterCallback?r.onAnnotationEnterCallback({annotation:i,commentActivity:this.props.commentActivity}):void 0},_onMarkerMouseOver:function(e){return{}},_onMarkerMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,o,i;return n=null!=(o=this.props.commentActivity)&&null!=(i=o.comment)?i.resolved:void 0,e=t({"annotation-marker":!0,"annotation-marker--ui":!0,"annotation-marker--blue":!n,"annotation-marker--resolved":n,"annotation-marker--ghost":this._isGhostAnnotation()}),r.div({className:"annotation-marker-container",ref:"markerContainer"},r.div({key:"annotationMarker",ref:"annotationMarker",style:{left:this.initialViewport.x-this.props.annotation.annotationSize/2,top:this.initialViewport.y-this.props.annotation.annotationSize/2},className:e,onClick:this._onMarkerClick,onMouseEnter:this._onMarkerMouseEnter,onMouseOver:this._onMarkerMouseOver,onMouseLeave:this._onMarkerMouseLeave},r.div({className:"annotation-maker-inner"})))}})})}.call(this),function(){define("modules/clean/annotations/annotation_region",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/annotations/annotation"],function(e,t,n,o,i,r){var s,a,l,u,c,d;return s=r.Annotation,u=r.AnnotationTypes,l=r.AnnotationSubtypes,d=n.DOM,c=n.addons.CSSTransitionGroup,a=n.createClass({displayName:"AnnotationRegion",propTypes:{onAnnotationPlacedCallback:n.PropTypes.func,onAnnotationHiddenCallback:n.PropTypes.func,onAnnotationStartDragCallback:n.PropTypes.func,onAnnotationEndDragCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationScrollCallback:n.PropTypes.func,onAnnotationScaleChangeCallback:n.PropTypes.func,onAnnotationEnterCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,parentContainerOffset:n.PropTypes.object},TYPE:u.REGION,SUBTYPE:l.REGION.RECTANGLE,DEFAULT_REGION_SIZE:60,Directions:{TOP:"top",RIGHT:"right",BOTTOM:"bottom",LEFT:"left"},getInitialState:function(){return{isInDragMode:!1,resizeDirections:[],isToolVisible:!1,isInitialCreation:!1,rectangle:{top:0,right:0,bottom:0,left:0},anchorRectangle:{top:0,right:0,bottom:0,left:0},anchorMouse:{x:0,y:0}}},getDefaultProps:function(){return{parentContainerOffset:{left:0,top:0}}},_getPositionRelativeToParentContainer:function(e){return{x:e.pageX-this.props.parentContainerOffset.left,y:e.pageY-this.props.parentContainerOffset.top}},_updateAnnotationFromState:function(){var e,t,n,o;return o=this.state.rectangle.top+this.props.parentContainerOffset.top,n=this.state.rectangle.right+this.props.parentContainerOffset.left,e=this.state.rectangle.bottom+this.props.parentContainerOffset.top,t=this.state.rectangle.left+this.props.parentContainerOffset.left,this.annotation.viewportCoordinates[0]=[{x:t,y:o},{x:t,y:e},{x:n,y:e},{x:n,y:o}]},_isOnRegion:function(t){var n;return this.state.isToolVisible&&(n=o.findDOMNode(this.refs.annotationRegion),null!=n)?t.target===n||e.contains(n,t.target):!1},_isInResizingMode:function(){return!i.isEmpty(this.state.resizeDirections)},_isModifying:function(){return this.state.isInDragMode||this._isInResizingMode()},_showNewRectangle:function(e){return this.setState({isInDragMode:!1,resizeDirections:[this.Directions.TOP,this.Directions.LEFT],isToolVisible:!0,isInitialCreation:!0,rectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorRectangle:{top:e.y,right:e.x,bottom:e.y,left:e.x},anchorMouse:e})},_startDragging:function(e){return this.setState({isInDragMode:!0,resizeDirections:[],anchorRectangle:i.clone(this.state.rectangle),anchorMouse:e})},_startResizing:function(e,t){return this.setState({isInDragMode:!1,resizeDirections:i.clone(t),anchorRectangle:i.clone(this.state.rectangle),anchorMouse:e})},componentWillMount:function(){return this.annotation=new s(this.TYPE,this.SUBTYPE)},hideAnnotation:function(){var e;return this.setState({isToolVisible:!1,isInDragMode:!1,resizeDirections:[]}),"function"==typeof(e=this.props).onAnnotationHiddenCallback?e.onAnnotationHiddenCallback(this.annotation):void 0},getDimensions:function(){return{width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},createDefaultRegion:function(e){var t,n,o,i;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),o=n.x,i=n.y,t=this.DEFAULT_REGION_SIZE/2,this.setState({isHovering:!0,isToolVisible:!0,isInDragMode:!1,resizeDirections:[],isInitialCreation:!1,rectangle:{top:i-t,right:o+t,bottom:i+t,left:o-t}},function(e){return function(){var t;return e._updateAnnotationFromState(),"function"==typeof(t=e.props).onAnnotationPlacedCallback?t.onAnnotationPlacedCallback(e.annotation):void 0}}(this))},onMouseDownCallback:function(e){var t,n;return e.preventDefault(),n=this._getPositionRelativeToParentContainer(e),this.state.isToolVisible?this._isOnRegion(e)&&!this._isInResizingMode()?(this._updateAnnotationFromState(),"function"==typeof(t=this.props).onAnnotationStartDragCallback&&t.onAnnotationStartDragCallback(this.annotation),this._startDragging(n)):void 0:this._showNewRectangle(n)},onMouseMoveCallback:function(e){var t,n,o;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(o=this._getPositionRelativeToParentContainer(e),t={x:o.x-this.state.anchorMouse.x,y:o.y-this.state.anchorMouse.y},n=i.clone(this.state.anchorRectangle),this.state.isInDragMode?n={top:this.state.anchorRectangle.top+t.y,right:this.state.anchorRectangle.right+t.x,bottom:this.state.anchorRectangle.bottom+t.y,left:this.state.anchorRectangle.left+t.x}:this._isInResizingMode()&&(this.state.resizeDirections.indexOf(this.Directions.TOP)>=0?n.top=this.state.anchorRectangle.top+t.y:this.state.resizeDirections.indexOf(this.Directions.BOTTOM)>=0&&(n.bottom=this.state.anchorRectangle.bottom+t.y),this.state.resizeDirections.indexOf(this.Directions.LEFT)>=0?n.left=this.state.anchorRectangle.left+t.x:this.state.resizeDirections.indexOf(this.Directions.RIGHT)>=0&&(n.right=this.state.anchorRectangle.right+t.x)),n={top:Math.min(n.top,n.bottom),right:Math.max(n.left,n.right),bottom:Math.max(n.top,n.bottom),left:Math.min(n.left,n.right)},this.setState({rectangle:n})):void 0:(o=this._getPositionRelativeToParentContainer(e),void this._showNewRectangle(o))},onMouseUpCallback:function(e){var t,n;return e.preventDefault(),this.state.isToolVisible?this._isModifying()?(this._updateAnnotationFromState(),this.state.isInitialCreation?"function"==typeof(t=this.props).onAnnotationPlacedCallback&&t.onAnnotationPlacedCallback(this.annotation):"function"==typeof(n=this.props).onAnnotationEndDragCallback&&n.onAnnotationEndDragCallback(this.annotation),this.setState({isInDragMode:!1,resizeDirections:[],isInitialCreation:!1})):this.hideAnnotation(e):void 0},onScrollCallback:function(){var e;return this.state.isToolVisible?(this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScrollCallback?e.onAnnotationScrollCallback(this.annotation):void 0):void 0},onScaleChangeCallback:function(){var e;return this._updateAnnotationFromState(),"function"==typeof(e=this.props).onAnnotationScaleChangeCallback?e.onAnnotationScaleChangeCallback(this.annotation):void 0},_onRegionMouseDown:function(e){},_onRegionMouseOver:function(e){var t;return"function"==typeof(t=this.props).onAnnotationOverCallback?t.onAnnotationOverCallback(this.annotation):void 0},_onRegionMouseUp:function(e){},_onRegionMouseEnter:function(e){var t;return this.setState({isHovering:!0}),"function"==typeof(t=this.props).onAnnotationEnterCallback?t.onAnnotationEnterCallback(this.annotation):void 0},_onRegionMouseLeave:function(e){var t;return this.setState({isHovering:!1}),"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback(this.annotation):void 0},_onHandleMouseDown:function(e,t){var n,o;return e.preventDefault(),o=this._getPositionRelativeToParentContainer(e),this._updateAnnotationFromState(),"function"==typeof(n=this.props).onAnnotationStartDragCallback&&n.onAnnotationStartDragCallback(this.annotation),this._startResizing(o,t)},_renderSideHandles:function(){var e;return d.div({ref:"side-handle-wrapper",className:"annotation-region-side-handle--wrapper"},function(){var t,n,o,r;for(o=i.values(this.Directions),r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push(function(e){return function(t){return d.div({ref:"side-handle-"+t,className:"annotation-region-side-handle annotation-region-side-handle--"+t,onMouseDown:function(n){return e._onHandleMouseDown(n,[t])}})}}(this)(e));return r}.call(this))},_renderCornerHandles:function(){var e,t,n,o,i,r;for(o=[this.Directions.TOP,this.Directions.BOTTOM],i=[],t=0,n=o.length;n>t;t++)r=o[t],i.push(function(){var t,n,o,i;for(o=[this.Directions.LEFT,this.Directions.RIGHT],i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(function(e){return function(t,n){return d.div({ref:"corner-handle-"+t+"-"+n,className:"annotation-region-corner-handle annotation-region-corner-handle--"+t+"-"+n,onMouseDown:function(o){return e._onHandleMouseDown(o,[t,n])}},d.div({ref:"corner-handle-"+t+"-"+n+"-dot",className:"annotation-region-corner-handle--dot annotation-region-corner-handle--dot--"+t+"-"+n}))}}(this)(r,e));return i}.call(this));return i},render:function(){var e,n;return n=[],this.state.isToolVisible&&(e={"annotation-region":!0,"annotation-region--blue":!0,"is-modifying":this._isModifying(),hover:this.state.isHovering},n=[d.div({key:"annotationRegion",ref:"annotationRegion",className:t(e),onMouseDown:this._onRegionMouseDown,onMouseUp:this._onRegionMouseUp,onMouseOver:this._onRegionMouseOver,onMouseOut:this._onRegionMouseOut,onMouseEnter:this._onRegionMouseEnter,onMouseLeave:this._onRegionMouseLeave,style:{left:this.state.rectangle.left,top:this.state.rectangle.top,width:this.state.rectangle.right-this.state.rectangle.left,height:this.state.rectangle.bottom-this.state.rectangle.top}},this._renderSideHandles(),this._renderCornerHandles())]),d.div({className:"annotation-region-container"},this.state.isToolVisible?n:void 0)}})})}.call(this),function(){define("modules/clean/annotations/annotation_region_ui",["jquery","external/classnames","external/react","external/react-dom"],function(e,t,n,o){var i,r;return r=n.DOM,i=n.createClass({displayName:"AnnotationRegionUI",propTypes:{annotation:n.PropTypes.object,commentActivity:n.PropTypes.object,options:n.PropTypes.shape({isGhostAnnotation:n.PropTypes.bool,isAnnotationNumberingEnabled:n.PropTypes.bool,annotationNumber:n.PropTypes.number}),onAnnotationEnterCallback:n.PropTypes.func,onAnnotationOverCallback:n.PropTypes.func,onAnnotationLeaveCallback:n.PropTypes.func,onAnnotationClickCallback:n.PropTypes.func},getInitialState:function(){return{}},_isGhostAnnotation:function(){return this.props.options.isGhostAnnotation||!1},_onRegionClick:function(e){var t;return"function"==typeof(t=this.props).onAnnotationClickCallback?t.onAnnotationClickCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseEnter:function(t){var n,i,r,s,a,l,u;return n=e(o.findDOMNode(this.refs.annotationRegion)),i=this.props.annotation,null==i.viewportCoordinates&&(i.viewportCoordinates=[]),u=n.offset().top,a=n.offset().left,s=u+n.height(),l=a+n.width(),i.viewportCoordinates[0]=[{x:a,y:u},{x:a,y:s},{x:l,y:s},{x:l,y:u}],"function"==typeof(r=this.props).onAnnotationEnterCallback?r.onAnnotationEnterCallback({annotation:i,commentActivity:this.props.commentActivity}):void 0},_onRegionMouseOver:function(e){return{}},_onRegionMouseLeave:function(e){var t;return"function"==typeof(t=this.props).onAnnotationLeaveCallback?t.onAnnotationLeaveCallback({annotation:this.props.annotation,commentActivity:this.props.commentActivity}):void 0},render:function(){var e,n,o,i,s,a;return o=null!=(s=this.props.commentActivity)&&null!=(a=s.comment)?a.resolved:void 0,i=this.props.annotation.getBoundingBox(),e=t({"annotation-region":!0,"annotation-region--ui":!0,"annotation-region--resolved":o,"annotation-region--ui--resolved":o,"annotation-region--ghost":this._isGhostAnnotation()}),r.div({className:"annotation-region-container"},r.div({key:"annotationRegion",ref:"annotationRegion",className:e,onClick:this._onRegionClick,onMouseEnter:this._onRegionMouseEnter,onMouseOver:this._onRegionMouseOver,onMouseLeave:this._onRegionMouseLeave,style:{left:i.left,top:i.top,width:i.right-i.left,height:i.bottom-i.top}},r.div({className:"annotation-region-inner"}),this.props.options.isAnnotationNumberingEnabled?(n=t({"annotation-number":!0,"annotation-number--resolved":o}),r.div({className:n},this.props.options.annotationNumber)):void 0))}})})}.call(this),function(){define("modules/clean/annotations/annotation_renderer_utils",["jquery","external/react","modules/clean/annotations/annotation","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","external/underscore"],function(e,t,n,o,i,r,s){var a,l,u;return a=n.Annotation,u=n.AnnotationTypes,l=function(){function e(){}return e.prototype.shouldUpdateAnnotations=function(e,t){var n,o,i,r,a,l,u;if((null!=(a=e.annotations)?a.length:void 0)!==(null!=(l=s.keys(t))?l.length:void 0))return!0;for(u=e.annotations,i=0,r=u.length;r>i;i++)if(o=u[i],n=o.commentActivity.activity_key,!s.isEqual(t[n],o))return!0;return!1},e.prototype.renderAnnotation=function(e,t,n){var s,l,c,d;if(null==e.annotation||null==e.commentActivity)return null;if(s=a.createAnnotationFromDict(e.annotation),c=e.commentActivity,null==(null!=s?s.type:void 0)||t(c.activity_key))return null;switch(l=null,s.type){case u.MARKER:l=i;break;case u.HIGHLIGHT:l=o;break;case u.REGION:l=r}return null==l?null:(d=null!=e.options?e.options:{},n(l,s,c,d))},e}()})}.call(this),function(){define("modules/clean/annotations/preview_image_annotations_toolbar",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/core/dom","modules/core/i18n","modules/clean/keycode","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/constants/comments_panel"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f;return h=s._,f=s.format_percent,_=t.createElement,m=t.DOM,p=3e3,d=t.createClass({displayName:"PreviewImageAnnotationsToolbar",propTypes:{canEnableRegionCreation:t.PropTypes.bool,index:t.PropTypes.number.isRequired,count:t.PropTypes.number.isRequired,zoomPercent:t.PropTypes.number,minimumZoomPercent:t.PropTypes.number,maximumZoomPercent:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func,onFullscreen:t.PropTypes.func,onZoomIn:t.PropTypes.func,onZoomOut:t.PropTypes.func,onZoomOriginalOrFit:t.PropTypes.func,onRegionCreationClick:t.PropTypes.func},getInitialState:function(){return{isToolbarVisible:!0}},componentDidMount:function(){return window.addEventListener("mousemove",this._onMouseMove),i(document).bind("keydown",this._handleKeyPress)},componentWillUnmount:function(){return window.removeEventListener("mousemove",this._onMouseMove),clearTimeout(this.hideToolbarTimeout),i(document).unbind("keydown",this._handleKeyPress)},_onMouseMove:function(e){return this.state.isToolbarVisible||this.setState({isToolbarVisible:!0}),this.state.isToolbarVisible?(clearTimeout(this.hideToolbarTimeout),this.hideToolbarTimeout=setTimeout(function(t){return function(){return t._maybeHideToolbar(e)}}(this),p)):void 0},_handleKeyPress:function(e){var t,n,o,i;return r.focus_in_input()||r.is_input(e.target)?!0:(i=e.keyCode,i===a.EQUALS||i===a.PLUS_EQUALS_FF||i===a.PLUS_CHROME||i===a.PLUS_EQUALS_FF_GERMAN?("function"==typeof(t=this.props).onZoomIn&&t.onZoomIn(),o=!0):i!==a.MINUS_FF_MAC&&i!==a.MINUS_FF&&i!==a.MINUS_CHROME||("function"==typeof(n=this.props).onZoomOut&&n.onZoomOut(),o=!0),o&&null!=e.preventDefault&&e.preventDefault(),!o)},_maybeHideToolbar:function(e){return 0===i(e.target).closest(n.findDOMNode(this.refs.previewToolbar)).length?this.setState({isToolbarVisible:!1}):void 0},_flipLabelText:function(){return h("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})},_zoomToolTipText:function(){return h(1===this.props.zoomPercent?"Zoom to fit":"View actual size")},_getZoomLabel:function(){return this.props.zoomPercent?f(Math.round(100*this.props.zoomPercent)):""},_onZoomMouseDown:function(e){return this.isZooming=!0,this._keepZooming(e,400)},_keepZooming:function(e,t){return this.isZooming?(e(),setTimeout(function(t){return function(){return t._keepZooming(e,75)}}(this),t)):void 0},_onZoomMouseUp:function(){return this.isZooming=!1},_onZoomMouseLeave:function(){return this.isZooming=!1},render:function(){var t,n,i;return this.state.isToolbarVisible?this.props.count<=1&&null==this.props.onZoomOut&&null==this.props.onZoomIn&&null==this.props.onFullscreen?!1:(i={"zoom-out":!0,disabled:null!=this.props.minimumZoomPercent&&this.props.zoomPercent<=this.props.minimumZoomPercent},n={"zoom-in":!0,disabled:null!=this.props.maximumZoomPercent&&this.props.zoomPercent>=this.props.maximumZoomPercent},t={"enable-region-creation":!0,"image-toolbar__item":!0,"item-w-label":!0,disabled:!this.props.canEnableRegionCreation},m.div({className:"preview-toolbar-overlay-container"},m.div({className:"preview-toolbar-overlay",ref:"previewToolbar"},m.div({className:"preview-toolbar-content image-toolbar"},this.props.count>1&&null!=this.props.onPrevious&&null!=this.props.onNext?m.span({className:"flip-buttons image-toolbar__item"},m.div({className:"flip-button flip-button--previous",onClick:this.props.onPrevious},_(l,{group:"web",name:"s_flip_left",alt:h("Previous")})),m.div({className:"nav-text"},this._flipLabelText()),m.div({className:"flip-button flip-button--next",onClick:this.props.onNext},_(l,{group:"web",name:"s_flip_right",alt:h("Next")}))):void 0,null!=this.props.onZoomOut||null!=this.props.onZoomIn?m.span({className:"flip-buttons image-toolbar__item"},null!=this.props.onZoomOut?m.div({className:e(i),onMouseDown:o.partial(this._onZoomMouseDown,this.props.onZoomOut),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},_(l,{group:"web",name:"zoomout",alt:h("Zoom Out")})):void 0,null!=this.props.onZoomOriginalOrFit?_(u,{content:this._zoomToolTipText(),position:u.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},m.div({ref:"zoomLabel",className:"zoom-label",onClick:this.props.onZoomOriginalOrFit},this._getZoomLabel())):void 0,null!=this.props.onZoomIn?m.div({className:e(n),onMouseDown:o.partial(this._onZoomMouseDown,this.props.onZoomIn),onMouseUp:this._onZoomMouseUp,onMouseLeave:this._onZoomMouseLeave},_(l,{group:"web",name:"zoom",alt:h("Zoom In")})):void 0):void 0,null!=this.props.onFullscreen?m.div({className:"fullscreen image-toolbar__item item-w-label",onClick:this.props.onFullscreen},_(l,{group:"web",name:"fullscreen",alt:h("Fullscreen")}),m.span({className:"item-w-label__label"},h("Fullscreen"))):void 0,c.ALLOW_VIEW_ANNOTATE_MODES?m.div({className:e(t),onClick:this.props.canEnableRegionCreation?this.props.onRegionCreationClick:void 0},_(l,{group:"web",name:"ic_comment_area_large",alt:h("Comment on specific areas")}),m.span({className:"item-w-label__label"},h("Comment"))):void 0)))):!1}})})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/api_v2/client",["jquery","external/underscore","modules/clean/api_v2/error","modules/clean/devtools/perf_hub_actions","external/rsvp","modules/constants/debug","modules/constants/env","modules/constants/request","modules/core/cookies","modules/core/notify","modules/core/uri"],function(t,n,o,i,r,s,a,l,u,c,d){var p,h,_,m,f,g,v,y;return p=o.ApiError,m=r.Promise,y=a.WEBSERVER,_=l.JS_CSRF_COOKIE,f=l.REQUEST_ID,h=function(){function e(){}return e.prototype.rpc=function(e,o,r,a){var l,c;return null==r&&(r=null),null==a&&(a=null),l=u.read(_)||"",c={"X-Dropbox-Uid":e,"X-CSRF-Token":l},n.extend(c,a),new m(function(e,n){var a;return a=d({scheme:"https",authority:y,path:"/2/"+o}),s.CPROFILE_ENABLED&&a.setQuery({cProfile:s.CPROFILE_PARAMETER,parent_request_id:f}),t.ajax({type:"POST",url:a.toString(),contentType:"application/json",headers:c,data:JSON.stringify(r)}).done(function(t,n,o){return s.CPROFILE_ENABLED&&i.add_ajax_profile({xhr:o,url:a.path}),e(null!=o.responseText?JSON.parse(o.responseText):null)}).fail(function(e){return n(p.parseResponse(e.status,e.getAllResponseHeaders(),e.responseText))})})},e}(),v=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.rpc=function(e,t,o,i){var r;return null==o&&(o=null),null==i&&(i=!0),r=n.__super__.rpc.apply(this,arguments),r.catch(function(e){return i&&c.error(e.message||c.DEFAULT_ERROR),m.reject(e)})},n}(h),g=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.rpc=function(e,t,o,i,r){var s;return null==o&&(o=null),null==i&&(i=null),null==r&&(r=!1),s=n.__super__.rpc.apply(this,arguments),s.catch(function(e){var t,n;return t=null!=(n=e.error)?n.admin_console_error:void 0,t||(t=e.message||c.DEFAULT_ERROR),r&&c.error(t),m.reject(e)})},n}(h),{ApiV2Client:h,UserActionClient:v,TeamActionsClient:g}})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,n){function o(){this.constructor=t}for(var i in n)e.call(n,i)&&(t[i]=n[i]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t};define("modules/clean/api_v2/error",["modules/core/i18n"],function(n){var o,i,r,s,a,l,u,c;return u=n._,o=function(){function t(){}return t.parseResponse=function(n,o,c,d){var p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P;null==d&&(d=null),null==d&&(d=function(){switch(n){case 400:return s;case 401:return r;case 409:return i;case 429:return a;default:return n>=500?l:t}}()),w={raw:{status:n,headerString:o,responseBody:c}};try{g=JSON.parse(c)||{},w.error=g.error,w.summary=g.error_summary,b=(null!=(T=g.user_message)?T.text:void 0)||""}catch(e){p=e,w.error=null,w.summary=null,b=""}if(429===n&&(b=b||u("Folder updates in progress — please try again later.")),w.headers={},null!=o)for(S=o.split("\n"),f=0,E=S.length;E>f;f++)h=S[f],h.length>0&&(C=h.split(": "),y=C[0],P=C[1],w.headers[y]=P);_=new d(b);for(v in w)e.call(w,v)&&(I=w[v],_[v]=I);return _},t}(),s=function(e){function n(e){this.message=e}return t(n,e),n}(o),r=function(e){function n(e){this.message=e}return t(n,e),n}(o),i=function(e){function n(e){this.message=e}return t(n,e),n}(o),a=function(e){function n(e){this.message=e}return t(n,e),n.prototype.getRetryAfter=function(){var e;return null!=(e=this.headers)?e["retry-after"]:void 0},n}(o),l=function(e){function n(e){this.message=e}return t(n,e),n}(o),c=function(e){return function(t){if(t instanceof o)return e(t);throw t}},{catchApiError:c,ApiError:o,AppError:i,AuthError:r,BadRequestError:s,RateLimitError:a,ServerError:l}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/api_v2/types",["external/underscore","modules/clean/datetime"],function(t,n){var o,i,r,s,a,l;return a=n.format_date_utc,o=function(){function e(e,t){this.type=e,this.value=t}return e.parse=function(e){var t;return t=e[".tag"],2===Object.keys(e).length&&null!=e[t]?new i(t,e[t]):new r(t,e)},e}(),i=function(t){function n(e,t){this.type=e,this.value=null!=t?t:null,this.isScalar=!0}return e(n,t),n.prototype.toJSON=function(){var e;return e={".tag":this.type},null!=this.value&&(e[this.type]=this.value),e},n}(o),r=function(n){function o(e,t){this.type=e,this.value=null!=t?t:{},this.isScalar=!1}return e(o,n),o.prototype.toJSON=function(){var e;return e={".tag":this.type},t.extend(e,this.value),e},o}(o),l="yyyy-MM-ddTHH:mm:ssZ",s=function(e){return a(e,l)},{formatTimestamp:s,Union:o,UnionScalar:i,UnionStruct:r}})}.call(this),function(){define("modules/clean/avatar/avatar_with_default",["external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/css"],function(e,t,n,o){var i,r,s,a;return s=n.VALID_AVATAR_DIMENSIONS,a=e.DOM,r=e.createFactory(t),i=e.createClass({displayName:"AvatarWithDefault",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(s).isRequired,defaultAvatar:e.PropTypes.element.isRequired,onPhotoClick:e.PropTypes.func,photoUrl:e.PropTypes.string,optionalClass:e.PropTypes.string,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){
return o.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},render:function(){return null!=this.props.photoUrl?r({alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photoUrl:this.props.photoUrl,optionalClass:this.props.optionalClass,shape:this.props.shape}):this.props.defaultAvatar}})})}.call(this),function(){define("modules/clean/avatar/contact_avatar",["external/react","modules/core/i18n","modules/core/user_i18n","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/contacts/data","modules/clean/contacts/types"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h;return p=t._,l=r.AVATAR_DIMENSION_BY_SIZE,d=r.VALID_AVATAR_DIMENSIONS,u=s.Contact,h=e.createElement,c=e.createClass({displayName:"ContactAvatar",propTypes:{dimension:e.PropTypes.oneOf(d).isRequired,contact:e.PropTypes.instanceOf(u).isRequired,optionalClass:e.PropTypes.string},render:function(){var e,t,r,s,u,c,d;return r=this.props.contact,u=r.name||r.email,c=r.photo_url,r.type===a.FB&&(c="https://graph.facebook.com/"+r.fb_id+"/picture"),s="",this.props.dimension!==l.XSMALL&&(s=n.getInitials(u)),r.type===a.NEW_STYLE_GROUP?(e=p("Group"),d="SQUARE"):(e=p("User"),d="CIRCLE"),t={alt:e,dimension:this.props.dimension,photoUrl:c,shape:d,optionalClass:this.props.optionalClass,defaultAvatar:h(i,{alt:e,dimension:this.props.dimension,name:u,initials:s,shape:d,optionalClass:this.props.optionalClass})},h(o,t)}})})}.call(this),function(){define("modules/clean/avatar/faceholder",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css","modules/clean/react/image","modules/clean/static_urls"],function(e,t,n,o,i,r){var s,a,l,u,c;return a=t.VALID_AVATAR_DIMENSIONS,u=n.getClassName,c=r.static_url,l=e.DOM,s=e.createClass({displayName:"Faceholder",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(a).isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},statics:{SRC_MAP:{16:c("/static/images/avatar/faceholder-16-vflzvFMED.png"),24:c("/static/images/avatar/faceholder-24-vflpqFBTK.png"),32:c("/static/images/avatar/faceholder-32-vflKWtuU5.png"),48:c("/static/images/avatar/faceholder-48-vfll8Voom.png"),64:c("/static/images/avatar/faceholder-64-vflHTEplh.png")},SRC_HI_RES_MAP:{16:c("/static/images/avatar/faceholder-16@2x-vflBZ7FgU.png"),24:c("/static/images/avatar/faceholder-24@2x-vflVegRLu.png"),32:c("/static/images/avatar/faceholder-32@2x-vflYmh947.png"),48:c("/static/images/avatar/faceholder-48@2x-vflUglZDR.png"),64:c("/static/images/avatar/faceholder-64@2x-vfl8eFSM8.png")}},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},render:function(){var t,n;return t=["c-avatar--circle"],this.props.optionalClass&&t.push(this.props.optionalClass),n=e.createElement(i,{alt:this.props.alt||"",src:s.SRC_MAP[this.props.dimension],srcHiRes:s.SRC_HI_RES_MAP[this.props.dimension]}),null!=this.props.onClick&&this.props.alt?(t.push("u-unbutton"),l.button({className:u(this.props.dimension,t),onClick:this.props.onClick},n)):l.div({className:u(this.props.dimension,t),onClick:this.props.onClick},n)}})})}.call(this),function(){define("modules/clean/avatar/initials_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style","modules/clean/css"],function(e,t,n,o){var i,r,s,a;return r=t.VALID_AVATAR_DIMENSIONS,a=n.getClassName,s=e.DOM,i=e.createClass({displayName:"InitialsAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(r).isRequired,initials:e.PropTypes.string.isRequired,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"]).isRequired,color:e.PropTypes.string,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string},componentDidMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},render:function(){var e;return e=["c-avatar--no-img","c-avatar--"+this.props.shape.toLowerCase()],null!=this.props.optionalClass&&e.push(this.props.optionalClass),null!=this.props.onClick&&this.props.alt?(e.push("u-unbutton"),s.button({className:a(this.props.dimension,e),onClick:this.props.onClick,style:this.getContainerStyle()},s.span({"aria-hidden":!0},this.props.initials),s.span({className:"ax-visually-hidden"},this.props.alt))):s.div({className:a(this.props.dimension,e),onClick:this.props.onClick,style:this.getContainerStyle()},this.props.alt?[s.span({"aria-hidden":!0},this.props.initials),s.span({className:"ax-visually-hidden"},this.props.alt)]:this.props.initials)},getContainerStyle:function(){var e;return e={},this.props.color&&(e.backgroundColor=this.props.color),e}})})}.call(this),function(){define("modules/clean/avatar/initials_avatar_with_color",["jquery","external/react","modules/clean/avatar/initials_avatar","modules/clean/avatar/style"],function(e,t,n,o){var i,r,s;return s=o.colorValueForAvatarName,r=t.createElement,i=t.createClass({displayName:"InitialsAvatarWithColorDerivedFromName",propTypes:{name:t.PropTypes.string.isRequired},render:function(){var t;return t=e.extend({color:s(this.props.name)},this.props),delete t.name,r(n,t)}})})}.call(this),function(){define("modules/clean/avatar/photo_avatar",["external/react","modules/clean/avatar/size","modules/clean/avatar/style"],function(e,t,n){var o,i,r,s,a;return i=t.VALID_AVATAR_DIMENSIONS,s=n.dynamicInlineStyle,a=n.getClassName,r=e.DOM,o=e.createClass({displayName:"PhotoAvatar",propTypes:{alt:e.PropTypes.string,dimension:e.PropTypes.oneOf(i).isRequired,photoUrl:e.PropTypes.string.isRequired,onClick:e.PropTypes.func,optionalClass:e.PropTypes.string,shape:e.PropTypes.oneOf(["CIRCLE","SQUARE"])},getDefaultProps:function(){return{shape:"CIRCLE"}},render:function(){var e,t;return e=["c-avatar--"+this.props.shape.toLowerCase()],null!=this.props.optionalClass&&e.push(this.props.optionalClass),t=r.img({alt:this.props.alt||"",src:this.props.photoUrl,width:this.props.dimension,height:this.props.dimension}),null!=this.props.onClick&&this.props.alt?(e.push("u-unbutton"),r.button({className:a(this.props.dimension,e),onClick:this.props.onClick},t)):r.div({className:a(this.props.dimension,e),onClick:this.props.onClick},t)}})})}.call(this),function(){define("modules/clean/avatar/size",[],function(){var e,t,n;return e={XSMALL:16,SMALL:24,MEDIUM:32,LARGE:48,XLARGE:64},t=function(){var t;t=[];for(n in e)t.push(e[n]);return t}(),{AVATAR_DIMENSION_BY_SIZE:e,VALID_AVATAR_DIMENSIONS:t}})}.call(this),function(){define("modules/clean/avatar/stacked_avatars",["external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/css","modules/core/user_i18n"],function(e,t,n,o,i,r){var s,a,l,u,c;return a=o.VALID_AVATAR_DIMENSIONS,u=e.DOM,c=e.PropTypes,l=e.createElement,s=e.createClass({displayName:"StackedAvatars",propTypes:{user_front:c.object.isRequired,user_back:c.object.isRequired,dimension:c.oneOf(a).isRequired,optionalClass:c.string,shape:c.oneOf(["CIRCLE","SQUARE"]).isRequired},getDefaultProps:function(){return{shape:"CIRCLE"}},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},render:function(){var e,o;return e="stacked-avatar-bottom",o="stacked-avatar-top",this.props.optionalClass&&(e+=" "+this.props.optionalClass,o+=" "+this.props.optionalClass),u.div({className:"stacked-avatars-section u-l-ib"},l(t,{dimension:this.props.dimension,photoUrl:this.props.user_back.avatar_url,optionalClass:e,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_back.display_name||this.props.user_back.email,initials:r.getInitials(this.props.user_back.display_name||this.props.user_back.email),shape:this.props.shape,optionalClass:e})}),l(t,{dimension:this.props.dimension,photoUrl:this.props.user_front.avatar_url,optionalClass:o,defaultAvatar:l(n,{dimension:this.props.dimension,name:this.props.user_front.display_name||this.props.user_front.email,initials:r.getInitials(this.props.user_front.display_name||this.props.user_front.email),shape:this.props.shape,optionalClass:o})}))}})})}.call(this),function(){define("modules/clean/avatar/style",["external/classnames","external/react","modules/clean/accessibility/utils"],function(e,t,n){var o,i,r,s;return i=n.accessibleColorPalette,o={16:"c-avatar--xs",24:"c-avatar--s",32:"c-avatar--m",48:"c-avatar--l",64:"c-avatar--xl"},r=function(e){var t,n;for(null==e&&(e=""),t=5381*e.length,n=0;n<e.length;)t=e.charCodeAt(n)+((t<<6)+(t<<16)-t),n++;return t=Math.abs(t),i[t%i.length]},s=function(t,n){var i;return null==t&&(t=32),null==n&&(n=[]),i=["c-avatar",o[t]],n=n.concat(i),e.apply(this,n)},{colorValueForAvatarName:r,getClassName:s}})}.call(this),function(){define("modules/clean/avatar/viewer_avatar",["jquery","external/react","modules/clean/avatar/photo_avatar","modules/clean/avatar/size","modules/clean/css","modules/core/uri"],function(e,t,n,o,i,r){var s,a,l,u,c;return a=o.VALID_AVATAR_DIMENSIONS,u=t.createElement,c=t.DOM,s=t.createFactory(n),l=t.createClass({displayName:"ViewerAvatar",propTypes:{alt:t.PropTypes.string,dimension:t.PropTypes.oneOf(a).isRequired,defaultAvatar:t.PropTypes.element.isRequired,onPhotoClick:t.PropTypes.func,photoUrl:t.PropTypes.string,optionalClass:t.PropTypes.string},getInitialState:function(){return{photoUrl:this.props.photoUrl}},componentDidMount:function(){return i.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css"),e(document).on("db:account_photo:photo_set",function(e){return function(t,n){var o,i,s;return o=2*e.props.dimension,s=o+"x"+o,i=r.parse(n.saved_photo_url).updateQuery({size:s}).toString(),e.setState({photoUrl:i})}}(this)),e(document).on("db:account_photo:photo_deleted",function(e){return function(t){return e.setState({photoUrl:null})}}(this))},render:function(){return null!=this.state.photoUrl?s({alt:this.props.alt,dimension:this.props.dimension,onClick:this.props.onPhotoClick,photoUrl:this.state.photoUrl,optionalClass:this.props.optionalClass}):this.props.defaultAvatar}})})}.call(this),function(){define("modules/clean/average_counter",[],function(){var e;return e=function(){function e(){this.average=0,this.count=0}return e.prototype.getAverage=function(){return this.average},e.prototype.add=function(e){return this.average=(this.average*this.count+e)/(this.count+1),this.count++},e.prototype.addArray=function(e){var t,n;return t=e.reduce(function(e,t){return e+t}),n=this.count+e.length,this.average=(this.average*this.count+t)/n,this.count=n},e}()})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/beacon",["external/underscore","jquery","modules/clean/beacon_nodeps","modules/clean/bolt_nodeps","modules/constants/env","modules/core/exception"],function(t,n,o,i,r,s){var a,l;return l=function(o){function i(e,o,a){this._token=e,this._authn_cb=o,this._authz_cb=a,i.__super__.constructor.call(this,this._token,this._authn_cb,this._authz_cb,r.BEACON_SERVER,n.ajax,t,s)}return e(i,o),i}(o.Transmitter),a=function(o){function a(e,o,l){a.__super__.constructor.call(this,e,o,l,i,r.THUNDER_SERVER,n.ajax,t,s)}return e(a,o),a}(o.Receiver),{Agent:o.Agent,AgentStatus:o.AgentStatus,Platforms:o.Platforms,PresenceParams:o.PresenceParams,PresenceType:o.PresenceType,Receiver:a,Source:o.Source,Transmitter:l,UserAppPresence:o.UserAppPresence,UserContextPresence:o.UserContextPresence}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/beacon_nodeps",[],function(){var t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S;return i=5e3,r=12e4,u=6e4,c="invalid_agent",t="authorization_error",d=32,f=64,p=64,m=32,h=128,_=32,s="-",a="|",g={WEB:0,IOS:1,ANDROID:2,DESKTOP:3},b=function(){function e(e,t,n){var o,i,r,s;this.platform=e,this.surface=t,this.identifier=null!=n?n:null,i=!1;for(o in g)if(s=g[o],this.platform===s){i=!0;break}if(!i)throw new Error("platform must be from Beacon.Platforms");if(this.surface.length>m||0===this.surface.length)throw new Error("surface must be populated and <= "+m+" chars.");if((null!=(r=this.identifier)?r.length:void 0)>h)throw new Error("identifier must be <= "+h+" chars.");null===this.identifier&&(this.identifier="")}return e.from_json=function(t){return new e(t.platform,t.surface,t.identifier)},e}(),n=function(){function e(e,t,n,o){if(this.user_id=e,this.app=t,this.context=n,this.source=o,this.user_id.length>f)throw new Error("user_id must be <= "+f+" chars.");if(this.app.length>d||0===this.app.length)throw new Error("app must be populated and <= "+d+" chars.");if(this.context.length>p||0===this.context.length)throw new Error("context must be populated and <= "+p+" chars.")}return e.from_json=function(t){var n;return n=b.from_json(t.source),new e(t.user_id,t.app,t.context,n)},e}(),o=function(){function e(e,t,n){if(this.agent=e,this.status=t,this.auth_key=null!=n?n:null,this.status.length>_)throw new Error("status must be <= "+_+" chars")}return e.from_json=function(t){return new e(n.from_json(t.agent),t.status)},e}(),y={UserContext:"UserContext",UserApp:"UserApp",Context:"Context"},v=function(){function e(e,t,n,o,i){var r,s;if(this.type=e,this.user_id=t,this.app=n,this.context=o,this.token=i,this.type!==y.UserContext&&this.type!==y.UserApp&&this.type!==y.Context)throw new Error("Unsupported type: "+this.type+".");if((null!=(r=this.user_id)?r.length:void 0)>f)throw new Error("user_id must be <= "+f+" chars.");if(this.app.length>d)throw new Error("app must be <= "+d+" chars.");if((null!=(s=this.context)?s.length:void 0)>p)throw new Error("context must be <= "+p+" chars.")}return e}(),S=function(){function e(e,t){this.presence_params=e,this.agents=t}return e}(),T=function(){function e(e,t){this.presence_params=e,this.status=t}return e.Status={Offline:1,Online:2},e}(),l=function(){function e(e,t,n){this.presence_params=e,this.snapshot=t,this.delta=n}return e}(),w=function(){function o(t,n,o,i,r,s,a){this._token=t,this._authn_cb=n,this._authz_cb=o,this._beacon_server=i,this._ajax=r,this._u=s,this._exclog=null!=a?a:null,this._handle_heartbeat_error=e(this._handle_heartbeat_error,this),this._handle_heartbeat_success=e(this._handle_heartbeat_success,this),this._heartbeat=e(this._heartbeat,this),this._started=!1,this._heartbeat_xhr=null,this._timeout_id=null,this._presence_data=[],this._offline_agents=[],this._has_changes=!1}return o.prototype.start=function(){return this._started?void 0:(this._backoff_window=i,this._started=!0,this._has_changes=!1,this._heartbeat())},o.prototype.stop=function(){return this._started=!1,this._heartbeat_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},o.prototype.add_or_update_agents=function(e){var t,n,o;for(n=0,o=e.length;o>n;n++)t=e[n],this._has_changes|=this._add_or_update_agent(t);if(!this._heartbeat_xhr&&this._started)return window.clearTimeout(this._timeout_id),this._timeout_id=window.setTimeout(this._heartbeat,0)},o.prototype.update_token=function(e){this._token=e},o.prototype._add_or_update_agent=function(e){var t,n,o,i,r;for(r=this._presence_data,n=t=0,o=r.length;o>t;n=++t)if(i=r[n],this._u.isEqual(i.agent,e.agent))return i.status!==e.status||i.auth_key!==e.auth_key?(this._presence_data[n]=e,!0):!1;return this._presence_data.push(e),!0},o.prototype._heartbeat=function(){return this._started&&0!==this._presence_data.length?(this._offline_agents=this._presence_data.filter(function(e){return""!==e.status}).map(function(e){return e.agent}),this._has_changes=!1,this._heartbeat_xhr=this._ajax({url:"https://"+this._beacon_server+"/1/update",type:"POST",data:JSON.stringify({token:this._token,updates:this._presence_data}),contentType:"application/json; charset=utf-8",dataType:"json",timeout:5e3,success:this._handle_heartbeat_success,error:this._handle_heartbeat_error,xhrFields:{withCredentials:!0}})):void 0},o.prototype._handle_heartbeat_success=function(e,o,r){var s,a,l,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C;if(this._heartbeat_xhr=null,this._started){for(d=[],w=e.agent_errors||[],_=0,v=w.length;v>_;_++)a=w[_],p=a.error,s=n.from_json(a.agent),p===t?d.push(s):p===c&&null!=(T=this._exclog)&&T.raiseAndReport("Input error: "+a),this._presence_data=this._presence_data.filter(function(e){return function(t){return!e._u.isEqual(t.agent,s)}}(this));for(d.length&&window.setTimeout(function(e){return function(){return e._authz_cb(d)}}(this),0),S=this._offline_agents,f=0,y=S.length;y>f;f++)for(b=S[f],C=this._presence_data,m=g=0,E=C.length;E>g;m=++g)if(l=C[m],this._u.isEqual(l.agent,b)&&""===l.status){this._presence_data.splice(m,1);break}return h=this._has_changes?0:u,this._backoff_window=i,this._timeout_id=window.setTimeout(this._heartbeat,h)}},o.prototype._handle_heartbeat_error=function(e,t,n){var o,i;if(this._heartbeat_xhr=null,this._started){if(e.status>=400&&e.status<500){if(401===e.status)return window.setTimeout(this._authn_cb,0),void this.stop();400===e.status&&null!=(i=this._exclog)&&i.raiseAndReport("Bad request: "+e.responseText)}return o=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,r),this._timeout_id=window.setTimeout(this._heartbeat,o)}},o}(),E=function(){function t(t,n,o,i,r,s,a,l){var u,c;this._presence_params=t,this._update_callback=n,this._refresh_callback=o,this._bolt=i,this._thunder_hostname=r,this._ajax=s,this._u=a,this._exclog=null!=l?l:null,this._on_refresh=e(this._on_refresh,this),this._on_update=e(this._on_update,this),this._compact_context_updates=e(this._compact_context_updates,this),u=function(){var e,t,n,o;for(n=this._presence_params,o=[],e=0,t=n.length;t>e;e++)c=n[e],o.push(this._presence_params_to_bolt_channel(c));return o}.call(this),this._thunder_client=new this._bolt.ThunderClient(u,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog)}return t.prototype.start=function(){return this._thunder_client.start()},t.prototype.stop=function(){return this._thunder_client.unsubscribe()},t.prototype.add_presence_params=function(e){var t,n,o;return o=this._presence_params.length,this._presence_params=this._u.union(e,this._presence_params),this._presence_params.length===o?!1:(this._thunder_client.unsubscribe(),t=function(){var e,t,o,i;for(o=this._presence_params,i=[],e=0,t=o.length;t>e;e++)n=o[e],i.push(this._presence_params_to_bolt_channel(n));return i}.call(this),this._thunder_client=new this._bolt.ThunderClient(t,this._on_update,this._on_refresh,this._thunder_hostname,this._ajax,this._u,this._exclog),this._thunder_client.start(),!0)},t.prototype._presence_params_to_bolt_channel=function(e){switch(e.type){case y.UserContext:return new this._bolt.SignedChannelState("beacon_uc"+s+e.app,""+e.user_id+a+e.context,"0",e.token);case y.UserApp:return new this._bolt.SignedChannelState("beacon_ua"+s+e.app,e.user_id,"0",e.token);case y.Context:return new this._bolt.SignedChannelState("beacon_c"+s+e.app,e.context,"0",e.token);default:throw new Error("Unknown type: "+e.type)}},t.prototype._bolt_channel_to_presence_params=function(e){var t,n,o,i,r,l;if(n=e.app_id.split(s),r=e.unique_id.split(a),2!==n.length)throw new Error("Unexpected format of Bolt app_id: "+e.app_id+".");switch(t=n[1],l="",o="",n[0]){case"beacon_uc":if(2!==r.length)throw new Error("Unexpected format of beacon_uc: "+e.unique_id+".");i=y.UserContext,l=r[0],o=r[1];break;case"beacon_ua":if(1!==r.length)throw new Error("Unexpected format of beacon_ua: "+e.unique_id+".");i=y.UserApp,l=r[0];break;case"beacon_c":if(1!==r.length)throw new Error("Unexpected format of beacon_c: "+e.unique_id+".");i=y.Context,o=r[0];break;default:throw new Error("Unknown Bolt app_id: "+e.app_id+".")}return new v(i,l,t,o,null)},t.prototype._compact_context_updates=function(e,t){var n,o,i,r,s,a,u,c,d,p,h,_,m,f,g,v;for(a=!1,n=[],r=0,d=t.length;d>r;r++)if(v=t[r],null!=v.snapshot)a=!0,n=v.snapshot;else if(null!=v.delta)for(f=v.delta,u=0,p=f.length;p>u;u++){for(_=f[u],i=!1,s=c=0,h=n.length;h>c;s=++c)if(m=n[s],this._u.isEqual(m.agent,_.agent)){i=!0,n[s]=_;break}i||n.push(_)}return a?(g=n,o=null):(g=null,o=n),new l(e,g,o)},t.prototype._on_update=function(e){var t,i,r,s,a,l,u,c,d,p,h,_,m;for(m=[],u=0,d=e.length;d>u;u++)s=e[u],a=s.channel_state,r=new this._bolt.ChannelId(a.app_id,a.unique_id),c=this._bolt_channel_to_presence_params(r),m.push(function(){switch(c.type){case y.UserContext:return h=s.payloads.slice(-1)[0].payload,i=null!=h.agents?function(){var e,n,i,r;for(i=h.agents,r=[],e=0,n=i.length;n>e;e++)t=i[e],r.push(o.from_json(t));return r}():[],new S(c,i);case y.UserApp:return h=s.payloads.slice(-1)[0].payload,new T(c,h.status);case y.Context:return l=function(e){var i;return i=b.from_json(e.source),t=new n(e.user_id,c.app,c.context,i),new o(t,e.status)},p=function(e){var t,n,o;return{snapshot:null!=(null!=(n=e.snapshot)?n.agents:void 0)?function(){var n,o,i,r;for(i=e.snapshot.agents,r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(l(t));return r}():void 0,delta:null!=(null!=(o=e.delta)?o.agents:void 0)?function(){var n,o,i,r;for(i=e.delta.agents,r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(l(t));return r}():void 0}},_=function(){var e,t,n,o;for(n=s.payloads,o=[],e=0,t=n.length;t>e;e++)h=n[e],o.push(p(h.payload));return o}(),this._compact_context_updates(c,_)}}.call(this));return this._update_callback(m)},t.prototype._on_refresh=function(e){var t;return this._refresh_callback(function(){var n,o,i;for(i=[],n=0,o=e.length;o>n;n++)t=e[n],i.push(this._bolt_channel_to_presence_params(t));return i}.call(this))},t}(),{Agent:n,AgentStatus:o,Platforms:g,PresenceParams:v,PresenceType:y,Receiver:E,Source:b,Transmitter:w,UserAppPresence:T,UserContextPresence:S}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/bolt",["jquery","external/underscore","modules/clean/bolt_nodeps","modules/constants/env","modules/core/exception"],function(t,n,o,i,r){var s,a;return s=function(o){function s(e,o,a){s.__super__.constructor.call(this,e,o,a,i.BOLT_SERVER,t.ajax,n,r)}return e(s,o),s}(o.BoltClient),a=function(o){function s(e,o,a){s.__super__.constructor.call(this,e,o,a,i.THUNDER_SERVER,t.ajax,n,r)}return e(s,o),s}(o.ThunderClient),{BoltClient:s,ThunderClient:a,ChannelId:o.ChannelId,SignedChannelState:o.SignedChannelState,Payload:o.Payload,ChannelPayloads:o.ChannelPayloads}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/bolt_nodeps",[],function(){var n,o,i,r,s,a,l,u,c,d,p;return n=1e3,o=3e5,l="/2/notify/subscribe",u="/2/payloads/subscribe",s=function(){function e(e,t){this.app_id=e,this.unique_id=t}return e}(),d=function(){function e(e,t,n,o){this.app_id=e,this.unique_id=t,this.revision=n,this.token=o}return e}(),c=function(){function e(e,t){this.revision=e,this.payload=t}return e}(),a=function(){function e(e,t){this.channel_state=e,this.payloads=t}return e}(),i=function(){function t(t,o,i,r,s,a,l){this._update_callback=o,this._refresh_callback=i,this._hostname=r,this._ajax=s,this._u=a,this._exclog=null!=l?l:null,this._handle_poll_error=e(this._handle_poll_error,this),this._handle_poll_success=e(this._handle_poll_success,this),this._must_find_state=e(this._must_find_state,this),this._long_poll=e(this._long_poll,this),this._find_state=e(this._find_state,this),this._signed_channel_states=[],this._started=!1,this._sequence_num=0,this._backoff_window=n,this._additional_headers={},this._timeout_id=null,this.update_states(t)}return t.prototype._encode_channel_state=function(e){return{channel_id:{app_id:e.app_id,unique_id:e.unique_id},revision:e.revision,token:e.token}},t.prototype._decode_channel_state=function(e){return new d(e.channel_id.app_id,e.channel_id.unique_id,e.revision,e.token)},t.prototype._decode_channel_id=function(e){return new s(e.app_id,e.unique_id)},t.prototype._compare_revisions=function(e,t){var n,o,i;return n=Math.max(e.length,t.length),o=Array(n-e.length+1).join("0")+e,i=Array(n-t.length+1).join("0")+t,i>o?-1:o>i?1:0},t.prototype._find_state=function(e){return this._u.find(this._signed_channel_states,function(t){return function(n){return t._u.isEqual(e,n.channel_id)}}(this))},t.prototype.update_states=function(e){var t,n,o,i,r;for(r=[],t=0,n=e.length;n>t;t++)i=e[t],i=this._encode_channel_state(i),o=this._find_state(i.channel_id),null==o?r.push(this._signed_channel_states.push(i)):this._compare_revisions(i.revision,o.revision)>=0?(o.revision=i.revision,r.push(o.token=i.token)):r.push(void 0);return r},t.prototype.start=function(){return this._started?void 0:(this._started=!0,this._long_poll())},t.prototype.unsubscribe=function(){return this._started=!1,null!=this._long_poll_xhr&&this._long_poll_xhr.abort(),this._long_poll_xhr=null,window.clearTimeout(this._timeout_id),this._timeout_id=null},t.prototype._long_poll=function(){var e;return this._sequence_num++,e=this._sequence_num,this._long_poll_xhr=this._ajax({url:this._subscribe_url(),type:"POST",data:JSON.stringify({channel_states:this._signed_channel_states}),contentType:"application/json; charset=utf-8",headers:this._additional_headers,dataType:"json",timeout:12e4,success:function(t){return function(n,o,i){return t._handle_poll_success(e,n,o,i)}}(this),error:function(t){return function(n,o){return t._handle_poll_error(e,n,o)}}(this),xhrFields:{withCredentials:!0}})},t.prototype._must_find_state=function(e){var t,n,o;return n=this._find_state(e),null==n&&(t="Bolt returned unknown channel id "+e,null!=(o=this._exclog)&&o.raiseAndReport(t)),n},t.prototype._handle_poll_data=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.raiseAndReport(e):void 0},t.prototype._subscribe_url=function(){return"https://"+this._hostname+this._subscribe_endpoint()},t.prototype._subscribe_endpoint=function(){var e,t;return e="Method must be implemented.",null!=(t=this._exclog)?t.raiseAndReport(e):void 0},t.prototype._handle_poll_success=function(e,t,o,i){var r,s,a;if(e===this._sequence_num&&(this._long_poll_xhr=null,this._started))return a=this._handle_poll_data(t,o,i),a.length>0&&this._u.defer(this._update_callback,a),(null!=(s=t.invalid_channels)?s.length:void 0)>0?void this._u.defer(this._refresh_callback,function(){var e,n,o,i;for(o=t.invalid_channels,i=[],e=0,n=o.length;n>e;e++)r=o[e],i.push(this._decode_channel_id(r));return i}.call(this)):(this._backoff_window=n,this._timeout_id=window.setTimeout(this._long_poll,0))},t.prototype._handle_poll_error=function(e,t,n){var i;if(e===this._sequence_num&&(this._long_poll_xhr=null,this._started))return i=Math.random()*this._backoff_window,this._backoff_window=Math.min(2*this._backoff_window,o),window.setTimeout(this._long_poll,i)},t}(),r=function(n){function o(t,n,i,r,s,a,l){null==l&&(l=null),this._handle_poll_data=e(this._handle_poll_data,this),o.__super__.constructor.call(this,t,n,i,r,s,a,l)}return t(o,n),o.prototype._subscribe_endpoint=function(){return l},o.prototype._handle_poll_data=function(e,t,n){var o,i,r,s,a,l;if(l=[],null!=e.channel_states)for(a=e.channel_states,o=0,i=a.length;i>o;o++)s=a[o],r=this._must_find_state(s.channel_id),this._compare_revisions(s.revision,r.revision)>0&&(r.revision=s.revision,r.token=s.token,l.push(this._decode_channel_state(s)));return l},o}(i),p=function(n){function o(t,n,i,r,s,a,l){null==l&&(l=null),this._handle_poll_data=e(this._handle_poll_data,this),o.__super__.constructor.call(this,t,n,i,r,s,a,l)}var i;return t(o,n),i="X-Bolt-Session",o.prototype.unsubscribe=function(){return this._additional_headers[i]=null,o.__super__.unsubscribe.call(this)},o.prototype._subscribe_endpoint=function(){return u},o.prototype._handle_poll_data=function(e,t,n){var o,r,s,l,u,d,p,h,_,m,f,g,v;if(v=[],this._additional_headers={},this._additional_headers[i]=n.getResponseHeader(i),null!=e.channel_payloads)for(f=e.channel_payloads,s=0,u=f.length;u>s;s++){for(o=f[s],h=o.channel_state,p=this._must_find_state(h.channel_id),r=this._decode_channel_state(o.channel_state),m=[],g=o.payloads,l=0,d=g.length;d>l;l++)_=g[l],this._compare_revisions(_.revision,p.revision)>0&&m.push(new c(_.revision,_.payload));m.length>0&&v.push(new a(r,m)),this._compare_revisions(h.revision,p.revision)>0&&(p.revision=h.revision,p.token=h.token)}return v},o}(i),{BoltClient:r,ThunderClient:p,ChannelId:s,SignedChannelState:d,Payload:c,ChannelPayloads:a}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/browse/browse_drag_utils",["jquery"],function(t){var n;return n={_dragEnabledChecks:[],getDraggedLink:function(n){var o,i,r,s,a,l,u,c;if(null==n)return null;if(a=e.call(n.types,"Files")>=0,o=e.call(n.types,"text/html")>=0&&t(n.getData("text/html")).attr("draggable")||e.call(n.types,"text/uri-list")>=0&&"about:blank"===n.getData("text/uri-list")||e.call(n.types,"Url")>=0&&"about:blank"===n.getData("Url"),a||o)return null;c=null;try{l=n.getData("text/x-moz-url")}catch(e){i=e}if(null!=l&&(u=l.split("\n"),u.length>=1&&(c=u[0])),!c)try{c=n.getData("text/uri-list")}catch(e){i=e}if(!c)try{c=n.getData("Url")}catch(e){}return c||(c=null),c},buildUrlLinkfileContents:function(e){return"[InternetShortcut]\r\nURL="+e+"\r\n"},isFileDragEnabled:function(){var e,t,n,o;for(o=this._dragEnabledChecks,t=0,n=o.length;n>t;t++)if(e=o[t],!e())return!1;return!0},addFileDragEnabledCheck:function(e){return this._dragEnabledChecks.push(e)},removeFileDragEnabledCheck:function(e){var t;return t=this._dragEnabledChecks.indexOf(e),t>=0?this._dragEnabledChecks.splice(t,1):void 0},removeAllFileDragEnabledChecks:function(){return this._dragEnabledChecks=[]}}})}.call(this),function(){define("modules/clean/browse_events",[],function(){var e;return e={RENDER:"db:browse:render",BEFORE_UPDATE:"db:browse:before_update",UPDATE:"db:browse:update",NEW_PAGE:"db:browse:new_page",UPDATE_RENDERED:"db:browse:update_rendered",GA_RENDERED:"db:browse:ga_rendered"}})}.call(this),function(){define("modules/clean/browse_interface",["modules/clean/viewer","modules/constants/env","modules/constants/viewer","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i){var r,s,a,l,u,c,d;return u=t.WEBSERVER,l=n.ROLE_PERSONAL,d=o._,s="/home",c="/work",a="/personal",r={HOME_ROOT:s,WORK_ROOT:c,PERSONAL_ROOT:a,base_prefix:"",get_browse_root:function(t){var n,o,i;return o=a,i=c,n=s,e.get_viewer().is_paired?t.role===l?this.base_prefix+o:this.base_prefix+i:this.base_prefix+n},get_browse_root_name:function(t){return e.get_viewer().is_paired?e.get_root_name(t):d("Files")},get_all_browse_roots:function(){return e.get_viewer().get_users().map(function(e){return{name:r.get_browse_root_name(e),path:r.get_browse_root(e)}})},browse_uri_for_fq_path:function(e,t){return i({scheme:"https",authority:u,path:""+r.get_browse_root(e)+t})},set_base_prefix:function(e){return this.base_prefix=e}}})}.call(this),function(){define("modules/clean/clipboard",["jquery","modules/clean/static_urls","modules/core/dom","external/swfobject"],function(e,t,n,o){var i,r,s,a,l,u;return u=t.static_url,s=function(){var e,t;return e=(new Date).getTime(),t=("00000"+Math.floor(1e6*Math.random())).slice(-6),"swf_"+e+"_"+t},a=function(e,t){return e.on("mouseover",function(){return t.addClass("hovered")}),e.on("mousedown",function(){return t.addClass("pressed")}),e.on("mouseout",function(){return t.removeClass("hovered pressed")}),e.on("mouseup",function(){return t.removeClass("pressed")})},l=function(e,t){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[e]=function(){return t()},"ClipboardSWFRegister."+e},i=function(t,i,r,c){var d,p,h;return null==r&&(r=null),null==c&&(c=null),c=c||e(document.body),h=s(),d=e("<div />",{id:"flash_copy_container"}).append(e("<div />",{id:h})).css({position:"absolute",zIndex:1}),a(d,i),c.append(d),n.clone_position(d,i,{}),p=l(h,r),window.copyLoaded=function(n){
return function(){var n;return n=e("#"+h)[0],n.setCopyText(t),n.setCallbackFunction(p)}}(this),o.embedSWF(u("/static/swf/copy_clipboard-vflvMcZTC.swf"),h,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),d},r={clipboard_overlay:i}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/clipboard_v2",["jquery","external/flash_detect","external/react","modules/core/browser","modules/core/exception","modules/clean/clipboard"],function(t,n,o,i,r,s){var a,l;return l=r.assert,a=function(){function o(t,n,o,i){this.copyText=t,this.onSuccess=n,this.onError=o,this.clickHandler=i,this.do_copy=e(this.do_copy,this)}return o.prototype.setupCopy=function(e,n){var i,r,a;return i=t(n),r=t(e),o.is_flashless_clipboard_supported()?void 0:(a=function(e){return function(){return"function"==typeof e.onSuccess&&e.onSuccess(),"function"==typeof e.clickHandler?e.clickHandler():void 0}}(this),s.clipboard_overlay(this.copyText,r,a,i))},o.prototype.do_copy=function(){var e;if(o.is_supported())return o.is_flashless_clipboard_supported()?(e=document.execCommand("copy",!1),e?"function"==typeof this.onSuccess?this.onSuccess():void 0:"function"==typeof this.onError?this.onError():void 0):void 0},o.is_supported=function(){return o.is_flashless_clipboard_supported()||n.installed},o.is_flashless_clipboard_supported=function(){var e;return e=parseInt(i.version),i.chrome?e>=42:i.mozilla?e>=41:i.opera?e>=29:i.msie?e>=9:i.edge?!0:i.safari?e>=10:!1},o}()})}.call(this),function(){var e=[].slice;define("modules/clean/comments/action_creators",["external/underscore","external/react","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/annotations/annotation","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/logged_out_utils","modules/clean/comments/models/comment","modules/clean/comments/models/comment_activity","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/comments/utils","modules/clean/file_activity/api","modules/clean/file_activity/clients/file_activity_data_source","modules/clean/file_activity/models/file_activity","modules/clean/immutability_helper","external/rsvp","modules/clean/react/file_comments/onboarding","modules/clean/react/file_comments/shared_link_signup_modals","modules/clean/react/file_viewer/actions","modules/clean/react/modal","modules/clean/storage","modules/constants/legacy","modules/constants/comments_panel","modules/core/exception","modules/core/i18n","modules/core/notify"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A){var N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$,J,X,ee,te,ne,oe,ie,re,se,ae,le,ue,ce,de,pe,he,_e;return D=o.EmailVerification,N=r.Annotation,O=a.CommentsEvents,k=u.CommentMetadata,R=c.CommentActivity,oe=d.isRevisionOlderThan,te=d.getFileWithRevision,F=f.FileActivity,se=g.merge,L=v.Promise,M=w.Modal,x=T.LocalStorage,J=I.assert,U=P._,K=function(e,t){var n;return n=m.getInstance().commitOptimisticUpdate(t),e.then(function(e){return m.getInstance().rebase(n),e}),e.catch(function(e){return m.getInstance().rollbackOptimisticUpdate(n),L.reject(e)})},W=function(e){var t,n,o,i,r,s,a,l,u;return u=e.targetActivityKey,r=e.pendingCommentActivity,n=p.state.activity.activity_key,o=u===n?null:u,l=r.comment,a=l.raw_comment_text,t=l.comment_metadata,s=_.addComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:o,text:a,metadata:null!=t?t.toDict():void 0,oref:p.state.oref}),i=m.getInstance().commitOptimisticUpdate(function(e){return e.appendComment(u,r)}),s.then(function(e){var t;return t=m.getInstance(),t.rollbackOptimisticUpdate(i),t.rebase(function(t){return t.appendComment(u,e)})}),[s,i]},V=function(e,t){return se(e,{status:"FAILED",activity_key:t})},H=function(e,t){return null!=e.stickerId||t?new k({revision:t?p.state.activity.latest_revision:void 0,annotation:null!=t?t.toMetadataDict():void 0,sticker_id:e.stickerId}):null},B=function(e){var t,n,o,i,r,s,a,l,u,c,d,_,f;return _=e.targetActivityKey,n=e.body,t=e.annotation,o=h.getActivityUser(p.state.actorId),i=p.state.activity,r=i.activity_key,f=null!=(c=n.text)?c:"",s=H(n,t),l=R.createLocalInstance({commenter:o,rawCommentText:f,metadata:s,status:"POSTING"}),d=W({targetActivityKey:_,pendingCommentActivity:l}),u=d[0],a=d[1],u.catch(function(e){var t;return t=m.getInstance(),t.rollbackOptimisticUpdate(a),t.commitOptimisticUpdate(function(e,t){var n;return n=V(l,t),e.appendComment(_,n)}),L.reject(e)}),l},Y=function(e,t,n){var o,r,s;return o=h.getActivityUser(p.state.actorId),s=p.state.activity.activity_key,o.is_signed_in?o.is_email_verified?!0:(r=D.get_for_user(o),D.set_should_use_simple_ui(!1),r.show_verify_modal(null,i.ADD_COMMENT),!1):(l.saveActionCreator({name:e,fileActivityKey:s,args:t}),O.emit("show-sign-up-modal",{fileActivityKey:s,variant:E.POST_COMMENT_VARIANT}),l.logSignUpModal({fileActivityKey:s,commentActivityKey:n,originType:S.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.POST_BUTTON}),x.set("tmp-file-comment",null),!1)},ae=function(e){var t,n,o,i,r;return r=e.targetActivityKey,n=e.pendingCommentActivity,m.getInstance().rollbackOptimisticUpdate(n.activity_key),n=n.setStatus("POSTING"),i=W({targetActivityKey:r,pendingCommentActivity:n}),o=i[0],t=i[1],o.catch(function(e){var o;return o=m.getInstance(),o.rollbackOptimisticUpdate(t),o.commitOptimisticUpdate(function(e){var o;return o=V(n,t),e.appendComment(r,o)}),L.reject(e)}),s.addedComment()},Q=function(e){var t;if(Y("addFileComment",[e]))return t=p.state.activity.activity_key,B({targetActivityKey:t,body:e}),s.addedComment()},Z=function(e){var t,n;return t=p.state.createAnnotation.annotation,null!=t&&Y("addInlineAnnotation",[e])?(n=B({targetActivityKey:p.state.activity.activity_key,body:e,annotation:t}),q(n),s.addedComment()):void 0},$=function(e){var t,n,o;return o=e.targetActivityKey,t=e.body,Y("addReply",[{targetActivityKey:o,body:t}])?(n=B({targetActivityKey:o,body:t}),q(n),s.addedComment()):void 0},q=function(e){return t.defer(function(){return ue({activityKey:e.activity_key,expandConversation:!1})})},X=function(e){var t,n;return t=e.commentActivityKey,J(null!=p.state.activity.findCommentByKey(t),"Comment activity to delete does not exist: "+t),n=_.deleteComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:t,oref:p.state.oref}),K(n,function(e){return e.purgeCommentByKey(t)})},ce=function(e){var t,n,o,i,r;return n=e.commentActivityKey,r=e.resolved,t=p.state.activity.findCommentByKey(n),J(null!=t,"Comment activity to resolve/unresolve does not exist: "+n),i=_.updateResolveComment({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKey:n,resolved:r,oref:p.state.oref}),o=t.comment.resolved?function(e){return e.unresolveCommentByKey(n)}:function(e){return e.resolveCommentByKey(n)},K(i,o)},pe=function(e){var t,n,o;return t=e.enabled,o=_.updateCommentSetting({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,enableComment:t,oref:p.state.oref}),n=p.state.activity.feedback_off?function(e){return e.enableCommenting()}:function(e){return e.disableCommenting()},K(o,n),t?s.enableCommenting():s.disableCommenting()},de=function(t){var n,o,r,s,a;return a=t.subscribed,n=h.getActivityUser(p.state.actorId),r=p.state.activity.activity_key,n.is_signed_in?n.is_email_verified?(s=_.updateFileActivitySubscription({actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,targetUserEmail:null,subscribed:a,oref:p.state.oref}),a?s.then(function(){return A.success(U("You have been subscribed."))}).catch(function(e){return A.error(U("We failed to unsubscribe you.")),L.reject(e)}):s.then(function(){return A.success(U("You have been unsubscribed."))}).catch(function(e){return A.error(U("We failed to unsubscribe you.")),L.reject(e)})):(o=D.get_for_user(n),D.set_should_use_simple_ui(!1),void o.show_verify_modal(null,i.SUBSCRIBE_TO_COMMENTS)):(l.saveActionCreator({name:"setCommentSubscribed",fileActivityKey:r,args:e.call(arguments)}),O.emit("show-sign-up-modal",{fileActivityKey:r,variant:E.SUBSCRIBE_VARIANT}),void l.logSignUpModal({fileActivityKey:r,originType:S.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.SUBSCRIBE_BUTTON}))},re=function(e){var n,o,i,r,s,a,l;return r=p.state.activity,o=r.findConversationByKey(e),n=h.getActivityUser(p.state.actorId),null!=o&&n.is_signed_in&&(s=function(e){return!(e.is_pending||e.is_seen)},i=o.comment_activities.filter(s),s(o)&&i.push(o),i.length>0)?(a=t.pluck(i,"activity_key"),l=_.markCommentSeenBatch({isBackgroundRequest:!0,actorId:p.state.actorId,context:p.state.viewing.context,contextData:p.state.viewing.contextData,commentActivityKeys:a}),K(l,function(e){return r.markCommentSeenByKeyBatch(a)})):void 0},ue=function(e){var t,n;return t=e.activityKey,n=e.expandConversation,O.emit("reveal-comment-in-pane",{activityKey:t,expandConversation:n})},le=function(e){var t,n,o,i,r,a,l;return i=p.state.activity,null!=i&&(o=i.findConversationByKey(e),null!=o&&null!=(r=o.comment.comment_metadata)?r.annotation:void 0)?(a=o.comment.comment_metadata,n=a.annotation,l=a.revision,t=N.createAnnotationFromDict(n),null!=l&&s.switchRevision({revision:l,commentActivity:o}),O.emit("reveal-annotation",{page:t.getFirstPdfPage(),commentActivity:o})):void 0},G=function(e){var t,n,o;return o=p.state.activity,t=h.getActivityUser(p.state.actorId),o&&e&&oe(o.latest_revision,e.latest_revision)&&(n=te(p.state.viewing.file,e.latest_revision),b.fastForwardRevision(n)),s.receiveFileActivity(e),t.is_signed_in&&null==o&&null!=e&&l.replayActionCreators({actionCreators:ee,fileActivityKey:e.activity_key}),p.state.isPreviewReady&&null==o?O.emit("preview-and-comments-ready"):void 0},z=function(){var e,t;return e=p.state.actorId,t=n.createElement(y,{onOpen:function(){return s.setShouldShowOnboarding(!1),_.markCommentingOnboardingSeen({actorId:e}).catch(function(){})}}),M.showInstance(t)},_e=function(){var e,t,n,o,i,r;if(e=p.state.actorId,r=p.state.shouldShowOnboarding,i=p.state.viewing,t=i.context,n=i.file,o=h.getPreviewType(t,null!=n?n.preview_type:void 0),null!=e&&null!=o){if(null==r)return _.shouldShowCommentingOnboarding({actorId:e}).then(function(e){return s.setShouldShowOnboarding(e),e?z():void 0}).catch(function(){});if(r===!0)return z()}},he=function(){if(h.useLegacyCommentsToggle(p.state.isReactViewer))return s.legacyShowComments();if(p.areCommentsHidden())return j(!0),s.showComments()},ne=function(){if(h.useLegacyCommentsToggle(p.state.isReactViewer))return s.legacyHideComments();if(!p.areCommentsHidden())return j(!1),s.hideComments()},j=function(e){return null!=p.state.actorId?_.setCommentingPaneVisibility({actorId:p.state.actorId,shouldShow:e}):_.setSessionCommentingPaneVisibility({shouldShow:e})},ie=function(){return _.setShowCommentsTutorial({actorId:p.state.actorId,shouldShow:!1})},m.getInstance(),O.on("file-activity-updated",G),ee=t.extend({},s,{addReply:$,addFileComment:Q,addInlineAnnotation:Z,retryPostingComment:ae,deleteComment:X,setCommentResolved:ce,setCommentSubscribed:de,setCommentsEnabled:pe,markConversationSeen:re,showOnboardingIfNecessary:_e,revealCommentInPane:ue,revealAnnotationInPreview:le,markCommentsTutorialAsDone:ie,showComments:he,hideComments:ne})})}.call(this),function(){define("modules/clean/comments/actions",["external/underscore","external/reflux"],function(e,t){return t.createActions(e.object(e.map(["stopViewingComments","showResolvedComments","hideResolvedComments","showAnnotationConversation","hideAnnotationConversation","showAnnotationInput","hideAnnotationInput","updateAnnotationText","updateAnnotationReplyText","startAnnotationCreation","stopAnnotationCreation","notifyPreviewReady","switchRevision","startViewingComments","revealAnnotation","receiveFileActivity","showComments","hideComments","legacyShowComments","legacyHideComments","switchTabs","setShouldShowOnboarding","updateAnnotationReplyFocused","updateAnnotationConversationHover","updateAnnotationUiHover","setRegionCreationEnabled","setShowTutorial","setCurrentTutorialStep","setExpandedComment","setMentionedContact","addedComment","enableCommenting","disableCommenting","cancelAnnotationComment"],function(e){return[e,{sync:!0}]})))})}.call(this),define("modules/clean/comments/components/ui_constants",["require","exports"],function(e,t){"use strict";t.DEFAULT_ANNOTATION_COMMENT_INPUT_MAX_HEIGHT=220,t.TUTORIAL_INITIATOR="tutorialInitiator",t.TUTORIAL_CREATE_ANNOTATION="tutorialCreateAnnotation",t.TUTORIAL_CREATE_ANNOTATION_SUCCESS="tutorialCreateAnnotationSuccess",t.TUTORIAL_REPLY="tutorialReply",t.TUTORIAL_REPLY_SUCCESS="tutorialReplySuccess",t.TUTORIAL_MENTION="tutorialMention",t.TUTORIAL_MENTION_SUCCESS="tutorialMentionSuccess"}),define("modules/clean/comments/constants",["require","exports","modules/constants/legacy"],function(e,t,n){"use strict";t.FileActivityLogEventType=n.FILE_ACTIVITY_LOG_EVENT_TYPE,t.FileActivityLogClientOriginType=n.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE,function(e){e[e.MARKER=0]="MARKER",e[e.HIGHLIGHT=1]="HIGHLIGHT",e[e.REGION=2]="REGION"}(t.AnnotationTypes||(t.AnnotationTypes={}));t.AnnotationTypes;t.AnnotationSubtypes={MARKER:{CIRCLE:0},REGION:{RECTANGLE:0},HIGHLIGHT:{HIGHLIGHT:0}}}),define("modules/clean/comments/events",["require","exports","external/eventemitter3"],function(e,t,n){"use strict";t.CommentsEvents=new n,t.CommentsEventsMixin={onCommentsEvent:function(e,n,o){this.__commentsEvents.push([e,n,o]),t.CommentsEvents.on(e,n,o)},componentWillMount:function(){this.__commentsEvents=[]},componentWillUnmount:function(){this.__commentsEvents.forEach(function(e){var n=e[0],o=e[1],i=e[2];t.CommentsEvents.off(n,o,i)}),this.__commentsEvents=null}}}),function(){define("modules/clean/comments/flux",["external/underscore","external/reflux","external/react"],function(e,t,n){var o,i,r,s;return o=t.ListenerMethods,i=t.ListenerMixin,s=function(t){return{getInitialState:function(){return t.state},componentWillMount:function(){return e.extend(this,o),this.replaceState(t.state),this.listenTo(t,this.replaceState)},componentWillUnmount:i.componentWillUnmount}},r=function(t,o,i){return null==i&&(i=function(t,n){return e.extend({},t,n)}),function(e){var r;return n.createClass({displayName:"Connect("+(null!=(r=e.displayName)?r:"?")+")",getInitialState:function(){return t.state},componentWillMount:function(){return this.unsubscribeStore=t.listen(function(e){return function(t){return e.replaceState(t)}}(this)),this.replaceState(t.state)},componentWillUnmount:function(){return this.unsubscribeStore()},render:function(){var t,r;return r=o(this.state),t=i(r,this.props),n.createElement(e,t)}})}},{sync:s,connect:r}})}.call(this),define("modules/clean/comments/lib/type_check",["require","exports","modules/core/types"],function(e,t,n){"use strict";function o(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(t,o,i){i.value=n.takes.apply(void 0,e.concat([i.value]))}}function i(e){return function(t,o,i){i.value=n.returns(e,i.value)}}t.takes=o,t.returns=i}),function(){define("modules/clean/comments/logged_out_utils",["modules/clean/react/file_comments/logger","modules/clean/storage","modules/constants/legacy"],function(e,t,n){var o,i,r,s,a,l,u,c;return a=t.SessionStorage,o=n.FILE_ACTIVITY_LOG_EVENT_TYPE,i="commenting_actions",s="v1",r=i+":"+s,l=function(t){var n,i,r,s;return i=t.fileActivityKey,n=null!=(s=t.commentActivityKey)?s:null,r=t.originType,e.log_event(o.CLIENT_SIGN_UP_MODAL,i,n,r)},c=function(e){var t,n,o,i,s,l,u,c;l=e.name,s=e.fileActivityKey,n=e.args;try{return c=r+":"+s,t=null!=(u=a.get(c))?u:[],t.push({name:l,args:n}),a.set(c,t)}catch(e){o=e,console.error(o)}},u=function(e){var t,n,o,i,s,l,u;t=e.actionCreators,s=e.fileActivityKey;try{return u=r+":"+s,n=null!=(l=a.get(u))?l:[],a.set(u,null),n.forEach(function(e){var n,o;return o=e.name,n=e.args,t[o].apply(t,n)})}catch(e){o=e,console.error(o)}},{logSignUpModal:l,saveActionCreator:c,replayActionCreators:u}})}.call(this),define("modules/clean/comments/logging",["require","exports","modules/clean/comments/store","modules/clean/react/file_comments/logger"],function(e,t,n,o){"use strict";function i(e,t){var i=n.state,r=i.actorId,s=i.activity,a=i.viewing.context;try{o.log_event(e,s.activity_key,null,t,r,a)}catch(e){console.warn("logEvent failed",e)}}function r(e,t){var i=n.state,r=i.actorId,s=i.activity,a=i.viewing.context,l=s.findCommentByKey(t);try{o.log_annotation_event(e,s.activity_key,t,r,a,l.comment.comment_metadata.annotation)}catch(e){console.warn("logAnnotationEvent failed",e)}}t.logEvent=i,t.logAnnotationEvent=r});var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=3>r?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(3>r?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};define("modules/clean/comments/models/comment",["require","exports","external/underscore","external/deep-freeze","modules/core/types","modules/clean/immutability_helper","modules/clean/comments/lib/type_check","modules/clean/activity/activity_user"],function(e,t,n,o,i,r,s,a){"use strict";var l=function(){function e(e){var t=void 0===e?{}:e,n=t.revision,i=void 0===n?null:n,r=t.annotation,s=void 0===r?null:r,a=t.sticker_id,l=void 0===a?null:a,u=t.thumbnail_url,c=void 0===u?null:u;this.revision=i,this.annotation=s,this.sticker_id=l,this.thumbnail_url=c,o(this)}return e.fromDict=function(t){return new e({revision:t.revision,annotation:t.annotation,sticker_id:t.stickers&&t.stickers.id,thumbnail_url:t.thumbnail_url})},e.prototype.toDict=function(){return n.pick({revision:this.revision,annotation:this.annotation,stickers:this.sticker_id?{id:this.sticker_id}:null,thumbnail_url:this.thumbnail_url},function(e){return null!=e})},e.prototype.hasRevisionData=function(){return null!=this.revision},e.prototype.hasAnnotationData=function(){return null!=this.annotation},e.prototype.hasStickerData=function(){return null!=this.sticker_id},e.prototype.hasThumbnailUrl=function(){return null!=this.thumbnail_url},e.prototype.getStickerId=function(){return this.sticker_id},__decorate([s.takes({revision:i.Any,annotation:i.Any,stickers:i.Maybe({id:Number}),thumbnail_url:i.Maybe(String)})],e,"fromDict",null),e}();t.CommentMetadata=l;var u=function(){function e(e){var t=void 0===e?{}:e,n=t.comment_gid,i=void 0===n?"":n,r=t.commenter,s=void 0===r?a.ActivityUser.anonymous:r,l=t.comment_text,u=void 0===l?"":l,c=t.raw_comment_text,d=void 0===c?"":c,p=t.when_mses,h=void 0===p?0:p,_=t.resolved,m=void 0===_?!1:_,f=t.comment_metadata,g=void 0===f?null:f;this.comment_gid=i,this.commenter=s,this.comment_text=u,this.raw_comment_text=d,this.raw_comment_text=d,this.when_mses=h,this.resolved=m,this.comment_metadata=g,o(this)}return e.fromDict=function(t){var n=t.comment_meta_json;return new e({comment_gid:t.comment_gid,commenter:a.ActivityUser.fromDict(t.commenter_dict),comment_text:t.comment_text,raw_comment_text:t.raw_comment_text,when_mses:t.when_mses,resolved:t.resolved,comment_metadata:n?l.fromDict(n):null})},e.prototype.hasMetadata=function(){return null!=this.comment_metadata},e.prototype.resolve=function(){return r.set(this,"resolved",!0)},e.prototype.unresolve=function(){return r.set(this,"resolved",!1)},__decorate([s.takes({comment_gid:String,commenter_dict:i.Any,comment_text:String,raw_comment_text:String,when_mses:Number,resolved:Boolean,comment_meta_json:i.Maybe(Object)})],e,"fromDict",null),e}();t.Comment=u});var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=3>r?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(3>r?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};define("modules/clean/comments/models/comment_activity",["require","exports","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment"],function(e,t,n,o,i,r,s,a,l){"use strict";var u=function(){function e(e){var t=(void 0===e?{}:e).user_ids_who_can_delete,o=void 0===t?[]:t;this.user_ids_who_can_delete=o,n(this)}return e.fromDict=function(t){return t.user_ids_who_can_delete.forEach(function(e){if(!o.isNumber(e))throw TypeError(e+" in user_ids_who_can_delete is not a number")}),new e(t)},__decorate([a.takes({user_ids_who_can_delete:Array})],e,"fromDict",null),e}();t.CommentActivityPermissions=u;var c=function(){function e(e){var t=void 0===e?{}:e,o=t.activity_key,i=void 0===o?"":o,r=t.comment_activities,s=void 0===r?[]:r,a=t.users_to_notify,c=void 0===a?[]:a,d=t.is_seen,p=void 0===d?!1:d,h=t.highlight_as_unread,_=void 0===h?!1:h,m=t.comment,f=void 0===m?new l.Comment:m,g=t.permissions,v=void 0===g?new u:g,y=t.status,E=void 0===y?"POSTED":y;this.activity_key=i,this.comment_activities=s,this.users_to_notify=c,this.is_seen=p,this.highlight_as_unread=_,this.comment=f,this.permissions=v,this.status=E,n(this)}return e.createLocalInstance=function(t){var n=t.activityKey,i=void 0===n?o.uniqueId("local-comment-activity-"):n,r=t.commenter,s=t.rawCommentText,a=t.metadata,u=void 0===a?null:a,c=t.status,d=void 0===c?"POSTING":c;return new e({activity_key:i,comment:new l.Comment({comment_gid:o.uniqueId("pending-comment-gid-"),commenter:r,comment_text:s,raw_comment_text:s,when_mses:(new Date).getTime(),resolved:!1,comment_metadata:u}),is_seen:!0,highlight_as_unread:!1,status:d})},e.fromDict=function(t){return new e({activity_key:t.activity_key,comment_activities:t.comment_activity_dicts.map(e.fromDict),users_to_notify:(t.users_to_notify||[]).map(s.ActivityUser.fromDict),is_seen:t.is_seen,highlight_as_unread:t.highlight_as_unread,comment:l.Comment.fromDict(t.comment),permissions:u.fromDict(t.permissions)})},Object.defineProperty(e.prototype,"when_mses",{get:function(){return this.comment.when_mses},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_pending",{get:function(){return"POSTED"!==this.status},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"is_resolved",{get:function(){return this.comment.resolved},enumerable:!0,configurable:!0}),e.prototype.shouldHighlightAsUnread=function(){return this.highlight_as_unread?!0:this.comment_activities.some(function(e){return e.shouldHighlightAsUnread()})},e.prototype.resolve=function(){return r.set(this,"comment",this.comment.resolve())},e.prototype.unresolve=function(){return r.set(this,"comment",this.comment.unresolve())},e.prototype.setStatus=function(e){return r.set(this,"status",e)},e.prototype.markSeen=function(){return r.merge(this,{is_seen:!0,highlight_as_unread:!1})},__decorate([a.takes({activity_key:String,comment_activity_dicts:Array,users_to_notify:i.Maybe(Array),is_seen:Boolean,highlight_as_unread:Boolean,comment:Object,permissions:Object})],e,"fromDict",null),e}();t.CommentActivity=c}),function(){define("modules/clean/comments/models/loading_spinner",[],function(){return function(e,t){return null==t||t.comment_activities.length>0?e:!1}})}.call(this),function(){define("modules/clean/comments/models/preview_types",[],function(){return{PDFJS:0,IMAGE:1}})}.call(this),function(){define("modules/clean/comments/revisions",["external/underscore"],function(e){var t,n,o,i,r;return n=function(t,n){return null!=t.set?t.merge({preview_url:n.preview_link,direct_blockserver_link:n.direct_blockserver_link}):e.extend({},t,{preview_url:n.preview_link,direct_blockserver_link:n.direct_blockserver_link})},t=function(e,t){return t.when-e.when},r=function(e,n){return t(e,n)>0},i=function(e,n){return t(e,n)<0},o=function(e,n){return 0===t(e,n)},{getFileWithRevision:n,compareRevision:t,isRevisionOlderThan:r,isRevisionNewerThan:i,isRevisionEqual:o}})}.call(this),function(){define("modules/clean/comments/store",["external/underscore","external/reflux","modules/constants/comments_panel","modules/constants/legacy","modules/core/exception","modules/core/i18n","modules/clean/annotations/annotation","external/rsvp","modules/clean/annotations/annotation","modules/clean/comments/actions","modules/clean/comments/events","modules/clean/comments/models/loading_spinner","modules/clean/comments/revisions","modules/clean/comments/components/ui_constants","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_comments/logger"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f){var g,v,y,E,b,w,T,S,C,I,P,A,N,R;return R=i.assert,N=r._,g=s.Annotation,b=a.Promise,v=l.AnnotationTypes,y=c.CommentsEvents,S=h.TUTORIAL_INITIATOR,P=h.TUTORIAL_REPLY,A=h.TUTORIAL_REPLY_SUCCESS,C=h.TUTORIAL_MENTION,I=h.TUTORIAL_MENTION_SUCCESS,w=h.TUTORIAL_CREATE_ANNOTATION,T=h.TUTORIAL_CREATE_ANNOTATION_SUCCESS,E=_.PermissionHelper,t.createStore({listenables:u,init:function(){return this.state=this.getInitialState()},getInitialState:function(){var e;return e={actorId:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},activity:null,showLoadingSpinner:!0,oref:null,showResolvedComments:!1,isPreviewReady:!1,isCommentsHidden:!1,regionCreationEnabled:!1,viewAnnotation:null,createAnnotation:null,annotationText:null,annotationReplyTextByKey:{},shouldShowOnboarding:void 0,showTutorial:n.SHOW_COMMENTS_TUTORIAL,currentTutorialStep:S,showCommentsPref:n.SHOW_COMMENTS_PANEL}},setState:function(t){return e.extend(this.state,t),this.trigger(this.state)},replaceState:function(e){return this.state=e,this.forceUpdate()},forceUpdate:function(){return this.trigger(this.state)},isUserSubscribed:function(e){var t,n,o,i,r;if(null!=(o=this.state.activity)?o.users_to_notify:void 0)for(i=this.state.activity.users_to_notify,t=0,n=i.length;n>t;t++)if(r=i[t],r.id===e)return!0;return!1},isCommentingEnabled:function(){return this.state.activity?!this.state.activity.feedback_off:null!=this.state.viewing.file?!this.state.viewing.file.feedback_off:!0},isFileActivityReady:function(){return null!=this.state.activity},canEnableComments:function(){var e;return null!=(e=this.state.activity)?e.can_edit_feedback:void 0},isStoreInitialized:function(){return!!this.state.viewing.context},hasUnreadComments:function(){var e;return!!(null!=(e=this.state.activity)?e.comment_activities.some(function(e){return e.shouldHighlightAsUnread()}):void 0)},areCommentsHidden:function(){return null!=this.state.viewing.showCommentsOverride?!this.state.viewing.showCommentsOverride:this.state.showCommentsPref===!1?!this.hasUnreadComments():!this.isCommentingEnabled()},unreadCommentCount:function(){var e,t;return null==this.state.activity?null:(e=function(e){return e.highlight_as_unread&&!e.comment.resolved},t=function(t,n){return n.comment.resolved?t:(e(n)&&(t+=1),t+=n.comment_activities.filter(e).length)},this.state.activity.comment_activities.reduce(t,0))},onReceiveFileActivity:function(e){return null!=e&&null==this.state.viewing.revision&&(this.state.viewing.revision=e.latest_revision),this.setState({activity:e})},onStartViewingComments:function(e){var t,n,o,i,r,s,a,l;return t=e.actorId,n=e.context,o=e.contextData,r=e.oref,i=e.file,s=e.previewSelector,a=e.showCommentsOverride,l=null!==this.state.contextData?d(this.state.showLoadingSpinner,this.state.activity):!0,this.setState({actorId:t,viewing:{context:n,contextData:o,file:i,revision:null,showCommentsOverride:a},oref:r,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,showLoadingSpinner:l,isReactViewer:(null!=s?s.indexOf("react"):void 0)>=0,annotationText:null,annotationReplyTextByKey:{}})},onStopViewingComments:function(){return this.setState({actorId:null,activity:null,viewing:{context:null,contextData:null,revision:null,file:null,showCommentsOverride:null},showLoadingSpinner:!0,oref:null,viewAnnotation:null,createAnnotation:null,isPreviewReady:!1,isReactViewer:!1,annotationText:null,annotationReplyTextByKey:{}})},onShowResolvedComments:function(){return this.setState({showResolvedComments:!0})},onHideResolvedComments:function(){return this.setState({showResolvedComments:!1})},onNotifyPreviewReady:function(){return this.setState({isPreviewReady:!0}),null!=this.state.activity?y.emit("preview-and-comments-ready"):void 0},onUpdateAnnotationConversationHover:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{conversationHover:t}),this.setState({viewAnnotation:n})):void 0},onUpdateAnnotationUiHover:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{annotationHover:t}),this.setState({viewAnnotation:n})):void 0},onShowAnnotationConversation:function(e){var t,n;return n=e.annotation,t=e.activityKey,R(null!=this.state.activity,"Cannot show annotation when file activity is not ready!"),R(null!=n,"Invalid annotation to show"),R(null!=this.state.activity.findConversationByKey(t),"Invalid inline comment to show: "+t),this.setState({viewAnnotation:{annotation:n,activityKey:t,replyFocused:!1,annotationHover:!0,conversationHover:!1}})},onHideAnnotationConversation:function(){return this.setState({viewAnnotation:null})},onUpdateAnnotationReplyFocused:function(t){var n;return null!=this.state.viewAnnotation?(n=e.extend({},this.state.viewAnnotation,{replyFocused:t}),this.setState({viewAnnotation:n})):void 0},onStartAnnotationCreation:function(e){var t;return t=e.annotation,this.setState({viewAnnotation:null,createAnnotation:{annotation:t,showBubble:!0}}),this._updateTutorial()},onStopAnnotationCreation:function(){return this.setState({createAnnotation:null})},onUpdateAnnotationText:function(e){return this.setState({annotationText:e})},onUpdateAnnotationReplyText:function(t){var n,o,i,r;return n=t.activityKey,r=t.text,n in this.state.annotationReplyTextByKey&&!r?(o=e.omit(this.state.annotationReplyTextByKey,n),this.setState({annotationReplyTextByKey:o})):(o=e.extend({},this.state.annotationReplyTextByKey,(i={},i[""+n]=r,i)),this.setState({annotationReplyTextByKey:o}))},onShowAnnotationInput:function(){return null!=this.state.createAnnotation?this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!0}}):void 0},onHideAnnotationInput:function(){return null!=this.state.createAnnotation?this.setState({createAnnotation:{annotation:this.state.createAnnotation.annotation,showBubble:!1}}):void 0},onSwitchRevision:function(t){var n,i,r,s,a;return a=t.revision,n=t.commentActivity,R(null!=a,"Revision to switch to must not be null!"),R(null!=this.state.activity,"Cannot switch revision when file activity is not ready!"),p.isRevisionEqual(a,this.state.viewing.revision)?void 0:(p.isRevisionEqual(a,this.state.activity.latest_revision)?(i=o.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_LATEST_REVISION,this.state.isReactViewer?m.restoreRevision():y.emit("switch-revision",{revision:a,commentActivity:n})):(i=o.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SWITCH_TO_OLD_REVISION,this.state.isReactViewer?(r=p.getFileWithRevision(this.state.viewing.file,a),m.switchRevision(r)):y.emit("switch-revision",{revision:a,commentActivity:n})),this.setState({viewing:e.extend({},this.state.viewing,{revision:a}),isPreviewReady:!1}),y.emit("revision-did-change"),f.log_annotation_event(i,this.state.activity.activity_key,null!=n?n.activity_key:void 0,this.state.actorId,this.state.viewing.context,null!=n&&null!=(s=n.comment.comment_metadata)?s.annotation:void 0))},onLegacyShowComments:function(){return this.setState({isCommentsHidden:!1})},onLegacyHideComments:function(){return this.setState({viewAnnotation:null,createAnnotation:null,isCommentsHidden:!0})},onShowComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!0
}),showCommentsPref:!0})},onHideComments:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!1}),viewAnnotation:null,createAnnotation:null,showCommentsPref:!1})},onSetRegionCreationEnabled:function(e){return this.setState({regionCreationEnabled:e,viewAnnotation:null,createAnnotation:null})},onAddedComment:function(){return this.onShowComments(),this.onCancelAnnotationComment()},onCancelAnnotationComment:function(){var e;return null!=this.state.createAnnotation?(this.onStopAnnotationCreation(),this.onUpdateAnnotationText(null)):null!=this.state.viewAnnotation?(e=this.state.viewAnnotation.activityKey,this.onHideAnnotationConversation(),this.onUpdateAnnotationReplyText({activityKey:e,text:null})):void 0},onEnableCommenting:function(){return this.onShowComments()},onDisableCommenting:function(){return this.setState({viewing:e.extend(this.state.viewing,{showCommentsOverride:!1})})},onSetShouldShowOnboarding:function(e){return this.setState({shouldShowOnboarding:e})},onSetShowTutorial:function(e){return n.SHOW_COMMENTS_TUTORIAL=e,this.setState({showTutorial:e})},onSetCurrentTutorialStep:function(e){return this.setState({currentTutorialStep:e})},onSetExpandedComment:function(e){return this.setState({expandedComment:e}),this._updateTutorial()},onSetMentionedContact:function(e){return this.setState({mentionedContact:e}),this._updateTutorial()},_updateTutorial:function(){return this.state.currentTutorialStep===w&&null!=this.state.createAnnotation?this.setState({currentTutorialStep:T}):this.state.currentTutorialStep===P&&this.state.expandedComment?this.setState({currentTutorialStep:A}):this.state.currentTutorialStep===C&&this.state.mentionedContact?this.setState({currentTutorialStep:I}):void 0}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/comments/utils",["modules/clean/annotations/annotation","modules/clean/activity/constants","modules/clean/activity/activity_user","modules/clean/comments/models/preview_types","modules/clean/comments/revisions","modules/clean/comments/store","modules/clean/previews/util","modules/clean/react/file_viewer/store","modules/clean/viewer","modules/constants/comments_panel","modules/core/exception","modules/core/i18n"],function(t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A;return m=t.Annotation,h=n.ActivityContext,_=o.ActivityUser,C=r.isRevisionEqual,f=a.PermissionHelper,g=p._,w=function(e){var t;return t=u.get_viewer(),null!=e?_.fromUser(t.get_user_by_id(e)):t.work_user||t.personal_user?_.fromUser(t.work_user||t.personal_user):t.is_signed_in?void 0:new _},T=function(t,n){var o;if(o=[h.BROWSE_FILE_VIEWER,h.SHARED_LINK_VIEW,h.SHARED_CONTENT_LINK_VIEW],e.call(o,t)>=0&&null!=n){if("photo"===n)return i.IMAGE;if("doc"===n||"adobecs"===n)return i.PDFJS}return null},E=function(e){return w(e.actorId).is_signed_in},v=function(){return A()?s.areCommentsHidden():s.state.isCommentsHidden},y=function(){var e;return s.isFileActivityReady()?(e=s.isCommentingEnabled(),c.ALLOW_VIEW_ANNOTATE_MODES||(e=e&&!v()),e):!1},b=function(e){var t;return s.isFileActivityReady()?(t=E(s.state),null==e&&(e=l.isFullscreen()),t&&y()&&!e&&C(s.state.viewing.revision,s.state.activity.latest_revision)):!1},S=function(){return b()?c.ALLOW_VIEW_ANNOTATE_MODES?s.state.regionCreationEnabled:!s.areCommentsHidden():!1},P=function(){return!s.areCommentsHidden()&&y()},A=function(e){return!(e&&f.is_commenting_integrated())},I=function(){return this.keyCode||this.which||this.charCode},{normalizedKeyCode:I,canAnnotate:b,getActivityUser:w,getPreviewType:T,isRegionCreationEnabled:S,shouldShowExistingAnnotations:P,useLegacyCommentsToggle:A}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/bubble_picker",["jquery","modules/clean/keycode"],function(t,n){var o;return o=function(){function o(t){this.$bubble_picker=t,this._on_button_keydown=e(this._on_button_keydown,this),this._on_option_keydown=e(this._on_option_keydown,this),this._on_option_mouseenter=e(this._on_option_mouseenter,this),this.enable_option=e(this.enable_option,this),this.disable_option=e(this.disable_option,this),this.show_dropdown=e(this.show_dropdown,this),this.hide_dropdown=e(this.hide_dropdown,this),this.set_value=e(this.set_value,this),this._listen=e(this._listen,this),this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label_wrapper.on("keydown",this._on_button_keydown),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this.$options=this.$bubble_picker.find("*[role='option']"),this.$options.on("mouseenter",this._on_option_mouseenter),this.$options.on("keydown",this._on_option_keydown),this._dropdown_shown=!1,this._listen()}return o.CHANGED="db:bubblepicker:changed",o.prototype._listen=function(){return t(document).click(function(e){return function(n){var o,i;return i=t(n.target).closest(e.$label_wrapper).length>0,o=t(n.target).closest(e.$dropdown).length>0,e._dropdown_shown&&!o?e.hide_dropdown():i?e.show_dropdown():void 0}}(this)),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(e){return function(n){var i,r;return n.preventDefault(),i=t(n.currentTarget),i.hasClass("disabled")?void 0:(r=e.get_value(),e.set_value(i.data("value")),e.$bubble_picker.trigger(o.CHANGED,{clicked_val:i.data("value"),old_val:r}),e.hide_dropdown(),e.$label_wrapper.focus())}}(this))},o.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},o.prototype.set_value=function(e){var t;return this.$bubble_picker.attr("data-selected-value",e),this.$label.empty(),this.$bubble_picker.find(".bubble-picker-option--selected").removeClass("bubble-picker-option--selected"),t=this.$bubble_picker.find("[data-value='"+e+"']").addClass("bubble-picker-option--selected"),this.$label.html(t.clone().html())},o.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this.$label_wrapper.attr("aria-expanded",!1),this._dropdown_shown=!1},o.prototype.show_dropdown=function(){var e,n;return this.$dropdown.show(),this.$label_wrapper.attr("aria-expanded",!0),this._dropdown_shown=!0,this.$options.attr({tabindex:-1,"aria-selected":!1}),n=this.$bubble_picker.attr("data-selected-value"),e=n?this.$bubble_picker.find(".bubble-picker-option[data-value='"+n+"']")[0]:this.$bubble_picker.find(".bubble-picker-option")[0],t(e).attr({tabindex:0,"aria-selected":!0}).focus()},o.prototype.disable_option=function(e,n){var o,i;return i=this.$bubble_picker.find(".bubble-picker-option[data-value="+e+"]:not('.disabled')"),i.length>0&&(o=t(i.find(".role-option")),o.attr("saved-title",o.attr("title")),o.attr("title",n),o.attr("aria-disabled",!0)),i.addClass("disabled")},o.prototype.enable_option=function(e){var n,o;return o=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+e+"]"),n=t(o.find(".role-option")),n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),n.attr("aria-disabled",!1),o.removeClass("disabled")},o.prototype._change_focus=function(e,n){return t(e).attr({tabindex:-1,"aria-selected":!1}),t(n).attr({tabindex:0,"aria-selected":!0}).focus()},o.prototype._focus_previous=function(e){var t;return t=this.$options.index(e),t>0?this._change_focus(e,this.$options.get(t-1)):void 0},o.prototype._focus_next=function(e){var t;return t=this.$options.index(e),t<this.$options.length-1?this._change_focus(e,this.$options.get(t+1)):void 0},o.prototype._on_option_mouseenter=function(e){return this.$dropdown.removeClass("bubble-picker-dropdown--keyboard")},o.prototype._on_option_keydown=function(e){this.$dropdown.addClass("bubble-picker-dropdown--keyboard"),e.keyCode===n.ESC?(this.hide_dropdown(),this.$label_wrapper.focus()):e.keyCode===n.DOWN?(this._focus_next(e.target),e.preventDefault()):e.keyCode===n.UP?(this._focus_previous(e.target),e.preventDefault()):e.keyCode!==n.TAB||e.shiftKey||this.hide_dropdown()},o.prototype._on_button_keydown=function(e){e.keyCode===n.ENTER?this.$dropdown.addClass("bubble-picker-dropdown--keyboard"):e.keyCode===n.TAB&&e.shiftKey&&this.hide_dropdown()},o}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},n=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;define("modules/clean/components/role_picker",["external/underscore","modules/constants/viewer","modules/core/controller_helpers","modules/core/exception","modules/clean/multiaccount_login","modules/clean/page_role_observer","modules/clean/viewer"],function(o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g;return d=i.ROLE_PERSONAL,p=i.ROLE_PHOTOS,h=i.ROLE_WORK,g=s.assert,m={ALL:"all",PERSONAL:d,WORK:h},_=function(){function n(n){var i,r,s,a,l,c;null==n&&(n={}),this._actually_set_state=e(this._actually_set_state,this),this._do_login=e(this._do_login,this),this.is_user_visible=e(this.is_user_visible,this),this.is_role_visible=e(this.is_role_visible,this),this.ensure_role_is_visible=e(this.ensure_role_is_visible,this),this.set_state=e(this.set_state,this),this.get_state=e(this.get_state,this),this._allow_merged_state=null!=n.allow_merged_state?n.allow_merged_state:!0,this._limit_to_role=null!=n.limit_to_role?n.limit_to_role:null,c=u.get_viewer(),r=c.is_role_signed_in(m.PERSONAL)&&c.is_role_signed_in(m.WORK),n.initial_state?(a=o.values(m),g((s=n.initial_state,t.call(a,s)>=0),"RolePicker requires initial_state to be one of: "+a),this.set_state(n.initial_state)):this._allow_merged_state&&r?this.set_state(m.ALL):(i=c.get_users(),g(i.length,"tried to use RolePicker on a page with no users"),l=i[0],this.set_state(l.role))}return n.prototype.get_state=function(){return this._state},n.prototype.set_state=function(e){var t,n,o,i;if(g(this._allow_merged_state||e!==m.ALL,"tried to set merged state in non-merged picker"),null!=this._limit_to_role&&g(e===m.ALL||e===this._limit_to_role),e===m.ALL){for(o=[d,h,p],t=0,n=o.length;n>t;t++)if(i=o[t],!u.get_viewer().is_role_signed_in(i))return void this._do_login(i,e)}else if(i=e,!u.get_viewer().is_role_signed_in(i))return void this._do_login(i,e);return this._actually_set_state(e)},n.prototype.update_picker_ui=function(){},n.prototype.ensure_role_is_visible=function(e){return this.is_role_visible(e)?void 0:this._allow_merged_state?this.set_state(m.ALL):this.set_state(e)},n.prototype.is_role_visible=function(e){return this._state===m.ALL||this._state===e},n.prototype.is_user_visible=function(e){return this.is_role_visible(e.role)},n.prototype._do_login=function(e,t){return a.show_modal({role:e,on_success:function(e){return function(){return e._actually_set_state(t)}}(this)})},n.prototype._actually_set_state=function(e){return e!==this._state?(this._state=e,this.update_picker_ui(),"function"==typeof this.on_state_change?this.on_state_change(e):void 0):void 0},n}(),f=function(t){function o(t,n){this.$container=t,null==n&&(n={}),this.limit_to_role=e(this.limit_to_role,this),this.update_picker_ui=e(this.update_picker_ui,this),this.on_ui_change=e(this.on_ui_change,this),this.$bubble_picker=this.$container.find(".bubble-picker"),this.$bubble_picker.on("db:bubblepicker:changed",this.on_ui_change),o.__super__.constructor.call(this,n)}return n(o,t),o.prototype.on_ui_change=function(e,t){var n;return n=t.clicked_val,n!==this._state?(r.get_controller(this.$bubble_picker).set_value(this._state),this.set_state(n)):void 0},o.prototype.update_picker_ui=function(){return r.get_controller(this.$bubble_picker).set_value(this._state)},o.prototype.limit_to_role=function(e,t){var n,o;if(null!=e){this.ensure_role_is_visible(e);for(n in m)o=m[n],o!==e&&o!==m.ALL&&r.get_controller(this.$bubble_picker).disable_option(o,t)}else for(n in m)o=m[n],r.get_controller(this.$bubble_picker).enable_option(o);return this._limit_to_role=e},o}(_),c=function(e){function t(e,n){null==n&&(n={}),n.allow_merged_state=!1,t.__super__.constructor.call(this,e,n)}return n(t,e),t.prototype.on_state_change=function(e){var t;return t=function(){switch(e){case m.PERSONAL:return d;case m.WORK:return h}}(),l.emit(t)},t}(f),{RolePickerState:m,RolePicker:_,RoleSelect:f,PageRoleSelect:c}})}.call(this),function(){define("modules/clean/components/scooter/badge",["external/classnames","external/react","external/underscore","modules/core/i18n"],function(e,t,n,o){var i,r,s,a,l,u;return l=o._,u=t.DOM,s={TOP_RIGHT:"TOP_RIGHT"},a=Object.freeze(["normal","loud"]),i=t.createClass({statics:{POSITIONS:s,VARIANTS:a},displayName:"Badge",mixins:[t.addons.PureRenderMixin],propTypes:{position:t.PropTypes.oneOf(n.values(s)),variant:t.PropTypes.oneOf(a)},getDefaultProps:function(){return{variant:"normal"}},render:function(){var t,n,o,i,r;return i=this.props,r=i.variant,o=i.position,n=i.children,t=e({"c-badge":!0,"c-badge--top-right":o===s.TOP_RIGHT,"c-badge--loud":"loud"===r}),u.div({className:t,"aria-hidden":!0},n)}}),r=t.createClass({statics:{POSITIONS:s,VARIANTS:a},displayName:"CounterBadge",mixins:[t.addons.PureRenderMixin],propTypes:{count:t.PropTypes.number,position:t.PropTypes.oneOf(n.values(s)),variant:t.PropTypes.oneOf(a),maxCount:t.PropTypes.number},render:function(){var e,n,o,r,s,a;return s=this.props,e=s.count,a=s.variant,r=s.position,o=s.maxCount,e?(n=null!=o&&e>o?l("%(count)s+",{comment:"label text for a counter badge, for example: 99+"}).format({count:o}):String(e),t.createElement(i,{position:r,variant:a},n)):u.div()}}),{Badge:i,CounterBadge:r}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/contacts/bloodhound_contacts",["jquery","external/typeahead.bundle","external/underscore","modules/clean/ajax","modules/clean/contacts/cache","modules/clean/contacts/list","modules/clean/profile_services/profile_services_link","modules/clean/viewer","modules/constants/contacts","modules/constants/request","modules/core/cookies","modules/core/exception","modules/core/uri"],function(t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v;return m=r.DefaultContactsCache,f=r.LimitedContactsCache,g=a.LinkedProfileServices,v=p.assert,_=function(){function t(t,n,o){var i,r,s,a,p,_;for(this.contacts_filter=null!=t?t:null,this.for_user=null!=n?n:null,this.limit=null!=o?o:10,this._get=e(this._get,this),this.server_search=u.SERVER_SEARCH_ALLOWED,p=null,this.server_search&&(p={url:"/contacts/search",replace:function(e,t){return v(!e.startsWith("//")&&e.startsWith("/"),"Request to non dropbox domain."),t.query=JSON.stringify(t.query),h({path:e,query:t}).toString()},rateLimitWait:300,ajax:{type:"post",headers:{"X-CSRF-Token":d.read(c.JS_CSRF_COOKIE)}},filter:function(e){return e.contacts}}),this.contacts=new Bloodhound({datumTokenizer:function(e){return[e.name,e.email,e.fname,e.lname].concat(e.name_tokens)},queryTokenizer:function(e){return e.query},dupDetector:function(e,t){return e.unique_key===t.unique_key},limit:this.limit,sorter:this._contacts_sorter,local:[],sufficient:15,remote:p}),this.contacts.initialize(),this.sortedContacts=[],this.extraContacts=[],this._batchGetQueue=[],this._getRequest=null,this._updatedCallbacks=[],this.server_search?this.contacts_cache=f:this.contacts_cache=m,l.get_viewer().is_signed_in&&this.contacts_cache.load_contacts(!0,function(e){return function(t){return e._init_contacts(t)}}(this)),a=l.get_viewer().get_users(),i=0,r=a.length;r>i;i++)_=a[i],s=g.get_linked_profile_services_for_user(_.id),s.register_for_service_changes("bloodhound_contacts",function(e){return function(t){return e.contacts.clearRemoteCache()}}(this))}return t.prototype._contacts_sorter=function(e,t){return e.priority>t.priority?-1:e.priority<t.priority?1:0},t.prototype._init_contacts=function(e){return this._update_contacts(e),this.contacts_cache.register_for_updates("bloodhound_contacts",function(e){return function(t){return e._update_contacts(t)}}(this))},t.prototype._filter_contacts=function(e){var t;return t=null!=this.for_user&&l.get_viewer().is_user_signed_in(this.for_user)?e.includeForUser(this.for_user.id):e.excludePairedUserDuplicates(),this.contacts_filter&&(t=t.filterContacts(this.contacts_filter)),t.contacts},t.prototype._update_contacts=function(e){var t,n,o,i,r,s,a,l;for(this.contacts.clearRemoteCache(),this.contacts.clear(),o=this._filter_contacts(e),this.contacts.add(o),s=this._dedupe_extra_contacts(),this.contacts.add(s),n=o.concat(s),n.sort(function(e){return function(t,n){return e._contacts_sorter(t,n)}}(this)),this.sortedContacts=n.slice(0,this.limit),a=this._updatedCallbacks,l=[],i=0,r=a.length;r>i;i++)t=a[i],l.push("function"==typeof t?t():void 0);return l},t.prototype.setExtraContacts=function(e){return this.extraContacts=e},t.prototype._dedupe_extra_contacts=function(){var e,t,n,o,i,r;for(t=this.contacts.index.datums,o={},n={},i=0,r=t.length;r>i;i++)e=t[i],o[e.email]=!0,n[e.dbx_account_id]=!0;return this.extraContacts.filter(function(e){return!n[e.dbx_account_id]&&!o[e.email]})},t.prototype._add_request=function(e,t){var n,o,i;return i=Boolean(0===this._batchGetQueue.length&&null===this._getRequest),o=Array.isArray(e),n={query:o?e:e.trim().split(/\s+/),callback:t,match_any:o,blocking:!0},n.match_any?this._batchGetQueue.push(n):this._getRequest=n,i},t.prototype._next_get_request=function(){var e;return e=null,null!=this._getRequest?(e=this._getRequest,this._getRequest=null):this._batchGetQueue.length>0&&(e=this._batchGetQueue[0],this._batchGetQueue.splice(0,1)),e},t.prototype._get=function(){var e,t,n,i,r,a,l;if(t=this._next_get_request()){if(e=function(e){return function(n){var o;return o=s.create_contacts_list(n),"function"==typeof t.callback&&t.callback(e._filter_contacts(o)),e._get()}}(this),this.server_search||!t.match_any)return this.contacts.get(o.omit(t,"callback"),e);for(r=[],l=t.query,n=0,i=l.length;i>n;n++)a=l[n],this.contacts.get({query:[a]},function(e){return r.push.apply(r,e)});return e(r)}},t.prototype.get=function(e,t){var n;return v(Array.isArray(e)||o.isString(e)),n=this._add_request(e,t),n?this.server_search||this.contacts_cache.is_loaded()?this._get():this.contacts_cache.load_contacts(!0,this._get):void 0},t.prototype.registerForUpdates=function(e){return this._updatedCallbacks.push(e)},t}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},t=function(e,t){return function(){return e.apply(t,arguments)}},n=function(e,t){function n(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},o={}.hasOwnProperty;define("modules/clean/contacts/cache",["jquery","modules/core/browser","modules/core/exception","modules/clean/ajax","modules/clean/contacts/list","modules/clean/profile_services/profile_services_constants","modules/clean/viewer","modules/constants/contacts","modules/clean/bolt"],function(o,i,r,s,a,l,u,c,d){var p,h,_,m,f,g,v,y,E,b,w;return w=r.assert,f=1e3,_="/contacts/get",h="/contacts/check",m=function(){function t(e){this.callbacks={},this.one_time_callbacks=[],this.cached_contacts=null,this._cache_download_name=e,this.should_force_refresh=!1,this.request_perf_records=[]}return t.MAX_REQUEST_PERF_RECORDS=20,t.prototype.register_for_updates=function(e,t){return this.callbacks[e]=t},t.prototype.unregister_for_updates=function(e){return null!=this.callbacks[e]?delete this.callbacks[e]:void 0},t.prototype.get_contacts_count=function(){return null!=this.cached_contacts?this.cached_contacts.length():0},t.prototype.get_downloaded_time=function(){var e,t;return e=null!=(t=i.performance())&&"function"==typeof t.getEntriesByName?t.getEntriesByName(this._get_contacts_downloaded_mark_name()):void 0,e.length?e[0].startTime:null},t.prototype.get_request_perf_records=function(){return this.request_perf_records},t.prototype._is_contact_get_or_check_ajax_request=function(e){var t,n;return t=e.initiatorType,n=e.name,"xmlhttprequest"===t&&(n.endsWith(_)||n.endsWith(h))},t.prototype._find_last_perf_entry=function(e){var t,n,o,r,s,a;if(null==e&&(e=500),a=null!=(r=i.performance())&&"function"==typeof r.getEntriesByType?r.getEntriesByType("resource"):void 0,null!=a?a.length:void 0)for(o=Math.min(a.length-1,e),t=n=s=o;n>=0;t=n+=-1)if(this._is_contact_get_or_check_ajax_request(a[t]))return a[t];return null},t.prototype._record_perf_stats=function(e){var n;return null==e&&(e={}),n=this._find_last_perf_entry(),n&&(e.ttfb=n.responseStart-n.requestStart,e.downloading_time=n.responseEnd-n.responseStart,e.duration=n.duration,this.request_perf_records.push(e),this.request_perf_records.length>t.MAX_REQUEST_PERF_RECORDS)?this.request_perf_records=this.request_perf_records.slice(this.request_perf_records.length-1):void 0},t.prototype._fetch_contacts=function(){return s.BackgroundRequest({url:this._get_request_url(),data:this._get_request_params(),success:function(e){return function(t,n,o){var i;return i=JSON.parse(t),e._contacts_loaded_callback(i),e._schedule_fetch?e._schedule_fetch():void 0}}(this)})},t.prototype._get_versioned_params=function(e,t){var n;return null==t&&(t=!0),n={version:e},t&&(n.force_refresh=this.should_force_refresh,this.should_force_refresh=!1),null!=this.digest&&(n.digest=this.digest),null!=this.limit&&(n.limit=this.limit),n},t.prototype._get_contacts_downloaded_mark_name=function(){return this._cache_download_name+"-"+this.instance},t.prototype._is_page_hidden=function(){return null!=window.document.visibilityState&&window.document.hidden},t.prototype._add_one_time_callback=function(t){return null!=t&&e.call(this.one_time_callbacks,t)<0?this.one_time_callbacks.push(t):void 0},t.prototype._invoke_all_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0),this._invoke_callbacks(this.callbacks,e,!1)},t.prototype._invoke_one_time_callbacks=function(e){return this._invoke_callbacks(this.one_time_callbacks,e,!0)},t.prototype._invoke_callbacks=function(e,t,n){var o,i,r,s,a;for(s=Object.keys(e),a=[],o=0,r=s.length;r>o;o++)i=s[o],e[i](t),n?a.push(delete e[i]):a.push(void 0);return a},t}(),p=function(o){function r(e){this.limit=null!=e?e:null,this.bolt_refresh_callback=t(this.bolt_refresh_callback,this),this.bolt_update_callback=t(this.bolt_update_callback,this),r.__super__.constructor.call(this,"BoltContactsCache download"),this.instance=r.INSTANCE++,this.loading_state=r.BOLT_NEED_TO_SEND_REQUEST,this.current_bolt_states=null,this._notified_states={},this._bolt=null}return n(r,o),r.INSTANCE=0,r.CONTACTS_APP_ID="contacts_cache_notify",r.BOLT_NEED_TO_SEND_REQUEST=0,r.BOLT_REQUEST_SENT=1,r.prototype.load_contacts=function(e,t){return u.get_viewer().is_signed_in?(this._add_one_time_callback(t),(this.loading_state===r.BOLT_NEED_TO_SEND_REQUEST||e)&&(this.loading_state=r.BOLT_REQUEST_SENT,e&&(this.should_force_refresh=!0),this._fetch_contacts()),!this._should_update_contacts()&&this.is_loaded()?this._invoke_one_time_callbacks(this.cached_contacts):void 0):void 0},r.prototype.is_loaded=function(){return null!=this.cached_contacts},r.prototype.bolt_update_callback=function(t){var n,o,i,s;for(o=0,i=t.length;i>o;o++)n=t[o],s=n.unique_id,(e.call(this._notified_states,s)<0||+this._notified_states[n.unique_id].revision<+n.revision)&&(this._notified_states[n.unique_id]=n);return this._should_update_contacts()&&(this.loading_state=r.BOLT_NEED_TO_SEND_REQUEST),this.load_contacts()},r.prototype.bolt_refresh_callback=function(e){var t;return null!=(t=this._bolt)&&t.unsubscribe(),this._bolt=null,this.loading_state=r.BOLT_NEED_TO_SEND_REQUEST,this._is_page_hidden()?void 0:this.load_contacts()},r.prototype._contacts_loaded_callback=function(e){var t,n,o,r;if(!this._is_old_contacts(e.bolt_info)&&(t=this._is_new_contacts(e.bolt_info),this.current_bolt_states=e.bolt_info,null==this._bolt&&this._subscribe_to_bolt(),t&&(null!=(n=e.contacts)?n.length:void 0)))return this._record_perf_stats(r={num_contacts:e.contacts.length}),this.digest=e.digest,this.cached_contacts=a.create_contacts_list(e.contacts),this._invoke_all_callbacks(this.cached_contacts),null!=(o=i.performance())&&"function"==typeof o.mark?o.mark(this._get_contacts_downloaded_mark_name()):void 0},r.prototype._subscribe_to_bolt=function(){var e,t,n,o;t=[],n=this.current_bolt_states;for(o in n)e=n[o],t.push(new d.SignedChannelState(r.CONTACTS_APP_ID,o.toString(),e.revision,e.token));return this._bolt=new d.BoltClient(t,this.bolt_update_callback,this.bolt_refresh_callback),this._bolt.start()},r.prototype._is_new_contacts=function(e){return this._first_contacts_are_newer(e,this.current_bolt_states)},r.prototype._is_old_contacts=function(e){return this._first_contacts_are_newer(this.current_bolt_states,e)},r.prototype._first_contacts_are_newer=function(e,t){var n,o,i,r;if(!t)return!0;for(i in t){r=t[i];for(n in e)if(o=e[n],n===i&&+r.revision<+o.revision)return!0}return!1},r.prototype._should_update_contacts=function(){return this._is_new_contacts(this._notified_states)},r.prototype._get_request_params=function(){var e;return e=this._get_versioned_params(1)},r.prototype._get_request_url=function(){return _},r}(m),g=new p,y=500,b=new p(y),"OFF"===c.LEGACY_CACHE_LIMIT?E=g:(v=+c.LEGACY_CACHE_LIMIT,E=new p(v)),{DefaultContactsCache:g,LegacyContactsCache:E,LimitedContactsCache:b,BoltContactsCache:p,ContactsCacheProto:m}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/data",["external/underscore","modules/core/exception","modules/clean/contacts/bloodhound_contacts","modules/clean/contacts/cache","modules/clean/contacts/list","modules/clean/contacts/types","modules/clean/fuzzy","modules/clean/viewer"],function(n,o,i,r,s,a,l,u){var c,d,p,h;return h=o.assert,p=r.DefaultContactsCache,c=function(){function e(e){this.dbx_account_id=e.dbx_account_id,this.type=e.type,this.name=e.name,this.email=e.email,this.fb_id=e.fb_id,this.group_id=e.group_id,this.group_size=e.group_size,this.photo_url=e.photo_url,this.members=e.members,this.avatar_url=e.avatar_url,this.invalid=e.invalid,this.on_team=e.on_team,this.dbx_team_id=e.dbx_team_id,this.nameMatch=e.nameMatch,this.emailMatch=e.emailMatch,this.pending=e.pending,this.unique_key=this.name+"-"+this.getContactID()+"-"+this.dbx_account_id}return e.prototype.getKey=function(){return"contact-"+this.type+"-"+this.unique_key},e.prototype.getContactID=function(){switch(this.type){case a.FB:return this.fb_id;case a.NEW_STYLE_GROUP:return this.group_id;default:return this.email}},e}(),d=function(){function o(t){var n;this.user=t.user,this.filterFunc=t.filterFunc,this._set_contacts=e(this._set_contacts,this),h(this.user,"must include user"),null==this.filterFunc&&(this.filterFunc=function(){return!0}),this.instance=o.INSTANCE++,n="contacts-data-source:"+this.instance,p.register_for_updates(n,this._set_contacts),this._team_members=[],this.bloodhound_contacts=new i(this.filterFunc,this.user,1e5)}return o.INSTANCE=0,o.prototype._set_contacts=function(e){var t;return this.user.is_team?(t=e.excludeNonTeam().contacts,this._team_members=n.map(t,function(e){return e.email})):void 0},o.prototype.registerForUpdates=function(e){return this.bloodhound_contacts.registerForUpdates(e)},o.prototype._isTeamContact=function(e){return this.user.is_team&&null!=e.team&&e.team},o.prototype.isTeamEmail=function(e){return this.user.is_team&&t.call(this._team_members,e)>=0},o.prototype._process_matches=function(e,t,n){var o,i,r,u,d,p;for(null==n&&(n=null),i=[],p=s.create_contacts_list(e).includeForUser(this.user.id).contacts,r=0,u=p.length;u>r;r++)d=p[r],n&&(d.nameMatch=l.match(n,d.name||""),d.emailMatch=l.match(n,d.email||"")),d.on_team=d.type!==a.FB&&this._isTeamContact(d),o=new c(d),o.pending=!1,i.push(o);return t(i)},o.prototype.query=function(e,t){return""===e.trim()?t([]):this.bloodhound_contacts.get(e,function(n){return function(o){return n._process_matches(o,t,e)}}(this))},o.prototype.query_batch=function(e,t){var o,i,r,s,a,l;for(r={},s=0,a=e.length;a>s;s++)o=e[s],o.pending=!1,r[o.getContactID()]=o;return i=function(e){var n,o,i;for(o=0,i=e.length;i>o;o++)n=e[o],r[n.getContactID()]=n;return t(r)},l=function(e){return function(t){return e._process_matches(t,i)}}(this),this.bloodhound_contacts.get(n.keys(r),l)},o}(),{Contact:c,ContactTypes:a,ContactsDataSource:d}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/contacts/facebook_modal",["modules/clean/dbmodal"],function(n){var o,i;return o=n.DBUserModal,i=function(n){function o(t,n,i){this.show_hidden_modal=n,this.link_with_facebook=i,this.on_confirm_button_click=e(this.on_confirm_button_click,this),this.on_hide=e(this.on_hide,this),o.__super__.constructor.call(this,t,{element_id:"facebook-confirm-modal-user-"+t.id})}return t(o,n),o.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},o.prototype.on_confirm_button_click=function(e){return this.hide(),this.link_with_facebook()},o}(o)})}.call(this),function(){define("modules/clean/contacts/facebook_oauth",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,o,i,r){var s,a;return a=t.assert,s={do_auth:function(e,t){var o;return a(null!=t,"user_id must be specified"),o=window.open(n({path:"/fb/access_token"}).updateQuery(r.UID_PARAM_NAME,t).toString(),"fb_auth","width=600,height=450"),e?s.onLoginSuccessCallback=e:void 0},post:function(e,t,r,l,u,c,d){return a(null!=d,"user_id must be specified!"),i.get_viewer().is_signed_in?("function"==typeof s.custom_show_posting&&s.custom_show_posting(),new o.WebRequest({url:"/fb/post",data:{message:e,link:t,link_name:r,description:l,from_referrals:s.from_referrals,from_getspace:s.from_getspace,picture:u?u:""},success:function(n,o,i){var a;return a=i.responseText,0===a.indexOf("ok")?"function"==typeof s.custom_show_complete?s.custom_show_complete():void 0:0===a.indexOf("auth")?s.do_auth(function(){return s.post(e,t,r,l,u,c,d)},d):void 0},error:function(){return"function"==typeof c?c():void 0},subject_user:d})):void window.open(n.parse("http://www.facebook.com/sharer.php").setQuery({u:t,t:r}).toString())}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(n,o,i){var r;return r=function(){function n(t){var n;this.contacts=t,this._lowercaseContact=e(this._lowercaseContact,this),this._excludeType=e(this._excludeType,this),this.sortByTeamFirst=e(this.sortByTeamFirst,this),this.excludeSuspended=e(this.excludeSuspended,this),this.excludeNonTeamActive=e(this.excludeNonTeamActive,this),this.excludeNonTeam=e(this.excludeNonTeam,this),this.excludePairedUserDuplicates=e(this.excludePairedUserDuplicates,this),this.excludeTeamMembers=e(this.excludeTeamMembers,this),this.excludeFacebook=e(this.excludeFacebook,this),this.excludeNewStyleGroups=e(this.excludeNewStyleGroups,this),this.excludeMe=e(this.excludeMe,this),this.excludeByEmail=e(this.excludeByEmail,this),this.includeForViewer=e(this.includeForViewer,this),this.includeForUser=e(this.includeForUser,this),this.slice=e(this.slice,this),this.length=e(this.length,this),this.filterContacts=e(this.filterContacts,this),this.lcontacts=function(){var e,t,o,i;for(o=this.contacts,i=[],e=0,t=o.length;t>e;e++)n=o[e],
i.push(this._lowercaseContact(n));return i}.call(this)}return n.create_contacts_list=function(e){return new n(e)},n.prototype.filterContacts=function(e){var t;return t=this.contacts.filter(e),new n(t)},n.prototype.length=function(){return this.contacts.length},n.prototype.slice=function(e,t){return new n(this.contacts.slice(e,t))},n.prototype.includeForUser=function(e){return this.filterContacts(function(t){return t.owning_user_id===e})},n.prototype.includeForViewer=function(e){var n;return n=e.get_user_ids(),this.filterContacts(function(e){var o;return o=e.owning_user_id,t.call(n,o)>=0})},n.prototype.excludeByEmail=function(e){return e=e?e.toLowerCase():"",this.filterContacts(function(t){return!(e===t.email.toLowerCase())})},n.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},n.prototype.excludeNewStyleGroups=function(){return this._excludeType(i.NEW_STYLE_GROUP)},n.prototype.excludeFacebook=function(){return this._excludeType(i.FB)},n.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},n.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},n.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},n.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},n.prototype.excludeSuspended=function(){return this.filterContacts(function(e){return"suspended"!==e.join_state})},n.prototype.sortByTeamFirst=function(){return new n(n.sortContactsByTeamFirst(this.contacts))},n.sortContactsByTeamFirst=function(e){var t,n,o,i,r;for(r=[],i=[],n=0,o=e.length;o>n;n++)t=e[n],t.team?r.push(t):i.push(t);return r.concat(i)},n.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},n.prototype._lowercaseContact=function(e){var t,n,o;n={};for(t in e)o=e[t],("string"==typeof o||o instanceof String)&&(o=o.toLowerCase()),n[t]=o;return n},n}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/tokenizer",["external/classnames","external/react","external/underscore","modules/core/browser","modules/core/i18n","modules/clean/analytics","modules/clean/avatar/contact_avatar","modules/clean/contacts/cache","modules/clean/contacts/data","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/em_string","modules/clean/tokenizer","modules/clean/validators/validators","jquery"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m){var f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D;return A=r._,g=s.ContactSearchLogger,S=l.DefaultContactsCache,f=u.Contact,E=u.ContactsDataSource,T=c.ContactsTypeaheadSelector,P=h.Tokenizer,N=n.createElement,R=n.DOM,I=16,C=100,D=_.check(_.create(["EmailValidator"])),v={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"},b=n.createClass({displayName:"ContactsToken",propTypes:{customClass:n.PropTypes.string,className:n.PropTypes.string,contact:n.PropTypes.object.isRequired,onRemove:n.PropTypes.func,tabIndex:n.PropTypes.number,tokenState:n.PropTypes.oneOf(function(){var e;e=[];for(k in v)O=v[k],e.push(O);return e}()).isRequired},render:function(){var e,n;return n={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===v.invalid,warned:this.props.tokenState===v.warn,pending:this.props.tokenState===v.pending},n[this.props.customClass]=null!=this.props.customClass,n[this.props.className]=null!=this.props.className,e=t(n),R.a(m.extend({tabIndex:-1},this.props,{className:e}),this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton())},_getTokenName:function(){switch(this.props.contact.type){case d.FB:return"fb_ids";case d.EMAIL:return"emails";case d.NEW_STYLE_GROUP:return"new_style_group_ids";default:return"invalids"}},_getTokenValue:function(){switch(this.props.contact.type){case d.FB:return this.props.contact.fb_id;case d.NEW_STYLE_GROUP:return this.props.contact.group_id;default:return this.props.contact.email}},_renderIcon:function(){return this.props.contact.type===d.FB?R.img({className:"token-icon",src:"/static/images/icons/fb_16-vflbiYTkC.png"}):this.props.contact.type===d.NEW_STYLE_GROUP||this.props.contact.dbx_account_id?N(a,{dimension:I,contact:this.props.contact,optionalClass:"token-icon"}):""},_renderInput:function(){return R.input({type:"hidden",name:this._getTokenName(),value:this._getTokenValue()})},_renderText:function(){var e,t;return e=22,t=this.props.contact.name||this.props.contact.email,p.em_snippet(t,e)},_makeCloseButton:function(){return this.props.onRemove?R.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(e.props.contact),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),y={basic:function(e){var t;return t=e.name&&!e.invalid&&e.email!==e.name,{state:e.invalid?v.invalid:v.ok,msg:t?e.email:null}},warn:function(e){return{state:e.pending?v.pending:e.on_team?v.ok:e.invalid?v.invalid:v.warn,msg:null}},forbid:function(e){return{state:e.pending?v.pending:e.on_team?v.ok:v.invalid,msg:null}}},w=n.createClass({displayName:"ContactsTokenizer",propTypes:{user:n.PropTypes.object.isRequired,context:n.PropTypes.string,customClass:n.PropTypes.string,customContactFilter:n.PropTypes.func,customContactValidator:n.PropTypes.func,focusOnMount:n.PropTypes.bool,id:n.PropTypes.string,onContentsChange:n.PropTypes.func,placeholder:n.PropTypes.string,populatedInputData:n.PropTypes.shape({tokens:n.PropTypes.array,value:n.PropTypes.string}),tabIndex:n.PropTypes.number,showContactImport:n.PropTypes.bool,shouldLogContactSearch:n.PropTypes.bool,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),tokenSpacing:n.PropTypes.number},getDefaultProps:function(){return{customContactFilter:function(e){return!0},customContactValidator:y.basic,focusOnMount:!1,id:null,placeholder:A("Invite more people"),populatedInputData:{tokens:[],value:""},tokenSpacing:4,showContactImport:!1,shouldLogContactSearch:!1,teamGroupInfo:null}},componentWillReceiveProps:function(e){var t;e.user===this.props.user&&e.customContactFilter.toString()===this.props.customContactFilter.toString()||(this.contactsDataSource=new E({user:e.user,filterFunc:e.customContactFilter})),this._validateTokens(null!=(t=e.populatedInputData)?t.tokens:void 0)},componentWillMount:function(){var e;this.contactsDataSource=new E({user:this.props.user,filterFunc:this.props.customContactFilter}),this._validateTokens(null!=(e=this.props.populatedInputData)?e.tokens:void 0,!0)},componentDidMount:function(){var e,t,n,o,i;return this.props.shouldLogContactSearch&&(this.contact_search_logger=new g(this._getLoggingContext()),this.unanswered_contact_search_queries={}),this.props.populatedInputData.tokens.length>0||(null!=(t=this.props.populatedInputData.value)?t.length:void 0)>0?(n=this.serializeInputData(),o=n.tokens,i=n.value,"function"==typeof(e=this.props).onContentsChange?e.onContentsChange(o,i):void 0):void 0},_validateTokens:function(e,t){var n,o,i,r;if(null==t&&(t=!1),(null!=e?e.length:void 0)>0){for(i=[],n=0,o=e.length;o>n;n++)r=e[n],r.type===d.EMAIL&&(r.invalid=!D(r.email)),t?i.push(r.pending=!0):i.push(void 0);return i}},finishLogging:function(e){var t,n,o;return o=S.get_contacts_count(),this._flush_unanswered_queries_cache(),n=S.get_request_perf_records(),t=n.length?n[n.length-1]:null,this.contact_search_logger.add_downloading_stats(t),this.props.shouldLogContactSearch?this.contact_search_logger.log_records(this.props.user.id,e,o):void 0},_logTokenChangeEvent:function(e,t,n){var o;if(null==t&&(t=!1),null==n&&(n={}),this.contact_search_logger){if(t)return this.contact_search_logger.flag_record_as_removed(e.getContactID());o={context:this._getLoggingContext(),contact_type:e.type,contact_id:e.getContactID(),contact_name:e.name,sort_variant:null};for(k in n)O=n[k],o[k]=O;return this.contact_search_logger.add_record(o)}},_logSearchComplete:function(e,t){var n,o,r,s,a,l,u;if(this._shouldLogSearch()&&e)return s=i.performance().now(),a=this.unanswered_contact_search_queries[e],this._flush_unanswered_queries_cache(s),null!=a&&(o=s-a,l=o>C)?(n=S.get_downloaded_time(),u=null!=n?n>a:!0,r={context:this._getLoggingContext(),query_length:e.length,duration:Math.floor(o),num_results:t,started_before_download:u},this.contact_search_logger.add_timing_record(r)):void 0},_logSearchBegin:function(e){var t;if(this._shouldLogSearch()&&e)return t=i.performance().now(),this._flush_unanswered_queries_cache(t),this.unanswered_contact_search_queries[e]=t},_shouldLogSearch:function(){var e;return this.props.shouldLogContactSearch&&null!=this.contact_search_logger&&null!=(null!=(e=i.performance())?e.now:void 0)},_flush_unanswered_queries_cache:function(e){var t,n,o,r;if(this._shouldLogSearch()){null==e&&(e=i.performance().now()),n=this.unanswered_contact_search_queries;for(t in n)r=n[t],o=e-r>C,this.contact_search_logger.count_search(o);return this.unanswered_contact_search_queries={}}},_getLoggingContext:function(){var e;return e="react_tokenizer",null!=this.props.context&&(e+="_"+this.props.context),e},addExternalContacts:function(e){return this.refs.tokenizer.addExternalTokens(e)},render:function(){return N(P,{ref:"tokenizer",dataSource:this.contactsDataSource,customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:function(e){return function(){return N(T,{showContactImport:e.props.showContactImport,teamGroupInfo:e.props.teamGroupInfo,user:e.props.user})}}(this),renderInput:function(e){return function(){return R.textarea({className:"contacts-tokenizer-input",id:e.props.id,rows:1})}}(this),renderToken:this._renderToken,renderTokenHover:this._renderTokenHover,onContentsChange:this.props.onContentsChange,onTokensAdd:this._lookupTokens,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens,tabIndex:this.props.tabIndex,tokenSpacing:this.props.tokenSpacing,focusOnMount:this.props.focusOnMount,logSearchBegin:this._logSearchBegin,logSearchComplete:this._logSearchComplete,logTokenChangeEvent:this._logTokenChangeEvent},this.props.children)},_renderToken:function(e){return N(b,{contact:e,tokenState:this.props.customContactValidator(e).state})},_renderTokenHover:function(e){return this.props.customContactValidator(e).msg},_lookupTokens:function(t,n){var o;return o=t.filter(function(e){return e.pending}),this.contactsDataSource.query_batch(o,function(o){return function(i){var r,s,a,l,u,c;for(t=[],r=o.serializeInputData(n).tokens,s=[],a=0,l=r.length;l>a;a++)c=r[a],u=i[c.getContactID()]||c,k=u.getKey(),e.call(s,k)>=0||(s.push(k),t.push(u));return n.replaceTokens(t)}}(this))},tokenizeEmails:function(e,t){var n,o,i,r,s,a,l,u,c,p;for(null==t&&(t=!1),n=/[,|;\n]+/,o=/[,|;\n ]+/,a=e.split(o),u=2===a.length&&D(a[0])&&""===a[1]?a:e.split(n),p="",t||(p=u.pop()),c=[],r=0,s=u.length;s>r;r++)l=u[r],i=l.trim(),""!==i&&c.push(new f({name:i,email:i,type:d.EMAIL,invalid:!D(i),on_team:this.refs.tokenizer.props.dataSource.isTeamEmail(i),pending:!0}));return{tokens:c,value:p}},serializeInputData:function(e){return e=e||this.refs.tokenizer,e.serializeInputData()},getContacts:function(){var e,t,n,o;return e=this.serializeInputData(),n=e.tokens,o=e.value,t=this.tokenizeEmails(o,!0),n.concat(t.tokens)},tokenizeAll:function(){return this.refs.tokenizer.tokenizeAll()}}),{ContactsTokenizer:w,ContactTokenValidator:y,ContactTokenState:v}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/typeahead",["jquery","external/classnames","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/avatar/contact_avatar","modules/clean/contacts/util","modules/clean/css","modules/clean/profile_services/profile_services_constants","modules/clean/profile_services/profile_services_link","modules/clean/contacts/types","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/paging_list","modules/clean/static_urls","modules/clean/typeahead","modules/clean/em_string"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y){var E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M;return O=r.assert,k=s._,C=p.LinkedProfileServices,I=p.ProfileServicesLinkingHandler,M=g.static_url,R=v.TypeaheadSelectorMixin,F=o.DOM,D=o.createElement,x=function(e,t){return i.extend({},e,t)},P=32,b=x(R,{getOptions:function(){var e,t,n;return null==this.props.queryOptions?[]:this.state.importsExpanded?function(){var e,n,o,i;for(o=d.importable_contact_services(),i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(new A({provider:t,connected:this.profile_services.service_is_connected(t)}));return i}.call(this):(e=this.props.queryOptions.slice(0),this.props.teamGroupInfo?e.push(u.teamGroupInfoToContact(this.props.teamGroupInfo)):(null!=(n=this.profile_services)?n.has_unconnected_services(!0):void 0)&&e.push(new T),e)},renderOption:function(e){return e instanceof T?D(S):e instanceof A?D(N,{import:e}):this.props.renderQueryOption(e)},onSelect:function(t){var n,o;return t instanceof T?(this._changeSelectionIndex(0),this.setState({importsExpanded:!0})):t instanceof A?(O((o=t.provider,e.call(d.contact_services(),o)>=0),"invalid party contact provider "+t.provider),this.profile_services.service_is_connected(t.provider)?(n=k("You're already connected to %(service_name)s").format({service_name:d.to_name(t.provider)}),void a.success(n)):this.link_handler.auth_service_with_user(t.provider,this.props.user.id,function(e){return function(e){return I.show_import_notifications(e)}}(this))):this.props.onSelect(t)},reset:function(){return this._changeSelectionIndex(0),this.setState({importsExpanded:!1})}}),E=o.createClass({displayName:"ContactsTypeaheadSelector",mixins:[b],propTypes:{customClass:o.PropTypes.string,onClose:o.PropTypes.func.isRequired,onSelect:o.PropTypes.func.isRequired,queryOptions:o.PropTypes.array,renderQueryOption:o.PropTypes.func.isRequired,showContactImport:o.PropTypes.bool,teamGroupInfo:o.PropTypes.shape({id:o.PropTypes.string,name:o.PropTypes.string}),user:o.PropTypes.object.isRequired},componentWillMount:function(){return this.link_handler=new I,this.profile_services=null,null===this.props.teamGroupInfo&&this.props.showContactImport&&null!=this.props.user?this.profile_services=C.get_linked_profile_services_for_user(this.props.user.id):void 0},componentWillReceiveProps:function(e){var t;return 0===(null!=(t=e.queryOptions)?t.length:void 0)?this._changeSelectionIndex(-1):void 0},shouldComponentUpdate:function(e,t){return!i.isEqual(e,this.props)||!i.isEqual(t,this.state)},getDefaultProps:function(){return{showContactImport:!1,teamGroupInfo:null,onSelect:function(e){},renderQueryOption:function(e){return D(w,{contact:e})}}},onSelectionIndexChange:function(e){var t;return null!=(t=this.refs.pagingList)?t.scrollAround(e):void 0},render:function(){var e;return c.require_css("/static/css/react/contacts_typeahead-vflRzfV9H.css"),this.getOptions().length?(e={"typeahead-selector":!0,"contacts-selector":!0},e[this.props.customClass]=null!=this.props.customClass,D(f,{customClass:n(e),pageSize:4,itemSize:54,ref:"pagingList"},this.renderOptions())):F.div({})}}),w=o.createClass({displayName:"ContactsTypeaheadSelectorOption",propTypes:{contact:o.PropTypes.object.isRequired,customClass:o.PropTypes.string},render:function(){var e,t,o,r,s;return e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,null!=this.props.className&&(e[this.props.className]=!0),o={primary:this._renderPrimary(),secondary:this._renderSecondary()},o=i.pick(o,function(e){return""!==e}),F.li(x(this.props,{className:n(e)}),D(_,{leftAttachment:this._renderIcon()},function(){var a;a=[];for(r in o)s=o[r],e={"option-only":1===i.size(o)},e["option-"+r]=!0,a.push(t=F.div({className:n(e),key:"option-"+r},s));return a}()))},_renderPrimary:function(){return this._renderMatch(this.props.contact.name,this.props.contact.nameMatch)},_renderSecondary:function(){switch(this.props.contact.type){case h.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case h.FB:return k("Facebook message");case h.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},_renderMatch:function(e,t){var n,o,i,r,s,a,l,u,c,d,p,h;if(n=22,e&&(e=y.em_snippet(e,n)),!t)return e;for(d=e.indexOf("…"),a=0,c=[],p=t.highlighted,r=0,l=p.length;l>r;r++)h=p[r],s=h[0],u=h[1],s>a&&c.push(e.slice(a,s)),o=s+u,o>d&&-1!==d&&(o=d),i=e.slice(s,o),c.push(F.strong({key:"highlight-"+i+"-"+s},i)),a=o;return a<e.length&&c.push(e.slice(a)),c},_renderIcon:function(){return F.div({className:"u-pad-right-xs"},D(l,{dimension:P,contact:this.props.contact,optionalClass:"contact-icon"}))}}),T=function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e}(),S=o.createClass({displayName:"ExpandImportOption",render:function(){var e;return e={"expand-imports-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),F.li(x(this.props,{className:n(e)}),D(_,{leftAttachment:D(m,{className:"u-pad-right-xs",src:M("/static/images/icons/icon-import-vflOL9sCs.png"),srcHiRes:M("/static/images/icons/icon-import@2x-vfluE8TBO.png")})},F.div({className:"option-primary option-only"},k("Import contacts"))))}}),A=function(){function e(e){this.provider=e.provider,this.connected=e.connected}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e}(),N=o.createClass({displayName:"ThirdPartyImportOption",getInitialState:function(){return{showSpinner:!1}},propTypes:{import:o.PropTypes.object.isRequired},componentWillMount:function(){return t(document).on("db:profile_service:auth_complete",function(e){return function(t){return e.show_contact_import_spinner(t)}}(this))},show_contact_import_spinner:function(e){return this.props.import.provider===e.provider?this.setState({showSpinner:!0}):void 0},render:function(){var e,t,o,i,r,s;return s=this.props.import,i=s.provider,t=s.connected,r=d.to_name(i),!t&&this.state.showSpinner&&(r=k("Importing %(service_name)s Contacts").format({service_name:r})),o=t?k("Connected"):"",e={"third-party-option":!0,"contacts-typeahead-option":!0},null!=this.props.className&&(e[this.props.className]=!0),F.li(x(this.props,{className:n(e)}),!t&&this.state.showSpinner?F.div({className:"option-spinner"},F.img({src:"/static/images/icons/ajax-loading-small-blue-vflm7vRcz.gif"})):void 0,D(_,{spacing:"xs",leftAttachment:D(m,{alt:"",src:M(d.to_img(i)[0]),srcHiRes:M(d.to_img(i)[1])})},F.div({className:n({"option-primary":!0,"option-only":!t})},r,t?F.div({className:"option-secondary u-font-meta"},o):void 0)))}}),{ContactsTypeaheadSelector:E,ContactsTypeaheadSelectorOption:w,ExpandImportOption:S,ThirdPartyImportOption:N}})}.call(this),function(){define("modules/clean/contacts/types",[],function(){var e;return e={EMAIL:0,FB:1,INVALID:2,NEW_STYLE_GROUP:4,DBX_ID:6}})}.call(this),function(){define("modules/clean/contacts/util",["modules/clean/contacts/data","modules/clean/contacts/types"],function(e,t){var n,o;return n=e.Contact,o=function(){function e(){}return e.activityUserToContact=function(e,n){return null==n&&(n=0),{dbx_account_id:e.unique_id,fname:e.fname,lname:e.lname,name:e.display_name,name_tokens:[e.fname,e.lname],email:e.email,type:t.DBX_ID,priority:n,photo_url:e.photo_circle_url}},e.teamGroupInfoToContact=function(e){return new n({group_id:e.id,group_size:e.group_size,type:t.NEW_STYLE_GROUP,name:e.name,on_team:!0,pending:!1})},e}()})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/dbmodal_loading",["modules/clean/dbmodal","modules/clean/uirequest"],function(t,n){var o;return o=function(t){function o(e){o.__super__.constructor.call(this,e)}return e(o,t),o.prototype.on_show=function(){return this.fetch()},o.prototype.fetch=function(){return new n(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,error:function(e){return function(t,n,o){return e.hide()}}(this)})},o.prototype.on_confirm_button_click=null,o.prototype.on_cancel_button_click=null,o}(t.DBModal)})}.call(this),function(){define("modules/clean/display_format",["modules/core/i18n"],function(e){var t,n,o;return t=e._,o=function(n,o){var i,r,s;return null==o&&(o=2),n=parseFloat(n),i=Math.abs(n),1024>i?(o=0,r=n,s=e.ungettext("byte","bytes",n)):921600>i?(r=n/1024,s=t("KB")):943718400>i?(r=n/1048576,s=t("MB")):966367641600>i||0===o&&1099511627776>n?(r=n/1073741824,s=t("GB")):(r=n/1099511627776,s=t("TB")),r=Math.round(r*Math.pow(10,o))/parseFloat(Math.pow(10,o)),r=r.toFixed(o),r+" "+s},n={format_bytes:o}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/downloads",["jquery","modules/clean/filepath","modules/constants/env","modules/constants/python","modules/constants/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m;return m=a.assert,_=l._,h=[o.BLOCK_CLUSTER,o.PUBSERVER],d=_("There was an error downloading your file."),p=function(){function a(){}return a.get=function(n){var o,r,l,p,_,f,g,v,y;return y=n.url,p=n.error,_=n.expected_domain,l=c.parse(y),o=_||l.authority,m(e.call(h,o)>=0),s.iOS?(m((v=l.authority,e.call(["",window.location.host].concat(h),v)>=0)),void s.unsafeRedirect(y)):(a.initialized||a.init(),r=a._create_download_id(),g={},g[i.DOWNLOAD_ID_PARAM_NAME]=r,g[i.DOWNLOADS_NOTIFY_DOMAIN_PARAM_NAME]=window.location.host,l.updateQuery(g),f=t("<iframe />",{src:String(l)}).css("display","none"),f.on("load",function(){var e;return e=function(){var e;return e=a.current_watches[r],null!=e?(s.chrome&&(u.error(d),"function"==typeof e.error&&e.error()),a._cleanup(r)):void 0},setTimeout(e,100)}),a.current_watches[r]={origin:o,error:p,iframe:f},t("body").append(f),window.setTimeout(function(){return a._cleanup(r)},9e4),!1)},a.get_blockserver_link=function(e){var t,n,i,r,s;return s=e.url,n=e.ns_id,i=e.ns_path,t=e.error,r=c.parse(s),r.setScheme("https"),r.updateQuery({dl:1}),null!=n&&(m("string"==typeof i,"Namespace ID was passed with invalid path, got: "+i),r.updateQuery({nsid:n}),r.updateQuery({path:i})),m(r.authority===o.BLOCK_CLUSTER,"download_blockserver_url expects a blockserver resource, got: "+s),this.get({url:r.toString(),error:t})},a.zip_batch_by_ns_id=function(e){var i,s,a,l,u,d,p,h,_,m,f,g,v;for(f=e.parent_ns_id,g=e.parent_ns_path,l=e.files,v=e.subject_uid,i=e.block_hash,d=c({scheme:"https",authority:o.BLOCK_CLUSTER,path:"/zip_batch_by_ns_id"}).updateQuery(r.UID_PARAM_NAME,v),d.updateQuery({parent_ns_id:f,parent_ns_path:g||"/"}),d=d.toString(),u=t("<form>",{action:d,method:"post"}),h=0,_=l.length;_>h;h++)s=l[h],a=n.filename(s.fq_path),m=g+"/"+a,p=t("<input>",{name:"ns_paths",value:m}),p.appendTo(u);return p=t("<input>",{name:"w",value:i}),p.appendTo(u),t(document.body).append(u),u.submit(),u.remove()},a.get_zip=function(e){var n,i,s,a,l,u,d,p,h,_;for(s=e.fq_paths,_=e.subject_uid,n=e.block_hash,p=e.parent_path,a=c({scheme:"https",authority:o.BLOCK_CLUSTER,path:"/zip_batch"}).updateQuery(r.UID_PARAM_NAME,_).toString(),h=t("<form>",{action:a,method:"post"}),u=0,d=s.length;d>u;u++)i=s[u],l=t("<input>",{name:"files",value:i}),l.appendTo(h);return l=t("<input>",{name:"parent_path",value:p||"/"}),l.appendTo(h),l=t("<input>",{name:"w",value:n}),l.appendTo(h),t(document.body).append(h),h.submit(),h.remove()},a.init=function(){return a.initialized=!0,a.current_watches={},t(window).on("message",a._post_handler)},a._post_handler=function(t){var n,o,i,r;if(n=c.parse(t.originalEvent.origin),"https"===n.scheme&&(i=n.authority,!(e.call(h,i)<0))){try{o=JSON.parse(t.originalEvent.data)}catch(e){return}if(null!=(null!=o?o.download_id:void 0)&&(r=a.current_watches[o.download_id],null!=r&&n.authority===r.origin&&t.originalEvent.source===r.iframe[0].contentWindow))return"failed"===o.status&&(u.error(o.message||d),"function"==typeof r.error&&r.error()),a._cleanup(o.download_id)}},a._cleanup=function(e){var t;return t=this.current_watches[e],null!=t?(t.iframe.remove(),delete this.current_watches[e]):void 0},a._create_download_id=function(){var e,t,n;for(n="",e=t=1;4>=t;e=++t)n+=String(Math.random()).split(".")[1];return n},a}()})}.call(this),function(){define("modules/clean/events/rollback",["jquery","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/react/modal","modules/clean/ajax"],function(e,t,n,o,i,r,s,a,l){var u,c,d;return d=o._,c=s.SupportExperimentsWebLogger,u={configureAllLinks:function(t,n,o,i,r){return null==o&&(o=null),null==i&&(i=void 0),null==r&&(r=void 0),e(t).on("click",n,function(t){var n,s,l,p,h,_;return null!=o&&c.log_file_restore(o),n=e(t.target),_=n.data("user-id"),l=n.data("ns-id"),s=n.data("cs-id"),p=n.data("redirect"),null==p&&(p=!0),h=i?n.data("sjids"):null,a.SimpleModal.show({title_text:d("Undo this deletion"),body_html:d("Are you sure you want to undo this deletion?"),confirm_text:d("Undo deletion"),confirm_callback:function(){return u.rollback(_,l,s,p,r,h,i)},cancel_text:d("Cancel")}),!1})},configureLink:function(t,o,i,r,s,l){return e(t).on("click",function(e){return e.stopPropagation(),a.SimpleModal.show({title_text:o,body_html:n.escape(i).toHTML(),confirm_text:d("Restore"),confirm_callback:function(){return u.rollback(r,s,l)},cancel_text:d("Cancel")}),!1})},rollback:function(e,n,o,s,a,u,c){var p;return null==a&&(a=void 0),null==u&&(u=null),null==c&&(c=!1),p={},c?(p[n]=u,l.WebProgressRequest({url:"/cmd/restore_sjids",data:{ns_to_sjids:JSON.stringify(p)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){return i.success(d("Finished restoring files.")),"function"==typeof a&&a(),s?t.redirect(r({path:"/browse_cs/"+e+"/"+n+"/"+o})):void 0}})):(p[n]=o,l.WebProgressRequest({url:"/cmd/restore_changesets",data:{ns_to_cs:JSON.stringify(p)},subject_user:e,html_in_error_msg:!0,progress_text:d("Restoring files..."),success:function(){return i.success(d("Finished restoring files.")),"function"==typeof a&&a(),s?t.redirect(r({path:"/browse_cs/"+e+"/"+n+"/"+o})):void 0}}))}}})}.call(this),function(){define("modules/clean/file_activity/api",["external/underscore","modules/core/types","modules/clean/ajax","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/file_activity","external/rsvp"],function(e,t,n,o,i,r){var s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z;return V=t.takes,M=t.returns,m=t.Maybe,u=t.Either,a=o.CommentActivity,h=i.FileActivity,f=r.Promise,w={actorId:m(Number),oref:m(String),isBackgroundRequest:m(Boolean)},P=function(t){var o,i,r,s,a,l,u,c;return c=t.url,u=t.type,i=t.data,o=t.actorId,s=t.oref,r=t.isBackgroundRequest,l=r?n.SilentBackgroundRequestOref:n.WebRequestOref,a=new f(function(t,n){return l({url:c,type:u,data:e.extend({oref:s},i),subject_user:o,success:t,error:function(e,t,o){return n(Error(o))}})}),a.then(JSON.parse)},S=function(e){var t,n,o;if("error"===e.status)throw n=null!=(o=e.payload)?o.error_text:void 0,t=Error(n),t.payload=e.payload,t.error_text=n,t;return e.payload},C=function(e){var t,n;return n=S(e),t=e.bolt_data,[n,t]},T=function(e){return h.fromDict(e)},s=e.extend({commentActivityKey:m(String),context:Number,contextData:String,text:String,metadata:m(Object)},w),A=V(s,M(f,function(e){var t,n,o,i,r,s,l,u;return t=e.actorId,n=e.commentActivityKey,o=e.context,i=e.contextData,u=e.text,s=e.metadata,l=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment",type:"POST",data:{activity_context:o,activity_context_data:i,comment_text:u,comment_metadata_json:JSON.stringify(s),target_comment_activity_key:n},oref:l,isBackgroundRequest:r}).then(S).then(a.fromDict)})),l=e.extend({commentActivityKey:String,context:Number,contextData:String},w),N=V(l,M(f,function(e){var t,n,o,i,r,s;return t=e.actorId,n=e.commentActivityKey,o=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/delete",type:"POST",data:{comment_key:n,activity_context:o,activity_context_data:i},oref:s,isBackgroundRequest:r}).then(S)})),y=e.extend({liked:Boolean,commentActivityKey:String,context:Number,contextData:String},w),j=V(y,M(f,function(e){var t,n,o,i,r,s,a;return t=e.actorId,s=e.liked,n=e.commentActivityKey,o=e.context,i=e.contextData,a=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/like",type:"POST",data:{activity_key:n,activity_context:o,activity_context_data:i,liked:s},oref:a,isBackgroundRequest:r}).then(S)})),v=e.extend({enableComment:Boolean,context:Number,contextData:String},w),W=V(v,M(f,function(e){var t,n,o,i,r,s;return t=e.actorId,i=e.enableComment,n=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/feedback_setting",type:"POST",data:{activity_context:n,activity_context_data:o,feedback_off:!i},oref:s,isBackgroundRequest:r}).then(S)})),E=e.extend({resolved:Boolean,commentActivityKey:String,context:Number,contextData:String},w),z=V(E,M(f,function(e){var t,n,o,i,r,s,a;return t=e.actorId,a=e.resolved,n=e.commentActivityKey,o=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/comment/resolve",type:"POST",data:{activity_key:n,activity_context:o,activity_context_data:i,resolved:a},oref:s,isBackgroundRequest:r}).then(S)})),_=e.extend({commentActivityKeys:Array,context:Number,contextData:String},w),F=V(_,M(f,function(e){var t,n,o,i,r,s;return t=e.actorId,n=e.commentActivityKeys,o=e.context,i=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/mark_comment_seen_batch",type:"POST",data:{comment_activity_keys:JSON.stringify(n),activity_context:o,activity_context_data:i},oref:s,isBackgroundRequest:r}).then(S)})),p=e.extend({context:Number,contextData:String},w),I=function(e){var t,n,o,i,r;return t=e.actorId,n=e.context,o=e.contextData,r=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/file_activity",type:"GET",data:{activity_context:n,activity_context_data:o},oref:r,isBackgroundRequest:i})},O=V(p,M(f,function(e){return I(e).then(S).then(T)})),D=V(p,M(f,function(e){return I(e).then(C).then(function(e){var t,n;return t=e[0],n=e[1],[T(t),n]})})),d=e.extend({context:Number,contextDataList:Array},w),k=V(d,M(f,function(t){var n,o,i,r,s;return n=t.actorId,o=t.context,i=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,P({actorId:n,url:"/file_activity/file_activity_batch",type:"GET",data:{activity_context:o,activity_context_data_batch:JSON.stringify(i)},oref:s,isBackgroundRequest:r}).then(function(t){return e.mapObject(t,T)})})),b=e.extend({targetUserEmail:m(String),subscribed:Boolean,context:Number,contextData:String},w),G=V(b,M(f,function(e){var t,n,o,i,r,s,a;return t=e.actorId,a=e.targetUserEmail,s=e.subscribed,n=e.context,o=e.contextData,r=e.oref,i=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/subscribe",type:"POST",data:{activity_context:n,activity_context_data:o,subscribed:s,target_user_identifier:a},oref:r,isBackgroundRequest:i}).then(S)})),c=e.extend({context:Number,contextDataList:Array},w),R=V(c,M(f,function(t){var n,o,i,r,s;return n=t.actorId,o=t.context,i=t.contextDataList,s=t.oref,r=t.isBackgroundRequest,P({actorId:n,url:"/file_activity/comment_status_batch",type:"POST",data:{activity_context:o,activity_context_data_batch:JSON.stringify(i)},oref:s,isBackgroundRequest:r}).then(S).then(function(t){return e.mapObject(t,function(e){var t,n,o;return n=e.feedback_off,
t=e.comment_count,o=e.unresolved_comment_count,{feedback_off:n,comment_count:t,unresolved_comment_count:o}})})})),g=e.extend({feedbackText:String,context:Number,contextData:String},w),q=V(g,M(f,function(e){var t,n,o,i,r,s;return t=e.actorId,i=e.feedbackText,n=e.context,o=e.contextData,s=e.oref,r=e.isBackgroundRequest,P({actorId:t,url:"/file_activity/product_feedback",type:"POST",data:{activity_context:n,activity_context_data:o,feedback_text:i},oref:s,isBackgroundRequest:r}).then(S)})),x=V({actorId:Number},M(f,function(e){var t,o;return t=e.actorId,o=new f(function(e,o){return n.SilentBackgroundRequestOref({url:"/file_activity/mark_commenting_onboarding_seen",type:"POST",success:e,error:o,subject_user:t})}),o.then(JSON.parse).then(S)})),H=V({actorId:Number},M(f,function(e){var t,o;return t=e.actorId,o=new f(function(e,o){return n.SilentBackgroundRequestOref({url:"/file_activity/should_show_commenting_onboarding",type:"POST",success:e,error:o,subject_user:t})}),o.then(JSON.parse).then(S)})),L=V({actorId:Number,shouldShow:Boolean},M(f,function(e){var t,n;return t=e.actorId,n=e.shouldShow,P({actorId:t,url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:n}}).then(S)})),U=V({shouldShow:Boolean},M(f,function(e){var t;return t=e.shouldShow,P({url:"/file_activity/set_commenting_pane_visibility",type:"POST",data:{show_pane:t}}).then(S)})),B=V({actorId:Number,shouldShow:Boolean},M(f,function(e){var t,n;return t=e.actorId,n=e.shouldShow,P({actorId:t,url:"/file_activity/set_show_comments_tutorial",type:"POST",data:{show_tutorial:n}}).then(S)})),{markCommentingOnboardingSeen:x,shouldShowCommentingOnboarding:H,setCommentingPaneVisibility:L,setSessionCommentingPaneVisibility:U,setShowCommentsTutorial:B,addComment:A,deleteComment:N,updateLikeComment:j,updateResolveComment:z,updateCommentSetting:W,markCommentSeenBatch:F,fetchCommentStatusBatch:R,fetchFileActivity:O,fetchFileActivityWithBoltData:D,fetchFileActivities:k,updateFileActivitySubscription:G,submitProductFeedback:q}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/file_activity/clients/file_activity_bolt_client",["external/underscore","modules/core/exception","modules/core/types","modules/clean/bolt","modules/clean/event_emitter","modules/clean/file_activity/api","modules/clean/optimistic_update","external/rsvp","modules/clean/storage"],function(n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f,g,v;return v=i.takes,p=i.Maybe,h=l.Optimist,_=u.Promise,m=c.SessionStorage,f=function(e,t){return new r.SignedChannelState("file_activity",e.activity_key,t.revision,t.token)},g=function(e){var t,n;return t=e.revision,n=e.token,{revision:t,token:n}},d=function(n){function i(){return this._onBoltRefresh=e(this._onBoltRefresh,this),this._onBoltUpdate=e(this._onBoltUpdate,this),s.apply(this,arguments)}var s;return t(i,n),s=v({actorId:p(Number),context:Number,contextData:String,oref:p(String)},function(e){var t,n,o,i;return t=e.actorId,n=e.context,o=e.contextData,i=e.oref,this.__requestOptions={actorId:t,context:n,contextData:o,oref:i,isBackgroundRequest:!0},this.__optimist=new h(null),this.__isLive=!1,this.__isReady=!1,this.__canInit=!0}),i.prototype.getFileActivity=function(){return this.__optimist.getValue()},i.prototype.isReady=function(){return this.__isReady},i.prototype.isLive=function(){return this.__isLive},i.prototype.rebase=function(e){var t;return o.assert(this.__isReady,"Cannot rebase when server data is not ready"),t=this.getFileActivity(),this.__optimist.rebase(e),this.emit("updated",this.getFileActivity(),t)},i.prototype.commitOptimisticUpdate=function(e){var t,n;return o.assert(this.__isReady,"Cannot commit optimistic update when server data is not ready"),n=this.getFileActivity(),t=this.__optimist.commit(e),this.emit("updated",this.getFileActivity(),n),t},i.prototype.rollbackOptimisticUpdate=function(e){var t,n;return o.assert(this.__isReady,"Cannot rollback optimistic update when server data is not ready"),t=this.getFileActivity(),n=this.__optimist.rollback(e),n?this.emit("updated",this.getFileActivity(),t):void 0},i.prototype.init=function(){o.assert(this.__canInit,"Cannot initialize an already initialized or initialization in-progress client"),this.__canInit=!1,this._pullFromServer().then(function(e){return function(){return e.__isLive?e._doStartLiveUpdate():void 0}}(this)).catch(function(e){return function(){return e.__canInit=!0}}(this))},i.prototype.startLiveUpdate=function(){return o.assert(!this.__isLive,"Client is already live updating"),this.__isReady&&this._doStartLiveUpdate(),this.__isLive=!0},i.prototype.stopLiveUpdate=function(){var e;return this.__isLive=!1,null!=(e=this.__boltClient)?e.unsubscribe():void 0},i.prototype._doStartLiveUpdate=function(){var e;return e=f(this.getFileActivity(),this.__boltData),this.__boltClient=new r.BoltClient([e],this._onBoltUpdate,this._onBoltRefresh),this.__boltClient.start()},i.prototype._pullFromServer=function(){var e;return m.set("reload-timestamp",(new Date).getTime()),e=a.fetchFileActivityWithBoltData(this.__requestOptions),e.then(function(e){return function(t){var n,o,i;return o=t[0],n=t[1],e.__boltData=n,i=e.__optimist.getValue(),e.__optimist.rebase(function(){return o}),o=e.__optimist.getValue(),e.__isReady?e.emit("updated",o,i):(e.__isReady=!0,e.emit("ready",o))}}(this)),e.catch(function(e){return function(t){return e.emit("error",t)}}(this)),e},i.prototype._onBoltUpdate=function(e){var t;if(1===(null!=e?e.length:void 0)&&e[0].unique_id===this.getFileActivity().activity_key)return t=e[0],this.__boltData=g(t),this._pullFromServer().then(function(e){return function(){return e.__isLive?(t=f(e.getFileActivity(),e.__boltData),e.__boltClient.update_states([t])):void 0}}(this))},i.prototype._onBoltRefresh=function(e){return this._pullFromServer().then(function(e){return function(){return e.__isLive?(e.stopLiveUpdate(),e.startLiveUpdate()):void 0}}(this))},i}(s)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/file_activity/clients/file_activity_data_source",["external/underscore","external/lru","modules/clean/comments/events","modules/clean/comments/store","modules/clean/file_activity/clients/file_activity_bolt_client","external/rsvp"],function(t,n,o,i,r,s){var a,l,u,c;return a=o.CommentsEvents,u=s.Promise,c=function(e,t,n,o){return null==o&&(o=""),e=null!=e?e:"",e+":"+t+":"+n+":"+o},l=function(){function o(t){this._cache=t._cache,this._unsubscribeStore=t._unsubscribeStore,this._sendFileActivity=t._sendFileActivity,this._state=t._state,this.onClientUpdated=e(this.onClientUpdated,this),this.onStoreUpdate=e(this.onStoreUpdate,this)}return o.getInstance=function(){var e;return e=o,null==e.__instance&&(e.__instance=e.create(i,function(e){return a.emit("file-activity-updated",e)})),e.__instance},o.create=function(e,t,i){var r,s;return null==i&&(i=10),r=new n(i),r.shift=function(){var e,t;return t=n.prototype.shift.call(this),e=t.value,null!=e&&e.removeAllListeners(),null!=e&&e.stopLiveUpdate(),t},s=new o({_cache:r,_state:{},_sendFileActivity:t}),s._unsubscribeStore=e.listen(s.onStoreUpdate),s.onStoreUpdate(e.state),s},o.prototype.dispose=function(){return this._unsubscribeStore()},o.prototype.resetCache=function(){return this._cache.removeAll()},o.prototype.replaceState=function(e){var t;return this.shouldUpdate(e)?(this.willUpdate(e),t=this._state,this._state=e,this.didUpdate(t)):void 0},o.prototype.getState=function(){return this._state},o.prototype.onStoreUpdate=function(e){var t,n,o,i,r,s;return t=e.actorId,r=e.oref,s=e.viewing,n=s.context,o=s.contextData,i={oref:r,actorId:t,context:n,contextData:o},this.replaceState(i)},o.prototype.shouldUpdate=function(e){return!t.isEqual(this._state,e)},o.prototype.willUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?this.deactivateClient(t):void 0},o.prototype.didUpdate=function(e){var t;return t=this.getCurrentFetchKey(),this.isFetching(t)||(this.sendActivity(null),this.isNullState(this._state))?void 0:this.fetchAndSend(this._state)},o.prototype.getFetchKey=function(e){var t,n,o,i;return t=e.actorId,n=e.context,o=e.contextData,i=e.oref,c(t,n,o,i)},o.prototype.getCurrentFetchKey=function(){return this.getFetchKey(this._state)},o.prototype.getCurrentClient=function(){var e;return e=this.getCurrentFetchKey(),this._cache.get(e)},o.prototype.isFetching=function(e){var t;return t=this._cache.find(this.getFetchKey(e)),null!=t&&!t.isReady()},o.prototype.isNullState=function(e){return!(null!=e.context&&null!=e.contextData)},o.prototype.activateClient=function(e){return e.on("ready",this.onClientUpdated),e.on("updated",this.onClientUpdated),e.on("error",this.onClientError),e.startLiveUpdate(),e.isReady()?this.onClientUpdated(e.getFileActivity()):void 0},o.prototype.deactivateClient=function(e){return e.off("ready",this.onClientUpdated),e.off("updated",this.onClientUpdated),e.off("error",this.onClientError),e.stopLiveUpdate()},o.prototype.deactivateCurrentClient=function(){var e;return e=this.getCurrentClient(),null!=e?this.deactivateClient(e):void 0},o.prototype.fetchAndSend=function(e){var t,n,o,i,r,s,a;return t=e.actorId,i=e.context,r=e.contextData,a=e.oref,s=c(t,i,r,a),n=this._cache.get(s),null!=n?this.activateClient(n):(o=this.createFileActivityBoltClient({actorId:t,context:i,contextData:r,oref:a}),o.init(),this._cache.set(s,o),this.activateClient(o))},o.prototype.onClientUpdated=function(e){return this.sendActivity(e)},o.prototype.onClientError=function(e){throw e},o.prototype.sendActivity=function(e){return this._sendFileActivity(e)},o.prototype.createFileActivityBoltClient=function(e){return new r(e)},o.prototype.rebase=function(e){var t;return t=this.getCurrentClient(),null!=t?t.rebase(e):!1},o.prototype.commitOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?t.commitOptimisticUpdate(e):null},o.prototype.rollbackOptimisticUpdate=function(e){var t;return t=this.getCurrentClient(),null!=t?t.rollbackOptimisticUpdate(e):!1},o}()})}.call(this);var __decorate=this&&this.__decorate||function(e,t,n,o){var i,r=arguments.length,s=3>r?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(3>r?i(s):r>3?i(t,n,s):i(t,n))||s);return r>3&&s&&Object.defineProperty(t,n,s),s};define("modules/clean/file_activity/models/file_activity",["require","exports","external/deep-freeze","external/underscore","modules/core/types","modules/clean/immutability_helper","modules/clean/activity/activity_user","modules/clean/comments/lib/type_check","modules/clean/comments/models/comment_activity","modules/clean/file_activity/models/revision"],function(e,t,n,o,i,r,s,a,l,u){"use strict";var c=function(){function e(e){var t=void 0===e?{}:e,o=t.activity_key,i=void 0===o?"":o,r=t.feedback_off,s=void 0===r?!1:r,a=t.can_edit_feedback,l=void 0===a?!0:a,u=t.comment_activities,c=void 0===u?[]:u,d=t.users_to_notify,p=void 0===d?[]:d,h=t.latest_revision,_=void 0===h?null:h;this.activity_key=i,this.feedback_off=s,this.can_edit_feedback=l,this.comment_activities=c,this.users_to_notify=p,this.latest_revision=_,n(this)}return e.fromDict=function(t){return new e({activity_key:t.activity_key,feedback_off:t.feedback_off,can_edit_feedback:t.can_edit_feedback,comment_activities:t.comment_activity_dicts.map(l.CommentActivity.fromDict),users_to_notify:(t.users_to_notify||[]).map(s.ActivityUser.fromDict),latest_revision:t.latest_revision})},e.prototype.enableCommenting=function(){return r.set(this,"feedback_off",!1)},e.prototype.disableCommenting=function(){return r.set(this,"feedback_off",!0)},e.prototype._withMutations=function(e){var t=r.thaw(this),o=this.comment_activities.map(r.thaw);return t.comment_activities=o,t.comment_activities.forEach(function(e){e.comment_activities=e.comment_activities.map(r.thaw)}),e(t),n(t)},e.prototype._reapComments=function(e){var t=this.comment_activities.slice();return this.comment_activities.forEach(function(e){t.push.apply(t,e.comment_activities)}),e?t.filter(e):t},e.prototype._findCommentPath=function(e,t){void 0===t&&(t=!1);for(var n=o.matches({activity_key:e}),i=0;i<this.comment_activities.length;i++){var r=this.comment_activities[i];if(n(r))return["comment_activities",i];if(!t)for(var s=0;s<r.comment_activities.length;s++)if(n(r.comment_activities[s]))return["comment_activities",i,"comment_activities",s]}return null},e.prototype._updateComment=function(e,t){return e?r.updateIn(this,e,t):this},e.prototype._updateConversations=function(e){return r.update(this,"comment_activities",e)},e.prototype._updateReplies=function(e,t){var n=this._findCommentPath(e,!0);return n?(n.push("comment_activities"),r.updateIn(this,n,t)):this},e.prototype.findCommentByKey=function(e){for(var t=o.matches({activity_key:e}),n=0;n<this.comment_activities.length;n++){var i=this.comment_activities[n];if(t(i))return i;for(var r=0;r<i.comment_activities.length;r++){var s=i.comment_activities[r];if(t(s))return s}}return null},e.prototype.findConversationByKey=function(e){return o.findWhere(this.comment_activities,{activity_key:e})},e.prototype.purgeCommentByKey=function(e){var t=this._findCommentPath(e);if(t){var n=t.pop();return r.updateIn(this,t,function(e){return r.splice(e,n,1)})}return this},e.prototype.appendComment=function(e,t){var n=function(e){return r.push(e,t)};return this.activity_key===e?this._updateConversations(n):this._updateReplies(e,n)},e.prototype.resolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.resolve()})},e.prototype.unresolveCommentByKey=function(e){var t=this._findCommentPath(e);return this._updateComment(t,function(e){return e.unresolve()})},e.prototype.setCommentStatusByKey=function(e,t){var n=this._findCommentPath(e);return this._updateComment(n,function(e){return e.setStatus(t)})},e.prototype.markCommentSeenByKeyBatch=function(e){return 0===e.length?this:this._withMutations(function(t){var n=t._reapComments(function(t){return o.contains(e,t.activity_key)});n.forEach(function(e){e.is_seen=!0,e.highlight_as_unread=!1})})},__decorate([a.takes({activity_key:String,feedback_off:Boolean,can_edit_feedback:Boolean,comment_activity_dicts:Array,users_to_notify:i.Maybe(Array),latest_revision:u.RevisionShape})],e,"fromDict",null),e}();t.FileActivity=c}),define("modules/clean/file_activity/models/revision",["require","exports","modules/core/types"],function(e,t,n){"use strict";t.RevisionShape=Object.freeze({revision_id:String,when:Number,preview_link:n.Maybe(String),direct_blockserver_link:n.Maybe(String)})}),function(){define("modules/clean/file_events",[],function(){var e;return e={DELETE:"db:bulk_delete",COPY:"db:bulk_copy",MOVE:"db:bulk_move",RENAME:"db:bulk_rename",PURGE:"db:bulk_purge",RESTORE:"db:bulk_restore",UPLOAD:"db:upload",COMPRESS:"db:compress",SF_NEW:"db:sf_new",SF_LEAVE:"db:sf_leave",SF_UNSHARE:"db:sf_unshare",SF_ADD_TO_DROPBOX:"db:sf_add_to_dropbox",SF_INVITE:"db:sf_invite",SF_IGNORE:"db:sf_ignore",LINKS_REMOVE:"db:link_remove",LINKS_ADD:"db:link_add",FILE_ACTIVITY_UPDATE:"db:file_activity_update"}})}.call(this),function(){define("modules/clean/file_operations/notifications",["external/underscore","modules/clean/browse_interface","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/undo","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f,g,v,y;return u=a._,y=a.ungettext,v=function(e,t,n,o,s){var a;return a=function(){return i.rollbackChangeSets({changesets:n,userId:t.id,progressText:u("Undoing…"),rollbackHints:o,onSuccess:function(){return l.success(u("Undo complete.")),"function"==typeof s?s():void 0}})},r.notifyWithUndo(e,n,a)},c=function(i,r){var s,a,l;return a=t.browse_uri_for_fq_path(r,i),l=40,s=n.em_snippet(o.filename(i),l),{href:a,text:e.escape(s)}},d=function(e,t,n,o,i,r){var a,l,u;return null==o&&(o=null),o?(a=c(o,t),u=y('Copied %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Copied %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),l=u.format({num_items:e,dest_href:a.href,dest_name:a.text}),l=new s(l)):(l=y("Copied %(num_items)d item.","Copied %(num_items)d items.",e),l=l.format({num_items:e})),v(l,t,n,i,r)},_=function(e,t,n,o,i,r){var a,l,u;return l=null,o?(a=c(o,t),u=y('Moved %(num_items)d item to <a href="%(dest_href)s">%(dest_name)s</a>.','Moved %(num_items)d items to <a href="%(dest_href)s">%(dest_name)s</a>.',e),l=u.format({num_items:e,dest_href:a.href,dest_name:a.text}),l=new s(l)):(u=y("Moved %(num_items)d item.","Moved %(num_items)d items.",e),l=u.format({num_items:e})),v(l,t,n,i,r)},p=function(e,t,n,o,i){var r,a;return a=y("Deleted %(num_items)d item","Deleted %(num_items)d items",e),r=a.format({num_items:e}),r=new s(r),v(r,t,n,o,i)},f=function(e,t,n,o){var i;return i=u("Rename complete."),i=new s(i),v(i,e,t,n,o)},h=function(e,t,n){var o,i;return i=u("Created folder %(folder_name)s"),o=i.format({folder_name:e}),o=new s(o),v(o,t,n)},m=function(e){var t,n;return n=y("Permanently deleted %(num)s item","Permanently deleted %(num)s items",e),t=n.format({num:e}),l.success(t)},g=function(t){var n,i,r,a;return n=t.length,1===n?(i=o.filename(t[0].fq_path),i=e.escape(i),a=u("Restored <strong>%(filename)s</strong>."),r=a.format({filename:i}),r=new s(r)):(a=y("Restored %(num)s file.","Restored %(num)s files.",n),r=a.format({num:n})),l.success(r)},{notifyCopySuccess:d,notifyMoveSuccess:_,notifyDeleteSuccess:p,notifyRestoreSuccess:g,notifyPurgeSuccess:m,notifyFolderCreationSuccess:h,notifyRenameSuccess:f}})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/flux/action_type",[],function(){var t;return t=function(t,n){var o,i,r,s;r={},s={};for(o in n)if(e.call(n,o)){if(i=n[o],r[o]=t+"__"+i,null!=s[i])throw new Error("Duplicate action value '"+i+"'!");s[i]=!0}return r},{withActionNamespace:t}})}.call(this),function(){"use strict";var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/flux/base_store",["modules/core/exception","modules/clean/flux/dispatcher"],function(t,n){var o,i,r;return i=t.assert,r=function(){var t,o;return o=!1,t=[],n.dispatch_begin=function(){return o=!0},n.dispatch_end=function(){var e,n,i,r;o=!1;try{for(r=[],n=0,i=t.length;i>n;n++)e=t[n],r.push(e());return r}finally{t.length=0}},function(n){return o?e.call(t,n)<0?t.push(n):void 0:n()}}(),o=function(){function t(e){null==e&&(e=null),"function"==typeof this._init&&this._init(),this._change_listeners=[],this._dispatcher=e||n,this.dispatchToken=this._dispatcher.register(this._new_payload_wrapper.bind(this))}return t.WIPE_TYPE="WIPE_ALL",t.prototype.destructor=function(){return this._dispatcher.unregister(this.dispatchToken),this.remove_all_change_listeners()},t.prototype.emit_change=function(){var e,t,n,o,i;for(o=this._change_listeners,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(r(e));return i},t.prototype.add_change_listener=function(t){return i(!(e.call(this._change_listeners,t)>=0)),this._change_listeners.push(t)},t.prototype.remove_change_listener=function(e){var t;return this._change_listeners=function(){var n,o,i,r;for(i=this._change_listeners,r=[],n=0,o=i.length;o>n;n++)t=i[n],t!==e&&r.push(t);return r}.call(this)},t.prototype.remove_all_change_listeners=function(){return this._change_listeners.length=0},t.prototype._new_payload_wrapper=function(e){var t;return(null!=e&&null!=(t=e.action)?t.type:void 0)===this.constructor.WIPE_TYPE&&"function"==typeof this._init&&this._init(),this._new_payload(e)},t.prototype._new_payload=function(e){throw new Error("Abstract method - must be implemented")},t}()})}.call(this),function(){define("modules/clean/flux/flux_store",function(){var e;return e=function(){function e(e){this._listeners=[],this._dispatcher=e,this._dispatchToken=this._dispatcher.register(this.__invokeOnDispatch.bind(this)),this.__hasChanged=!1}return e.prototype.teardown=function(){return this._dispatcher.unregister(this._dispatchToken)},e.prototype.getDispatcher=function(){return this._dispatcher},e.prototype.getDispatchToken=function(){return this._dispatchToken},e.prototype.addListener=function(e){return this._listeners.push(e),function(t){return function(){var n;return t._listeners=function(){var t,o,i,r;for(i=this._listeners,r=[],t=0,o=i.length;o>t;t++)n=i[t],n!==e&&r.push(n);return r}.call(t)}}(this)},e.prototype.hasChanged=function(){return this.__hasChanged},e.prototype.__emitChange=function(){return this.__hasChanged=!0},e.prototype.__onDispatch=function(){throw new Error("__onDispatch should be overridden by subclass")},e.prototype.__invokeOnDispatch=function(e){var t,n,o,i,r;if(this.__hasChanged=!1,this.__onDispatch(e),this.__hasChanged){for(i=this._listeners,r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(t());return r}},e}()})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/flux/store_listener",["external/react"],function(t){var n;return n=function(n,o,i){var r;return t.createClass({displayName:"StoreListener("+(null!=(r=n.displayName)?r:"Unknown")+")",getInitialState:function(){return{childProps:i(this.props,o)}},componentDidMount:function(){var t,n;for(n in o)e.call(o,n)&&(t=o[n],t.add_change_listener(this._handleStoreChanged));return this.setState({childProps:i(this.props,o)})},componentWillUnmount:function(){var t,n,i;t=[];for(i in o)e.call(o,i)&&(n=o[i],t.push(n.remove_change_listener(this._handleStoreChanged)));return t},render:function(){var o,i,r,s;o={ref:"wrapped"},r=this.state.childProps;for(i in r)e.call(r,i)&&(s=r[i],o[i]=s);return t.createElement(n,o,this.props.children)},getWrappedComponent:function(){return this.refs.wrapped},getStores:function(){return o},_handleStoreChanged:function(){var e;return this.isMounted()&&(e=i(this.props,o),null!=e)?this.setState({childProps:e}):void 0}})},{listenToStores:n}})}.call(this),function(){var e={}.hasOwnProperty;define("modules/clean/form",["jquery","external/purify","modules/core/exception","modules/core/notify","modules/clean/ajax","modules/core/cookies","modules/constants/request"],function(t,n,o,i,r,s,a){var l,u;return u=o.assert,l={submit:function(e,t,n,o){return r.FormWebRequest({url:e.attr("action"),data:this.collect_data(e),skipErrorHandling:!0,success:function(e,o,i){var r,s,a;return s=l.parse_response(i.responseText),a=s[0],r=s[1],a?t(r):n(r)},error:function(e,t,o){return n(i.DEFAULT_ERROR)},complete:o})},collect_data:function(e){var n,o,i,r,s,a,l;for(n={},a=e.find("input, select, textarea"),o=0,r=a.length;r>o;o++)if(i=a[o],s=t(i).attr("name")){if("checkbox"===t(i).attr("type"))l=t(i).prop("checked")?"True":"";else if("radio"===t(i).attr("type")){if(!t(i).prop("checked"))continue;l=t(i).val()}else l=t(i).val();s in n?("string"==typeof n[s]&&(n[s]=[n[s]]),n[s].push(l)):n[s]=l}return n},parse_response:function(e){var t,n,o,r;if(0!==e.indexOf("err:"))return[!0,e];n=e.substr(4);try{return r=JSON.parse(n),[!1,r]}catch(e){return t=e,[!1,n||i.DEFAULT_ERROR]}},parse_error:function(e){var t,n;if("string"==typeof e)return[!0,e];if("object"==typeof e)for(n in e)if(t=e[n],"message_text"in t)return[!0,t.message_text];return[!1,i.DEFAULT_ERROR]},add_vars:function(o,i,r){var s,a,l,u;null==r&&(r=!1),l=[];for(a in i)e.call(i,a)&&(s=t("<input>",{type:"hidden",name:a}),s.val(i[a]),u=n.sanitize(s.prop("outerHTML")),r===!0&&t("input[name='"+a+"']").remove(),l.push(o.append(u)));return l},post_request:function(e,o,i){var r,l;return null==o&&(o={}),null==i&&(i={}),u(null!=e,"post_request missing action"),r=t("<form>",{action:e,method:"POST",target:i.target?i.target:void 0}),o.t=s.read(a.JS_CSRF_COOKIE),this.add_vars(r,o),l=t(n.sanitize(r.prop("outerHTML"))),t("body").append(l),l.submit()}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/frame_messenger",["jquery"],function(n){var o;return o=function(){function o(){this.handleUntrustedMessage=e(this.handleUntrustedMessage,this),Object.defineProperty(this,"trustedParentOriginForPosting",{get:function(){return this._trustedParentOriginForPosting}}),Object.defineProperty(this,"trustedChildOriginForPosting",{get:function(){var e,t,o,i;if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(e=n(this._childIframeQuery),t=0,i=e.length;i>t&&(o=e[t],!this._validateChildOriginForPosting(o.src));t++);return this._trustedChildOriginForPosting}})}return o._ALLOWED_CHILD_ORIGINS=["https://www.dropboxstatic.com","https://www.dropboxstatic.com:443","https://cf.dropboxstatic.com","https://cf.dropboxstatic.com:443","https://cfl.dropboxstatic.com","https://cfl.dropboxstatic.com:443","https://www.dropbox.com","https://www.dropbox.com:443","https://dl-doc.dropbox.com","https://dl-doc.dropbox.com:443","https://dl-web.dropbox.com","https://dl-web.dropbox.com:443","https://dl.dropboxusercontent.com","https://dl.dropboxusercontent.com:443","null"],o._ALLOWED_PARENT_ORIGINS=["https://www.dropbox.com","https://www.dropbox.com:443"],o._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,o.prototype._childIframeQuery=null,o.prototype._trustedChildOriginForPosting=null,o.prototype._trustedParentOriginForPosting=null,o.prototype._validActionsFromChild=[],o.prototype._validActionsFromParent=[],o.prototype._trustedMessageFromChildHandler=null,o.prototype._trustedMessageFromParentHandler=null,o.prototype._parentMessageQueue=[],o.prototype._requestParentOriginPollRetry=null,o.prototype._onParentReady=null,o.prototype.resetOriginsForPosting=function(){return this._trustedChildOriginForPosting=null,this._trustedParentOriginForPosting=null},o.prototype.configureChildMessaging=function(e,t,n){return this._childIframeQuery=e,this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},o.prototype.configureParentMessaging=function(e,t,n){return null==n&&(n=null),this._trustedParentOriginForPosting=null,this._validActionsFromParent=t,this._trustedMessageFromParentHandler=e,this._onParentReady=n},o.prototype.startListening=function(){return window.addEventListener("message",this.handleUntrustedMessage),null!=this._validActionsFromParent&&this._validActionsFromParent.length>0&&null!=this._trustedMessageFromParentHandler&&this._requestParentOrigin(),null!=this._validActionsFromChild&&this._validActionsFromChild.length>0&&null!=this._trustedMessageFromChildHandler?this.postMessageToChildren("parent-ready"):void 0},o.prototype.stopListening=function(){return window.removeEventListener("message",this.handleUntrustedMessage)},o.prototype._isNumber=function(e){return!isNaN(parseInt(e))},o.prototype._getOriginFromUrl=function(e){var t,n,o;return o=document.createElement("a"),o.href=e,t=this._isNumber(o.port)?":"+o.port:"",n="https://"+o.hostname+t},o.prototype._isChildOriginAllowed=function(e){return t.call(this.constructor._ALLOWED_CHILD_ORIGINS,e)>=0||this._isDevVmOrigin(e)},o.prototype._isParentOriginAllowed=function(e){return t.call(this.constructor._ALLOWED_PARENT_ORIGINS,e)>=0||this._isDevVmOrigin(e)},o.prototype._isDevVmOrigin=function(e){var t;return t=e.match(/\.dev\.corp\.dropbox(static|usercontent)?\.com($|:)/),(null!=t?t.length:void 0)>=1},o.prototype._validateChildOriginForPosting=function(e){var t;return t="null"===e?"*":this._getOriginFromUrl(e),"null"===e||this._isChildOriginAllowed(t)?(this._trustedChildOriginForPosting=t,!0):(console.warn("Untrusted message from child blocked: "+e),!1)},o.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},o.prototype._validateParentOriginForPosting=function(e){var t,n,o,i,r,s,a;if(s=this._trustedParentOriginForPosting,r=this._getOriginFromUrl(e),!this._isParentOriginAllowed(r))return console.warn("Untrusted message from parent blocked: "+e),!1;if(this._trustedParentOriginForPosting=r,this._parentMessageQueue.length>0){for(a=this._parentMessageQueue,t=0,n=a.length;n>t;t++)o=a[t],i=JSON.parse(o),this.postMessageToParent(i.action,i.parameters);this._parentMessageQueue=[]}return null!=this._trustedParentOriginForPosting&&null==s&&null!=this._onParentReady&&this._onParentReady(),!0},o.prototype.handleUntrustedMessage=function(e){var n,o,i,r,s;if(!this._isChildOriginAllowed(e.origin)&&!this._isParentOriginAllowed(e.origin))return void console.warn("Message received not in parent or child origin whitelist: "+e.origin);try{i=JSON.parse(e.data)}catch(e){return void(n=e)}if(null!=i.action)return"child-requesting-parent-origin"===i.action?void(this._validateChildOriginForPosting(e.origin)&&this.postMessageToChildren("parent-ready")):"parent-ready"===i.action?void this._validateParentOriginForPosting(e.origin):(r=i.action,t.call(this._validActionsFromChild,r)>=0&&this._validateChildOriginForPosting(e.origin)&&null!=this._trustedMessageFromChildHandler?void this._trustedMessageFromChildHandler(i):(s=i.action,void(t.call(this._validActionsFromParent,s)>=0&&this._validateParentOriginForPosting(e.origin)&&null!=this._trustedMessageFromParentHandler&&this._trustedMessageFromParentHandler(i))))},o.prototype._packagePostMessage=function(e,t){var n,o;return o=this.trustedChildOriginForPosting,n={action:e,parameters:t},JSON.stringify(n)},o.prototype.postMessageToChildElements=function(e,t,n){var o,i,r,s,a;if(null==n&&(n={}),null!=this.trustedChildOriginForPosting){for(s=this._packagePostMessage(t,n),a=[],o=0,r=e.length;r>o;o++)i=e[o],a.push(i.contentWindow.postMessage(s,this.trustedChildOriginForPosting));return a}},o.prototype.postMessageToChildren=function(e,t,o){var i;return null==t&&(t={}),null==o&&(o=null),null==o&&(o=this._childIframeQuery),i=n(o),this.postMessageToChildElements(i,e,t)},o.prototype.postMessageToParent=function(e,t){var n;return null==t&&(t={}),n=this._packagePostMessage(e,t),null==this.trustedParentOriginForPosting?void this._parentMessageQueue.push(n):window.parent.postMessage(n,this.trustedParentOriginForPosting)},o.prototype._requestParentOrigin=function(){var e;return window.parent.postMessage('{"action": "child-requesting-parent-origin"}',"*"),e=function(){return this._requestParentOriginPollRetry=null,null==this._trustedParentOriginForPosting?this._requestParentOrigin():void 0},setTimeout(n.proxy(e,this),this._REQUEST_PARENT_ORIGIN_POLL_DELAY)},o}()})}.call(this),function(){define("modules/clean/fuzzy",[],function(){var e;return e={simpleFilter:function(t,n){return n.filter(function(n){return e.test(t,n)})},test:function(t,n){return null!==e.match(t,n)},match:function(e,t,n){var o,i,r,s,a,l,u,c,d,p,h,_,m,f;for(n=n||{},d=0,m=[],c=t.length,f=0,l=0,h=n.pre||"",p=n.post||"",r=n.caseSensitive&&t||t.toLowerCase(),o=void 0,i=void 0,e=n.caseSensitive&&e||e.toLowerCase(),u=0,_=[],s=0,a=0;c>u;)o=t[u],r[u]===e[d]?(o=h+o+p,a?a+=1:(s=u,a=1),d+=1,l+=1+l):(l=0,a&&(_.push([s,a]),a=0)),f+=l,m[m.length]=o,u++;return a&&_.push([s,a]),d===e.length?{highlighted:_,rendered:m.join(""),score:f}:null},filter:function(e,t,n){var o,i;return null==n&&(n={}),i=[],o=this._reduce.bind(this,e,n),t.reduce(o,i).sort(this._sort)},_reduce:function(t,n,o,i,r){var s,a;return a=i,n.extract&&(a=n.extract(i)),s=e.match(t,a,n),null!=s&&o.push({string:s.rendered,score:s.score,index:r,original:i}),o},_sort:function(e,t){var n;return n=t.score-e.score,n?n:e.index-t.index}}})}.call(this),function(){define("modules/clean/groups/api",["jquery","modules/clean/ajax","modules/clean/contacts/cache","modules/clean/viewer"],function(e,t,n,o){var i,r,s;return i=n.DefaultContactsCache,s={},r="/groups_ajax",s.ready=function(){},s.get_groups_for_user=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_groups_for_user",
data:e,success:t})},s.get_group_info=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_group_info",data:e,success:t})},s.get_groups_for_team=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_groups_for_team",data:{},success:t})},s.get_users_for_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"get_users_in_group",data:e,success:t})},s.create_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_new_group",data:e,success:t,reload_contacts:!0})},s.create_group_with_users=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_new_group_with_users",data:e,success:t,reload_contacts:!0})},s.remove_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"remove_group",data:e,success:t,reload_contacts:!0})},s.rename_group=function(e,t,n){return null==n&&(n=function(){return{}}),s.metaserver_ajax({method:"rename_group",data:e,success:t,error:n,reload_contacts:!0})},s.add_users_to_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"add_users_to_group",data:e,success:t,reload_contacts:!0})},s.remove_user_from_group=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"remove_user_from_group",data:e,success:t,reload_contacts:!0})},s.change_group_member_type=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"change_group_member_type",data:e,success:t})},s.remove_namespace_from_group=function(e,t){return s.metaserver_ajax({method:"remove_namespace_from_group",data:e,success:t})},s.change_group_access_type=function(e,n){var i;return i=function(e,t,o){return n(o)},t.WebRequest({url:r+"/change_group_access_type",type:"post",data:e,subject_user:o.get_viewer().work_user,success:i})},s.make_group_join_request=function(e,t){return null==t&&(t=function(){return{}}),s.metaserver_ajax({method:"make_group_join_request",data:e,success:t})},s.metaserver_ajax=function(n){var s,a,l,u;return u=r+"/"+n.method,a=n.reload_contacts||!1,l=function(t){var o,r;o=JSON.parse(t),o.ok&&(n.success(o.data),e(".error_msg").hide()),a&&i.load_contacts(r=!0)},s=function(t){var o;o=t.responseText,n.error&&(n.error(o.slice(4)),e(".error_msg").hide())},t.WebRequest({url:u,type:"post",data:n.data,subject_user:o.get_viewer().work_user,success:l,error:s})},s})}.call(this),function(){define("modules/clean/growth/experiments/logger",["modules/clean/ajax"],function(e){var t;return t=function(){function t(){}var n,o;return t.start_times={},t.DEFAULT_TIMER_NAME="view_time",t.get_timer_name=function(e){return null==e||"boolean"==typeof e?t.DEFAULT_TIMER_NAME:e},t.set_start_time=function(e){var n;return n=t.get_timer_name(e),t.start_times[n]=Date.now()},t.do_log_view_time=function(e,n){var o;return o=t.get_timer_name(n),e[o]=Math.round((Date.now()-t.start_times[o])/1e3)},o={},n=[5,15,60,120,300],t.start_counter=function(e,t){var i,r,s,a;for(s=[],i=0,r=n.length;r>i;i++)a=n[i],s.push(function(n){return o[e+n]=setTimeout(function(){return t(e,{time_since_first_view:n})},1e3*n)}(a));return s},t.stop_counter=function(e){var t,i,r,s;for(r=[],t=0,i=n.length;i>t;t++)s=n[t],r.push(clearTimeout(o[e+s]));return r},t.log=function(n,o,i,r){switch(null==r&&(r=!1),i=i||{},n){case"paywall_device_limit":return r&&t.do_log_view_time(i,r),e.SilentBackgroundRequest({url:"/growth_paywall_device_limit_log",data:{evt:o,extra:JSON.stringify(i)}});case"onboarding":return r&&t.do_log_view_time(i,r),e.SilentBackgroundRequest({url:"/growth_onboarding_log",data:{evt:o,extra:JSON.stringify(i)}});case"sharing":return t.do_log_view_time(i),e.SilentBackgroundRequest({url:"/growth_sharing_log",data:{evt:o,extra:JSON.stringify(i)}});case"post_client_install_tab":return r&&t.do_log_view_time(i,r),e.SilentBackgroundRequest({url:"/growth_post_client_install_tab_log",data:{evt:o,extra:JSON.stringify(i)}});default:throw new Error("Invalid series name")}},t}()})}.call(this),function(){define("modules/clean/history",["external/modernizr","external/underscore","modules/core/browser","modules/core/exception","modules/core/uri"],function(e,t,n,o,i){var r,s;return s=o.assert,r=function(){var o,r,a,l,u,c,d,p,h,_,m,f,g,v,y;return o=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$"),f=function(){var t,r,s;return s=void 0,e.history||-1===n.get_href().indexOf("#!")?(t=window.location.pathname,r=window.location.search,-1!==t.search(o)&&(t=String(i({path:t}))),s=t+r):s=n.get_href().split("#!").pop(),s},c=function(e,t){return String(i.parse(e).setQuery(t))},d=function(e){var t;return null==e&&(e=f()),t=e.split("?"),{url:e,path:t[0],qargs:i.parse(e).getQuery()}},a={},p={},g=f(),y=null,r="",m=function(e){var t;return t=r+"/"+e.substring(r.length).split("/")[1]},v=function(e){return r=e},h=function(){var e,t,n;return n=g,t=d(n),e=m(t.path),e in a?(a[e](t.path.substr(e.length+1),t.qargs),!0):!1},_=function(){var e,t,n;return n=g,t=d(n),e=m(t.path),e in p?p[e](t.path.substr(e.length+1),t.qargs):void 0},l=function(e,t){var n,o;return o=m(e),n=m(t),o!==n?_():void 0},u=function(){var e;return e=f(),e!==g?(l(g,e),g=e,h()):void 0},{init:function(){return y?void 0:(g=f(),y=setInterval(u,50))},add_callback:function(e,t,n){return this.init(),s("string"==typeof e,"DBHistory prefix is not a string"),s(0===e.indexOf("/"),"DBHistory prefix must be absolute"),s(-1===e.substring(r.length).indexOf("/",1),"multi-component prefixes arent supported"),a[e]=t,n?void 0:h()},add_exit_callback:function(e,t){return this.init(),s("string"==typeof e,"DBHistory prefix is not a string"),s(0===e.indexOf("/"),"DBHistory prefix must be absolute"),s(-1===e.substring(r.length).indexOf("/",1),"multi-component prefixes arent supported"),p[e]=t},fire_callbacks:function(){return h()},_build_url_for_state_change:function(e,t){var n;return s("string"==typeof e,"DBHistory path is not a string"),s(0===e.indexOf("/"),"DBHistory path must be absolute"),s(-1===e.indexOf("//"),"DBHistory path contains //"),n=c(e,t)},_pre_state_change:function(e){return e===g?!1:(l(g,e),!0)},_post_state_change:function(e){return null==e&&(e=!0),g=f(),e?h():void 0},replace_state:function(e,t){var n;return n=this._build_url_for_state_change(e,t),this._pre_state_change(n)&&window.history.replaceState?(window.history.replaceState(null,null,n),this._post_state_change()):void 0},push_state:function(n,o,i){var r;return null==i&&(i={}),i=t.defaults(i,{immediatelyRestoreState:!0}),s(-1===n.indexOf("?"),"DBHistory path contains ?"),s(-1===n.indexOf("#"),"DBHistory path contains #"),r=this._build_url_for_state_change(n,o),this._pre_state_change(r)?(e.history?window.history.pushState(null,null,r):window.location.href="#!"+r,this._post_state_change(i.immediatelyRestoreState)):void 0},update_query_param:function(t,n){var o;if(e.history)return o=this.deconstruct_url(),o.qargs[t]=n,this.replace_state(o.path,o.qargs)},remove_query_param:function(t){var n;if(e.history)return n=this.deconstruct_url(),delete n.qargs[t],this.replace_state(n.path,n.qargs)},get_url:f,construct_url:c,deconstruct_url:d,set_base_prefix:v,URL_ESCAPE_REGEX:o}}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_annotations",["jquery","modules/clean/image_viewer_annotation_interface","modules/clean/image_viewer_annotation_renderer","modules/clean/image_preview_util"],function(t,n,o,i){var r;return r=function(){function r(){this.onResize=e(this.onResize,this),this._onScroll=e(this._onScroll,this),this._handleMessage=e(this._handleMessage,this)}return r.prototype.onImageLoad=function(e){return null==e&&(e=null),this.reset(),this.resizeImageCallback=e,this._prepareAnnotations()},r.prototype._prepareAnnotations=function(){return this._prepareAnnotationInterface(),this.annotationRenderer=new o,window.addEventListener("resize",this.onResize),i.getPreviewImageWrapper().on("scroll",this._onScroll),window.addEventListener("message",this._handleMessage),this._postPageRendered()},r.prototype._prepareAnnotationInterface=function(){var e,o;return 0===i.getAnnotationContainer().length&&(e=i.getPreviewImageWrapper(),o=t("<div class='"+i.ANNOTATION_CONTAINER+"' />"),this.$annotationContainer=o.appendTo(e)),this._resizeAnnotationContainer(),this.annotationInterface=new n,i.getAnnotationContainer().on("mouseup.image",this.annotationInterface.onMouseUpCallback).on("mousedown.image",this.annotationInterface.onMouseDownCallback).on("mousemove.image",this.annotationInterface.onMouseMoveCallback).on("keydown.image",this.annotationInterface.onKeyDownCallback),setTimeout(function(e){return function(){var t;return e._resizeAnnotationContainer(),null!=(t=e.annotationInterface)?t.onScaleChangeCallback():void 0}}(this),0)},r.prototype._handleMessage=function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h;try{i=JSON.parse(e.data)}catch(e){return void(n=e)}switch(i.action){case"update-annotations":return this._resizeAnnotationContainer(),null!=(r=this.annotationInterface)&&r._updateOffset(),null!=(s=this.annotationRenderer)?s.updateAnnotations(i.parameters):void 0;case"remove-annotation":return t=i.parameters.commentActivity,null!=(a=this.annotationRenderer)?a.removeAnnotation(t):void 0;case"remove-all-annotations":return null!=(l=this.annotationRenderer)&&l.removeAllAnnotations(),this._resizeAnnotationContainer(),null!=(u=this.annotationInterface)?u._updateOffset():void 0;case"enable-annotation-creation":return null!=(c=this.annotationInterface)?c.enableAnnotationCreation():void 0;case"disable-annotation-creation":return null!=(d=this.annotationInterface)?d.disableAnnotationCreation():void 0;case"enable-region-creation":return this._setRegionCreationEnabled(!0);case"disable-region-creation":return this._setRegionCreationEnabled(!1);case"hide-annotation":return null!=(p=this.annotationInterface)?p.onHideAnnotation():void 0;case"scroll-to-annotation":return t=i.parameters.commentActivity,null!=(h=this.annotationRenderer)?h.highlightAnnotation(t):void 0;case"file-feedback-ui-ready":return this._postPageRendered()}},r.prototype._postPageRendered=function(){return this._postMessage("page-rendered")},r.prototype._postMessage=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},r.prototype._setRegionCreationEnabled=function(e){var t,n,o;return e?null!=(t=this.annotationInterface)&&t.enableRegionCreation():null!=(n=this.annotationInterface)&&n.disableRegionCreation(),this._resizeAnnotationContainer(),null!=(o=this.annotationInterface)?o._updateOffset():void 0},r.prototype._onScroll=function(){var e;return null!=(e=this.annotationInterface)?e.onScrollCallback():void 0},r.prototype.onResize=function(e){var t,n;return null==e&&(e=!0),null!=(t=this.annotationRenderer)&&t.removeAllAnnotations(),this._postMessage("scale-change"),n=function(e){return function(){var t;return e._resizeAnnotationContainer(),e._postPageRendered(),null!=(t=e.annotationInterface)&&t.onScaleChangeCallback(),"function"==typeof e.resizeImageCallback?e.resizeImageCallback():void 0}}(this),clearTimeout(this.scaleChangeTimer),e?this.scaleChangeTimer=setTimeout(n,100):n()},r.prototype._resizeAnnotationContainer=function(){var e,t,n,o,r,s,a,l,u,c,d,p,h;return e=i.getPreviewImage(),null!=e&&null!=e.offset()&&null!=(null!=(o=e.offsetParent())?o.offset():void 0)?(n=e.offset().top-e.offsetParent().offset().top,t=e.offset().left-e.offsetParent().offset().left,0>n&&(n=0),0>t&&(t=0),null!=(r=this.$annotationContainer)&&r.css("margin-top",n),null!=(s=this.$annotationContainer)&&s.css("margin-bottom",n),null!=(a=this.$annotationContainer)&&a.css("margin-left",t),null!=(l=this.$annotationContainer)&&l.css("margin-right",t),(null!=(u=this.annotationInterface)?u.isAnnotationRegionEnabled:void 0)?(null!=(c=this.$annotationContainer)&&c.height(e.height()),null!=(d=this.$annotationContainer)?d.width(e.width()):void 0):(null!=(p=this.$annotationContainer)&&p.height(0),null!=(h=this.$annotationContainer)?h.width(0):void 0)):void 0},r.prototype.removeAnnotations=function(){var e;return null!=(e=this.annotationRenderer)?e.removeAllAnnotations():void 0},r.prototype.reset=function(){var e,t;return null!=(e=this.annotationRenderer)&&e.reset(),null!=(t=this.annotationInterface)&&t.reset(),i.getAnnotationContainer().off("mouseup.image").off("mousedown.image").off("mousemove.image").off("keydown.image"),i.getPreviewImageWrapper().off("scroll",this._onScroll),window.removeEventListener("resize",this.onResize),window.removeEventListener("message",this._handleMessage),this._postMessage("reset-file-feedback-ui")},r}()})}.call(this),function(){define("modules/clean/image_preview_util",["jquery","modules/clean/annotations/annotation"],function(e,t){var n,o,i,r;return n=t.Annotation,i=t.AnnotationTypes,o=t.AnnotationSubtypes,r={PREVIEW_IMAGE_CONTAINER:"preview-image-container",PREVIEW_IMAGE_WRAPPER:"preview-image-wrapper",PREVIEW_IMAGE:"preview-image",ANNOTATION_CONTAINER:"db-annotation-container",ANNOTATION_LAYER_CSS:"db-annotation-layer",ANNOTATION_CANVAS_LAYER_CSS:"db-annotation-canvas-layer",getPreviewImageContainer:function(){return e("."+this.PREVIEW_IMAGE_CONTAINER)},getPreviewImageWrapper:function(){return e("."+this.PREVIEW_IMAGE_WRAPPER)},getPreviewImage:function(){return this.getPreviewImageContainer().find("."+this.PREVIEW_IMAGE)},getPreviewImageElement:function(){return this.getPreviewImage()[0]},getAnnotationContainer:function(){return e("."+this.ANNOTATION_CONTAINER)},getAnnotationLayers:function(){return e("."+this.ANNOTATION_LAYER_CSS)},getAnnotationLCanvasLayer:function(){return e("."+this.ANNOTATION_CANVAS_LAYER_CSS)},convertAnnotationImagePointsToViewportCoordinates:function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h,_,m;for(c=[],t=this.getPreviewImageElement(),s=t.clientWidth,r=t.clientHeight,_=e.image_coordinates,i=0,l=_.length;l>i;i++){for(n=_[i],o=[],m=n.coordinates,a=0,u=m.length;u>a;a++)h=m[a],d=h.x*s,p=h.y*r,o.push({x:d,y:p});c.push(o)}return c},convertAnnotationViewportCoordinatesToImagePoints:function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g;for(d=[],t=this.getPreviewImageElement(),r=t.getBoundingClientRect(),_=r.left,m=r.top,a=t.clientWidth,s=t.clientHeight,g=e.viewportCoordinates,i=0,u=g.length;u>i;i++){for(n=g[i],o=[],l=0,c=n.length;c>l;l++)f=n[l],p=(f.x-_)/a,h=(f.y-m)/s,o.push({x:p,y:h});d.push({coordinates:o})}return d}}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_interface",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_controller","modules/clean/image_preview_util","modules/constants/comments_panel"],function(t,n,o,i,r,s){var a;return a=function(){function a(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationScaleChangeCallback=e(this.onAnnotationScaleChangeCallback,this),this.onAnnotationScrollCallback=e(this.onAnnotationScrollCallback,this),this.onAnnotationEndDragCallback=e(this.onAnnotationEndDragCallback,this),this.onAnnotationStartDragCallback=e(this.onAnnotationStartDragCallback,this),this.onAnnotationPlacedCallback=e(this.onAnnotationPlacedCallback,this),this.onAnnotationHiddenCallback=e(this.onAnnotationHiddenCallback,this),this.onScaleChangeCallback=e(this.onScaleChangeCallback,this),this.onScrollCallback=e(this.onScrollCallback,this),this.onKeyDownCallback=e(this.onKeyDownCallback,this),this.onMouseUpCallback=e(this.onMouseUpCallback,this),this.onMouseMoveCallback=e(this.onMouseMoveCallback,this),this.onMouseDownCallback=e(this.onMouseDownCallback,this),this.onHideAnnotation=e(this.onHideAnnotation,this),this._prepareAnnotationCoords=e(this._prepareAnnotationCoords,this),this._refreshAnnotationController=e(this._refreshAnnotationController,this),this._prepareAnnotationController=e(this._prepareAnnotationController,this),this.controllerEventHandlers={onMouseMoveCallback:t.noop,onMouseDownCallback:t.noop,onMouseUpCallback:t.noop,onHideAnnotation:t.noop,onScrollCallback:t.noop,onScaleChangeCallback:t.noop,onKeyDownCallback:t.noop},this.isAnnotationMarkerEnabled=s.ALLOW_ANNOTATION_MARKER,this.isAnnotationRegionEnabled=!1,this.isAnnotationCreationEnabled=!1,this._prepareAnnotationController()}return a.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},a.prototype._isOnAnnotationUI=function(e){return t(e.target).parents(".db-annotation-layer").length>0},a.prototype._isOnAnnotationOverlay=function(e){return t(e.target).parents("#annotation-overlay").length>0},a.prototype._destroyAnnotationController=function(){var e;return e=r.getAnnotationLCanvasLayer(),(null!=e?e.length:void 0)>0?(o.unmountComponentAtNode(e[0]),e.remove()):void 0},a.prototype._prepareAnnotationController=function(){var e,n;return e=r.getAnnotationContainer(),0===e.find("."+r.ANNOTATION_CANVAS_LAYER_CSS).length?(n=t("<div class='"+r.ANNOTATION_CANVAS_LAYER_CSS+"' />"),this.$parentContainerEl=n.appendTo(e),this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController()):void 0},a.prototype._refreshAnnotationController=function(e){var t;if(null!=(t=this.$parentContainerEl)?t.get(0):void 0)return this.annotationController=o.render(n.createElement(i,{parentContainerOffset:this.parentContainerOffset,controllerEventHandlers:this.controllerEventHandlers,onAnnotationHiddenCallback:this.onAnnotationHiddenCallback,onAnnotationPlacedCallback:this.onAnnotationPlacedCallback,onAnnotationStartDragCallback:this.onAnnotationStartDragCallback,onAnnotationEndDragCallback:this.onAnnotationEndDragCallback,onAnnotationScrollCallback:this.onAnnotationScrollCallback,onAnnotationScaleChangeCallback:this.onAnnotationScaleChangeCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback,isAnnotationMarkerEnabled:this.isAnnotationMarkerEnabled,isAnnotationHighlightEnabled:!1,isAnnotationRegionEnabled:this.isAnnotationRegionEnabled,isAnnotationCreationEnabled:this.isAnnotationCreationEnabled}),this.$parentContainerEl.get(0),e)},a.prototype._prepareAnnotationCoords=function(e){return null!=e&&(e=this._addTranslatedImagePoints(e)),e},a.prototype._addTranslatedImagePoints=function(e){return e.image_coordinates=r.convertAnnotationViewportCoordinatesToImagePoints(e),e},a.prototype._updateOffset=function(e){return this.$parentContainerEl?(this.parentContainerOffset=this.$parentContainerEl.offset(),this._refreshAnnotationController(e)):void 0},a.prototype.enableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!0,this._refreshAnnotationController()},a.prototype.disableAnnotationCreation=function(){return this.isAnnotationCreationEnabled=!1,this._refreshAnnotationController()},a.prototype.enableRegionCreation=function(){return t("html").addClass("region-creation"),this.isAnnotationRegionEnabled=!0,this._refreshAnnotationController()},a.prototype.disableRegionCreation=function(){return t("html").removeClass("region-creation"),this.isAnnotationRegionEnabled=!1,this._refreshAnnotationController()},a.prototype.reset=function(){return this.disableRegionCreation(),this._destroyAnnotationController(),r.getAnnotationContainer().remove()},a.prototype.onHideAnnotation=function(){var e;return null!=(e=this.controllerEventHandlers)?e.onHideAnnotation():void 0},a.prototype.onMouseDownCallback=function(e){var t;return this._isOnAnnotationUI(e)||this._isOnAnnotationOverlay(e)?void 0:null!=(t=this.controllerEventHandlers)?t.onMouseDownCallback(e):void 0},a.prototype.onMouseMoveCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseMoveCallback(e):void 0},a.prototype.onMouseUpCallback=function(e){var t;return null!=(t=this.controllerEventHandlers)?t.onMouseUpCallback(e):void 0},a.prototype.onKeyDownCallback=function(e){var t;return t=e.keyCode||e.which||e.charCode,this._sendToParent("on-keydown",{keyCode:t})},a.prototype.onScrollCallback=function(e){var t,n;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onScrollCallback():void 0),(null!=(n=this.annotationController)?n.hasVisibleActiveAnnotation():void 0)?void 0:this._sendToParent("scroll")},a.prototype.onScaleChangeCallback=function(e){var t;return this._updateOffset(null!=(t=this.controllerEventHandlers)?t.onHideAnnotation:void 0),this._sendToParent("scale-change",e)},a.prototype.onAnnotationHiddenCallback=function(){return this._sendToParent("annotation-hidden")},a.prototype.onAnnotationPlacedCallback=function(e){return this._sendToParent("annotation-placed",{annotation:this._prepareAnnotationCoords(e)})},a.prototype.onAnnotationStartDragCallback=function(e){return this._sendToParent("annotation-start-drag")},a.prototype.onAnnotationEndDragCallback=function(e){return this._sendToParent("annotation-end-drag",{annotation:this._prepareAnnotationCoords(e)})},a.prototype.onAnnotationScrollCallback=function(e){return this._sendToParent("scroll",{annotation:this._prepareAnnotationCoords(e)})},a.prototype.onAnnotationScaleChangeCallback=function(e){return this._sendToParent("scale-change",{annotation:this._prepareAnnotationCoords(e)})},a.prototype.onAnnotationEnterCallback=function(){return this._sendToParent("annotation-enter",{annotation:this._prepareAnnotationCoords()})},a.prototype.onAnnotationLeaveCallback=function(){return this._sendToParent("annotation-leave",{annotation:this._prepareAnnotationCoords()})},a}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/image_viewer_annotation_renderer",["jquery","external/react","external/react-dom","modules/clean/annotations/annotation_highlight_ui","modules/clean/annotations/annotation_marker_ui","modules/clean/annotations/annotation_region_ui","modules/clean/annotations/annotation_renderer_utils","modules/clean/image_preview_util"],function(t,n,o,i,r,s,a,l){var u,c;return c=new a,u=function(){function i(){this.onAnnotationLeaveCallback=e(this.onAnnotationLeaveCallback,this),this.onAnnotationEnterCallback=e(this.onAnnotationEnterCallback,this),this.onAnnotationClickCallback=e(this.onAnnotationClickCallback,this),this._renderAnnotation=e(this._renderAnnotation,this),this.updateAnnotations=e(this.updateAnnotations,this),this.removeAnnotation=e(this.removeAnnotation,this),this._annotationsByActivityKey={}}return i.prototype._isAnnotationAlreadyRendered=function(e){return t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e+"']").length>0},i.prototype.removeAnnotation=function(e){var n;return this._isAnnotationAlreadyRendered(e.activity_key)?(n=t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']").get(0),o.unmountComponentAtNode(n),n.remove()):void 0},i.prototype.removeAllAnnotations=function(){return this.reset()},i.prototype.reset=function(){var e,t,n,i;for(t=l.getAnnotationLayers(),n=0,i=t.length;i>n;n++)e=t[n],o.unmountComponentAtNode(e);return t.remove(),this._annotationsByActivityKey={}},i.prototype.highlightAnnotation=function(e){var n;return this._isAnnotationAlreadyRendered(e.activity_key)?(n=t("."+l.ANNOTATION_LAYER_CSS+"[data-comment-activity-key='"+e.activity_key+"']"),n.removeClass("start-highlight-animation"),n.width(n.width()),n.addClass("start-highlight-animation")):void 0},i.prototype.updateAnnotations=function(e){var t,n,o,i,r,s;if(c.shouldUpdateAnnotations(e,this._annotationsByActivityKey)){for(this.removeAllAnnotations(),r=e.annotations,s=[],o=0,i=r.length;i>o;o++)n=r[o],c.renderAnnotation(n,this._isAnnotationAlreadyRendered,this._renderAnnotation),t=n.commentActivity.activity_key,s.push(this._annotationsByActivityKey[t]=n);return s}},i.prototype._renderAnnotation=function(e,i,r,s){var a,u,c;return u=l.getAnnotationContainer(),(null!=u?u.length:void 0)>0?(i.viewportCoordinates=l.convertAnnotationImagePointsToViewportCoordinates(i),c=t("<div class='"+l.ANNOTATION_LAYER_CSS+"' />"),c.attr({"data-comment-activity-key":r.activity_key}),a=c.appendTo(u).get(0),o.render(n.createElement(e,{annotation:i,commentActivity:r,options:s,onAnnotationClickCallback:this.onAnnotationClickCallback,onAnnotationEnterCallback:this.onAnnotationEnterCallback,onAnnotationOverCallback:this.onAnnotationOverCallback,onAnnotationLeaveCallback:this.onAnnotationLeaveCallback}),a)):void 0},i.prototype._sendToParent=function(e,t){return null==t&&(t=null),window.postMessage(JSON.stringify({action:e,parameters:t}),"*")},i.prototype.onAnnotationClickCallback=function(e){return this._sendToParent("annotation-ui-click",e)},i.prototype.onAnnotationEnterCallback=function(e){return this._sendToParent("annotation-ui-enter",e)},i.prototype.onAnnotationOverCallback=function(e){return{}},i.prototype.onAnnotationLeaveCallback=function(e){return this._sendToParent("annotation-ui-leave",e)},i}()})}.call(this),define("modules/clean/immutability_helper",["require","exports","external/deep-freeze"],function(e,t,n){"use strict";function o(e){if(null==e)throw new TypeError("Cannot thaw null/undefined object");if(Array.isArray(e))return Array.prototype.slice.call(e);for(var t=Object.create(Object.getPrototypeOf(e)),n=Object.getOwnPropertyNames(e),o=0;o<n.length;o++){var i=n[o],r=Object.getOwnPropertyDescriptor(e,i);r.get||r.set?(r.configurable=!0,Object.defineProperty(t,i,r)):t[i]=e[i]}return t}function i(e,t){var i=o(e);return t(i),n(i)}function r(e,t){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));return t.reduce(function(e,t){return null==e?null:e[t]},e)}function s(e,t,i){if(null==e)throw new TypeError("Object to `set` cannot be null");if(e[t]===i)return e;var r=o(e);return r[t]=i,n(r)}function a(e,t,n){return s(e,t,n(e[t]))}function l(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var o=t[0];return 1===t.length?a(e,o,n):s(e,o,l(e[o],t.slice(1),n))}function u(e,t,n){if(!t||0===t.length)throw new TypeError("Invalid key path: "+JSON.stringify(t));if(null==e)throw new TypeError("Target object cannot be null");var o=t[0];switch(t.length){case 1:return s(e,o,n);default:return s(e,o,u(e[o]||{},t.slice(1),n))}}function c(e,t){if(null==e||null==t)throw new TypeError("Both target and source cannot be null");var i=Object.keys(t).reduce(function(n,o){return t[o]!==e[o]&&n.push(o),n},[]);if(i.length){for(var r=o(e),s=0;s<i.length;s++){var a=i[s];Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(t,a))}return n(r)}return e}function d(e,t,n){if(null==e||null==n)throw new TypeError("Both target and source cannot be null");return l(e,t,function(e){return c(e,n)})}function p(e,t,o){for(var i=[],r=3;r<arguments.length;r++)i[r-3]=arguments[r];var s=m.call(e);return s.splice.apply(s,[t,o].concat(i)),n(s)}function h(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var i=m.call(e);return i.unshift.apply(i,t),n(i)}function _(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var i=m.call(e);return i.push.apply(i,t),n(i)}var m=Array.prototype.slice;t.thaw=o,t.withMutations=i,t.getIn=r,t.set=s,t.update=a,t.updateIn=l,t.setIn=u,t.merge=c,t.mergeIn=d,t.splice=p,t.unshift=h,t.push=_}),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/loggers/file_preview_logger",["modules/clean/ajax","modules/clean/react/file_viewer/constants","modules/clean/uuid","modules/clean/web_timing_logger","modules/constants/request","modules/core/browser"],function(t,n,o,i,r,s){var a,l,u,c,d,p,h;return l=n.EventTypes,h=n.SourceContext,a={},a[l.FILE_PREVIEW_SESSION_ENDED]="preview_session_ended",a[l.FILE_PREVIEW_ATTEMPT_STARTED]="preview_attempted",a[l.FILE_PREVIEW_SUPPORT_CONFIRMED]="support_confirmed",a[l.FILE_PREVIEW_SUPPORT_DENIED]="support_denied",a[l.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]="download_attempted",a[l.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]="download_succeeded",a[l.FILE_PREVIEW_DOWNLOAD_FAILED]="download_failed",a[l.FILE_PREVIEW_RENDER_SUCCEEDED]="render_succeeded",a[l.FILE_PREVIEW_RENDER_FAILED]="render_failed",a[l.FILE_PREVIEW_SEEN_STATE_SHOWN]="seen_state_shown",a[l.FILE_PREVIEW_PASS_SHOWN]="pass_shown",a[l.FILE_PREVIEW_PASS_HOVER]="pass_hover",a[l.FILE_PREVIEW_PASS_CLICK]="pass_click",p={},p[h.BROWSE]="browse",p[h.SHARED_LINK_FILE]="sl_file",p[h.SHARED_LINK_FOLDER]="sl_folder",p[h.SHARED_LINK_COLLECTION]="sl_collection",p[h.VERSION_HISTORY]="version_history",u=function(){function e(){}return e.prototype._getSerializedTimeline=function(){return null},e.prototype._log=function(e,n,o){var i,r;return null==o&&(o={}),r=this._getSerializedTimeline(n),i={event_name:a[e],file_viewer_session_id:n.fileViewerSession.id,file_preview_session_id:n.id,file_ns_id:n.file.ns_id,file_sjid:n.file.sjid,file_preview_timeline:null!=r?JSON.stringify(r):null,file_preview_size:n.previewSize,extra:JSON.stringify(o)},t.SilentBackgroundRequest({url:"/log/file_preview",data:i})},e}(),c=function(t){function n(){this._passEventsToHandler={},this._passEventsToHandler[l.FILE_PREVIEW_SEEN_STATE_SHOWN]=this._handleFilePreviewSeenStateShown.bind(this),this._passEventsToHandler[l.FILE_PREVIEW_PASS_SHOWN]=this._handleFilePreviewPassShown.bind(this),this._passEventsToHandler[l.FILE_PREVIEW_PASS_HOVER]=this._handleFilePreviewPassHover.bind(this),this._passEventsToHandler[l.FILE_PREVIEW_PASS_CLICK]=this._handleFilePreviewPassClick.bind(this)}return e(n,t),n.prototype.listenTo=function(e){var t,n,o,i;o=this._passEventsToHandler,i=[];for(t in o)n=o[t],i.push(e.addListener(t,n));return i},n.prototype.unlistenTo=function(e){var t,n,o,i;o=this._passEventsToHandler,i=[];for(t in o)n=o[t],i.push(e.removeListener(t,n));return i},n.prototype._convertEventDataToExtra=function(e){return{num_current_viewers:e.numCurrentViewers,num_viewers:e.numViewers}},n.prototype._handleFilePreviewSeenStateShown=function(e,t){return this._log(l.FILE_PREVIEW_SEEN_STATE_SHOWN,e,this._convertEventDataToExtra(t))},n.prototype._handleFilePreviewPassShown=function(e,t){return this._log(l.FILE_PREVIEW_PASS_SHOWN,e,this._convertEventDataToExtra(t))},n.prototype._handleFilePreviewPassHover=function(e,t){return this._log(l.FILE_PREVIEW_PASS_HOVER,e,this._convertEventDataToExtra(t))},n.prototype._handleFilePreviewPassClick=function(e,t){return this._log(l.FILE_PREVIEW_PASS_CLICK,e,this._convertEventDataToExtra(t))},n}(u),d=function(t){function n(e){this._filePreviewSessionId=e,this._timelineEventsToHandler={},this._timelineEventsToHandler[l.FILE_PREVIEW_ATTEMPT_STARTED]=this._handleFilePreviewAttemptStarted.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_SUPPORT_CONFIRMED]=this._handleFilePreviewSupportConfirmed.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_SUPPORT_DENIED]=this._handleFilePreviewSupportDenied.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]=this._handleFilePreviewDownloadAttempted.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=this._handleFilePreviewDownloadSucceeded.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_DOWNLOAD_FAILED]=this._handleFilePreviewDownloadFailed.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_RENDER_SUCCEEDED]=this._handleFilePreviewRenderSucceeded.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_RENDER_FAILED]=this._handleFilePreviewRenderFailed.bind(this),this._timelineEventsToHandler[l.FILE_PREVIEW_SESSION_ENDED]=this._handleFilePreviewSessionEnded.bind(this)}return e(n,t),n.prototype.listenTo=function(e){var t,n,o,i;o=this._timelineEventsToHandler,i=[];for(t in o)n=o[t],i.push(e.addListener(t,n));return i},n.prototype.unlistenTo=function(e){var t,n,o,i;o=this._timelineEventsToHandler,i=[];for(t in o)n=o[t],i.push(e.removeListener(t,n));return i},n.prototype._handleFilePreviewAttemptStarted=function(e,t){
return this._handleEvent(l.FILE_PREVIEW_ATTEMPT_STARTED,e,t)},n.prototype._handleFilePreviewSupportConfirmed=function(e,t){return this._handleEvent(l.FILE_PREVIEW_SUPPORT_CONFIRMED,e,t)},n.prototype._handleFilePreviewSupportDenied=function(e,t){return this._handleEvent(l.FILE_PREVIEW_SUPPORT_DENIED,e,t)},n.prototype._handleFilePreviewDownloadAttempted=function(e,t){return this._handleEvent(l.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,e,t)},n.prototype._handleFilePreviewDownloadSucceeded=function(e,t){return this._handleEvent(l.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,e,t)},n.prototype._handleFilePreviewDownloadFailed=function(e,t){return this._handleEvent(l.FILE_PREVIEW_DOWNLOAD_FAILED,e,t)},n.prototype._handleFilePreviewRenderSucceeded=function(e,t){return this._handleEvent(l.FILE_PREVIEW_RENDER_SUCCEEDED,e,t)},n.prototype._handleFilePreviewRenderFailed=function(e,t){return this._handleEvent(l.FILE_PREVIEW_RENDER_FAILED,e,t)},n.prototype._handleFilePreviewSessionEnded=function(e,t){return this._handleEvent(l.FILE_PREVIEW_SESSION_ENDED,e,t)},n.prototype._handleEvent=function(e,t,n){var o,u,c,d;return null==n&&(n={}),this._filePreviewSessionId===t.id?(n.file_preview_timeline=JSON.stringify(this._getSerializedTimeline(t)),n.web_timing_logger_req_id=r.REQUEST_ID,d=t.fileViewerSession.sourceContext,d&&(n.source_context=p[d]),null!=t.lastEvent&&(n.last_event=a[t.lastEvent]),e===l.FILE_PREVIEW_RENDER_SUCCEEDED&&d===h.SHARED_LINK_FILE&&(u=i.start_time(),n.time_to_render=Date.now()-u,(o=null!=(c=s.performance())?c.timing:void 0)&&(n.time_to_first_byte=o.responseStart-u)),this._log(e,t,n)):void 0},n.prototype._getSerializedTimeline=function(e){var t,n,o,i,r;o={},n=e.previewTimeline;for(t in n)i=n[t],r=this._timelineKey(t),o[r]=i.timestamp;return o},n.prototype._timelineKey=function(e){var t;return t=a[e],t+"_ts"},n}(u),{FilePreviewPassLogger:c,FilePreviewTimelineLogger:d}})}.call(this),function(){define("modules/clean/loggers/file_viewer_logger",["jquery","modules/constants/python","modules/clean/analytics","modules/clean/previews/util"],function(e,t,n,o){var i,r,s,a,l;return i=t.FileViewModeType,r=t.FileViewPlatformType,s=t.FileViewTargetType,l=o.PreviewHelper,a=function(){function t(){}return t.start=function(){return n.UserActivityLogger.start("web","file_view_first_page_rendered"),n.PreviewActivityLogger.start("file_view_first_page_rendered"),n.FileViewLogger.start()},t.logPageRendered=function(t,o){var i,r,s,a,u,c,d;for(t=t,i=l.get_extension(t),a=e.extend(o.attributes,{total_time:-1,file_ext:i,source:"file-viewer",originalSize:null!=t.bytes?t.bytes:0,docPreviewStatus:t.doc_preview_status}),c=o.stats,r=0,s=c.length;s>r;r++)d=c[r],u=function(){switch(d.name){case"Page Request":return"viewer_page_request_time";case"Rendering":return"viewer_rendering_time";case"Overall":return"viewer_overall_time"}}(),a[u]=d.end-d.start;return n.UserActivityLogger.stop("web","file_view_first_page_rendered",a),n.PreviewActivityLogger.stop("file_view_first_page_rendered",{file_ext:i,extra:JSON.stringify(a)})},t.logView=function(e,t,o,i,s,a,u,c,d){var p;return null==u&&(u=1),null==c&&(c=!1),null==d&&(d=!1),p={user_id:null!=t?t.id:void 0,target:o,platform:r.WEB,ns_id:e.ns_id,sjid:e.sjid,ns_path:e.ns_path,origin:i,action:s,shared_link_url:a,extra:{file_ext:l.get_extension(e),file_bytes:e.bytes,file_mtime:e.ts,preview_type:e.preview_type,preview_status:e.doc_preview_status,time_taken:-1,in_progress:c,is_team:1===(null!=t?t.is_team:void 0),paid:1===(null!=t?t.paid:void 0),file_view_attempts:u,is_ndsl:d}},n.FileViewLogger.stop(p)},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/loggers/folder_invite_impression_logger",["modules/clean/analytics","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/models"],function(t,n,o){var i,r,s,a,l,u,c,d;return l=t.ProEventsLogger,i=n.EventTypes,c=o.SharedFolderInviteData,d=o.UserNotification,a=c.OVER_QUOTA_STATUSES,s=3,u={},u[a.ALREADY_OVER]="view_shared_folder_notification_already_oq",u[a.WILL_BE_OVER]="view_shared_folder_notification_near_oq",r=function(){function t(){this._handleRenderedNotifications=e(this._handleRenderedNotifications,this)}return t.prototype.listenTo=function(e){return e.addListener(i.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},t.prototype.unlistenTo=function(e){return e.removeListener(i.RENDERED_NOTIFICATIONS,this._handleRenderedNotifications)},t.prototype._handleRenderedNotifications=function(e){var t;return t=e.notifications,this._hasLoggedOverQuotaImpressions?void 0:(this._hasLoggedOverQuotaImpressions=!0,this._logOverQuotaImpressions(t))},t.prototype._logOverQuotaImpressions=function(e){var t,n,o,i,r,a,c;for(a=e.slice(0,s),c=[],n=0,o=a.length;o>n;n++)if(i=a[n],i.type===d.TYPES.SHARED_FOLDER_INVITE){if(r=i.typeData.overQuotaStatus,t=u[r]){l.log(t);break}c.push(void 0)}else c.push(void 0);return c},t}()})}.call(this),function(){define("modules/clean/loggers/notification_logger",["modules/clean/ajax","modules/clean/react/user_notifications/models"],function(e,t){var n,o;return o=t.UserNotification,n={logReceive:function(e){return n._log("receive",e,!1,0,n._eventData)},logRender:function(e,t){return n._log("render",e,!0,t,n._eventData)},logReceiveLegacy:function(e){return n._log("receive",e,!1,0,n._eventDataLegacy)},logRenderLegacy:function(e,t){return n._log("render",e,!0,t,n._eventDataLegacy)},_log:function(t,n,o,i,r){var s,a,l;if(0!==n.length)return s=function(){var e,s,u;for(u=[],a=e=0,s=n.length;s>e;a=++e)l=n[a],u.push(r(t,l,i+a,o));return u}(),e.SilentBackgroundRequest({url:"/log/notif_events",data:{event_list:JSON.stringify(s)}})},_eventData:function(e,t,n,i){var r;return r={event_name:e,type_id:t.typeId,campaign_id:t.campaignId,campaign_version:t.campaignVersion,instance_id:parseInt(t.id),status:o.STATUS_STRINGS[t.status],target_object_key:t.targetObjectKey,location:i?"home":void 0,location_index:i?n:void 0}},_eventDataLegacy:function(e,t,n,i){var r;return r={event_name:e,type_id:t.type_id,campaign_id:t.campaign_id,campaign_version:t.campaign_version,instance_id:parseInt(t.nid),status:o.STATUS_STRINGS[t.status],target_object_key:t.target_object_key,location:i?"home":void 0,location_index:i?n:void 0}}},{NotificationLogger:n}})}.call(this),function(){define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/controller_helpers","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/dbmodal","modules/clean/teams/team_assume_user_personal_locked_modal"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p;return p=o.assert,d=i._,u=a.DBModal,c=function(){function o(){}return o.$element=function(){return e("#db-modal-multiaccount-login-modal")},o.set_during_login_callback=function(e){return p(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},o.show_modal=function(o){var i,a,l,c,h;return null==o&&(o={}),s.get_viewer().is_team_assume_user_session?this.show_personal_account_disabled_modal():(this.$element=e.isFunction(this.$element)?this.$element():this.$element,p(null!=(a=this.$element)?a.length:void 0,"MultiaccountLogin needs its @$element to be set"),p(!(null!=o.on_success&&null!=o.success_href),"on_success and success_href are mutually exclusive"),null!=o.user?h=o.user:null!=o.user_id?h=s.get_viewer().get_user_by_id(o.user_id,!0):null!=o.role&&(h=s.get_viewer().get_user_by_role(o.role,!0)),p(null!=h,"invalid user"),l=h.role,p(!s.get_viewer().is_user_signed_in(h),"called MultiaccountLogin for a user that's already signed in"),c="personal"===l?d("Sign in to your personal Dropbox"):d("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),i=this.$element.find("form"),n.get_controller(i).reset(),n.get_controller(i).set_input_value("login_email",h.email),this.auth_success_callback=function(e){return function(){var n;return s.get_viewer()._sign_in_all_users(),n=function(n){return null!=n?(r.error(n),s.get_viewer()._sign_out_user_by_id(h.id),void e.modal.hide()):null!=o.success_href?t.get_uri().toString()!==o.success_href?t.redirect(o.success_href):t.reload():(e.modal.hide(),"function"==typeof o.on_success?o.on_success():void 0)},null!=e._during_login_callback&&null==o.success_href?e._during_login_callback(h,n):n(),!1}}(this),e(document).off("db:multilogin:success"),e(document).on("db:multilogin:success",this.auth_success_callback),this.modal=new u({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(c),this.$element.find('input[name="login_password"]').focus())},o.show_page_login_modal=function(e){var t,n,o,i,r,a,l;for(l=s.get_viewer(),o=null,r=l.get_users(!0),t=0,n=r.length;n>t;t++)if(a=r[t],!l.is_user_signed_in(a)){o=a;break}return o?(i={user:o},"string"==typeof e?i.success_href=e:"function"==typeof e&&(i.on_success=e),this.show_modal(i),!1):void 0},o.show_personal_account_disabled_modal=function(){var e;return e=s.get_viewer(),l.AssumePersonalLockedModal.show({displayName:e.display_name,teamName:e.team_name}),!1},o}(),INLINE_JS.MultiaccountLogin=c,c})}.call(this),function(){define("modules/clean/notifications/file_watcher",["jquery","external/underscore","modules/clean/notserver","modules/clean/revisions/file_revisions_iterator"],function(e,t,n,o){var i,r,s,a,l,u,c;return s=n.NotClients,c={},l=function(e){return s[e.id]},u=function(e,t){var n,o;return n=e.fq_path,o=t.id,n in c||(c[n]={}),o in c[n]||(c[n][o]=new i(e,t)),c[n][o]},i=function(){function n(t,n){var o,i;this.file=t,this.user=n,this.subscriptions=[],o=l(this.user),i=o.subscribe_sfj({name:"FileWatcher",handler:function(t){return function(){var n;return n=new e.Deferred,n.done(function(){return o.handler_success(i,{ns_map:{}})}),n.fail(function(){return o.handler_failure(i)}),t.checkForUpdates(n)}}(this)})}return n.prototype.subscribe=function(e){return this.subscriptions.push(e)},n.prototype.unsubscribe=function(e){return this.subscriptions=t.reject(this.subscriptions,e)},n.prototype.checkForUpdates=function(e){var t,n,i;return 0===this.subscriptions.length?void e.resolve():(n=new o(this.file.fq_path,this.user.id),i=n.next(1),i.done(function(e){var n,o;return o=e.revisions[0],n=o.file,t(n)}),i.then(e.resolve,e.reject),t=function(e){return function(t){var n,o,i,r,s;for(i=e.subscriptions,r=[],n=0,o=i.length;o>n;n++)s=i[n],r.push(function(e){return setTimeout(function(){return t.sjid>e.latestSjid?e.fulfill(t):void 0},0)}(s));return r}}(this))},n}(),r=function(){function e(e,t,n){this.file=e,this.user=t,this.onFulfill=n,this.latestSjid=this.file.sjid}return e.prototype.fulfill=function(e){return this.file=e,this.latestSjid=e.sjid,this.onFulfill(e)},e.prototype.cancel=function(){var e;return e=u(this.file,this.user),e.unsubscribe(this)},e}(),a={},a.subscribe=function(e,t,n){var o,i;if(l(t))return o=new r(e,t,n),i=u(e,t),i.subscribe(o),o},a._reset=function(){return c={}},a})}.call(this),function(){define("modules/clean/notifications/updated_file_notification",["jquery","modules/core/i18n","modules/core/notify"],function(e,t,n){var o,i,r;return r=t._,o=10,i=function(){function t(e){this.refresh=e,this._render()}return t.prototype.hide=function(){return this._isShowing()&&n.clear(),delete this._notification},t.prototype._render=function(){var t,i,s,a;return t=e("<span></span>").text(r("Someone edited this file.")),a=e("<span></span>").html("&nbsp;"),s=e("<a/>").text(r("Refresh")),s.on("click",this._hideAndRefresh.bind(this)),i=e("<span></span>").append(t).append(a).append(s),this._notification=n.success(i,o)},t.prototype._isShowing=function(){return null!=this._notification&&n.isShown()&&n.current()===this._notification},t.prototype._hideAndRefresh=function(){return this.hide(),this.refresh()},t}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/open_with",["external/underscore","modules/clean/browse_interface","modules/clean/filepath","modules/clean/gandalf_util","modules/core/uri"],function(t,n,o,i,r){var s;return s=function(){function s(){}var a,l,u;return s.PRELOAD_URLS={},s.MAX_SUPPORTED_FILE_SIZE_B=157286400,a=["com.adobe.Reader","Acrord32.exe","com.adobe.Acrobat","Acrobat.exe"],l=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"},{id:"wopitest",ext:["wopitest"],icon:"word",name:"WopiTest"}],u=function(n){var i,r;return r=o.filename(n),i=o.file_extension(r).toLowerCase(),t.find(l,function(t){return e.call(t.ext,i)>=0})},s.get_open_handler_for=function(e,t){var o,i;return i=u(e.fq_path),i&&s.is_app_supported(i.id)?(o=r.encode_parts(e.fq_path),{icon:i.icon,name:i.name,uri:"/ow/msft/edit"+n.get_browse_root(t)+o}):null},s.file_supported=function(e){return!!u(e.fq_path)},s.is_adobe_app=function(t){return e.call(a,t)>=0},s.is_app_supported=function(e){switch(e){case"word":return!0;case"excel":return!0;case"powerpoint":return!0;case"wopitest":return i.getGandalfRule("wopi_view_wopitest");default:return!1}},s}(),__CONDITIONAL_JS__.OpenWith=s,s})}.call(this),define("modules/clean/optimistic_update",["require","exports","external/underscore"],function(e,t,n){"use strict";function o(e){return n.isString(e)}var i={},r=function(){function e(e){this._base=e,this._journal=[],this._head=i}return e.prototype.getValue=function(){return this._head===i&&(this._head=this._journal.reduce(function(e,t){return t.patch(e,t.id)},this._base)),this._head},e.prototype.commit=function(e){var t=n.uniqueId("optimist-patch-");return this._head=i,this._journal.push({id:t,patch:e}),t},e.prototype.rollback=function(e){return null!==this._removeJournalEntry(e)},e.prototype.rebase=function(e){if(o(e)){var t=this._removeJournalEntry(e);return t?(this._head=i,this._base=t.patch(this._base,e),!0):!1}return this._head=i,this._base=e(this._base),!0},e.prototype._removeJournalEntry=function(e){var t=n.findIndex(this._journal,function(t){return t.id===e});return 0>t?null:(this._head=i,this._journal.splice(t,1)[0])},e}();t.Optimist=r}),function(){define("modules/clean/page_role_observer",["modules/core/exception"],function(e){var t,n;return n=e.assert,new(t=function(){function e(){this._listeners=[]}return e.prototype.addListener=function(e){return n("function"==typeof e,"PageRoleState.addListener expects a function, got: "+typeof e),this._listeners.push(e)},e.prototype.removeListener=function(e){var t;return n("function"==typeof e,"PageRoleState.removeListener expects a function, got: "+typeof e),this._listeners=function(){var n,o,i,r;for(i=this._listeners,r=[],n=0,o=i.length;o>n;n++)t=i[n],t!==e&&r.push(t);return r}.call(this)},e.prototype.removeAllListeners=function(){return this._listeners=[]},e.prototype.emit=function(e){var t,n,o,i,r;for(i=this._listeners.slice(),r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(t(e));return r},e}())})}.call(this),function(){define("modules/clean/pagination_manager",["modules/clean/ajax","modules/constants/viewer","modules/core/notify","modules/core/i18n"],function(e,t,n,o){var i,r;return r=o._,i=function(){function o(){}var i,s;return i=function(){function e(e,t){this.userRole=e,this.hasMoreItems=t}return e.prototype.areAllItemsReady=function(e){return null==e&&(e=this.userRole),e===t.ROLE_BOTH?!(this.hasMoreItems[t.ROLE_PERSONAL]||this.hasMoreItems[t.ROLE_WORK]):!this.hasMoreItems[e]},e.prototype.invalidateHasMore=function(){var e,t;e=[];for(t in this.hasMoreItems)e.push(this.hasMoreItems[t]=!0);return e},e.prototype.addDataToAjax=function(e){return e.role=this.areAllItemsReady()?t.ROLE_BOTH:this.userRole},e}(),s=function(){function e(e){this.hasMoreItems=e}return e.prototype.areAllItemsReady=function(){return!this.hasMoreItems},e.prototype.invalidateHasMore=function(){return this.hasMoreItems=!0},e.prototype.addDataToAjax=function(){},e}(),o.prototype.initialize=function(e,t,n,o,i){return this.ajaxURL=n,this.newDataCallback=i,this.autoFetching=!1,this.mode=new s(e.has_more_items),this.keyName=t,this.items={},this.pages=[],this.nextRequestVoucher=e.next_request_voucher,this.userID=o,this._addPage(e.items)},o.prototype.areAllItemsReady=function(e){return this.mode.areAllItemsReady(e)},o.prototype._addPage=function(e){var t,o,i,s,a,l;for(l=[],a=[],t=0,s=e.length;s>t;t++){if(o=e[t],i=o[this.keyName],null==i)return void n.warning(r("Invalid server response"));null==this.items[i]&&(this.items[i]=o,a.push(o),l.push(i))}return this.pages.push(l),this.newDataCallback(this,a)},o.prototype.startAutoFetching=function(){return this.autoFetching=!0,this.fetchNext()},o.prototype.stopAutoFetching=function(){return this.autoFetching=!1},o.prototype.setUserRole=function(e){return this.mode=new i(e,this.mode.hasMoreItems)},o.prototype.reSync=function(e){var n;return null==e&&(e=!1),e&&(this.nextRequestVoucher=null,this.items={},this.pages=[]),n=this.autoFetching&&this.mode.areAllItemsReady(t.ROLE_BOTH),this.mode.invalidateHasMore(),n?this.startAutoFetching():void 0},o.prototype.fetchNext=function(){var o;if(!this.mode.areAllItemsReady(t.ROLE_BOTH))return o={},this.nextRequestVoucher&&(o.voucher=this.nextRequestVoucher),this.mode.addDataToAjax(o),e.WebRequest({url:this.ajaxURL,data:o,subject_user:this.userID,success:function(e){return function(t){return t=JSON.parse(t),e.nextRequestVoucher=t.next_request_voucher,e.mode.hasMoreItems=t.has_more_items,e.autoFetching&&e.fetchNext(),e._addPage(t.items)}}(this),error:function(e){return function(){return n.error()}}(this)})},o.prototype.loadedPageCount=function(){return this.pages.length},o.prototype.getLoadedPage=function(e){var t,n,o,i,r;if(i=[],r=this.pages[e],null==r)return null;for(t=0,o=r.length;o>t;t++)n=r[t],i.push(this.items[n]);return i},o.prototype.getLastLoadedPage=function(){return this.getLoadedPage(this.loadedPageCount()-1)},o}()})}.call(this),define("modules/clean/payments/cash",["require","exports"],function(e,t){"use strict";var n=function(){function e(){}return e.set_locale_number_format=function(t,n,o){void 0===t&&(t=","),void 0===n&&(n="."),void 0===o&&(o="-"),e.groupSymbol=t,e.decimalSymbol=n,e.minusSignSymbol=o},e.set_currency_format_map=function(t){e.currencyFormatMap=t},e.formatAmountThousandsHelper=function(t){var n=Math.abs(parseInt(t,10)).toFixed(0).toString();if(n.length<=3)return n;var o=n.substr(0,n.length-3),i=e.formatAmountThousandsHelper(o);return i+e.groupSymbol+n.substr(n.length-3)},e.roundCurrency=function(t,n,o){return void 0===n&&(n="USD"),void 0===o&&(o=2),o=t%1===0?0:o,e.formatCurrency(t,n,o)},e.formatCurrency=function(t,n,o){void 0===n&&(n="USD"),void 0===o&&(o=2);var i=parseFloat(t);"JPY"===n&&(o=0);var r=e.formatNumber(i,o);return e.currencyFormatMap[n]?e.currencyFormatMap[n].replace("%v",r):r+" "+n},e.splitFormatCurrency=function(t,n,o){void 0===n&&(n="USD"),void 0===o&&(o=2);var i=e.formatCurrency(t,n,o),r=i.indexOf(e.decimalSymbol);return-1===r?[i,""]:[i.slice(0,r+1),i.slice(r+1)]},e.formatNumber=function(t,n){void 0===n&&(n=2);var o=0>t?e.minusSignSymbol:"",i="";return n>0&&(i=e.decimalSymbol+t.toFixed(n).split(".")[1]),o+e.formatAmountThousandsHelper(t)+i},e.groupSymbol=",",e.decimalSymbol=".",e.minusSignSymbol="-",e.currencyFormatMap={USD:"$%v"},e}();t.CashUtil=n;var o=function(){function e(e,t){this.cash1=e,this.cash2=t}return e}();t.CashCurrenciesDoNotMatch=o;var i=function(){function e(){}return e}();t.CashNeedsAmountAndCurrency=i;var r=function(){function e(e,t){if(this.currency=t,this.amount=parseFloat(e),isNaN(this.amount)||!this.currency)throw new i}return e.fromObject=function(t){return new e(parseFloat(t.amount),t.currency)},e.prototype.add=function(t){if(this.currency!==t.currency)throw new o(this,t);return new e(this.amount+t.amount,this.currency)},e.prototype.subtract=function(t){return this.add(new e(-t.amount,t.currency))},e.prototype.multiply=function(t){return new e(this.amount*t,this.currency)},e.prototype.divide=function(t){return new e(this.amount/t,this.currency)},e.prototype.round=function(t){void 0===t&&(t=2);var n=Math.pow(10,t);return new e(Math.round(this.amount*n)/n,this.currency)},e.prototype.toString=function(e){return void 0===e&&(e=2),"JPY"===this.currency&&(e=0),n.roundCurrency(this.amount,this.currency,e)},e.prototype.formatCurrency=function(e){return void 0===e&&(e=2),n.formatCurrency(this.amount,this.currency,e)},e}();t.Cash=r}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/payments/dfb_util",["external/underscore","modules/clean/ajax","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(t,n,o,i,r){var s,a,l,u,c;return s=o.Cash,c=r.assert,u=function(){function e(e,t,n,o,i,r,s){this.plan_ids=e,this.schedule_ids=t,this.license_ids_and_counts=n,this.currencies=o,this.country_code=i,this.zip_code=r,this.vat_id=s,this.renew=!1,this.discount_ratio=0}return e.prototype.set_only_license_count=function(e){var t;return t=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[t]=e},e.prototype.get_only_license_count=function(){var e;return e=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[e]},e.prototype.set_country_code=function(e){this.country_code=e},e.prototype.set_zip_code=function(e){this.zip_code=e},e.prototype.set_currencies=function(e){this.currencies=e},e.prototype.set_renew=function(e){this.renew=e},e.prototype.set_discount_ratio=function(e){this.discount_ratio=e},e.prototype.set_vat_id=function(e){return""!==e&&i.validateVat(this.country_code,e)?this.vat_id=e:this.vat_id=""},e.prototype.cache_key=function(e){var t;return null==e&&(e=!1),this.currencies&&!e&&(t=this.currencies.join(",")),[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),t,this.country_code,this.zip_code,this.vat_id,this.renew,this.discount_ratio].join(":")},e.prototype.to_json=function(){var e;return e=this.renew?{renew:1}:{},e=t.extend(e,{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:this.currencies?JSON.stringify(this.currencies):"",country_code:this.country_code,zip_code:this.zip_code,vat_id:this.vat_id,discount_percentage:JSON.stringify(100*this.discount_ratio)})},e.from_transition_view_models=function(n){var o,i,r,s,a,l,u,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P;for(_=[],S=[],r=[],h=!1,i=!1,I=!1,P=!1,s=0,u=n.length;u>s;s++)if(C=n[s],_.push(C.state.plan.id),S.push(C.state.schedule.id),r.push(C.state.currency),h===!1){for(h={},m=C.state.allocated_licenses,a=0,d=m.length;d>a;a++)o=m[a],h[o.license_id]=o.license_count;i=null!=(f=C.read_only_invoice)?f.tax_country_code:void 0,I=null!=(g=null!=(v=C.read_only_invoice)?v.tax_exclusion_id:void 0)?g:null,P=null!=(y=C.read_only_invoice)?y.tax_zip_code:void 0}else{for(c(C.state.allocated_licenses.length===Object.keys(h).length,"License sets differ"),E=C.state.allocated_licenses,l=0,p=E.length;p>l;l++)o=E[l],c(o.license_id in h,"License sets differ"),c(h[o.license_id]===o.license_count,"License count must match");c(i===(null!=(b=C.read_only_invoice)?b.tax_country_code:void 0),"country codes must match"),c(P===(null!=(w=C.read_only_invoice)?w.tax_zip_code:void 0),"zip codes must match"),c(I===(null!=(T=C.read_only_invoice)?T.tax_exclusion_id:void 0),"VAT IDs must match")}return new e(t.uniq(_),t.uniq(S),h,t.uniq(r),i,P,I)},e}(),a=function(){function e(e){var t,n;this.transition_view_model=e,this.transition_view_model.read_only_invoice?this.current_total=s.fromObject(this.transition_view_model.read_only_invoice.total):this.current_total=new s(0,this.transition_view_model.state.currency),this.transition_view_model.state.per_license_prices.length?this.per_license_price=s.fromObject(this.transition_view_model.state.per_license_prices[0].price):this.per_license_price=new s(0,this.transition_view_model.state.currency),this.recurring_total=s.fromObject(this.transition_view_model.state.total_recurring_price),this.transition_view_model.prices?this.tax=s.fromObject(this.transition_view_model.prices.tax):this.tax=new s(0,this.recurring_total.currency),this.recurring_total_tax=this.recurring_total.add(this.tax),this.tax_percentage=0,this.transition_view_model.read_only_invoice&&(n=this.transition_view_model.read_only_invoice.line_items,t=n.length>0?n[0]:void 0,(null!=t?t.country_tax_percentage:void 0)?this.tax_percentage=t.country_tax_percentage:(null!=t?t.state_tax_percentage:void 0)&&(this.tax_percentage=t.state_tax_percentage))}return e}(),l=function(){function t(t){this.default_transition_view_models=t,this._get_transition_info_for=e(this._get_transition_info_for,this),this._add_to_cache=e(this._add_to_cache,this),this.has_inflight_request=e(this.has_inflight_request,this),this.transition_view_model_requests={},this.transition_info_cache={},this._add_to_cache(this.default_transition_view_models)}return t.prototype.get=function(e,t,o){var i,r,s;return s=u.from_transition_view_models(this.default_transition_view_models),t.total_users&&s.set_only_license_count(t.total_users),t.country_code&&s.set_country_code(t.country_code),t.currency&&s.set_currencies([t.currency]),t.remove_currency&&s.set_currencies(),t.zip_code&&s.set_zip_code(t.zip_code),t.renew&&s.set_renew(t.renew),(t.vat_id||""===t.vat_id)&&s.set_vat_id(t.vat_id),t.discount_ratio&&s.set_discount_ratio(t.discount_ratio),i=s.cache_key(),(r=this._get_transition_info_for(i))?void e(r):this.transition_view_model_requests[i]?void 0:(this.transition_view_model_requests[i]=!0,n.SilentBackgroundRequest({url:"/business/transition-model",type:"GET",dataType:"json",data:s.to_json(),success:function(n){return function(o){var r;return delete n.transition_view_model_requests[i],r=n._add_to_cache(o,t.remove_currency),e(r)}}(this),error:function(e){return function(t){return"function"==typeof o&&o(t),delete e.transition_view_model_requests[i]}}(this)}))},t.prototype.has_inflight_request=function(){return Object.keys(this.transition_view_model_requests).length},t.prototype._add_to_cache=function(e,t){var n,o,i;return null==t&&(t=!1),n=u.from_transition_view_models(e).cache_key(t),o=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)i=e[t],o.push(new a(i));return o}(),this.transition_info_cache[n]=o,o},t.prototype._get_transition_info_for=function(e){return e in this.transition_info_cache?this.transition_info_cache[e]:null},t}(),{DfBTransitionInfo:a,DfBTransitionInfoFetcher:l}})}.call(this),define("modules/clean/payments/validation",["require","exports"],function(e,t){"use strict";function n(e,t){return t.trim().length?s[e]?s[e].regex.test(t):!1:!0}function o(e){return s[e]?s[e].prefix:""}function i(e){return s[e]?s[e].examples:[]}function r(e){if(e=e.replace(/\s+/g,""),e.length<2)return!1;var t=e.substring(0,2);switch(t){case"AT":return/^AT[0-9]{18}$/.test(e);case"BE":return/^BE[0-9]{14}$/.test(e);case"CY":return/^CY[0-9]{10}[0-9a-zA-Z]{16}$/.test(e);case"CZ":return/^CZ[0-9]{22}$/.test(e);case"DE":return/^DE[0-9]{20}$/.test(e);case"EE":return/^EE[0-9]{18}$/.test(e);case"ES":return/^ES[0-9]{22}$/.test(e);case"FI":return/^FI[0-9]{16}$/.test(e);case"FR":return/^FR[0-9]{12}[0-9a-zA-Z]{11}[0-9]{2}$/.test(e);case"GR":return/^GR[0-9]{9}[0-9a-zA-Z]{16}$/.test(e);case"HU":return/^HU[0-9]{26}$/.test(e);case"HR":return/^HR[0-9]{19}$/.test(e);case"IE":return/^IE[0-9]{2}[0-9a-zA-Z]{4}[0-9]{14}$/.test(e);case"IT":return/^IT[0-9]{2}[A-Z]{1}[0-9]{10}[0-9a-zA-Z]{12}$/.test(e);case"LU":return/^LU[0-9]{5}[0-9a-zA-Z]{13}$/.test(e);case"NL":return/^NL[0-9]{2}[A-Z]{4}[0-9]{10}$/.test(e);case"PL":return/^PL[0-9]{26}$/.test(e);case"PT":return/^PT[0-9]{23}$/.test(e);case"SE":return/^SE[0-9]{22}$/.test(e)}return!1}var s={AT:{prefix:"AT",regex:/^ATU[0-9]{8}$/,examples:["ATU12345678"]},BE:{prefix:"BE",regex:/^BE(0?|1)[0-9]{9}$/,examples:["BE0123456789","BE1123456789","BE1234567890"]},BG:{prefix:"BG",regex:/^BG[0-9]{9,10}$/,examples:["BG123456789","BG1234567890"]},CH:{prefix:"CH",regex:/^CHE[0-9]{9}(TVA|MWST|IVA)$/,examples:["CHE123456789TVA","CHE123456789MWST","CHE123456789IVA"]},CY:{prefix:"CY",regex:/^CY[0-9]{8}[A-Z]$/,examples:["CY12345678X"]},CZ:{prefix:"CZ",regex:/^CZ[0-9]{8,10}$/,examples:["CZ12345678","CZ123456789","CZ1234567890"]},DE:{prefix:"DE",regex:/^DE[0-9]{9}$/,examples:["DE123456789"]},DK:{prefix:"DK",regex:/^DK[0-9]{8}$/,examples:["DK12345678"]},EE:{prefix:"EE",regex:/^EE[0-9]{9}$/,examples:["EE123456789"]},GR:{prefix:"EL",regex:/^EL[0-9]{9}$/,examples:["EL123456789"]},ES:{prefix:"ES",regex:/^ES([A-Z][0-9]{7}[0-9A-Z]|[0-9A-Z][0-9]{7}[A-Z])$/,examples:["ESX12345678","ES12345678X","ESX1234567X"]},FI:{prefix:"FI",regex:/^FI[0-9]{8}$/,examples:["FI12345678"]},FR:{prefix:"FR",regex:/^FR[0-9A-Z]{2}[0-9]{9}$/,examples:["FR12345678901","FRX1234567890","FR1X123456789","FRXX123456789"]},GB:{prefix:"GB",regex:/^GB([0-9]{9}|[0-9]{12}|GD[0-9]{3}|HA[0-9]{3})$/,examples:["GB123456789","GB123456789012","GBGD123","GBHA123"]},HR:{prefix:"HR",regex:/^HR[0-9]{11}$/,examples:["HR12345678901"]},HU:{prefix:"HU",regex:/^HU[0-9]{8}$/,examples:["HU12345678"]},IE:{prefix:"IE",regex:/^IE([0-9][0-9A-Z+*][0-9]{5}[A-Z]{1,2}|[0-9]{7}WI)$/,examples:["IE1X23456X","IE1X23456X","IE1234567XX"]},IT:{prefix:"IT",regex:/^IT[0-9]{11}$/,examples:["IT12345678901"]},LT:{prefix:"LT",regex:/^LT([0-9]{9}|[0-9]{12})$/,examples:["LT123456789","LT123456789012"]},LU:{prefix:"LU",regex:/^LU[0-9]{8}$/,examples:["LU12345678"]},LV:{prefix:"LV",regex:/^LV[0-9]{11}$/,examples:["LV12345678901"]},MT:{prefix:"MT",regex:/^MT[0-9]{8}$/,examples:["MT12345678"]},NL:{prefix:"NL",regex:/^NL[0-9]{9}B[0-9]{2}$/,examples:["NL123456789B01"]},NO:{prefix:"NO",regex:/^NO[0-9]{9}(MVA)?$/,examples:["NO123456789","NO123456789MVA"]},PL:{prefix:"PL",regex:/^PL[0-9]{10}$/,examples:["PL1234567890"]},PT:{prefix:"PT",regex:/^PT[0-9]{9}$/,examples:["PT123456789"]},RO:{prefix:"RO",regex:/^RO[0-9]{2,10}$/,examples:["RO12","RO1234567890"]},SE:{prefix:"SE",regex:/^SE[0-9]{12}$/,examples:["SE123456789012"]},SI:{prefix:"SI",regex:/^SI[0-9]{8}$/,examples:["SI12345678"]},SK:{prefix:"SK",regex:/^SK[0-9]{10}$/,examples:["SK1234567890"]}};t.validateVat=n,t.getVatPrefix=o,t.getVatExamples=i,t.validIBANForCountry=r}),function(){define("modules/clean/photos/thumb_loading/generic_thumb_store",["modules/core/exception","modules/clean/photos/thumb_loading/http2_thumb_loader"],function(e,t){var n,o;return o=e.assert,n=function(){function e(e,n){this._loader_batches=null!=n?n:!1,this._thumb_url_to_data={},this._callbacks_by_request_id={},null!=e?this.thumb_loader=e:this.thumb_loader=new t}return e.prototype.is_batching=function(){return this._loader_batches},e.prototype.bind_url=function(e,t){var n,i,r,s,a,l,u,c;return r=t.onSuccess,n=t.onError,i=t.onRequest,o(r,"missing onSuccess handler"),e in this._thumb_url_to_data?("function"==typeof i&&i(!0),r(!0),null):(u=this._get_request_id(),this._callbacks_by_request_id[u]={onSuccess:r,onError:n,onRequest:i},a=function(e){return function(){var t;return null!=(t=e._callbacks_by_request_id[u])&&"function"==typeof t.onRequest?t.onRequest(!1):void 0}}(this),l=function(t){return function(n){var o;return t._thumb_url_to_data[e]=n,null!=(o=t._callbacks_by_request_id[u])?o.onSuccess(!1):void 0}}(this),s=function(e){return function(){var t;return null!=(t=e._callbacks_by_request_id[u])&&"function"==typeof t.onError?t.onError():void 0}}(this),c=function(e){return function(){return u in e._callbacks_by_request_id}}(this),this.thumb_loader.load_image(e,u,a,l,s,c),u)},e.prototype._get_request_id=function(){return this.thumb_loader.get_request_id()},e.prototype.unbind_url=function(e){return null!=e?(delete this._callbacks_by_request_id[e],this.thumb_loader.cancel_thumb(e)):void 0},e.prototype.get_thumb=function(e){return e in this._thumb_url_to_data?this._thumb_url_to_data[e]:null},e}()})}.call(this),function(){define("modules/clean/photos/thumb_loading/http2_thumb_loader",["modules/clean/photos/thumb_loading/utils"],function(e){
var t,n;return n=e.load_individual_image,t=function(){function e(){this._http2_request_id=0}return e.prototype.get_request_id=function(){var e;return e=this._http2_request_id,this._http2_request_id+=1,e},e.prototype.load_image=function(e,t,o,i,r,s){return o(),n(e,1,i,r,s)},e.prototype.cancel_thumb=function(e){},e}()})}.call(this),function(){define("modules/clean/photos/thumb_loading/utils",[],function(){var e;return e=function(e,t,n,o,i){var r;return r=new Image,r.onload=function(){return n(e)},r.onerror=function(){return t>0&&i()?(t-=1,r.src=e):o()},r.src=e},{load_individual_image:e}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/photos/thumbnail_url_util",["external/underscore","modules/constants/python","modules/core/exception","modules/core/uri"],function(t,n,o,i){var r,s,a,l;return r=n.THUMBNAIL_SIZE_MODE,s=n.THUMBNAIL_SIZES,l=function(n,a,l,u){var c,d;return o.assert(null!=a&&null!=l,"Width and height must both be specified or neither"),d=a+"x"+l,o.assert(e.call(s,d)>=0,"Invalid thumbnail size ("+d+")"),c={size:d},null!=u&&(o.assert(e.call(t.values(r),u)>=0,"Invalid thumbnail size mode ("+u+")"),c.size_mode=u),i.parse(n).updateQuery(c).toString()},a=function(e){return i.parse(e).updateQuery({size_mode:5}).toString()},{ThumbnailSizeMode:r,thumbnailUrlForSize:l,fullSizeUrl:a}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/previews/file_view_rams_common",["jquery","modules/clean/gandalf_util","modules/constants/env","modules/core/browser","modules/core/uri"],function(t,n,o,i,r){var s;return s={RAMS_FULLSCREEN_TRANSITION_TIME_MSEC:1e3,_PDF_PREVIEW_DOMAINS:[o.DL_DOC_DOMAIN,o.BLOCK_CLUSTER,o.PUBSERVER,o.DL_DOC_USER_CONTENT_DOMAIN],enterRamsFullscreen:function(e){return e.addClass("rams-fullscreen").data("rams-fullscreen",!0),t(window).resize()},exitRamsFullscreen:function(e){return e.removeClass("rams-fullscreen").removeData("rams-fullscreen"),t(window).resize()},isRamsFullscreenActive:function(e){var t;return t=e.data("rams-fullscreen"),null!=t&&t},_isPdfPreviewDomain:function(t){return t=t.toLowerCase(),e.call(this._PDF_PREVIEW_DOMAINS,t)>=0},_supportsNativePrinting:function(){return i.chrome||i.safari},getNativePrintUrl:function(e,t){var n,o;return this._supportsNativePrinting()?this._isPdfPreviewDomain(t)?(o=e.clone(),o.updateQuery({from_native_print:1}),n=r.parse("https://"+t+"/nativeprint"),n.updateQuery({file:o}),n.toString()):(console.warn("Blocked attempt to load pdf native print for unexpected domain"),null):null}}})}.call(this),function(){define("modules/clean/previews/file_viewer_utils",["jquery"],function(e){var t;return t=function(){return e("#file-viewer")},{getFileViewerElement:t}})}.call(this),function(){define("modules/clean/previews/pdf_loader",["external/underscore","modules/clean/ajax","modules/clean/frame_messenger","modules/clean/gandalf_util","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r){var s,a,l,u;return l=["exit-parent-fullscreen","failed","pagerendered","viewer-initialized","loaded","viewer-ready"],s="iframe.pdfjs",u=function(e){var t,n,o,i,r,s,a,l,u;t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";try{l=crypto.getRandomValues(new Uint8Array(e))}catch(e){o=e,l=[]}for(null==l&&(l=[]),s="",r=a=0,u=e;u>=0?u>a:a>u;r=u>=0?++a:--a)n=e===l.length?l[r]%t.length:Math.floor(Math.random()*t.length),s+=t[n];return s},a=function(){function a(){}return a.prototype._exitFullscreenCallback=null,a.prototype._frameMessenger=new n,a.prototype._fileUrl=null,a.prototype._isFullscreen=!1,a.prototype._options={},a.prototype._ducId=u(64),a.prototype.startListening=function(){return this._frameMessenger.configureChildMessaging(s,this.handleTrustedMesssageFromChild.bind(this),l),this._frameMessenger.startListening()},a.prototype.stopListening=function(){return this._frameMessenger.stopListening()},a.prototype.handleTrustedMesssageFromChild=function(e){switch(e.action){case"viewer-initialized":return this._onViewerInitialized();case"viewer-ready":if(this._isFullscreen)return this._sendEnterFullscreenAction();break;case"exit-parent-fullscreen":return this._isFullscreen=!1,"function"==typeof this._exitFullscreenCallback?this._exitFullscreenCallback():void 0;case"failed":return this._onFailed();case"pagerendered":return this._onPageRendered();case"loaded":return this._onLoaded(e.parameters)}},a.prototype.setExitFullscreenCallback=function(e){return this._exitFullscreenCallback=e},a.prototype.setIsFullscreen=function(e){return this._isFullscreen=e},a.prototype.setOnDownloadAttempted=function(e){return this._onDownloadAttempted=e},a.prototype.setOnDownloadSucceeded=function(e){return this._onDownloadSucceeded=e},a.prototype.setOnDownloadFailed=function(e){return this._onDownloadFailed=e},a.prototype.setOnRenderSucceeded=function(e){return this._onRenderSucceeded=e},a.prototype.setOnRenderFailed=function(e){return this._onRenderFailed=e},a.prototype.openFile=function(n,s){var a,l,u,c;return null==s&&(s={}),this._hasDocumentDownloaded=!1,null!=n?(u=r.parse(n.toString()),c=u.getQuery(),e.defaults(s,{disableRange:!!i.safari_version_at_most(8),chunkSizeGandalf:"64000",minRangeSizeGandalf:"10000000",presentationMode:!1,dropboxDucId:"duc_id"in c?null:this._ducId}),a=null,o.getGandalfRule("docpreview_debug_force_test_pdf")?a="test.pdf":o.getGandalfRule("docpreview_debug_force_test_deck_pdf")?a="test-deck.pdf":o.getGandalfRule("docpreview_debug_force_test_excel2_pdf")&&(a="test-excel2.pdf"),null!=a&&(c.canned_file_name=a,u.setQuery(c)),0===u.getPath().toString().indexOf("/pri")?(l=u.getPath().toString().slice(8),u.setPath("/pri/get_content_url"),t.WebRequest({url:u.toString(),data:{path:l},success:function(e){return function(t){var n;return n=JSON.parse(t),e._finishOpenFile(n.url,s)}}(this)})):this._finishOpenFile(u,s)):void 0},a.prototype._finishOpenFile=function(e,t){return null==t&&(t={}),this._isNewFileUrl(e)?(this._fileUrl=e.toString(),this._options=t,this._sendOpenFileAction()):void 0},a.prototype._isNewFileUrl=function(e){return e.toString()!==this._fileUrl},a.prototype._sendOpenFileAction=function(){return this._frameMessenger.postMessageToChildren("open-file",{fileUrl:this._fileUrl,options:this._options})},a.prototype._sendEnterFullscreenAction=function(){return this._frameMessenger.postMessageToChildren("enter-fullscreen")},a.prototype._onViewerInitialized=function(){return this._sendOpenFileAction(),"function"==typeof this._onDownloadAttempted?this._onDownloadAttempted():void 0},a.prototype._onLoaded=function(e){return"function"==typeof this._onDownloadSucceeded&&this._onDownloadSucceeded({size:e.size}),this._hasDocumentDownloaded=!0},a.prototype._onPageRendered=function(){return"function"==typeof this._onRenderSucceeded?this._onRenderSucceeded():void 0},a.prototype._onFailed=function(e){return this._hasDocumentDownloaded?"function"==typeof this._onRenderFailed?this._onRenderFailed():void 0:"function"==typeof this._onDownloadFailed?this._onDownloadFailed():void 0},a}()})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/previews/preview_actions_helper",["jquery","modules/clean/previews/file_view_rams_common","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/store","modules/constants/legacy","modules/core/browser","modules/core/uri"],function(t,n,o,i,r,s,a,l){var u,c,d,p;return p=o.PreviewHelper,d=function(){function e(){}return e.getIframeQuery=function(){return".react-file-viewer__preview iframe"},e.nativePdfPrint=function(e){var t,o,i,r,u,c,d,h;if(null!=e.preview_type){if(o=e,r=o.doc_preview_status!==s.DOC_PREVIEW_AVAILABLE,u="doc"!==(h=o.preview_type)&&"adobecs"!==h,r||u)return!1;d=p.get_progressive_url("doc",o.href),t=l.parse(d).getAuthority()}else{if(0!==("function"==typeof e.indexOf?e.indexOf("https://"):void 0))return!1;c=e,d=l.parse(a.get_href()),d.setQuery({preview:1}),t=l.parse(c).getAuthority()}return i=n.getNativePrintUrl(d,t),null==i?!1:(window.open(i,"_blank"),!0)},e.enterFullscreen=function(){return i.openFullscreen(),!1},e.exitFullscreen=function(){return i.closeFullscreen(),!1},e.isFullscreen=function(){return r.isFullscreen()},e}(),u=function(o){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,o),i.getEmbedContainer=function(){var e;return e=t("#pdf-embed-container, #html-container, #htmlified-wrapper, #code-wrapper"),1!==e.length&&(e=[]),e},i._getPdfEmbedIframe=function(){return t("#pdf-embed-iframe")},i.getIframeQuery=function(){return".preview-box iframe"},i.nativePdfPrint=function(e){var o,i,r,s;return o=this._getPdfEmbedIframe(),t("body").hasClass("file-preview-body")&&1===o.length&&null!=e?(s=l.parse(a.get_href()),s.setQuery({preview:1}),i=l.parse(e).getAuthority(),r=n.getNativePrintUrl(s,i),null==r?!1:(window.open(r,"_blank"),!0)):!1},i.enterFullscreen=function(){return n.enterRamsFullscreen(t(this.getEmbedContainer())),!0},i.exitFullscreen=function(){return n.exitRamsFullscreen(t(this.getEmbedContainer())),!0},i.isFullscreen=function(){return n.isRamsFullscreenActive(t(this.getEmbedContainer()))},i}(d),c=function(o){function i(){return i.__super__.constructor.apply(this,arguments)}return e(i,o),i.prototype._non_fullscreen_vert_overflow=null,i.getIframeQuery=function(){return".preview-content-container > iframe"},i.enterFullscreen=function(){var e;return n.enterRamsFullscreen(t(".preview")),e=t("html"),this._non_fullscreen_vert_overflow=e.css("overflow-y"),e.css("overflow-y","hidden"),!0},i.exitFullscreen=function(){return n.exitRamsFullscreen(t(".preview")),t("html").css("overflow-y",this._non_fullscreen_vert_overflow),this._non_fullscreen_vert_overflow=null,!0},i.isFullscreen=function(){return n.isRamsFullscreenActive(t(".preview"))},i.nativePdfPrint=function(e){var o,i,r,a;return e.doc_preview_status!==s.DOC_PREVIEW_AVAILABLE||"doc"!==(a=e.preview_type)&&"adobecs"!==a?!1:(r=p.get_progressive_url("doc",e.href),o=l.parse(r).getAuthority(),i=n.getNativePrintUrl(r,o,t("#file-viewer")),null==i?!1:(window.open(i,"_blank"),!0))},i}(d),{PreviewActions:d,LegacyFileViewerActions:c,LegacyFilePreviewActions:u}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/previews/preview_status_watcher",["modules/constants/legacy","modules/core/uri","modules/clean/ajax"],function(t,n,o){var i;return i=function(){function i(){this._onCheckError=e(this._onCheckError,this),this._onCheckSuccess=e(this._onCheckSuccess,this),this._check=e(this._check,this)}return i.TIMEOUT=1e3,i.MAX_TRIES=5,i.prototype._statusRequest=null,i.prototype._statusTimeout=null,i.prototype._statusTries=0,i.prototype.onSuccess=null,i.prototype.onError=null,i.prototype.userId=0,i.prototype.start=function(e,t,o,i){return this.userId=e,this.onSuccess=o,this.onError=i,this.url=n({path:"/doc_preview_status"+t}).toString(),this._check()},i.prototype.stop=function(){return this.reset()},i.prototype.reset=function(){var e;return null!=(e=this._statusRequest)&&e.abort(),this._statusRequest=null,clearTimeout(this._statusTimeout),this._statusTimeout=null,this._statusTries=0},i.prototype._check=function(){return this._statusTries>=i.MAX_TRIES?void("function"==typeof this.onError&&this.onError()):(this._statusTries++,this._statusRequest=o.WebRequest({url:this.url,subject_user:this.userId,success:this._onCheckSuccess,error:this._onCheckError}))},i.prototype._onCheckSuccess=function(e,n,o){switch(parseInt(e,10)){case t.DOC_PREVIEW_AVAILABLE:return"function"==typeof this.onSuccess?this.onSuccess():void 0;case t.DOC_PREVIEW_IN_PROGRESS:return this._statusTimeout=setTimeout(this._check,i.TIMEOUT);default:return"function"==typeof this.onError?this.onError():void 0}},i.prototype._onCheckError=function(e,t,n){return"function"==typeof this.onError?this.onError():void 0},i}()})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/previews/util",["modules/core/browser","modules/clean/analytics","modules/clean/datetime","modules/clean/filepath","modules/clean/gandalf_util","modules/clean/react/file_viewer/constants","modules/constants/comments_panel","modules/constants/env","modules/constants/file_viewer","modules/constants/legacy","modules/constants/static","modules/constants/viewer","modules/core/uri"],function(t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v;return g=n.UserActivityLogger,v=o.getActingTime,f=s.SourceContext,_={is_annotation_marker_enabled:function(){return a.ALLOW_ANNOTATION_MARKER},is_indesign_preview_enabled:function(){return p.docpreview_indesign_preview},is_saveas_experiment_enabled:function(){return r.getGandalfRule("saveas_experiment")},is_password_protected_preview_enabled:function(){return p.docpreview_password_protected_preview},use_excel2_for_extension:function(e){return null==e&&(e=""),m.is_excel2_file(e)&&r.getGandalfRule("docpreview_excel2")},is_commenting_integrated:function(){return r.getGandalfRule("file_viewer_hide_comments")},force_serve_from_dldoc:function(){return p.docpreview_serve_from_dldoc},use_riviera_to_generate_preview:function(){return p.docpreview_riviera_on_the_fly},validate_riviera:function(){return p.docpreview_validate_riviera},is_seen_state_enabled:function(e){return"LIBERAL"===u.FILE_VIEWER_SEEN_STATE&&((null!=e?e.is_team:void 0)||!1)},is_presence_enabled:function(e){return u.FILE_VIEWER_PRESENCE_ENABLED&&((null!=e?e.is_team:void 0)||!1)},is_videojs_5_enabled:function(){return u.VIDEOJS_5_ENABLED},use_hls_video:function(){return u.FILE_VIEWER_VIDEO_USE_HLS}},m={get_extension:function(e){return i.file_extension(e.fq_path||e.filename).toLowerCase()},get_filename:function(e){return i.filename(e.fq_path||e.filename)},normalize_extension:function(e){var t;if("indd"===e)return e;switch(t=e.substring(0,3)){case"rtf":case"odt":return"doc";case"pps":case"odp":return"ppt";case"csv":case"ods":return"xls";default:return t}},is_excel2_file:function(e){var t;return"xls"===(t=e.substring(0,3))||"csv"===t||"ods"===t},get_progressive_url:function(e,t){var n,o,i;return n=m.normalize_extension(e),i=h.parse(t),("doc"===n||"key"===n||"keynote"===n||"adobecs"===n||_.use_excel2_for_extension(n))&&"pdf-js"!==c.PDF_PREVIEW_MODE&&(i=i.updateQuery({post_message_on_failure:1})),"xls"!==n||_.use_excel2_for_extension(n)||(o="xls/preview"),(null!=o||_.use_excel2_for_extension(n))&&i.setAuthority(i.getAuthority().replace("dl-web","dl-doc")),null!=o&&(i.setPath(i.getPath().replace("/pri/get/","/get/")),i.setPath(i.getPath().replace("/get/","/"+o+"/"))),i=i.updateQuery({get_preview:1,saveas:_.is_saveas_experiment_enabled()?1:0,use_riviera:_.use_riviera_to_generate_preview()?1:0,validate_riviera:_.validate_riviera()?1:0})},get_pdf_js_url:function(e,t){return"pdf-js"===c.PDF_PREVIEW_MODE&&(e=_.use_excel2_for_extension(t)?h.parse(d.static_url_pdfjs_excel):h.parse(d.static_url_pdfjs_viewer)),e},getModifierString:function(e){return v(1e3*e.ts)},_getVersionHistoryUrl:function(e,t){var n;return n=h(r.getGandalfRule("revision_history_web")?{path:"/history"+e.fq_path}:{path:"/revisions"+e.fq_path}),this.update_url_with_user_id(n,t.id)},redirectToVersionHistory:function(e,n){var o;return g.log("web","view_version_history"),o=m._getVersionHistoryUrl(e,n),t.redirect(o)},update_url_for_annotation:function(e){return _.is_annotation_marker_enabled()&&(e=e.updateQuery("annotation_marker","1")),e=e.updateQuery("annotation_highlight","1"),e=e.updateQuery("annotation_region","1")},update_url_with_user_id:function(e,t){return e.updateQuery(p.UID_PARAM_NAME,t)},VALID_PREVIEW_TYPES:["photo","video","linkfile","adobecs","doc","excel","html","text","audio"],extensionSupported:function(t){var n;return n=t.preview_type,e.call(this.VALID_PREVIEW_TYPES,n)>=0},filesizeSupported:function(e){var t,n,o;return t=m.get_extension(e),n=e.bytes,o=Number.MAX_VALUE,"pdf"===t?o=c.MAX_PDF_FILE_SIZE_B:"text"===e.preview_type?o=c.MAX_TEXT_FILE_SIZE_B:"linkfile"===e.preview_type?o=c.MAX_LINKFILE_SIZE_B:n=0,o>n},browserSupported:function(e){return!t.msie_version_at_most(9)},isPreviewable:function(e){return m.extensionSupported(e)&&m.filesizeSupported(e)&&m.browserSupported(e)},canGeneratePreview:function(e){var t;return t=m.get_extension(e),m.isPreviewable(e)&&e.doc_preview_status!==c.DOC_PREVIEW_UNAVAILABLE_BAD_FILE&&m.extCanGeneratePreview(t)},extCanGeneratePreview:function(e){var t;return t=m.normalize_extension(e),"doc"===t||"ppt"===t||"xls"===t||"key"===t||"eps"===t||"ai"===t||"indd"===t},usesFrameMessenger:function(e){return"excel"===e||"text"===e||"doc"===e},determineSourceContext:function(){var e;return e=t.get_uri().path,/^\/(home|work|personal|search)/.test(e)?f.BROWSE:/^\/(s|scl\/fi)\//.test(e)?f.SHARED_LINK_FILE:/^\/(sh|scl\/fo)\//.test(e)?f.SHARED_LINK_FOLDER:/^\/sc\//.test(e)?f.SHARED_LINK_COLLECTION:/^\/history/.test(e)?f.VERSION_HISTORY:null}},{PermissionHelper:_,PreviewHelper:m}})}.call(this),function(){define("modules/clean/react/account_menu/account_info",["external/react","modules/clean/react/account_menu/avatar"],function(e,t){var n,o,i;return o=e.createFactory(t),i=e.DOM.div,n=e.createClass({displayName:"AccountInfo",propTypes:{accountPhotoUrl:e.PropTypes.string,userDisplayName:e.PropTypes.string.isRequired,isAccountPhotoEnabled:e.PropTypes.bool.isRequired,isPagelet:e.PropTypes.bool},getDefaultProps:function(){return{isPagelet:!1}},render:function(){return this.props.isPagelet?i({className:"account-info"},i({className:"account-info-name"},this.props.userDisplayName)):i({className:"account-info"},i({className:"o-flag"},i({className:"o-flag__fix"},o({isEnabled:this.props.isAccountPhotoEnabled,photoUrl:this.props.accountPhotoUrl})),i({className:"o-flag__flex"},i({className:"account-info-name"},this.props.userDisplayName))))}})})}.call(this),function(){define("modules/clean/react/account_menu/account_menu",["external/react","external/underscore","modules/clean/em_string","modules/clean/react/bubble_dropdown","modules/clean/react/account_menu/avatar","modules/clean/react/account_menu/account_menu_contents","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h,_,m,f;return h=a._,c=e.createFactory(i),u=e.createFactory(r),d=e.createFactory(o),m=e.DOM,_=m.button,f=m.span,p=18,l=e.createClass({displayName:"AccountMenu",propTypes:{accountPhotoUrl:e.PropTypes.string,arrowPosition:e.PropTypes.string,isAccountPhotoEnabled:e.PropTypes.bool,isToolbarAccountPhotoEnabled:e.PropTypes.bool,logoutContinuationPath:e.PropTypes.string,openLinksInNewTab:e.PropTypes.bool,showAccountSwitcher:e.PropTypes.bool,showBusinessUpgradeLink:e.PropTypes.bool,showInstallLink:e.PropTypes.bool,showNameOnButton:e.PropTypes.bool,showProGiftingLink:e.PropTypes.bool,showProUpgradeLink:e.PropTypes.bool,onSelectUser:e.PropTypes.func,showSettingsLink:e.PropTypes.bool,user:e.PropTypes.object.isRequired,viewer:e.PropTypes.object,isPagelet:e.PropTypes.bool},getDefaultProps:function(){return{accountPhotoUrl:null,arrowPosition:"top",isAccountPhotoEnabled:!0,isPagelet:!1,isToolbarAccountPhotoEnabled:!0,openLinksInNewTab:!0,showNameOnButton:!0,showAccountSwitcher:!1}},_getTargetButtonText:function(){var e,t;return t=this.props.user,e=t.display_name.length<=p?t.display_name:t.familiar_name,n.em_snippet(e,p)},render:function(){var n;return n=_({className:"button-as-link account-menu-target",title:h("Account menu")},c({isEnabled:this.props.isAccountPhotoEnabled&&this.props.isToolbarAccountPhotoEnabled,photoUrl:this.props.accountPhotoUrl||this.props.user.photo_circle_url,dimension:this.props.isPagelet?32:24}),this.props.showNameOnButton?[f({className:"account-menu__name u-mar-left-xs"},this._getTargetButtonText()),e.createElement(s,{group:"web",name:"control_menu",className:"u-mar-left-xxs"})]:void 0),d({targetButton:n,arrow_position:this.props.arrowPosition,extra_css_class:"account-menu"},u(t.extend({},this.props)))}})})}.call(this),function(){define("modules/clean/react/account_menu/account_menu_contents",["external/react","modules/clean/react/account_menu/business_upgrade_link","modules/clean/react/account_menu/avatar","modules/clean/react/account_menu/account_info","modules/clean/react/account_menu/account_switcher","modules/clean/react/account_menu/install_link","modules/clean/react/account_menu/logout_link","modules/clean/react/account_menu/pro_gifting_link","modules/clean/react/account_menu/pro_upgrade_link","modules/clean/react/account_menu/settings_link"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y,E,b;return c=e.createFactory(o),p=e.createFactory(i),h=e.createFactory(t),_=e.createFactory(r),m=e.createFactory(s),f=e.createFactory(l),g=e.createFactory(u),E=e.DOM,v=E.div,y=E.li,b=E.ul,d=e.createClass({displayName:"AccountMenuContents",propTypes:{accountPhotoUrl:e.PropTypes.string,isAccountPhotoEnabled:e.PropTypes.bool,logoutContinuationPath:e.PropTypes.string,openLinksInNewTab:e.PropTypes.bool,showBusinessUpgradeLink:e.PropTypes.bool,showInstallLink:e.PropTypes.bool,showProGiftingLink:e.PropTypes.bool,showProUpgradeLink:e.PropTypes.bool,showSettingsLink:e.PropTypes.bool,showAccountSwitcher:e.PropTypes.bool,onSelectUser:e.PropTypes.func,viewer:e.PropTypes.object,user:e.PropTypes.object.isRequired,isPagelet:e.PropTypes.bool},getDefaultProps:function(){return{accountPhotoUrl:null,isAccountPhotoEnabled:!0,logoutContinuationPath:null,openLinksInNewTab:!1,showBusinessUpgradeLink:!1,showInstallLink:!0,showProGiftingLink:!1,showProUpgradeLink:!1,showSettingsLink:!0,showAccountSwitcher:!1,isPagelet:!1}},_renderAccountSwitcher:function(){return p({user:this.props.user,viewer:this.props.viewer,onSelectUser:this.props.onSelectUser})},_renderInstallLink:function(){return y({className:"link-item"},_({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderLogoutLink:function(){return y({className:"link-item"},m({continuationPath:this.props.logoutContinuationPath}))},_renderBusinessUpgradeLink:function(){return y({className:"link-item"},h({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderProUpgradeLink:function(){return y({className:"link-item"},f({openLinksInNewTab:this.props.openLinksInNewTab}))},_renderProGiftingLink:function(){return y({className:"link-item"},e.createElement(a,null))},_renderSettingsLink:function(){return y({className:"link-item"},g({openLinksInNewTab:this.props.openLinksInNewTab}))},render:function(){return v({className:"dropdown-content-wrapper"},c({userDisplayName:this.props.user.display_name,isAccountPhotoEnabled:this.props.isAccountPhotoEnabled,accountPhotoUrl:this.props.accountPhotoUrl,isPagelet:this.props.isPagelet}),this.props.showAccountSwitcher?this._renderAccountSwitcher():void 0,b({className:"links"},this.props.showSettingsLink?this._renderSettingsLink():void 0,this.props.showInstallLink?this._renderInstallLink():void 0,this.props.showBusinessUpgradeLink?this._renderBusinessUpgradeLink():void 0,this.props.showProUpgradeLink?this._renderProUpgradeLink():void 0,this.props.showProGiftingLink?this._renderProGiftingLink():void 0,this._renderLogoutLink()))}})})}.call(this),function(){define("modules/clean/react/account_menu/account_switcher",["external/react","modules/constants/env","modules/constants/viewer","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r){var s,a,l;return a=i._,l=e.DOM.div,s=e.createClass({displayName:"AccountSwitcher",propTypes:{viewer:e.PropTypes.object,user:e.PropTypes.object,onSelectUser:e.PropTypes.func},_renderEntry:function(e){return l({className:e.is_active?"user-entry active":"user-entry inactive",onClick:e.select_fn?function(t){return e.select_fn(t,e.id)}:void 0,key:e.id},l({className:"u-ellip"},e.title),l({className:"user-entry-email u-ellip"},e.text))},renderUserEntry:function(e){var t;return t=this.props.user.id===e.id,this._renderEntry({id:e.id,text:e.email,title:a(e.role===n.ROLE_PERSONAL?"Personal":"Work"),is_active:t,select_fn:t?null:this.props.onSelectUser})},renderUnpairedUserEntry:function(e){var t;return t=e===n.ROLE_PERSONAL,this._renderEntry({id:t?"/personal":"/team",text:a(t?"Add a personal Dropbox":"Add a work Dropbox"),title:a(t?"Personal":"Work"),is_active:!1,select_fn:function(e,t){return o.redirect(r({path:t}))}})},render:function(){var e,t;return l({className:"account-switcher"},function(){var o,i,r,s;for(r=[n.ROLE_WORK,n.ROLE_PERSONAL],s=[],o=0,i=r.length;i>o;o++)e=r[o],t=this.props.viewer.get_user_by_role(e,!0),t?s.push(this.renderUserEntry(t)):s.push(this.renderUnpairedUserEntry(e));return s}.call(this))}})})}.call(this),function(){define("modules/clean/react/account_menu/avatar",["external/react","modules/clean/avatar/faceholder","modules/clean/avatar/viewer_avatar"],function(e,t,n){var o,i,r;return i=e.createFactory(t),r=e.createFactory(n),o=e.createClass({displayName:"Avatar",propTypes:{isEnabled:e.PropTypes.bool,photoUrl:e.PropTypes.string,dimension:e.PropTypes.number},getDefaultProps:function(){return{isEnabled:!0,dimension:24}},render:function(){return this.props.isEnabled?r({defaultAvatar:i({dimension:this.props.dimension}),dimension:this.props.dimension,photoUrl:this.props.photoUrl}):null}})})}.call(this),function(){define("modules/clean/react/account_menu/business_upgrade_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var i,r,s;return r=n._,s=e.DOM.a,i=e.createClass({displayName:"BusinessUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getUpgradeUrl:function(){return new o({scheme:"https",authority:t.WEBSERVER,path:"/business"})},render:function(){return s({href:this._getUpgradeUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Try Dropbox for business"))}})})}.call(this),function(){define("modules/clean/react/account_menu/install_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var i,r,s;return r=n._,s=e.DOM.a,i=e.createClass({displayName:"InstallLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getInstallUrl:function(){return new o({scheme:"https",authority:t.WEBSERVER,path:"/install"})},render:function(){return s({href:this._getInstallUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Install"))}})})}.call(this),function(){define("modules/clean/react/account_menu/logout_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var i,r,s;return r=n._,s=e.DOM.a,i=e.createClass({displayName:"LogoutLink",propTypes:{continuationPath:e.PropTypes.string},_getLogoutUrl:function(){var e;return e=new o({scheme:"https",authority:t.WEBSERVER,path:"/logout",query:{cont:this.props.continuationPath}})},render:function(){return s({href:this._getLogoutUrl(),className:"link"},r("Sign out"))}})})}.call(this),function(){define("modules/clean/react/account_menu/pro_gifting_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var i,r,s;return r=n._,s=e.DOM.a,i=e.createClass({displayName:"ProGiftingLink",_getGiftingUrl:function(){return new o({scheme:"https",authority:t.WEBSERVER,path:"/gift",query:{trigger:"dropdown"}})},render:function(){return s({href:this._getGiftingUrl(),className:"link"},r("Gift Dropbox Pro"))}})})}.call(this),function(){define("modules/clean/react/account_menu/pro_upgrade_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var i,r,s;return r=n._,s=e.DOM.a,i=e.createClass({displayName:"ProUpgradeLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getUpgradeUrl:function(){return new o({scheme:"https",authority:t.WEBSERVER,path:"/pro/buy",query:{trigger:"direct"}})},render:function(){return s({href:this._getUpgradeUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Upgrade your Dropbox"))}})})}.call(this),function(){define("modules/clean/react/account_menu/settings_link",["external/react","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o){var i,r,s;return r=n._,s=e.DOM.a,i=e.createClass({displayName:"SettingsLink",propTypes:{openLinksInNewTab:e.PropTypes.bool},getDefaultProps:function(){return{openLinksInNewTab:!1}},_getSettingsUrl:function(){return new o({scheme:"https",authority:t.WEBSERVER,path:"/account"})},render:function(){return s({href:this._getSettingsUrl(),className:"link",target:this.props.openLinksInNewTab?"_blank":""},r("Settings"))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/browse/actions",["jquery","external/underscore","modules/clean/browse_interface","modules/clean/css","modules/clean/downloads","modules/clean/em_string","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/flux/dispatcher","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/react/file_modal_controller","modules/clean/react/file_viewer/controller","modules/clean/react/selectable_list","modules/clean/sharing/ui_util","modules/clean/undo","modules/constants/env","modules/constants/python","modules/constants/request","modules/constants/viewer","modules/constants/viewer","modules/core/browser","modules/core/cookies","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k){var O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K;return O=h.BrowseActionTypes,B=h.LoadingStates,H=h.REACT_FILE_VIEWER_ELEMENT_ID,V=h.SEARCH_PREFIX,M=_.File,F=_.BrowseContext,x=m.BrowseStore,L=f.FileModalController,z=v.createSelection,U=y.GoldenGate,q=C.ROLE_WORK,W=N._,K=N.ungettext,G=["#maestro-nav","#page-footer","#page-header","#page-sidebar","#browse-box",".growth-onboarding-progress-bar__container",".team-progress-bar-experience","#flash-upload-container"].join(),j=function(e){var o,i,r,s,a,l,u,c,d,p;return o=e.files,i=e.indexOfPreviewFile,p=e.user,c=e.shouldFocusComment,d=null!=(a=e.updateBrowserLocation)?a:!0,r=null!=(l=e.onCloseViewer)?l:n.noop,s=null!=(u=e.onViewerUnmount)?u:n.noop,g.open(o,i,p,H,{fileViewTarget:w.FileViewTargetType.PRIVATE,fileViewOrigin:w.FileViewOriginType.BROWSE,fileViewAction:w.FileViewActionType.CLICK,shouldFocusCommentInput:c,disableRouting:!d,onCloseViewer:r,onComponentDidMount:function(){return t(G).hide()},onComponentWillUnmount:function(){return t(G).show(),s()}})},new(D=function(){function i(){this.setShouldShowDeletedFiles=e(this.setShouldShowDeletedFiles,this),this.navigateToParentFolder=e(this.navigateToParentFolder,this),this.navigateToFileOrFolder=e(this.navigateToFileOrFolder,this),this.computeAndApplyDeltasFromNotServer=e(this.computeAndApplyDeltasFromNotServer,this),this.pasteClipboardFilesToCurrentPath=e(this.pasteClipboardFilesToCurrentPath,this)}return i.prototype.initializeEverything=function(e){var t,n,o,i,r,s,a,l,c,d;return d=e.user,s=e.path,n=e.files,c=e.urlPrefix,t=e.context,r=e.mountPoints,a=e.shouldShowDeletedFiles,o=e.fqPathsToSelect,i=e.loadingState,l=e.teamFolders,u.dispatch({type:O.INITIALIZE_EVERYTHING,data:{user:d,path:s,files:n,urlPrefix:c,context:t,mountPoints:r,shouldShowDeletedFiles:a,fqPathsToSelect:o,loadingState:i,teamFolders:l}})},i.prototype._dataApi=p,i.prototype.load=function(e){var t,n,o;return o=e.path,n=e.files,t=e.context,u.dispatch({type:O.LOAD_PATH,data:{path:o,files:n,context:t}})},i.prototype.add=function(e){var t,n;return n=e.path,
t=e.files,u.dispatch({type:O.ADD_FILES,data:{path:n,files:t}})},i.prototype.setLoadingState=function(e){var t,n;return t=e.loadingState,n=e.path,u.dispatch({type:O.SET_LOADING_STATE,data:{loadingState:t,path:n}})},i.prototype.setMountPoints=function(e){var t;return t=e.mountPoints,u.dispatch({type:O.SET_MOUNT_POINTS,data:{mountPoints:t}})},i.prototype.setTeamFolders=function(e){var t;return t=e.teamFolders,u.dispatch({type:O.SET_TEAM_FOLDERS,data:{teamFolders:t}})},i.prototype.setPath=function(e){var t,n,o,i,r;return i=e.path,o=e.onPathLoaded,n=e.nsId,u.dispatch({type:O.SET_PATH,data:{path:i}}),this.setLoadingState({loadingState:B.LOADING_FIRST_PAGE,path:i}),r=x.user().id,t=function(e){return function(t){var n,s,a,l,u,c;return a=t.path,s=t.data,e.setMountPoints({mountPoints:s.ns_id_to_mount_point}),e.setTeamFolders({teamFolders:s.team_folders_js_info}),n=F.fromServerObject(s),s.paginated?(e.setLoadingState({loadingState:B.LOADING_REMAINING_PAGES,path:i}),e.load({path:a,files:[],context:n}),l=function(t,n){return e.add({path:a,files:n}),t.areAllItemsReady()?(e.setLoadingState({loadingState:B.LOADED,path:i}),t.stopAutoFetching()):void 0},u=new d,u.initialize(s.first_page,"sjid","/browse_get_next",r,l),u.startAutoFetching()):(c=s.file_info,e.load({path:a,files:c,context:n}),e.setLoadingState({loadingState:B.LOADED,path:i})),"function"==typeof o?o():void 0}}(this),this._dataApi.loadPath({path:i,userId:r,sortFoldersFirst:!I.mac,includeDeletedFiles:x.shouldShowDeletedFiles(),nsId:n,onSuccess:t,onError:function(e){return function(){return"/"!==i?e.setPath({path:"/",onPathLoaded:o}):void 0}}(this)})},i.prototype.reloadCurrentPath=function(){return this.setPath({path:x.path()})},i.prototype.setUser=function(e){var t;return t=e.user,u.dispatch({type:O.SET_USER,data:{user:t}})},i.prototype.updatePreview=function(e){var t;return t=e.files,g.updateFiles(t)},i.prototype.closeFileViewer=function(){return g.close()},i.prototype.setUrlPrefix=function(e){var t;return t=e.prefix,u.dispatch({type:O.SET_URL_PREFIX,data:{prefix:t}})},i.prototype.setUrl=function(e){var t,n,i,r,s,a;t=e.path,n=e.prefix,i=e.qargs,n===V?(a=x.user(),s=a.role===q?o.WORK_ROOT:o.PERSONAL_ROOT,n+=s,c.push_state(n,i)):(r={},"1"===c.deconstruct_url().qargs.d&&(r.d="1"),c.push_state(x.urlPrefix()+k.encode_parts(t),r),u.dispatch({type:O.SET_SELECTION,data:{selection:z()}}))},i.prototype.copySelectedFilesToClipboard=function(){var e,t,n;return t=x.selectedFiles(),t&&t.size?t.some(function(e){return e.isDeleted})?(R.error(W("Deleted files cannot be added to the clipboard")),!1):U.canDeepNest(x.user().id)&&(e=t.some(function(e){return M.isTeamSharedFolder(e)}))?void R.error(W("Team Folders can’t be copied.")):(n=K("Added %(num_items)s item to clipboard","Added %(num_items)s items to clipboard",t.size).format({num_items:t.size}),R.success(n),u.dispatch({type:O.COPY_SELECTED_FILES_TO_CLIPBOARD})):void 0},i.prototype.pasteClipboardFilesToCurrentPath=function(){return this.copyFiles({files:x.clipboardFiles().toArray(),newPath:x.path()})},i.prototype.selectRowsFromNotServer=function(e){return null==e&&(e=[]),this.setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.map(function(e){return e.fq_path})})},i.prototype.setFilePathsToSelectOnNextUpdate=function(e){var t;return t=e.fqPathsToSelect,u.dispatch({type:O.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE,data:{fqPathsToSelect:t}})},i.prototype.copyFiles=function(e){var t,n,o;return t=e.files,n=e.newPath,o=x.user(),this._dataApi.copyFiles({files:t,newPath:n,userId:o.id,onSuccess:function(e){return function(i){var r,s;return s=i.files,r=i.changesets,a.notifyCopySuccess(t.length,o,r,n,function(){return e.selectRowsFromNotServer(t)}),e.selectRowsFromNotServer(s)}}(this)})},i.prototype.deleteFiles=function(e){var t,n;return t=e.files,n=x.user(),this._dataApi.deleteFiles({files:t,userId:n.id,onSuccess:function(e){var o,i,r;return i=e.fileDeltas,o=e.changesets,r=e.rollbackHints,a.notifyDeleteSuccess(t.length,n,o,r,function(e){return function(){return e.selectRowsFromNotServer(t)}}(this))}})},i.prototype.moveFiles=function(e){var t,n,o,i;return o=e.path,t=e.files,n=e.newPath,i=x.user(),this._dataApi.moveFiles({path:o,files:t,newPath:n,userId:i.id,onSuccess:function(e){return function(o){var r,s,l;return l=o.path,s=o.fileDeltas,r=o.changesets,a.notifyMoveSuccess(t.length,i,r,n,function(){return e.selectRowsFromNotServer(t)})}}(this)})},i.prototype.showFileRename=function(e){var t;return t=e.file,u.dispatch({type:O.REQUEST_NEW_FILE_NAME,data:{file:t}})},i.prototype.cancelFileRename=function(e){var t;return t=e.file,u.dispatch({type:O.CANCEL_FILE_RENAME,data:{file:t}})},i.prototype.renameFile=function(e){var t,n,o;return t=e.file,n=e.newName,u.dispatch({type:O.SET_FILE_RENAME_PENDING,data:{file:t}}),o=x.user(),this._dataApi.renameFile({file:t,newName:n,userId:o.id,onSuccess:function(e){return function(n){var i,r,s;return r=n.renamedFile,i=n.changesets,s=n.rollbackHints,a.notifyRenameSuccess(o,i,s,function(){return e.selectRowsFromNotServer([t])}),e.selectRowsFromNotServer([r])}}(this),onError:function(e){return function(n,o,i){return e.cancelFileRename({file:t})}}(this)})},i.prototype.applyFileDeltas=function(e){var t,n;return n=e.path,t=e.fileDeltas,u.dispatch({type:O.CHANGE_FILES,data:{path:n,fileDeltas:t}})},i.prototype._getMountPointUpdateForCurrentPath=function(e){var t,o,i,r,s,a,l,u;return i=x.path(),t=(null!=(u=x.mountPoints())?u.toJS():void 0)||{},r=function(e){return function(e){return e===i}}(this),o=parseInt(n.findKey(t,r),10),o?(a=e[o]||null,l=t[o]||null):(l=null,s=Boolean(n.findKey(e,r)),a=s?i:null),[l,a]},i.prototype._getPathForNewMountPoint=function(e,t){return e&&!t?x.path():e&&t?l.paths_are_equal(e,t)?null:t:!e&&t?x.path():null},i.prototype._showUserNotificationForPathChange=function(e,t){var i,r,s,a,u,c,d,p,h;return c=t.old_fq_path,h=o.get_browse_root(e)+t.new_fq_path,i=function(e){return n.escape(l.filename(e))},s=function(e){return R.success(new A(e))},r=function(e){return R.error(new A(e))},u=!t.is_changing_view,a=null!=(p=t.change_type)?p.toLowerCase():void 0,"moved"===a?u?s(W("This folder has been moved")):(d=W('The folder ‘%(folder_name)s’ has been moved. <a href="%(href)s">View</a>'),d=d.format({folder_name:i(c),href:n.escape(h)}),r(d)):"renamed"===a?u?(d=W("This folder has been renamed to ‘%(folder_name)s’"),d=d.format({folder_name:i(t.change_to_fq_path)}),s(d)):(d=W('The folder ‘%(folder_name)s’ has been renamed. <a href="%(href)s">View</a>'),d=d.format({folder_name:i(c),href:n.escape(h)}),r(d)):"deleted"===a?(d=W("The folder ‘%(folder_name)s’ has been deleted"),d=d.format({folder_name:i(c)}),r(d)):void 0},i.prototype.computeAndApplyDeltasFromNotServer=function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P;if(E=e.path,b=e.payload,r=e.currentNSId,t=b.added,f=b.moved,C=b.removed,m=b.mount_points,y=b.parent_changes,null!=y?y.change_to_fq_path:void 0)return P=x.user(),this._showUserNotificationForPathChange(P,y),void this.setUrl({path:y.change_to_fq_path});if(T=this._getMountPointUpdateForCurrentPath(m),i=T[0],g=T[1],i&&!g&&R.success(W("The folder was unshared.")),I=this._getPathForNewMountPoint(i,g))return void this.setPath({path:I,nsId:r});for(this.setMountPoints({mountPoints:m}),s=x.filesMap(),a=[],u=0,p=t.length;p>u;u++)v=t[u],o=null,n=M.fromServerObject(v),a.push({before:o,after:n});for(c=0,h=f.length;h>c;c++)S=f[c],w=S[0],v=S[1],o=s.get(w,null),n=M.fromServerObject(v),a.push({before:o,after:n});for(d=0,_=C.length;_>d;d++)l=C[d],o=s.get(l,null),n=null,a.push({before:o,after:n});return this.applyFileDeltas({path:E,fileDeltas:a})},i.prototype.setSelection=function(e){var t;return t=e.selection,u.dispatch({type:O.SET_SELECTION,data:{selection:t}})},i.prototype.selectFilesByFqPath=function(e){var t;return t=e.fqPathsToSelect,u.dispatch({type:O.SELECT_FILES_BY_FQ_PATH,data:{fqPathsToSelect:t}})},i.prototype.toggleFqPathSelected=function(e){var t;return t=e.path,u.dispatch({type:O.TOGGLE_FQ_PATH_SELECTED,data:{path:t}})},i.prototype.setActiveTab=function(e){var t;return t=e.tabName,u.dispatch({type:O.SET_ACTIVE_TAB,data:{tabName:t}})},i.prototype.navigateToFileOrFolder=function(e){var t,n,o,i,r,s,a;return t=e.file,a=null!=(r=e.shouldFocusComment)?r:!1,i=e.onFileViewerUnmount,t.is_dir?t.no_access?L.showNoAccess(t):this.setUrl({path:t.fq_path}):(n=x.getIndexOfFile(t),n>-1?o=null!=(s=x.files())?s.toJS():void 0:(n=0,o=[t]),t.isDeleted?L.showRestore(x.user(),[t]):"download"===t.preview_type?I.unsafe_open_tab(t.href):j({files:o,indexOfPreviewFile:n,shouldFocusComment:a,user:x.user(),onViewerUnmount:i}))},i.prototype.openPreviewForFile=function(e){var t,n;return t=e.file,n=e.onCloseViewer,j({files:[t],indexOfPreviewFile:0,user:x.user(),updateBrowserLocation:!1,onCloseViewer:function(){return"function"==typeof n?n():void 0}})},i.prototype.navigateToParentFolder=function(){var e;return e=l.parent_dir(x.path()),this.setUrl({path:e})},i.prototype.setShouldShowDeletedFiles=function(e){var t,n,o;return o=e.shouldShowDeletedFiles,n=null!=(t=e.shouldReloadFolder)?t:!0,o?c.update_query_param("d","1"):c.remove_query_param("d"),u.dispatch({type:O.SET_SHOULD_SHOW_DELETED_FILES,data:{shouldShowDeletedFiles:o}}),n?this.reloadCurrentPath():void 0},i.prototype.sortFiles=function(e){var t,n;return n=e.sortField,t=e.direction,u.dispatch({type:O.SORT_FILES,data:{sortField:n,direction:t}})},i.prototype.setCopyMode=function(e){var t;return t=e.copyMode,u.dispatch({type:O.SET_COPY_MODE,data:{copyMode:t}})},i.prototype.downloadFiles=function(e){var t,n,o,i,s,a,u,c,d,p;return s=e.files,n=e.context,p=e.user,1!==s.count()||s.first().is_dir?n.blockHash?n.isNonUserRelativeContext?r.zip_batch_by_ns_id({parent_ns_id:n.rootNSID,parent_ns_path:n.currentFQPath,files:s.toArray(),subject_uid:p.id,block_hash:n.blockHash}):(d=n.currentFQPath,a=function(){var e,t,n,i;for(n=s.toArray(),i=[],e=0,t=n.length;t>e;e++)o=n[e],i.push(o.fq_path);return i}(),r.get_zip({fq_paths:a,subject_uid:p.id,block_hash:n.blockHash,parent_path:d})):!1:void(n.isNonUserRelativeContext?(o=s.first(),t=o.direct_blockserver_link,u=n.rootNSID,i=l.filename(o.fq_path),c=n.currentFQPath+"/"+i,r.get_blockserver_link({url:t,ns_id:u,ns_path:c})):r.get_blockserver_link({url:s.first().direct_blockserver_link}))},i.prototype.nameNewFolder=function(){return u.dispatch({type:O.REQUEST_FOLDER_NAME})},i.prototype.createFolder=function(e){var t,n,o,i,r;return o=e.pathName,t=e.folderName,n=null!=(i=e.nsId)?i:null,u.dispatch({type:O.CREATE_FOLDER_PENDING}),r=x.user(),this._dataApi.createNewFolder({pathName:o,folderName:t,nsId:n,userId:r.id,onSuccess:function(e){return function(n){var o,i;return o=n.changesets,i=n.createdFolder,u.dispatch({type:O.CREATE_FOLDER_COMPLETE}),a.notifyFolderCreationSuccess(t,r,o),e.selectRowsFromNotServer([i])}}(this),onError:function(){return u.dispatch({type:O.CANCEL_CREATE_FOLDER})}})},i.prototype.cancelCreateFolder=function(){return u.dispatch({type:O.CANCEL_CREATE_FOLDER})},i.prototype.addCommentStatusBatch=function(e){var t;return t=e.commentStatusByFqPath,u.dispatch({type:O.ADD_COMMENT_STATUS_BATCH,data:{commentStatusByFqPath:t}})},i.prototype.viewInPhotos=function(e){var n,o,i,r,s,a,l,u,c,d;return s=e.files,d=e.user,s=s.toArray(),a=k({scheme:"https",authority:b.WEBSERVER,path:"/app/view_in_timeline"}).updateQuery(S.UID_PARAM_NAME,d.id).toString(),c=t("<form>",{action:a,method:"post"}),o=t("<input>",{name:"t",value:P.read(T.JS_CSRF_COOKIE)}),o.appendTo(c),l=JSON.stringify(function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(r.ns_id);return n}()),n=t("<input>",{name:"ns_ids",value:l}),n.appendTo(c),u=JSON.stringify(function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(r.ns_path);return n}()),i=t("<input>",{name:"ns_paths",value:u}),i.appendTo(c),t(document.body).append(c),c.submit(),c.remove()},i.prototype.setDropTarget=function(e){var t;return t=e.target,u.dispatch({type:O.SET_DROP_TARGET,data:{target:t}})},i.prototype.setDataApi=function(e){return this._dataApi=e},i}())})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/api",["external/underscore","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/models","modules/clean/react/browse/store","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse","modules/constants/viewer"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m){var f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D;return y=o.LoadingStates,v=a.File,f=a.BrowseContext,g=l.BrowseStore,E=d._,D=function(e){var t,n;try{return JSON.parse(e)}catch(e){if(n=e,!(n instanceof SyntaxError))throw n}return null},P=function(e){var o,i,r,s,a,l,u,c,d;return s=e.path,d=e.userId,r=e.onSuccess,o=null!=(a=e.includeDeletedFiles)?a:!1,c=null!=(l=e.sortFoldersFirst)?l:!0,i=null!=(u=e.onError)?u:t.noop,n.WebRequest({data:{show_deleted:o||"",sort_folders_first:c},url:h({path:"/browse"+s}),subject_user:d,success:function(e){var t;return t=D(e),t?r({path:s,data:t}):void 0},error:function(e,t,n){return"function"==typeof i?i(e,t,n):void 0}})},b=function(o){var i,r,s,a,l,u;return r=o.files,a=o.newPath,u=o.userId,l=o.onSuccess,s=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)i=r[e],n.push(i.fq_path);return n}(),e.call(s,a)>=0?(p.error(E("You can’t copy a folder into itself.")),null):n.WebProgressRequest({url:h({path:"/cmd/copy"}),data:{files:s,to_path:a},subject_user:u,progress_text:E("Copying files..."),success:function(e){try{return t.isString(e)&&(e=JSON.parse(e)),r=function(){var t,n,o,r;for(o=e.new_browse_files,r=[],t=0,n=o.length;n>t;t++)i=o[t],r.push(v.fromServerObject(i));return r}(),l({files:r,destinationPath:a,changesets:e.changesets,rollbackHints:e.rollback_hints})}catch(e){}}})},T=function(e){var o,i,r,s,a;return i=e.files,a=e.userId,s=e.onSuccess,r=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)o=i[e],n.push(o.fq_path);return n}(),n.WebProgressRequest({url:h({path:"/cmd/delete"}),data:{files:r},subject_user:a,progress_text:E("Deleting files..."),success:function(e){var n,o;try{return t.isString(e)&&(e=JSON.parse(e)),o=function(){var e,t,o;for(o=[],e=0,t=i.length;t>e;e++)n=i[e],o.push({before:n,after:null});return o}(),s({fileDeltas:o,changesets:e.changesets,rollbackHints:e.rollback_hints})}catch(e){}}})},A=function(o){var r,s,a,l,u,c,d;return c=o.path,s=o.files,l=o.newPath,d=o.userId,u=o.onSuccess,c===l?(p.error(E("Those files already exist in that folder.")),null):(a=function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(r.fq_path);return n}(),e.call(a,l)>=0?(p.error(E("You can’t move a folder into itself.")),null):n.WebProgressRequest({url:h({path:"/cmd/move"}),data:{files:a,to_path:l},subject_user:d,progress_text:E("Moving files..."),success:function(e){var n;try{return t.isString(e)&&(e=JSON.parse(e)),s=g.filesMap(),n=function(){var n,o,l,u;for(l=e.new_browse_files,u=[],n=0,o=l.length;o>n;n++)r=l[n],u.push({before:s.get(t.find(a,function(e){return i.filename(e)===i.filename(r.fq_path)}),null),after:v.fromServerObject(r)});return u}(),u({path:c,destinationPath:l,fileDeltas:n,changesets:e.changesets,rollbackHints:e.rollback_hints})}catch(e){}}}))},R=function(e){var t,o,i,r,s;return t=e.file,o=e.newName,s=e.userId,r=e.onSuccess,i=e.onError,n.WebRequest({url:h({path:"/cmd/rename"+t.fq_path}).toString(),subject_user:s,data:{to_path:o},success:function(e,t,n){var o,s,a,l;l=null;try{l=JSON.parse(e)}catch(e){if(o=e,!(o instanceof SyntaxError))throw o}return l?(a=v.fromServerObject(l.new_browse_files[0]),r({changesets:l.changesets,renamedFile:a,rollbackHints:l.rollback_hints})):i?i():void 0},error:i?i:void 0})},I=function(e){var t,n,o,i;return t=e.fqPath,i=e.userId,n={prev:h.parse(r.get_url()).setFragment("").toString()},n[m.UID_PARAM_NAME]=i,t=t.replace(/^[\/]/,""),o=h({path:"/restore/"+t}).updateQuery(n),o.toString()},C=function(e){var t,n,o,i;return t=e.fqPath,i=e.userId,o={undelete:1},o[m.UID_PARAM_NAME]=i,t=t.replace(/^[\/]/,""),n=_.REVISION_HISTORY_WEB?"/history":"/revisions",h({path:n+"/"+t}).updateQuery(o).toString()},k=function(e){var o,i,r;return o=e.files,r=e.userId,i=e.onSuccess,n.WebProgressRequest({url:"/cmd/restore",data:{files:t.pluck(o,"fq_path")},subject_user:r,dataType:"json",progress_text:E("Restoring…"),success:function(e){return i()}})},N=function(e){var o,i,r,s,a;return o=e.files,a=e.userId,i=e.onSuccess,r=null!=(s=e.progressText)?s:E("Deleting…"),n.WebProgressRequest({url:"/cmd/purge",data:{files:t.pluck(o,"fq_path")},subject_user:a,dataType:"text",progress_text:r,success:function(e){var t;return t=D(e),t&&"success"===t.status?i():void 0}})},O=function(e){var t,o,i,r,s,a;return a=e.userId,t=e.changesets,i=e.progressText,s=null!=(r=e.rollbackHints)?r:{},o=e.onSuccess,n.WebProgressRequest({url:h({path:"/cmd/rollback"}),data:{ns_to_cs:JSON.stringify(t),rollback_hints:JSON.stringify(s)},subject_user:a,progress_text:i,success:function(){return o()}})},w=function(e){var t,o,i,r,s;return r=e.pathName,t=e.folderName,s=e.userId,i=e.onSuccess,o=e.onError,n.WebProgressRequest({url:h({path:"/cmd/new"+r}),data:{to_path:t,folder:"yes"},subject_user:s,success:function(e){var t,n;return t=D(e),t?(n=v.fromServerObject(t.new_browse_files[0]),i({changesets:t.changesets,createdFolder:n})):void 0},error:function(){return o()}})},S=function(e){var t,o,i,r,s,a,l,u,c;return a=e.path,c=e.userId,o=e.namespaceToJournalIdMap,t=e.includeDeletedFiles,r=e.onSuccess,l="/"===a?"":a,s={fq_dir:l,ns_map:function(){var e;e=[];for(i in o)u=o[i],e.push(i+"_"+u);return e}().join(","),show_deleted:Boolean(t)},n.WebRequest({url:h({path:"/update/list_dir"}),subject_user:c,data:s,dataType:"text",success:function(e){var t;return t=D(e),t?r(t):void 0}})},{loadPath:P,copyFiles:b,moveFiles:A,deleteFiles:T,renameFile:R,getFileHistoryUrl:C,getRestoreFileUrl:I,restoreFiles:k,purgeFiles:N,rollbackChangeSets:O,getChangesForDirectory:S,createNewFolder:w}})}.call(this),function(){define("modules/clean/react/browse/constants",["modules/core/i18n"],function(e){var t,n,o,i,r,s,a,l;t=e._,i={},i.BrowseActionTypes={INITIALIZE_EVERYTHING:"INITIALIZE_EVERYTHING",LOAD_PATH:"LOAD_PATH",ADD_FILES:"ADD_FILES",SET_PATH:"SET_PATH",SET_USER:"SET_USER",SET_URL_PREFIX:"SET_URL_PREFIX",SET_LOADING_STATE:"SET_LOADING_STATE",SET_MOUNT_POINTS:"SET_MOUNT_POINTS",SET_TEAM_FOLDERS:"SET_TEAM_FOLDERS",CHANGE_FILES:"CHANGE_FILES",SET_SELECTION:"SET_SELECTION",SELECT_FILES_BY_FQ_PATH:"SELECT_FILES_BY_FQ_PATH",TOGGLE_FQ_PATH_SELECTED:"TOGGLE_FQ_PATH_SELECTED",SET_SHOULD_SHOW_DELETED_FILES:"SET_SHOULD_SHOW_DELETED_FILES",START_INTERNAL_DRAG:"START_INTERNAL_DRAG",STOP_INTERNAL_DRAG:"STOP_INTERNAL_DRAG",SET_DROP_TARGET:"SET_DROP_TARGET",SORT_FILES:"SORT_FILES",SET_COPY_MODE:"SET_COPY_MODE",COPY_SELECTED_FILES_TO_CLIPBOARD:"COPY_SELECTED_FILES_TO_CLIPBOARD",REQUEST_NEW_FILE_NAME:"REQUEST_NEW_FILE_NAME",CANCEL_FILE_RENAME:"CANCEL_FILE_RENAME",SET_FILE_RENAME_PENDING:"SET_FILE_RENAME_PENDING",SET_FILE_RENAME_COMPLETE:"SET_FILE_RENAME_COMPLETE",REQUEST_FOLDER_NAME:"REQUEST_FOLDER_NAME",CREATE_FOLDER_PENDING:"CREATE_FOLDER_PENDING",CREATE_FOLDER_COMPLETE:"CREATE_FOLDER_COMPLETE",CANCEL_CREATE_FOLDER:"CANCEL_CREATE_FOLDER",SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:"SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE",TEAM_FOLDER_DOWNGRADE:"TEAM_FOLDER_DOWNGRADE",ADD_COMMENT_STATUS_BATCH:"ADD_COMMENT_STATUS_BATCH",ADD_FILE_JUMP_KEY_CODE:"ADD_FILE_JUMP_KEY_CODE",RESET_FILE_JUMP:"RESET_FILE_JUMP",SET_ACTIVE_TAB:"SET_ACTIVE_TAB"},i.NewFolderCreationState={CREATE_FOLDER_INACTIVE:"CREATE_FOLDER_INACTIVE",PENDING_INPUT:"PENDING_INPUT",SAVING_INPUT:"SAVING_INPUT"},i.LoadingStates={LOADED:"LOADED",LOADING_FIRST_PAGE:"LOADING_FIRST_PAGE",LOADING_REMAINING_PAGES:"LOADING_REMAINING_PAGES"},i.Direction={UP:"UP",DOWN:"DOWN"},i.FileTypes={FILE:1,FOLDER:2,PACKAGE:3,SHARED_FOLDER:4,SANDBOX:5,TEAM_SHARED_FOLDER:6},i.NameSpaceAccess={ACCESS_NO_ACCESS:0,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},i.REACT_FILE_VIEWER_ELEMENT_ID="browse-react-file-viewer-container",i.BrowseSortField={FILENAME:"FILENAME",MODIFIED:"MODIFIED",CATEGORY:"CATEGORY",EXTENSION:"EXTENSION",SIZE:"SIZE",SHARED_WITH:"SHARED_WITH"},i.DropTargetHighlightMode={NONE:"NONE",ALL_FOLDERS:"ALL_FOLDERS",NONSELECTED_FOLDERS:"NONSELECTED_FOLDERS",NONSELECTED_NONSHARED_FOLDERS:"NONSELECTED_NONSHARED_FOLDERS",NONSELECTED_NONSHARED_NONTEAM_FOLDERS:"NONSELECTED_NONSHARED_NONTEAM_FOLDERS"},n={IMAGE:["bmp","cr2","gif","ico","jpeg","jpg","nef","png","psd","tif","tiff","svg","svgz"],VIDEO:["3gp","3gpp","3gpp2","avi","dv","flv","m2t","m4v","mkv","mov","mp4","mpeg","mpg","mts","ts","vob","wmv"],AUDIO:["aif","flac","m4a","m4p","mp3","ogg","wav","wma"],DOCUMENT:["ai","cdr","csv","doc","docx","docm","eps","fla","indd","keynote","numbers","otf","pages","pdf","ppt","pptx","pptm","pps","ppsx","ppsm","ps","rtf","swf","txt","wpd","xls","xlsx","xlsm"],COMPRESSED_FILE:["7z","bz2","gz","gzip","rar","tar","zip"],CODE:["as","as3","c","coffee","cpp","cs","css","cxx","h","html","java","js","less","php","py","rb","sass","scss","sh","sql","vb","xhtml","xml"],DISK_IMAGE:["dmg","iso"],EXECUTABLE:["exe"],SHORTCUT:["lnk"],LINK:["url","webloc"],FONT:["ttf"]},i.CulledListConstants={ITEM_ROW_HEIGHT_PX:46,MAESTRO_ITEM_ROW_HEIGHT_PX:57,SEARCH_ROW_HEIGHT_PX:53,MAESTRO_SEARCH_ROW_HEIGHT_PX:66,DEFAULT_HEADER_HEIGHT_PX:142,ITEM_BUFFER_SIZE:5},i.ItemTypes={CREATE_FOLDER_UI:"CreateFolderUI",LOADING_INDICATOR:"LoadingIndicator"},i.FileTypeCategoryTranslations={FILE:t("file"),FOLDER:t("folder"),SHARED_FOLDER:t("shared folder"),TEAM_SHARED_FOLDER:t("team folder"),PUBLIC_FOLDER:t("folder"),IMAGE:t("image"),VIDEO:t("video"),AUDIO:t("audio"),DOCUMENT:t("document"),COMPRESSED_FILE:t("archive"),CODE:t("code"),DISK_IMAGE:t("disk image"),EXECUTABLE:t("executable"),SHORTCUT:t("shortcut"),LINK:t("link"),FONT:t("font"),SANDBOX:t("app folder")},i.DeletedFileTypeCategoryTranslations={FILE:t("deleted file"),FOLDER:t("deleted folder"),SHARED_FOLDER:t("deleted shared folder"),TEAM_SHARED_FOLDER:t("deleted team folder"),PUBLIC_FOLDER:t("deleted folder"),IMAGE:t("deleted image"),VIDEO:t("deleted video"),AUDIO:t("deleted audio"),DOCUMENT:t("deleted document"),COMPRESSED_FILE:t("deleted archive"),CODE:t("deleted code"),DISK_IMAGE:t("deleted disk image"),EXECUTABLE:t("deleted executable"),SHORTCUT:t("deleted shortcut"),LINK:t("deleted link"),FONT:t("deleted font"),SANDBOX:t("deleted app folder")},i.ExtensionCategories={};for(o in n)for(s=n[o],a=0,l=s.length;l>a;a++)r=s[a],i.ExtensionCategories[r]=o;return i.RenameStates={PENDING_INPUT:"pending-input",SAVING_INPUT:"saving-input"},i.MouseEventButton={NONE:-1,LEFT:0,MIDDLE:1,RIGHT:2},i.ShareFolderModalTypes={ShareExisting:1,EditShared:2,EditSharedSubFolder:3},i.SharedWithActionTypes={SET_SHARED_FOLDER_DATA:"SET_SHARED_FOLDER_DATA",SET_MEMBER_COUNTS_FOR_NS:"SET_MEMBER_COUNTS_FOR_NS",SET_SHARED_LINK_DATA:"SET_SHARED_LINK_DATA",SET_SHARED_FILE_DATA:"SET_SHARED_FILE_DATA",SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE:"SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE",SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE:"SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE",SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE:"SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE",CLEAR_SHARED_FOLDER_DATA_FOR_NS:"CLEAR_SHARED_FOLDER_DATA_FOR_NS",REMOVE_SHARED_LINK_DATA:"REMOVE_SHARED_LINK_DATA"},i.SEARCH_PREFIX="/search",i})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/models",["external/underscore","external/react","external/immutable","modules/core/exception","modules/clean/filepath","modules/clean/react/browse/constants","modules/constants/legacy"],function(t,n,o,i,r,s,a){var l,u,c,d,p,h,_,m,f,g,v,y,E,b;return v=n.PropTypes,f=s.NameSpaceAccess,_=s.FileTypeCategoryTranslations,c=s.DeletedFileTypeCategoryTranslations,d=s.ExtensionCategories,m=s.FileTypes,E=s.RenameStates,b=function(e,t,n){var o,i,r;r=[];for(o in e)n.hasOwnProperty(o)&&(i=n[o],r.push(t[i]=e[o]));return r},p=o.Record({ago:void 0,beacon_context:void 0,bytes:void 0,comment_count:null,default_sync_setting:null,direct_blockserver_link:void 0,doc_preview_status:void 0,feedback_off:null,file_id:void 0,filename_highlights:void 0,fq_path:void 0,href:void 0,htmlified_link:void 0,icon:void 0,in_root_coll:void 0,is_dir:!1,is_in_team_folder_tree:!1,is_read_only_mount:!1,is_unmounted:!1,last_modified_fname:null,linkfile_data:void 0,match_type:void 0,no_access:!1,ns_id:0,ns_path:void 0,preview_type:void 0,preview_url:void 0,request_id:0,size:-1,sjid:0,sort_key:[""],sort_rank:0,target_ns:0,team_folder_status:null,thumbnail_url_tmpl:void 0,ts:0,type:null,unresolved_comment_count:null,video_transcode_url:void 0,isDeleted:!1}),p.SERVER_PROP_TO_CLIENT_PROP_MAP={ago:"ago",beacon_context:"beacon_context",bytes:"bytes",comment_count:"comment_count",default_sync_setting:"default_sync_setting",direct_blockserver_link:"direct_blockserver_link",doc_preview_status:"doc_preview_status",feedback_off:"feedback_off",file_id:"file_id",filename_highlights:"filename_highlights",fq_path:"fq_path",href:"href",htmlified_link:"htmlified_link",icon:"icon",in_root_coll:"in_root_coll",is_dir:"is_dir",is_in_team_folder_tree:"is_in_team_folder_tree",is_read_only_mount:"is_read_only_mount",is_unmounted:"is_unmounted",last_modified_fname:"last_modified_fname",linkfile_data:"linkfile_data",match_type:"match_type",no_access:"no_access",ns_id:"ns_id",ns_path:"ns_path",preview_type:"preview_type",preview_url:"preview_url",request_id:"request_id",size:"size",sjid:"sjid",sort_rank:"sort_rank",sort_key:"sort_key",target_ns:"target_ns",team_folder_status:"team_folder_status",thumbnail_url_tmpl:"thumbnail_url_tmpl",ts:"ts",type:"type",unresolved_comment_count:"unresolved_comment_count",video_transcode_url:"video_transcode_url"},p.fromServerObject=function(e){var t;return"object"!=typeof e?(i.raiseAndReport({msg:"File.fromServerObject called with an unexpected argument: "+e}),new p):(t={},b(e,t,p.SERVER_PROP_TO_CLIENT_PROP_MAP),e.hasOwnProperty("bytes")&&(t.isDeleted=-1===e.bytes),new p(t))},p.getExtension=function(e){return r.file_extension(e.fq_path,!0).toLowerCase()},p.getCategoryDescription=function(e){var t;if(e.is_dir){switch(t="FOLDER",e.type){case m.TEAM_SHARED_FOLDER:t="TEAM_SHARED_FOLDER";break;case m.SHARED_FOLDER:t="SHARED_FOLDER";break;case m.SANDBOX:t="SANDBOX";break;default:e.target_ns&&(t="SHARED_FOLDER")}return e.isDeleted?c[t]:_[t]}return t=d[p.getExtension(e)]||"FILE",e.isDeleted?c[t]:_[t]},p.isTeamSharedFolder=function(e){return e.type===m.TEAM_SHARED_FOLDER},p.areEqual=function(e,t){return e.ns_id===t.ns_id&&e.sjid===t.sjid},u=o.Record({isPublicFolderEnabled:!1,publicAppToken:null}),u.SERVER_PROP_TO_CLIENT_PROP_MAP={simple_sharing_enabled:"isSimpleSharingEnabled",public_folder_enabled:"isPublicFolderEnabled",public_app_token:"publicAppToken"},u.fromServerObject=function(e){var t;return t={},b(e,t,u.SERVER_PROP_TO_CLIENT_PROP_MAP),new u(t)},l=o.Record({cdmMveQuotaStats:null,currentNSID:a.root_ns,currentFQPath:null,currentMountPoint:null,currentNSPath:null,currentSharedFolderPermissionRole:f.ACCESS_NO_ACCESS,currentNSAllowsNesting:!1,inactiveNSIDByFQPath:o.Map(),permanentDeletionDisabledStateByNSID:o.Map(),isInFolderMode:!0,isInsideSharedFolder:!1,isInsideAutoTeamFolder:!1,isInsideTeamFolderTree:!1,isInsideDeletedFolder:!1,isInsideDeletedSharedFolder:!1,isInsideDeletedNestedSharedFolder:!1,isNonUserRelativeContext:!1,rootNSID:null,showSharedFolderCreateTeamPromo:!1,showPinnedTeamFolder:!1,blockHash:null,config:new u}),y=o.Record({quotaRawBytesUsed:0,quotaRawBytes:0,formattedQuota:""}),y.SERVER_PROP_TO_CLIENT_PROP_MAP={quota_raw_bytes_used:"quotaRawBytesUsed",quota_raw_bytes:"quotaRawBytes",formatted_quota:"formattedQuota"},y.fromServerObject=function(e){var t;return t={},b(e,t,y.SERVER_PROP_TO_CLIENT_PROP_MAP),new y(t)},l.SERVER_PROP_TO_CLIENT_PROP_MAP={root_ns_id:"rootNSID",containing_ns_id:"currentNSID",fqPath:"currentFQPath",containing_mount_point:"currentMountPoint",containing_ns_path:"currentNSPath",old_path_to_ns_id:"inactiveNSIDByFQPath",permanent_delete_is_disabled_by_ns_id:"permanentDeletionDisabledStateByNSID",inside_dir:"isInFolderMode",inside_shared_folder:"isInsideSharedFolder",inside_auto_team_folder:"isInsideAutoTeamFolder",inside_team_folder_tree:"isInsideTeamFolderTree",inside_deleted_dir:"isInsideDeletedFolder",inside_deleted_nested_shared_folder:"isInsideDeletedNestedSharedFolder",is_non_user_relative_context:"isNonUserRelativeContext",show_shared_folder_create_team_promo:"showSharedFolderCreateTeamPromo",show_pinned_team_folder:"showPinnedTeamFolder",block_hash:"blockHash"},l.fromServerObject=function(t){var n,o,i;return i={},t.hasOwnProperty("containing_fq_path")&&(o=t.containing_fq_path||"",0!==o.indexOf("/")&&(o="/"+o),i.currentFQPath=o),t.inside_shared_folder&&(i.currentSharedFolderPermissionRole=f.ACCESS_READER),t.cdm_mve_quota_stats&&(i.cdmMveQuotaStats=y.fromServerObject(t.cdm_mve_quota_stats)),t.hasOwnProperty("containing_ns_permissions")&&(n=t.containing_ns_permissions||[],i.currentNSAllowsNesting=e.call(n,"mount_shared_folders")>=0,t.inside_shared_folder&&(e.call(n,"edit_contents")>=0&&(i.currentSharedFolderPermissionRole=f.ACCESS_WRITER),e.call(n,"change_folder_options")>=0&&(i.currentSharedFolderPermissionRole=f.ACCESS_OWNER))),t.hasOwnProperty("inside_deleted_shared_folder")&&(i.isInsideDeletedSharedFolder=Boolean(t.inside_deleted_shared_folder)),b(t,i,l.SERVER_PROP_TO_CLIENT_PROP_MAP),i.config=u.fromServerObject(t),new l(i)},l.prototype.isCurrentPathWriteable=function(){var e;return!this.isInsideSharedFolder||(e=this.currentSharedFolderPermissionRole)===f.ACCESS_WRITER||e===f.ACCESS_OWNER},l.prototype.getNameOfTargetFolder=function(){return r.filename(this.currentFQPath)},h=o.Record({file:null,state:null}),h.propTypes=v.shape({file:v.instanceOf(p),state:v.oneOf(t.values(E))}),g=o.Record({title:"",pad_id:void 0,url:void 0,title_highlights:[],creator_name:"",last_modified_date:void 0},"Paper"),g.SERVER_PROP_TO_CLIENT_PROP_MAP={title:"title",pad_id:"pad_id",url:"url",title_highlights:"title_highlights",creator_name:"creator_name",last_modified_date:"last_modified_date"},g.fromServerObject=function(e){var t;return"object"!=typeof e?(i.raiseAndReport({msg:"Paper.fromServerObject called with an unexpected argument: "+e}),new g):(t={},b(e,t,g.SERVER_PROP_TO_CLIENT_PROP_MAP),new g(t))},{File:p,Config:u,BrowseContext:l,FileRename:h,Paper:g,QuotaStats:y}})}.call(this),function(){define("modules/clean/react/browse/render_partials",["external/react","modules/clean/react/sprite","modules/clean/react/browse/models"],function(e,t,n){var o,i,r,s;return o=n.File,s=e.DOM,r=e.createElement,i=e.createClass({displayName:"FileIconView",propTypes:{file:e.PropTypes.instanceOf(o).isRequired,onClick:e.PropTypes.func,onMouseDown:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{onClick:function(){},onMouseDown:function(){},onDragStart:function(){},className:""}},getInitialState:function(){return{hasThumbFailed:!1}},render:function(){return this.props.file.thumbnail_url_tmpl&&!this.state.hasThumbFailed?s.img({src:this.props.file.thumbnail_url_tmpl,className:"browse-file-row__accessory "+this.props.className,alt:"",onError:function(e){return function(){return e.setState({hasThumbFailed:!0})}}(this),onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown}):r(t,{group:"web",name:this.props.file.icon,className:"browse-file-row__accessory "+this.props.className,alt:"",onClick:this.props.onClick,onDragStart:this.props.onDragStart,onMouseDown:this.props.onMouseDown})}}),{FileIcon:i}})}.call(this),function(){define("modules/clean/react/browse/sort_helpers",["external/underscore"],function(e){var t,n;return t=function(e,t,n){var o,i,r,s,a,l,u,c;for(o="=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=u=0,c=Math.max(e.length,t.length);c>=0?c>u:u>c;s=c>=0?++u:--u){
if(i=e.charAt(s),r=t.charAt(s),!i)return-n;if(!r)return n;if(a=o.indexOf(i),l=o.indexOf(r),l>a)return-n;if(a>l)return n}return 0},n=function(n,o,i){var r,s,a,l,u,c;if(e.isArray(n)&&e.isArray(o)){for(l=u=0,c=Math.max(n.length,o.length);c>=0?c>u:u>c;l=c>=0?++u:--u){if(s=n[l],a=o[l],null==s)return-i;if(null==a)return i;if(e.isNumber(s)&&e.isString(a))return-i;if(e.isNumber(a)&&e.isString(s))return i;if(e.isString(s)&&e.isString(a)){if(r=t(s,a,i),0!==r)return r}else{if(a>s)return-i;if(s>a)return i}}return 0}return n===o?0:o>n?-i:i},{compare:n}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/browse/store",["external/underscore","external/immutable","modules/core/browser","modules/core/exception","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/file_uploader/store","modules/clean/react/columnheader","modules/clean/react/selectable_list"],function(t,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R;return A=r.assert,_=l.BrowseActionTypes,f=l.BrowseSortField,b=l.FileTypes,w=l.LoadingStates,T=l.NewFolderCreationState,S=l.RenameStates,v=u.File,m=u.BrowseContext,y=u.FileRename,N=c.compare,P=d.UploaderStore,I=d.UploaderActionTypes,E=d.FileStatus,C=p.SortDirections,R=h.createSelection,g=function(r){function a(){return a.__super__.constructor.apply(this,arguments)}return e(a,r),a.prototype._init=function(){return this._unsortedFiles=o.Map(),this._sortedFiles=o.List(),this._teamFolders=o.List(),this._path="",this._user=null,this._urlPrefix="",this._selection=R(),this._loadingState=w.LOADING_FIRST_PAGE,this._context=new m,this._mountPoints=null,this._shouldShowDeletedFiles=!1,this._activeDropTarget=null,this._inCopyMode=!1,this._clipboardFiles=o.Set(),this._currentSort={sortField:f.FILENAME,direction:C.ASCENDING},this._fileRename=null,this._newFolderCreationState=T.CREATE_FOLDER_INACTIVE,this._filePathsToSelectOnNextUpdate=o.Set(),this._activeFileJumpFilter="",this._fileJumpIndex=[],this._activeTab=void 0},a.prototype.files=function(){return this._sortedFiles},a.prototype.filesMap=function(){return this._unsortedFiles},a.prototype.filesWithoutTeamFolders=function(){return this._sortedFiles.filter(function(e){return e.type!==b.TEAM_SHARED_FOLDER})},a.prototype.teamFolders=function(){return this._teamFolders},a.prototype.path=function(){return this._path},a.prototype.user=function(){return this._user},a.prototype.urlPrefix=function(){return this._urlPrefix},a.prototype.selection=function(){return this._selection},a.prototype.selectedFiles=function(){return this._sortedFiles.filter(function(e){return function(t){return e._selection.selected.has(t.fq_path)}}(this)).toOrderedSet()},a.prototype.activeTab=function(){return this._activeTab},a.prototype.loadingState=function(){return this._loadingState},a.prototype.context=function(){return this._context},a.prototype.mountPoints=function(){return this._mountPoints},a.prototype.shouldShowDeletedFiles=function(){return this._shouldShowDeletedFiles},a.prototype.activeDropTarget=function(){return this._activeDropTarget},a.prototype.currentSort=function(){return this._currentSort},a.prototype.getIndexOfFile=function(e){return this._sortedFiles.findIndex(function(t){return t.sjid===e.sjid&&t.ns_id===e.ns_id})},a.prototype.getFileByFilename=function(e){return this._sortedFiles.find(function(t){return s.filename(t.fq_path)===e})||null},a.prototype.getFileByFullPath=function(e){return this._sortedFiles.find(function(t){return t.fq_path===e})||null},a.prototype.inCopyMode=function(){return this._inCopyMode},a.prototype.clipboardFiles=function(){return this._clipboardFiles},a.prototype.fileRename=function(){return this._fileRename},a.prototype.newFolderCreationState=function(){return this._newFolderCreationState},a.prototype.isFileJumping=function(){return this._activeFileJumpFilter.length>0},a.prototype._initializeEverything=function(e){var t,n,i,r,s,a,l,u,c,d;return d=e.user,a=e.path,n=e.files,c=e.urlPrefix,t=e.context,s=e.mountPoints,i=e.fqPathsToSelect,r=e.loadingState,l=e.shouldShowDeletedFiles,u=e.teamFolders,this._user=d,this._path=a,this._urlPrefix=c,this._appendFiles({path:a,files:n},!1),this._context=t,this._mountPoints=o.Map(s),this._loadingState=r,this._setTeamFolders({teamFolders:u}),r===w.LOADED?this._selectFqPaths({fqPathsToSelect:i},!1):this._filePathsToSelectOnNextUpdate=o.Set(i),this._shouldShowDeletedFiles=Boolean(l),this.emit_change()},a.prototype._setUser=function(e){var t;return t=e.user,null==this.user()?this._user=t:void 0},a.prototype._setPathData=function(e){var t,n,o;return o=e.path,n=e.files,t=e.context,o===this.path()?(this._unsortedFiles=this._unsortedFiles.clear(),this._sortedFiles=this._sortedFiles.clear(),this._selection=R(),this._appendFiles({path:o,files:n},!1),this._context=t,this.emit_change()):void 0},a.prototype._appendFiles=function(e,t){var n,i,r,s,a,l,u;if(u=e.path,i=e.files,null==t&&(t=!0),u===this.path()){for(r=[],s=[],a=0,l=i.length;l>a;a++)n=i[a],n instanceof v||(n=v.fromServerObject(n)),r.push([n.fq_path,n]),this._sortedFiles.has(n)||s.push(n);if(this._unsortedFiles=this._unsortedFiles.merge(r),this._sortedFiles=this._sortedFiles.concat(o.List(s)),A(this._unsortedFiles.size===this._sortedFiles.size,"appendFiles ended up with mismatched data structures"),this._sortFiles(this._currentSort,!1),this._filePathsToSelectOnNextUpdate.count()&&this._selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),this._buildFileJumpIndex(),t)return this.emit_change()}},a.prototype._isMostRecentVersionOfFile=function(e){var t,n;return n=e.file,t=n&&this._unsortedFiles.get(n.fq_path),t?t.sjid<n.sjid:!0},a.prototype._updateQuotaStats=function(e){var t,n,o,i,r;return n=e.before,t=e.after,this._context.cdmMveQuotaStats?(o=(null!=t?t.bytes:void 0)||0,r=(null!=n?n.bytes:void 0)||0,i=this._context.cdmMveQuotaStats.update("quotaRawBytesUsed",function(e){return e+o-r}),this._context=this._context.set("cdmMveQuotaStats",i)):void 0},a.prototype._insertOrUpdateFile=function(e){var t,n,o,i,r,s,a,l;return i=e.file,r=null!=(a=e.forceUpdate)?a:!1,this._unsortedFiles=this._unsortedFiles.set(i.fq_path,i),s=i.fq_path.toLowerCase(),t=function(e){return e.fq_path.toLowerCase()===s},l=this._sortedFiles.findEntry(t)||[null,null],o=l[0],n=l[1],n?r||i.sjid>n.sjid?this._sortedFiles=this._sortedFiles.set(o,i):void 0:this._sortedFiles=this._sortedFiles.push(i)},a.prototype._removeFile=function(e){var t,n;return t=e.file,A(this._unsortedFiles.has(t.fq_path),"trying to remove a file that doesn't exist in the file map"),n=this._sortedFiles.indexOf(t),A(-1!==n,"tried to remove file that doesn't exist in the sorted file list"),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._sortedFiles=this._sortedFiles.delete(n)},a.prototype._replaceFile=function(e){var t,n,o,i;return t=e.existingFile,o=e.newFile,A(this._unsortedFiles.has(t.fq_path),"tried to replace file, but previous file doesn't exist in map"),n=this._sortedFiles.indexOf(t),A(-1!==n,"tried to update file, but previous file doesn't exist in sorted list"),t.fq_path===o.fq_path?(this._sortedFiles=this._sortedFiles.set(n,o),this._unsortedFiles=this._unsortedFiles.set(t.fq_path,o)):(this._sortedFiles=this._sortedFiles.delete(n),this._unsortedFiles=this._unsortedFiles.delete(t.fq_path),this._unsortedFiles=this._unsortedFiles.set(o.fq_path,o),this._sortedFiles=this._sortedFiles.push(o),(null!=(i=this._fileRename)?i.state:void 0)===S.SAVING_INPUT?(this._updateRenameState(t,null),this._selectFqPaths({fqPathsToSelect:[o.fq_path]})):void 0)},a.prototype._applyFileDelta=function(e){var t,n,o;return n=e.before,t=e.after,o=e.pathForDelta,t&&!s.paths_are_equal(s.parent_dir(t.fq_path),o)&&(t=null),t!==n&&this._isMostRecentVersionOfFile({file:t})?(t&&n?this._replaceFile({existingFile:n,newFile:t}):t&&!n?this._insertOrUpdateFile({file:t}):n&&!t&&this._removeFile({file:n}),this._updateQuotaStats({before:n,after:t})):void 0},a.prototype._applyFileDeltas=function(e){var t,n,i,r,a,l,u,c;if(l=e.path,i=e.fileDeltas,s.paths_are_equal(l,this._path)){for(r=0,a=i.length;a>r;r++)c=i[r],n=c.before,t=c.after,this._applyFileDelta({before:n,after:t,pathForDelta:l});return this._filePathsToSelectOnNextUpdate.size&&(u=this._selectFqPaths({fqPathsToSelect:this._filePathsToSelectOnNextUpdate.toArray()},!1),u.size===this._filePathsToSelectOnNextUpdate.size&&(this._filePathsToSelectOnNextUpdate=o.Set())),A(this._unsortedFiles.size===this._sortedFiles.size,"applyFileDeltas ended up with mismatched file collections (map vs. sorted list)"),this._sortFiles(this._currentSort,!1),this._buildFileJumpIndex(),this.emit_change()}},a.prototype._applyTeamFolderDowngrade=function(e){var t,n,o;return o=this.mountPoints().get(e),n=this.filesMap().get(o),null!=n&&(t=n.merge({icon:"folder_user_32",type:b.SHARED_FOLDER}),this._replaceFile({existingFile:n,newFile:t})),this.emit_change()},a.prototype._setPath=function(e){var t;return t=e.path,this._path=t,this.emit_change()},a.prototype._setUrlPrefix=function(e){var t;return t=e.prefix,this._urlPrefix=t,this.emit_change()},a.prototype._setLoadingState=function(e){var t,n;return n=e.path,t=e.loadingState,this.path()===n?(this._loadingState=t,t===w.LOADED&&(this._filePathsToSelectOnNextUpdate=o.Set()),this.emit_change()):void 0},a.prototype._setMountPoints=function(e){var t;return t=e.mountPoints,this._mountPoints=o.Map(t)},a.prototype._setTeamFolders=function(e){var t,n;return n=e.teamFolders,this._teamFolders=o.List(function(){var e,o,i,r;for(i=n||[],r=[],e=0,o=i.length;o>e;e++)t=i[e],r.push(v.fromServerObject(t));return r}())},a.prototype._setSelection=function(e){var t;return t=e.selection,this._selection=t,this.emit_change()},a.prototype._selectFqPaths=function(e,t){var i,r,s,a,l,u;return s=e.fqPathsToSelect,null==t&&(t=!0),a=s.map(function(e){return e.toLowerCase()}),r=this._sortedFiles.filter(function(e){var t;return t=e.fq_path.toLowerCase(),n.call(a,t)>=0}),l=r.map(function(e){return e.fq_path}),u=this._selection.set("selected",o.OrderedSet(l)),i=l.size?l.get(0):null,u=u.set("anchor",i),this._selection=u,t&&this.emit_change(),l},a.prototype._toggleFqPathSelected=function(e){var t,n,o,i,r,s,a,l,u,c,d;if(a=e.path,d=this._selection,d.selected.has(a)){for(d=d.update("selected",function(e){return e.delete(a)}),s=null,t=this._selection.selected.indexOf(a),n=i=l=t+1,u=this._selection.selected.count();u>=l?u>i:i>u;n=u>=l?++i:--i)if(o=this._selection.selected.get(n),d.selected.has(o)){s=o;break}if(!s)for(n=r=c=t-1;0>=c?0>=r:r>=0;n=0>=c?++r:--r)if(o=this._selection.selected.get(n),d.selected.has(o)){s=o;break}s||(s=this._selection.selected.get(0)),d=d.set("anchor",s)}else d=d.update("selected",function(e){return e.add(a)}).set("anchor",a);return this._selection=d,this.emit_change()},a.prototype._setActiveTab=function(e){var t;return t=e.tabName,this._activeTab=t,this.emit_change()},a.prototype._setShouldShowDeletedFiles=function(e){var t;return t=e.shouldShowDeletedFiles,this._shouldShowDeletedFiles=Boolean(t),this.emit_change()},a.prototype._setDropTarget=function(e){var t;return t=e.target,this._activeDropTarget=t,this.emit_change()},a.prototype._setCopyMode=function(e){var t;return t=e.copyMode,this._inCopyMode=t,this.emit_change()},a.prototype._sortFiles=function(e,t){var n,o,r,s,a,l,u,c;return c=e.sortField,a=e.direction,null==t&&(t=!0),u=a===C.ASCENDING?1:-1,r=function(e,t){var n,o;return n=e.value,o=t.value,N(n,o,u)},o=function(e,t){var n,o,i,r;return o=e.isFolder,n=e.value,r=t.isFolder,i=t.value,o&&r?N(n,i,u):o?-u:r?u:N(n,i,u)},n=function(e,t){var n,o,i,r;return o=e.isFolder,n=e.value,r=t.isFolder,i=t.value,o&&r?N(n,i,u):o?1:r?-1:""===n?1:""===i?-1:N(n,i,u)},l=c===f.FILENAME||c===f.SHARED_WITH,l?(s=i.mac?r:o,this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.sort_key}},s)):c===f.MODIFIED?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:e.ts}},n):c===f.CATEGORY?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:v.getCategoryDescription(e)}},n):c===f.EXTENSION?this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:v.getExtension(e)}},n):c===f.SIZE&&(this._sortedFiles=this._sortedFiles.sortBy(function(e){return{isFolder:e.is_dir,value:-e.bytes}},n)),this._currentSort={sortField:c,direction:a},t?this.emit_change():void 0},a.prototype._setClipboardToSelectedFiles=function(){return this._clipboardFiles=this.selectedFiles(),this.emit_change()},a.prototype._updateRenameState=function(e,o){var i;return o?(i=t.values(S),A(n.call(i,o)>=0,"_updateRenameState received: "+o+", but expected one of: "+i),this._fileRename=new y({file:e,state:o})):this._fileRename=null,this.emit_change()},a.prototype._setNewFolderCreationState=function(e){return this._newFolderCreationState=e,this.emit_change()},a.prototype._setFilePathsToSelectOnNextUpdate=function(e){var t,n;return t=null!=(n=e.fqPathsToSelect)?n:[],this._filePathsToSelectOnNextUpdate=o.Set(t)},a.prototype._addCommentStatusBatch=function(e){var n,o;return n=e.commentStatusByFqPath,o=this._unsortedFiles,t.each(n,function(e){return function(t,n){var i,r;return i=o.get(n),null!=i?(r=i.merge(t),e._insertOrUpdateFile({file:r,forceUpdate:!0})):void 0}}(this)),this.emit_change()},a.prototype._buildFileJumpIndex=function(){return this._fileJumpIndex=this._unsortedFiles.keySeq().toArray().map(function(e){var t;return t=s.filename(e).toLowerCase(),{filename:t,fqPath:e}}),this._fileJumpIndex.sort(function(e,t){var n,o;return n=e.filename,o=t.filename,o>n?-1:n>o?1:0})},a.prototype._addFileJumpKeyCode=function(e){var t,n,o,i,r,s,a,l;for(r=e.keyChar,this._activeFileJumpFilter+=r.toLowerCase(),o=null,a=this._fileJumpIndex,i=0,s=a.length;s>i;i++)if(l=a[i],n=l.fqPath,t=l.filename,t>=this._activeFileJumpFilter){o=n;break}return null!=o?this._selectFqPaths({fqPathsToSelect:[o]}):void 0},a.prototype._resetFileJump=function(){return this._activeFileJumpFilter=""},a.prototype._completeUpload=function(){var e,t;return t=P.fileList().find(function(e){var t;return(t=e.status)===E.PENDING||t===E.UPLOADING}),t?void 0:(e=P.fileList().valueSeq().filter(function(e){return e.status===E.COMPLETE}).map(function(e){return s.normalize(e.dest)+s.normalize(e.name)}),e.every(function(e){return function(t){return e._unsortedFiles.has(t)}}(this))?this._selectFqPaths({fqPathsToSelect:e.toArray()}):this._setFilePathsToSelectOnNextUpdate({fqPathsToSelect:e.toArray()}))},a.prototype._new_payload=function(e){switch(e.action.type){case _.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case _.LOAD_PATH:return this._setPathData(e.action.data);case _.ADD_FILES:return this._appendFiles(e.action.data);case _.SET_PATH:return this._setPath(e.action.data);case _.SET_USER:return this._setUser(e.action.data);case _.SET_URL_PREFIX:return this._setUrlPrefix(e.action.data);case _.CHANGE_FILES:return this._applyFileDeltas(e.action.data);case _.OPEN_PREVIEW:return this._setPreviewFile(e.action.data);case _.CLOSE_PREVIEW:return this._setPreviewFile(e.action.data);case _.SET_ACTIVE_TAB:return this._setActiveTab(e.action.data);case _.SET_SELECTION:return this._setSelection(e.action.data);case _.SELECT_FILES_BY_FQ_PATH:return this._selectFqPaths(e.action.data);case _.TOGGLE_FQ_PATH_SELECTED:return this._toggleFqPathSelected(e.action.data);case _.SET_LOADING_STATE:return this._setLoadingState(e.action.data);case _.SET_SEARCH_ACTIVE:return this._setSearchActive(e.action.data);case _.SET_MOUNT_POINTS:return this._setMountPoints(e.action.data);case _.SET_TEAM_FOLDERS:return this._setTeamFolders(e.action.data);case _.SET_SHOULD_SHOW_DELETED_FILES:return this._setShouldShowDeletedFiles(e.action.data);case _.SET_DROP_TARGET:return this._setDropTarget(e.action.data);case _.SET_COPY_MODE:return this._setCopyMode(e.action.data);case _.COPY_SELECTED_FILES_TO_CLIPBOARD:return this._setClipboardToSelectedFiles();case _.SORT_FILES:return this._sortFiles(e.action.data);case _.REQUEST_NEW_FILE_NAME:return this._updateRenameState(e.action.data.file,S.PENDING_INPUT);case _.SET_FILE_RENAME_PENDING:return this._updateRenameState(e.action.data.file,S.SAVING_INPUT);case _.SET_FILE_RENAME_COMPLETE:case _.CANCEL_FILE_RENAME:return this._updateRenameState(e.action.data.file,null);case _.REQUEST_FOLDER_NAME:return this._setNewFolderCreationState(T.PENDING_INPUT);case _.CREATE_FOLDER_PENDING:return this._setNewFolderCreationState(T.SAVING_INPUT);case _.CREATE_FOLDER_COMPLETE:case _.CANCEL_CREATE_FOLDER:return this._setNewFolderCreationState(T.CREATE_FOLDER_INACTIVE);case _.SET_FILE_PATHS_TO_SELECT_ON_NEXT_UPDATE:return this._setFilePathsToSelectOnNextUpdate(e.action.data);case _.TEAM_FOLDER_DOWNGRADE:return this._applyTeamFolderDowngrade(e.action.data.nsId);case _.ADD_COMMENT_STATUS_BATCH:return this._addCommentStatusBatch(e.action.data);case _.ADD_FILE_JUMP_KEY_CODE:return this._addFileJumpKeyCode(e.action.data);case _.RESET_FILE_JUMP:return this._resetFileJump();case I.COMPLETE_UPLOAD:return this._completeUpload(e.action.data)}},a}(a),{BrowseStore:new g}})}.call(this),function(){define("modules/clean/react/bubble",["external/react","external/underscore","modules/clean/css"],function(e,t,n){var o,i,r;return r=e.DOM,o={TOP:"top",TOP_LEFT:"top-left",TOP_RIGHT:"top-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",RIGHT:"right",RIGHT_TOP:"right-top",RIGHT_BOTTOM:"right-bottom",LEFT:"left",LEFT_TOP:"left-top",LEFT_BOTTOM:"left-bottom"},i=e.createClass({displayName:"Bubble",statics:{ARROW:o},propTypes:{arrow:e.PropTypes.oneOf(t.values(o)),className:e.PropTypes.string},getDefaultProps:function(){return{arrow:null,className:""}},componentWillMount:function(){return"undefined"!=typeof window&&null!==window?n.require_css("/static/css/react/bubble_box-vflhusCtq.css"):void 0},render:function(){var e,n;return e=["react-bubble-box","react-bubble-box--arrow-"+this.props.arrow,this.props.className],n=t.extend({},t.omit(this.props,["arrow","className"]),{className:e.join(" ")}),r.div(n,this._renderArrow(),this.props.children)},_renderArrow:function(){return null!=this.props.arrow?[r.div({className:"react-bubble-box__arrow-border",key:"arrow-border"}),r.div({className:"react-bubble-box__arrow",key:"arrow"})]:[]}})})}.call(this),function(){define("modules/clean/react/bubble_dropdown",["jquery","external/classnames","external/jquery_ui","external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/core/dom"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_;return _=l.getFocusableElementsIn,h=i.DOM,d="react-bubble-dropdown-root",p=function(){var t;return t=e("#"+d),t.length||(t=e('<div tabindex="-1"/>').attr({id:d}).prependTo("body")),t[0]},c=i.createClass({displayName:"BubbleDropdownContents",propTypes:{target_node:i.PropTypes.instanceOf(HTMLElement).isRequired,targetFixed:i.PropTypes.bool.isRequired,label_id:i.PropTypes.string,arrow_position:i.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:i.PropTypes.number,horizontal_displacement:i.PropTypes.number,anchor_bottom:i.PropTypes.bool,show_arrow:i.PropTypes.bool,className:i.PropTypes.string,extra_css_class:i.PropTypes.string,justify:i.PropTypes.bool},componentDidMount:function(){var t,n,o,i,s,a,l,u,c,p,h,_,m,f,g,v;if(null!=this.refs.dropdown){switch(i=this._arrow_direction(),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[i],o=e(this.props.target_node),n=e(r.findDOMNode(this.refs.dropdown)),t=e(r.findDOMNode(this.refs.arrow)),h=e("#"+d).position().top,v=t.outerWidth(),l=t.outerHeight(),_=t.position().top,u=this.props.horizontal_displacement||0,c=t.position().left+u,g=this.props.vertical_displacement||0,m=l+h,this._arrow_direction()){case"left":s=0>m?"left+"+v+"px top+"+-m+"px":"left+"+v+"px top-"+m+"px";break;case"right":s=0>m?"right-"+v+"px top+"+-m+"px":"right-"+v+"px top-"+m+"px";break;case"top":m=l-h-g,s=0>m?"left-"+c+"px top-"+-m+"px":"left-"+c+"px top+"+m+"px";break;case"bottom":a=l+h-g,s=0>a?"left-"+c+"px bottom+"+-a+"px":"left-"+c+"px bottom-"+a+"px"}return f=function(e){return function(t){var n,i,r;return r=t.top,i=t.left,e.props.anchor_bottom?(n=e.props.targetFixed?document.documentElement.clientHeight-o[0].getBoundingClientRect().top-g:document.documentElement.clientHeight-o.offset().top-g,e.setState({dropdown_style:{bottom:n,left:i}})):e.setState({dropdown_style:{top:r,left:i}})}}(this),p={my:s,at:this.target_position,of:o,collision:"none",using:f},n.position(p),e("#"+d).attr("aria-labelledby",this.props.label_id),this.props.show_arrow?void 0:(t.css("visibility","hidden"),e(".bubble-arrow-border").css("visibility","hidden"))}},render:function(){return h.div({className:t("bubble-dropdown",this.props.extra_css_class,this.props.className,this.props.arrow_position,{justify:this.props.justify}),style:this.state.dropdown_style,ref:"dropdown"},this.props.children,h.div({className:"bubble-arrow-border"}),h.div({className:"bubble-arrow",ref:"arrow"}))},_arrow_direction:function(){var e;return"top"===this.props.arrow_position.substring(0,3)?e="top":"bottom"===this.props.arrow_position.substring(0,6)?e="bottom":"left"===this.props.arrow_position.substring(0,4)?e="left":"right"===this.props.arrow_position.substring(0,5)&&(e="right"),e},getInitialState:function(){return{dropdown_style:{}}}}),u=i.createClass({displayName:"BubbleDropdown",statics:{DROPDOWN_ROOT_ID:d},propTypes:{targetButton:function(e,t,n){return null==e.targetButton||"button"!==e.targetButton.type?new Error("BubbleDropdown's targetButton must be a `<button>`"):void 0},targetFixed:i.PropTypes.bool,arrow_position:i.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:i.PropTypes.number,horizontal_displacement:i.PropTypes.number,show_arrow:i.PropTypes.bool,anchor_bottom:i.PropTypes.bool,className:i.PropTypes.string,extra_css_class:i.PropTypes.string,container_css_class:i.PropTypes.string,bubbleDropdownShown:i.PropTypes.func,bubbleDropdownHidden:i.PropTypes.func,autofocus:i.PropTypes.bool,position:i.PropTypes.oneOf(["static","relative","fixed","absolute"]),bubbleDropdownScrollable:i.PropTypes.bool,closeBubbleDropdownOnWindowScroll:i.PropTypes.bool,shouldDisableBubbleDropdownHideOnResize:i.PropTypes.bool,justify:i.PropTypes.bool,disabled:i.PropTypes.bool},getDefaultProps:function(){return{vertical_displacement:0,horizontal_displacement:0,anchor_bottom:!1,show_arrow:!0,className:null,extra_css_class:"",container_css_class:"",position:"fixed",autofocus:!1,targetFixed:!1,bubbleDropdownScrollable:!1,closeBubbleDropdownOnWindowScroll:!0,justify:!1,disabled:!1}},render:function(){return h.div({className:t("bubble-dropdown-container",this.props.container_css_class),onMouseDown:this.preventSelection,onMouseUp:this.toggle,onKeyDown:this.targetKeyDown,ref:"target",id:this.containerId},this.props.targetButton)},render_tooltip:function(){var t,n;return n=p(),this.shown?(e("#"+d).css("position",this.props.position),this.props.anchor_bottom?(e("#"+d).css("bottom","0"),e("#"+d).css("top","auto")):(e("#"+d).css("top","0"),e("#"+d).css("bottom","auto")),t=i.createElement(c,{target_node:this.getTargetButton(),targetFixed:this.props.targetFixed,label_id:this.containerId,arrow_position:this.props.arrow_position,vertical_displacement:this.props.vertical_displacement,horizontal_displacement:this.props.horizontal_displacement,anchor_bottom:this.props.anchor_bottom,show_arrow:this.props.show_arrow,extra_css_class:this.props.extra_css_class,className:this.props.className,justify:this.props.justify},this.props.children),r.render(t,n)):r.unmountComponentAtNode(n)},preventSelection:function(e){return e.preventDefault()},targetKeyUp:function(e){return e.preventDefault()},componentWillMount:function(){return this.eventId=s.uniqueId(),this.containerId="bubbleDropdownTarget"+this.eventId},componentDidMount:function(){return this.shown=!1,this.$target=e(r.findDOMNode(this.refs.target)),e(this.getTargetButton()).addClass("bubble-dropdown-target").attr("aria-expanded",this.shown),this.props.disabled&&(e(this.getTargetButton()).addClass("disabled"),this.$target.addClass("disabled")),this.bodyClickHandler=function(t){return function(n){var o,i;if(t.shown)return o=e(n.target),o.is("select")?!0:(i=o.closest(t.$target).length||o.closest(e("#"+d)).length,i||t.hide(),!0)}}(this),e("body").on("mouseup."+this.eventId,this.bodyClickHandler)},componentDidUpdate:function(){return e(this.getTargetButton()).addClass("bubble-dropdown-target").attr("aria-expanded",this.shown),this.shown?this.render_tooltip():void 0},bindDocHandlers:function(){return this.hasBindedDocHandlers?void 0:(key("esc",this.hideIfShown),this.props.bubbleDropdownScrollable?e("*").not("#"+d+" *").on("scroll."+this.eventId,this.hideIfShown):e("*").on("scroll."+this.eventId,this.hideIfShown),this.props.closeBubbleDropdownOnWindowScroll&&e(window).on("scroll."+this.eventId,this.hideIfShown),this.props.shouldDisableBubbleDropdownHideOnResize||e(window).on("resize."+this.eventId,this.hideIfShown),e("#"+d).on("keydown",this.dropdownKeyDown),this.hasBindedDocHandlers=!0)},unbindDocHandlers:function(){return this.hasBindedDocHandlers?(e("body").off("mouseup."+this.eventId),e("*").off("scroll."+this.eventId),e(window).off("scroll."+this.eventId),this.props.shouldDisableBubbleDropdownHideOnResize||e(window).off("resize."+this.eventId),e("#"+d).off("keydown",this.dropdownKeyDown),this.hideIfShown()):void 0},targetKeyDown:function(e){var t;(t=e.keyCode)!==a.ENTER&&t!==a.SPACE||(this.toggle(),e.preventDefault()),e.keyCode===a.TAB&&(e.shiftKey?this.hide():this.shown&&(this.focusInDropdown(),e.preventDefault()))},dropdownKeyDown:function(t){var n,o,i;if(t.keyCode===a.TAB){if(n=e("#"+d)[0],o=this.getFocusableDropdownElements(),t.shiftKey){if((i=t.target)===n||i===o[0])return this.getTargetButton().focus(),t.preventDefault()}else if(t.target===o[o.length-1]||t.target===n&&0===o.length)return this.hide(),this.getTargetButton().focus()}else if(t.keyCode===a.ESC)return this.hide(),this.getTargetButton().focus(),t.stopPropagation()},focusInDropdown:function(){var t;return this.props.autofocus&&(t=this.getFocusableDropdownElements()[0]),t||(t=e("#"+d)[0]),t.focus()},getTargetButton:function(){var e;return null!=(e=r.findDOMNode(this.refs.target))?e.firstChild:void 0},getFocusableDropdownElements:function(){return _("#"+d+" .bubble-dropdown")},hideIfShown:function(){return this.shown?this.hide():void 0},componentWillUnmount:function(){return this.unbindDocHandlers(),e("body").off("mouseup."+this.eventId,this.bodyClickHandler)},toggle:function(){this.shown?this.hide():this.show()},show:function(){var t;if(!this.props.disabled)return this.shown=!0,e(this.getTargetButton()).addClass("bubble-dropdown-target--active").attr("aria-expanded",!0),this.render_tooltip(),this.focusInDropdown(),"function"==typeof(t=this.props).bubbleDropdownShown&&t.bubbleDropdownShown(),this.bindDocHandlers()},hide:function(){var t;return this.shown=!1,e(this.getTargetButton()).removeClass("bubble-dropdown-target--active").attr("aria-expanded",!1),this.render_tooltip(),"function"==typeof(t=this.props).bubbleDropdownHidden?t.bubbleDropdownHidden():void 0},isShown:function(){return this.shown}})})}.call(this),function(){define("modules/clean/react/bubble_dropdown_v2",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/overlay"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h,_;return d=a.PositionedOverlay,_=n.DOM,h=n.createElement,c=d.POSITIONS,u=n.createClass({displayName:"BubbleDropdownContents",propTypes:{targetNode:n.PropTypes.instanceOf(HTMLElement).isRequired,position:n.PropTypes.oneOf(i.values(c)).isRequired,verticalArrowOffset:n.PropTypes.number,horizontalArrowOffset:n.PropTypes.number,shouldShowArrow:n.PropTypes.bool,className:n.PropTypes.string},getDefaultProps:function(){return{verticalArrowOffset:0,horizontalArrowOffset:0,shouldShowArrow:!0,className:null}},componentDidMount:function(){return this._adjustArrowPosition()},componentDidUpdate:function(){return this._adjustArrowPosition()},_getArrowStyleFromPosition:function(){var e,t;return t={},t[""+c.TOP_LEFT]="top-left",t[""+c.TOP]="top",t[""+c.TOP_RIGHT]="top-right",t[""+c.LEFT_TOP]="left-top",t[""+c.LEFT]="left",t[""+c.LEFT_BOTTOM]="left-bottom",t[""+c.RIGHT_TOP]="right-top",t[""+c.RIGHT]="right",t[""+c.RIGHT_BOTTOM]="right-bottom",t[""+c.BOTTOM_LEFT]="bottom-left",t[""+c.BOTTOM]="bottom",t[""+c.BOTTOM_RIGHT]="bottom-right",t[""+c.TOP_ALIGN_LEFT]="top-align-left",t[""+c.TOP_ALIGN_RIGHT]="top-align-right",t[""+c.LEFT_ALIGN_TOP]="left-align-top",t[""+c.LEFT_ALIGN_BOTTOM]="left-align-bottom",t[""+c.RIGHT_ALIGN_TOP]="right-align-top",t[""+c.RIGHT_ALIGN_BOTTOM]="right-align-bottom",t[""+c.BOTTOM_ALIGN_LEFT]="bottom-align-left",t[""+c.BOTTOM_ALIGN_RIGHT]="bottom-align-right",e=t,e[this.props.position]},_adjustArrowPosition:function(){var t;if(this.props.shouldShowArrow){switch(t=e(o.findDOMNode(this.refs.bubbleArrowContainer)),this.props.position){case c.TOP_ALIGN_LEFT:case c.BOTTOM_ALIGN_LEFT:t.css("left",this.props.targetNode.offsetWidth/2);break;case c.TOP_ALIGN_RIGHT:case c.BOTTOM_ALIGN_RIGHT:t.css("right",this.props.targetNode.offsetWidth/2);break;case c.LEFT_ALIGN_TOP:case c.RIGHT_ALIGN_TOP:t.css("top",this.props.targetNode.offsetHeight/2);break;case c.LEFT_ALIGN_BOTTOM:case c.RIGHT_ALIGN_BOTTOM:t.css("bottom",this.props.targetNode.offsetHeight/2)}return(this.props.verticalArrowOffset||this.props.horizontalArrowOffset)&&(this._getArrowStyleFromPosition().match(/^(top|bottom)/)&&t.css("left","-="+this.props.horizontalArrowOffset),this._getArrowStyleFromPosition().match(/^(left|right)/))?t.css("top","-="+this.props.verticalArrowOffset):void 0}},render:function(){return _.div({ref:"dropdown",className:t("bubble-dropdown-v2","bubble-dropdown-v2--"+this._getArrowStyleFromPosition(),this.props.className),"aria-labelledby":this.props.targetNode.id},this.props.children,this.props.shouldShowArrow?_.div({ref:"bubbleArrowContainer",className:"bubble-arrow-container"},_.div({className:"bubble-arrow-border"}),_.div({className:"bubble-arrow"})):null)}}),p=n.createClass({displayName:"BubbleDropdown",propTypes:{targetButton:function(e,t,n){return null==e.targetButton||"button"!==e.targetButton.type?new Error("BubbleDropdown's targetButton must be a `<button>`"):void 0},position:n.PropTypes.oneOf(i.values(c)).isRequired,targetFixed:n.PropTypes.bool,verticalDisplacement:n.PropTypes.number,horizontalDisplacement:n.PropTypes.number,className:n.PropTypes.string,disabled:n.PropTypes.bool,shouldShowArrow:n.PropTypes.bool,shouldTrapKeyboardFocus:n.PropTypes.bool,onShowDropdown:n.PropTypes.func,onHideDropdown:n.PropTypes.func},getDefaultProps:function(){return{targetFixed:!1,verticalDisplacement:0,horizontalDisplacement:0,className:null,disabled:!1,shouldShowArrow:!0,shouldTrapKeyboardFocus:!1,onShowDropdown:i.noop,onHideDropdown:i.noop}},getInitialState:function(){return{isVisible:!1,targetNode:null,shouldAutoFocusDropdownContent:!1}},componentDidMount:function(){var e;return e=o.findDOMNode(this.refs.bubbleDropdownContainer).childNodes[0],e&&!e.hasAttribute("id")&&e.setAttribute("id","bubbleDropdownTarget-"+i.uniqueId()),this.setState({targetNode:e})},componentDidUpdate:function(e,t){return t.isVisible===this.state.isVisible||this.state.isVisible?void 0:this._hasHidden();
},showDropdown:function(){return this.props.disabled?void 0:this.setState({isVisible:!0})},hideDropdown:function(){return this.props.disabled?void 0:this.setState({isVisible:!1})},_handleMouseDown:function(e){return this.setState({shouldAutoFocusDropdownContent:!1},this._toggle),e.preventDefault()},_handleKeyDown:function(e){var t;return(t=e.keyCode)===r.ENTER||t===r.SPACE?(this.setState({shouldAutoFocusDropdownContent:!0},this._toggle),e.preventDefault()):void 0},_toggle:function(){return this.props.disabled?void 0:this.setState({isVisible:!this.state.isVisible})},_hasShown:function(){return this.state.targetNode.setAttribute("aria-expanded",!0),this.props.onShowDropdown()},_hasHidden:function(){return this.state.targetNode.setAttribute("aria-expanded",!1),this.props.onHideDropdown()},render:function(){return _.div({className:"bubble-dropdown-v2-container",onMouseDown:this._handleMouseDown,onKeyDown:this._handleKeyDown,ref:"bubbleDropdownContainer"},this.props.targetButton,this.state.isVisible&&!this.props.disabled?h(d,{targetNode:this.state.targetNode,isTargetPositionFixed:this.props.targetFixed,shouldTrapKeyboardFocus:this.props.shouldTrapKeyboardFocus,shouldAutoFocusOverlayContent:this.state.shouldAutoFocusDropdownContent,position:this.props.position,positionOffset:{horizontal:this.props.horizontalDisplacement,vertical:this.props.verticalDisplacement},onRendered:function(e){return function(){return e._hasShown()}}(this),onBlur:function(e){return function(){return e.hideDropdown()}}(this)},h(u,{ref:"bubbleDropdownContents",targetNode:this.state.targetNode,position:this.props.position,verticalArrowOffset:this.props.verticalDisplacement,horizontalArrowOffset:this.props.horizontalDisplacement,shouldShowArrow:this.props.shouldShowArrow,className:this.props.className},this.props.children)):void 0)}}),l=s(p,["/static/css/components/bubble_dropdown_v2-vflhhYVBe.css"]),l.POSITIONS=c,l})}.call(this),function(){define("modules/clean/react/bubble_menu",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/bubble_dropdown_v2"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p;return p=n.DOM,d=n.createElement,c=function(e,t,n){var o;return o=e[t].type,o!==l?new Error("Expected "+t+" to be BubbleMenuItems, not "+o+"."):void 0},l=n.createClass({displayName:"BubbleMenuItem",propTypes:{onClick:n.PropTypes.func,href:n.PropTypes.string,target:n.PropTypes.string,disabled:n.PropTypes.bool,closeOnClick:n.PropTypes.bool,closeFunc:n.PropTypes.func,className:n.PropTypes.string,onMouseEnter:n.PropTypes.func,onMouseLeave:n.PropTypes.func},getDefaultProps:function(){return{onClick:i.noop,href:"#",target:null,disabled:!1,closeOnClick:!0,closeFunc:i.noop,className:null,onMouseEnter:i.noop,onMouseLeave:i.noop}},_handleMouseEnter:function(t){return null!=this.refs.item?(e(o.findDOMNode(this.refs.item)).closest(".bubble-menu").removeClass("bubble-menu--keyboard"),this.props.onMouseEnter(t)):void 0},_handleClick:function(e){return this.props.disabled?(e.preventDefault(),e.stopPropagation()):"#"===this.props.href&&(e.preventDefault(),this.props.onClick(e),this.props.closeOnClick)?this.props.closeFunc():void 0},renderContents:function(){var e;return e={"bubble-menu-item":!0,"bubble-menu-item--disabled":this.props.disabled},p.a({ref:"item",role:"menuitem",className:t(e),href:this.props.href,target:this.props.target,onClick:this._handleClick,onMouseEnter:this._handleMouseEnter,onMouseLeave:this.props.onMouseLeave,"aria-disabled":this.props.disabled},this.props.children)},render:function(){return p.li({role:"presentation",className:t("bubble-menu-item-wrapper",this.props.className)},this.renderContents())}}),u=n.createClass({displayName:"BubbleMenuItemGroup",props:{items:n.PropTypes.arrayOf(c).isRequired,closeFunc:n.PropTypes.func},render:function(){var e,t;return 0===this.props.items.length?null:p.li({className:"bubble-menu-item-group",role:"presentation"},p.ul({className:"bubble-menu-item-group u-unlist u-trim-padding",role:"group"},function(){var o,i,r,s,a;for(r=this.props.items,a=[],e=o=0,i=r.length;i>o;e=++o)t=r[e],a.push(n.cloneElement(t,{closeFunc:this.props.closeFunc,key:null!=(s=t.key)?s:e}));return a}.call(this)))}}),a=n.createClass({displayName:"BubbleMenu",propTypes:i.extend({},s.propTypes,{items:n.PropTypes.arrayOf(c).isRequired,onShowDropdown:n.PropTypes.func,targetButton:function(e,t,n){var o;return"button"!==(null!=(o=e.targetButton)?o.type:void 0)?new Error("BubbleDropdown's targetButton must be a `<button>`, found: "+e[t].type):void 0}}),showMenu:function(){var e,t;return null!=(e=this.refs.bubble)&&null!=(t=e.getWrappedComponent())?t.showDropdown():void 0},hideMenu:function(){var e,t;return null!=(e=this.refs.bubble)&&null!=(t=e.getWrappedComponent())?t.hideDropdown():void 0},_onShowBubbleMenu:function(){var t;if(null!=this.refs.menu&&null!=this.refs.bubble)return this.$menu=e(o.findDOMNode(this.refs.menu)),this.$menuitems=this.$menu.find('*[role="menuitem"]'),this.$menu.addClass("bubble-menu--keyboard"),this.$menu.on("keydown",this._onKeyDown),"function"==typeof(t=this.props).onShowDropdown?t.onShowDropdown():void 0},_onKeyDown:function(e){return this.$menu.addClass("bubble-menu--keyboard"),e.keyCode===r.DOWN?(this._focusNext(e.target),e.preventDefault(),e.stopPropagation()):e.keyCode===r.UP?(this._focusPrevious(e.target),e.preventDefault(),e.stopPropagation()):void 0},_focusPrevious:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||0===t?this.$menuitems.length-1:t-1,this.$menuitems.get(t).focus()},_focusNext:function(e){var t;return t=this.$menuitems.index(e),t=-1===t||t===this.$menuitems.length-1?0:t+1,this.$menuitems.get(t).focus()},render:function(){var e,t,o;return this.props.targetButton&&(o=n.cloneElement(this.props.targetButton,{ref:"targetButton","aria-haspopup":!0})),d(s,i.extend({},this.props,{ref:"bubble",shouldTrapKeyboardFocus:!0,onShowDropdown:this._onShowBubbleMenu,targetButton:o}),p.ul({role:"menu",ref:"menu",className:"bubble-menu"},function(){var o,i,r,s,a;for(r=this.props.items,a=[],e=o=0,i=r.length;i>o;e=++o)t=r[e],a.push(n.cloneElement(t,{closeFunc:this.hideMenu,key:null!=(s=t.key)?s:e}));return a}.call(this)))}}),a.POSITIONS=s.POSITIONS,{BubbleMenuItem:l,BubbleMenuItemGroup:u,BubbleMenu:a}})}.call(this),function(){define("modules/clean/react/calendar",["external/classnames","external/react","external/react-dom","jquery","modules/core/i18n","modules/clean/css","modules/clean/datetime","modules/clean/react/sprite","modules/clean/keycode","external/underscore"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m;return h=i._,m=t.DOM,_=t.createElement,c=t.createClass({displayName:"Calendar",propTypes:{onDateChange:t.PropTypes.func,initDate:t.PropTypes.instanceOf(Date),isPagelet:t.PropTypes.bool,firstDay:t.PropTypes.instanceOf(Date),lastDay:t.PropTypes.instanceOf(Date),alignAtLeft:t.PropTypes.bool},getDefaultProps:function(){var e,t,n;return e=new Date,t=new Date(e.getTime()),t.setFullYear(t.getFullYear()-1),n=new Date(e.getTime()),n.setFullYear(n.getFullYear()+1),{initDate:e,isPagelet:!1,firstDay:t,lastDay:n,alignAtLeft:!0,onDateChange:function(){}}},getInitialState:function(){return{selectedDate:this.props.initDate,calendarVisible:!1}},hide:function(){return this.setState({calendarVisible:!1})},_handleClickOutsideCalendar:function(e){var t,i;return t=n.findDOMNode(this),i=o(e.target).parents(".c-datepicker")[0],this.state.calendarVisible&&i!==t?(e.preventDefault(),e.stopPropagation(),this.hide()):void 0},_handleKeyDown:function(e){return e.keyCode===l.ESC?(e.preventDefault(),e.stopPropagation(),this.hide()):void 0},componentDidMount:function(){return r.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css"),o(document).on("click",this._handleClickOutsideCalendar)},componentWillUnmount:function(){return o(document).off("click",this._handleClickOutsideCalendar)},_toggleCalendarView:function(){return this.setState({calendarVisible:!this.state.calendarVisible})},_handleDateChange:function(e){return this.setState({selectedDate:e,calendarVisible:!1}),this.props.onDateChange(e)},_startOfDay:function(e){var t;return t=new Date(e.getTime()),t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t},render:function(){var t;return t={"c-datepicker":!0,"scooter-css u-l-fl clearfix":!this.props.isPagelet},m.div({className:e(t)},_(d,{date:this.state.selectedDate,calendarVisible:this.state.calendarVisible,isPagelet:this.props.isPagelet,onClick:this._toggleCalendarView,onKeyDown:this._handleKeyDown}),_(p,{alignAtLeft:this.props.alignAtLeft,firstDay:this._startOfDay(this.props.firstDay),lastDay:this._startOfDay(this.props.lastDay),initDate:this.state.selectedDate,visible:this.state.calendarVisible,onDateChange:this._handleDateChange}))}}),d=t.createClass({displayName:"CalendarDateView",propTypes:{date:t.PropTypes.instanceOf(Date).isRequired,calendarVisible:t.PropTypes.bool.isRequired,isPagelet:t.PropTypes.bool,onClick:t.PropTypes.func.isRequired,onKeyDown:t.PropTypes.func},getDefaultProps:function(){return{isPagelet:!1,onKeyDown:u.noop}},_date_to_string:function(e){return s.format_date(e,s.localized_date_format)},renderLegacyCaret:function(){return _(a,{group:"web",name:"calendar_view_month",className:"u-l-fr",alt:h("Change deadline")})},renderMaestroCaret:function(){return m.div({className:"filter-item__dropdown-arrow"},_(a,{group:"web",name:"arrow-down-gray",alt:h("Change deadline")}))},render:function(){var t;return t={"is-active":this.props.calendarVisible,"c-input":!this.props.isPagelet,"filter-item__filter-input":this.props.isPagelet},m.button({className:e(t),onClick:this.props.onClick,onKeyDown:this.props.onKeyDown},this.props.isPagelet?void 0:[this.renderLegacyCaret()],m.span({className:"c-calendar__date-text"},this._date_to_string(this.props.date)),this.props.isPagelet?[this.renderMaestroCaret()]:void 0)}}),p=t.createClass({displayName:"CalendarView",propTypes:{alignAtLeft:t.PropTypes.bool.isRequired,initDate:t.PropTypes.instanceOf(Date).isRequired,onDateChange:t.PropTypes.func.isRequired,firstDay:t.PropTypes.instanceOf(Date),lastDay:t.PropTypes.instanceOf(Date),visible:t.PropTypes.bool.isRequired},getInitialState:function(){return{viewDate:this.props.initDate,selectedDate:this.props.initDate}},_daysInMonth:function(e){return new Date(e.getFullYear(),e.getMonth()+1,0).getDate()},_handleDayClicked:function(e){var t,n;return n=parseInt(e.target.id.substr(3).split("-")[0],10),t=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),n),this.setState({selectedDate:t}),this.props.onDateChange(t)},_renderDay:function(t,n){var o,i,r,s;return i=!n,this.props.lastDay&&(n=n||t>this.props.lastDay),this.props.firstDay&&(n=n||t<this.props.firstDay),o={"button-as-link":!n,"c-calendar__date":!0,"c-calendar__date--disabled":n,"current-month":i,"is-selected":this.state.selectedDate.getDate()===t.getDate()&&this.state.selectedDate.getMonth()===t.getMonth()&&this.state.selectedDate.getFullYear()===t.getFullYear()},s="day"+t.getDate()+"-"+t.getMonth(),r=m.td({},m.button({className:e(o),id:s,disabled:n,onClick:n?void 0:this._handleDayClicked},t.getDate()))},_renderDays:function(){var e,t,n,o,i,r,s,a,l,u,c;for(t=[],n=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),1),l=n.getDay(),o=r=u=l;0>=u?0>r:r>0;o=0>=u?++r:--r)a=new Date(n.getFullYear(),n.getMonth(),n.getDate()),a.setDate(a.getDate()-o),t.push(this._renderDay(a,!0));for(i=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),1);i.getMonth()===this.state.viewDate.getMonth();)t.push(this._renderDay(i)),i=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),i.getDate()+1);for(s=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth()+1,0);6!==s.getDay();)s=new Date(s.getFullYear(),s.getMonth(),s.getDate()+1),t.push(this._renderDay(s,!0));return c=[],e=[],t.forEach(function(t,n){return e.push(t),(n+1)%7===0?(c.push(m.tr({},e)),e=[]):void 0}),c},_renderMonthChangers:function(){var t,n,o,i,r;return o=[],r=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),1),i=new Date(this.state.viewDate.getFullYear(),this.state.viewDate.getMonth(),this._daysInMonth(this.state.viewDate)),n={"c-arrow":!0,"c-arrow--left":!0,"u-thide":!0,"u-l-dn":r<=this.props.firstDay},o.push(m.div({className:"u-l-fl"},m.a({className:e(n),onClick:function(e){return function(){return e.setState({viewDate:new Date(e.state.viewDate.getFullYear(),e.state.viewDate.getMonth()-1,1)})}}(this)},h("Previous month")))),t={"c-arrow":!0,"c-arrow--right":!0,"u-thide":!0,"u-l-dn":i>=this.props.lastDay},o.push(m.div({className:"u-l-fr"},m.a({className:e(t),onClick:function(e){return function(){return e.setState({viewDate:new Date(e.state.viewDate.getFullYear(),e.state.viewDate.getMonth()+1,1)})}}(this)},h("Next month")))),o},_renderWeekDays:function(){var e,t;return t=[],e=[h("Sunday"),h("Monday"),h("Tuesday"),h("Wednesday"),h("Thursday"),h("Friday"),h("Saturday")],e.forEach(function(e){return t.push(m.th({},m.abbr({title:e},e.slice(0,3))))}),t},render:function(){var t,n,o,i;return t={"c-calendar":!0,"c-card":!0,"u-pad-xs":!0,"u-l-dn":!this.props.visible,"is-visible":this.props.visible,"u-left":this.props.alignAtLeft,"u-right":!this.props.alignAtLeft},i=this._renderMonthChangers(),o=i[0],n=i[1],m.div({className:e(t)},m.div({className:"c-calendar__nav u-mar-bottom-s u-font-center u-cf"},o,n,m.strong({},h("%(month)s %(year)s",{comment:"For example 'January 2010'. This is used as part of a calendar."}).format({month:s.month_name(this.state.viewDate.getMonth()),year:this.state.viewDate.getFullYear()}))),m.table({className:"c-calendar__picker"},m.thead({className:"ax-visually-hidden"},this._renderWeekDays()),m.tbody({},this._renderDays())))}}),c})}.call(this),function(){define("modules/clean/react/columnheader",["jquery","external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n","modules/clean/css","modules/clean/react/css"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h,_,m,f,g,v,y;return h=r._,y=n.DOM,v=n.createElement,d={ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},c={STATIC:"STATIC",SINGLE:"SINGLE",MULTI:"MULTI"},p=n.PropTypes.shape({label:n.PropTypes.string.isRequired,sortField:n.PropTypes.string,headerClassName:n.PropTypes.string}),u=n.PropTypes.shape({type:n.PropTypes.oneOf([c.STATIC,c.SINGLE,c.MULTI]).isRequired,label:n.PropTypes.string,headerClassName:n.PropTypes.string,sortField:n.PropTypes.string,content:n.PropTypes.node,columns:n.PropTypes.arrayOf(p)}).isRequired,g=function(e,t){var n,o,i,r;for(i=0,r=t.length;r>i;i++){if(n=t[i],n.sortField===e)return n;if(n.type===c.MULTI&&(o=g(e,n.columns)))return o}return null},l=n.createClass({displayName:"ColumnHeader",propTypes:{columns:n.PropTypes.arrayOf(u).isRequired,className:n.PropTypes.string,css:n.PropTypes.string,tabbable:n.PropTypes.bool,disabled:n.PropTypes.bool,activeSortField:n.PropTypes.string,activeSortDirection:n.PropTypes.oneOf([d.ASCENDING,d.DESCENDING]),initialMultiColumnSortField:n.PropTypes.string,onSortChange:n.PropTypes.func,onMultiColumnChange:n.PropTypes.func},getDefaultProps:function(){return{tabbable:!0,disabled:!1,activeSortField:void 0,activeSortDirection:d.ASCENDING,onSortChange:o.noop,onMultiColumnChange:o.noop}},getInitialState:function(){return{cssLoaded:!1}},componentWillMount:function(){return this.props.css?s.require_css(this.props.css,function(e){return function(){return e.setState({cssLoaded:!0})}}(this)):this.setState({cssLoaded:!0})},_didChangeSort:function(e,t){var n,o;return o=e!==this.props.activeSortField,n=t!==this.props.activeSortDirection,o||n},handleSingleColumnClick:function(e){var t,n,o;return o=e.sortField,t=this.props.activeSortField===e.sortField,n=t?this.props.activeSortDirection===d.ASCENDING?d.DESCENDING:d.ASCENDING:this.props.activeSortDirection,this._didChangeSort(o,n)?this.props.onSortChange(o,n):void 0},handleSubColumnChange:function(e){var t,n;return n=e.sortField,t=d.ASCENDING,this._didChangeSort(n,t)&&this.props.onSortChange(n,t),this.props.onMultiColumnChange(e)},renderStaticColumnHeader:function(e){return v(f,{key:e.label,label:e.label,className:e.headerClassName||"",content:e.content})},renderSingleColumnHeader:function(e){return v(_,{key:e.label,label:e.label,isActive:this.props.activeSortField===e.sortField,onClick:function(t){return function(){return t.handleSingleColumnClick(e)}}(this),sortDirection:this.props.activeSortDirection,canTriggerSortDirection:!0,className:e.headerClassName||"",tabbable:this.props.tabbable,disabled:this.props.disabled})},renderMultiColumnHeader:function(e){return v(m,{key:e.columns[0].label,columns:e.columns,activeSortField:this.props.activeSortField,initialSortField:this.props.initialMultiColumnSortField,onSubColumnChange:this.handleSubColumnChange,tabbable:this.props.tabbable,disabled:this.props.disabled})},render:function(){var e,t,n,o,i,r;if(this.state.cssLoaded){for(t=[],r=this.props.columns,n=0,i=r.length;i>n;n++)o=r[n],o.type===c.STATIC?t.push(this.renderStaticColumnHeader(o)):o.type===c.SINGLE?t.push(this.renderSingleColumnHeader(o)):o.type===c.MULTI&&t.push(this.renderMultiColumnHeader(o));return e="c-column-header "+this.props.className,y.ul({role:"row",className:e},t)}return y.ul(null)}}),f=n.createClass({displayName:"_StaticColumnHeader",propTypes:{label:n.PropTypes.string.isRequired,className:n.PropTypes.string.isRequired,content:n.PropTypes.node},render:function(){return y.li({role:"columnheader",className:"c-column-header__header u-pad-vertical-xs "+this.props.className},null!=this.props.content?this.props.content:void 0,y.span({className:"col-header-contents"},this.props.label))}}),_=n.createClass({displayName:"_ColumnHeaderView",propTypes:{label:n.PropTypes.string.isRequired,className:n.PropTypes.string,isActive:n.PropTypes.bool,canTriggerSortDirection:n.PropTypes.bool,nextColumnLabel:n.PropTypes.string,tabbable:n.PropTypes.bool,disabled:n.PropTypes.bool,sortDirection:n.PropTypes.oneOf([d.ASCENDING,d.DESCENDING]),onClick:n.PropTypes.func},getDefaultProps:function(){return{className:null,isActive:!1,canTriggerSortDirection:!1,nextColumnLabel:void 0,tabbable:!0,disabled:!1,sortDirection:d.DESCENDING,onClick:o.noop}},renderColumnHeaderLabel:function(){var e,t,n;return this.props.isActive&&this.props.canTriggerSortDirection?(this.props.sortDirection===d.ASCENDING?(n="arrow-up-gray",e="ascending"):(n="arrow-down-gray",e="descending"),t=v(i,{group:"web",name:n,alt:"",key:"icon-element",className:"c-column-header__sort-icon u-mar-left-xxs u-l-ib--m"}),[y.span({key:"label"},this.props.label),t]):[y.span({key:"label"},this.props.label)]},getActionDescription:function(){var e;return this.props.nextColumnLabel?(e=h("Swap column to %(nextlabel)s",{comment:"nextlabel is the name of the column that the current column will be replaced with when this button is clicked."}),e.format({nextlabel:this.props.nextColumnLabel})):this.props.sortDirection===d.DESCENDING?h("Sort in ascending order"):this.props.sortDirection===d.ASCENDING?h(this.props.isActive?"Sort in descending order":"Sort in ascending order"):null},getAriaDirectionName:function(){if(this.props.isActive){if(this.props.sortDirection===d.ASCENDING)return"ascending";if(this.props.sortDirection===d.DESCENDING)return"descending"}return""},render:function(){var e;return e=t("c-column-header__button u-trim-margin u-trim-padding",{"u-font-strong":this.props.isActive}),y.li({role:"columnheader","aria-sort":this.getAriaDirectionName(),className:"c-column-header__header u-pad-vertical-xs "+this.props.className},y.button({className:e,onClick:this.props.onClick,ref:"columnButton",title:this.getActionDescription(),tabIndex:this.props.tabbable?0:-1,disabled:this.props.disabled},this.renderColumnHeaderLabel()))}}),m=n.createClass({displayName:"_MultiColumnHeader",propTypes:{columns:n.PropTypes.arrayOf(p).isRequired,tabbable:n.PropTypes.bool,disabled:n.PropTypes.bool,activeSortField:n.PropTypes.string,initialSortField:n.PropTypes.string,onSubColumnChange:n.PropTypes.func},getDefaultProps:function(){return{tabbable:!0,disabled:!1,activeSortField:void 0,onSubColumnChange:o.noop}},getInitialState:function(){var e,t;return this.props.initialSortField&&(t=g(this.props.initialSortField,this.props.columns),t&&(e=this.props.columns.indexOf(t))),{currentColumnIndex:e||0}},componentWillMount:function(){return this.updateCurrentColumnIndex(this.props.activeSortField)},componentWillReceiveProps:function(e){return e.activeSortField!==this.props.activeSortField?this.updateCurrentColumnIndex(e.activeSortField):void 0},updateCurrentColumnIndex:function(e){var t,n;return n=g(e,this.props.columns),n?(t=this.props.columns.indexOf(n),t!==this.state.currentColumnIndex&&this.props.onSubColumnChange(n),this.setState({currentColumnIndex:t})):void 0},switchToColumn:function(e){return this.props.onSubColumnChange(e)},render:function(){var e,t,n,o;return e=this.props.columns[this.state.currentColumnIndex],n=this.props.activeSortField&&this.props.activeSortField===e.sortField,t=(this.state.currentColumnIndex+1)%this.props.columns.length,o=this.props.columns[t],v(_,{ref:"singleColumn",key:e.label,className:e.headerClassName||"",canTriggerSortDirection:!1,label:e.label,nextColumnLabel:o.label,tabbable:this.props.tabbable,disabled:this.props.disabled,isActive:n,onClick:function(e){return function(){return e.switchToColumn(o)}}(this)})}}),{ColumnHeader:a(l,["/static/css/components/column-headers-vflS11lNY.css","/static/css/scooter/scooter-scoped-vflx8uhBs.css"]),SortDirections:d,ColumnTypes:c}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/content_manager/api",["external/underscore","modules/clean/ajax","modules/clean/react/browse/constants","modules/clean/filepath","modules/clean/history","modules/clean/pagination_manager","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/sort_helpers","modules/clean/react/browse/store","modules/clean/teams/admin/api/admin_console_api_client","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/constants/browse","modules/constants/viewer","require"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E){var b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z;return k=o.LoadingStates,I=l.FileTypes,S=u.Config,w=u.BrowseContext,x=c.compare,T=d.BrowseStore,C=d.File,b=p.AdminConsoleApiClient,O=m._,G=m.ungettext,D=function(e){return{fq_path:"/"+e.name,href:"/work/"+e.name,is_dir:!0,bytes:0,target_ns:e.team_folder_id,icon:F[e.status[".tag"]],team_folder_status:e.status[".tag"],default_sync_setting:e.default_sync_setting[".tag"],type:I.TEAM_SHARED_FOLDER}},N=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|<|>|\\"|\\|)'),P=new RegExp('([\\u0000-\\u001F]|\\\\|\\/|:|\\?|\\*|\\"|\\|)'),R=new RegExp("[\\ufffe-\\uffff\\ud800-\\udfff]"),A=[".",".."],z=function(t){return""===t?"":t.length>255?O("The folder name should be under 255 characters"):e.call(A,t)>=0?O("The names dot (.) and dot dot (..) are’t allowed"):N.test(t)?O("The following characters aren’t allowed: \\ / : ? * < > ” |"):R.test(t)?O("The folder name contains invalid characters"):null},j=function(e){return""===e?"":e.length>255?O("The file name should be under 255 characters"):P.test(e)?O("The following characters aren’t allowed: \\ / : ? * ” |"):R.test(e)?O("The file name contains invalid characters"):null},H=function(e){var o,i,r,s,a,l,u,c,d,p,h;return l=e.path,h=e.userId,d=e.sortFoldersFirst,i=e.includeDeletedFiles,r=e.nsId,a=e.onSuccess,s=e.onError,o=new b,"/"===l?o.teamFoldersList().then(function(e){var t,n,o;return e.entries=e.entries.sort(function(e,t){return x(e.name,t.name,1)}),n=function(){var t,n,i,r;for(i=e.entries,r=[],t=0,n=i.length;n>t;t++)o=i[t],r.push(D(o));return r}(),t={file_info:n,paginated:!1,inside_auto_team_folder:!0,is_non_user_relative_context:!0},a({path:l,data:t})}).catch(function(e){if(!e.headers)throw e;return"function"==typeof s?s(e.headers,e.raw.status,e.raw.responseBody):void 0}):(u=l.split("/"),c=u[1],p="/"+u.slice(2).join("/"),n.WebRequest({data:{show_deleted:i||"",admin_console:!0,ns_id:r},url:g({path:"/browse"+p}),subject_user:h,success:function(e){var n,o,i,r;try{for(t.isString(e)&&(e=JSON.parse(e)),r=e.file_info,o=0,i=r.length;i>o;o++)n=r[o],n.fq_path="/"+c+n.fq_path;a({path:l,data:e})}catch(e){}},error:function(e,t,n){return"function"==typeof s?s(e,t,n):void 0}}))},M=function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h,_,m;if(r=e.files,u=e.newPath,m=e.userId,c=e.onSuccess,t=E("modules/clean/react/browse/actions"),n=new b(s=!1),o=T.context(),(null!=r?r.length:void 0)>1)return void f.error("Bulk copy is currently not supported.");for(h=o.rootNSID,p=[],a=0,l=r.length;l>a;a++)i=r[a],d=i.fq_path.split("/"),_="/"+d.slice(2).join("/"),p.push(n.fileCopy(h,_,u).then(function(e){return f.success(O("Copy completed.")),t.setPath({path:T.path(),nsId:o.rootNSID})}).catch(function(e){return f.error(e.message)}));return p},U=function(e){var t,n,o,i,r;return i=e.files,o=e.context,t=E("modules/clean/react/browse/actions"),n=new b(r=!1),n.bulkFileDelete(i).then(function(e){var n;return n=G("Deleted %d item.","Deleted %d items.",i.length).format(i.length),f.success(n),t.setPath({path:T.path(),nsId:o.rootNSID})}).catch(function(e){return f.error(e.message)})},V=function(e){var t,n,o,i,r,s,a,l,u,c;return r=e.file,c=e.userId,u=e.onSuccess,l=e.onError,a=e.newName,t=E("modules/clean/react/browse/actions"),o=T.context(),(i=r.is_dir?z(a):j(a))?(f.error(i),void l()):(n=new b(s=!1),n.fileRename(r.ns_id,r.ns_path,a).then(function(e){return r.is_dir?f.success(O("Folder renamed.")):f.success(O("File renamed.")),t.setPath({path:T.path(),nsId:o.rootNSID})}).catch(function(e){return f.error(e.message)}))},q=function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,g;if(d=e.path,r=e.files,u=e.newPath,g=e.userId,c=e.onSuccess,t=E("modules/clean/react/browse/actions"),n=new b(s=!1),o=T.context(),(null!=r?r.length:void 0)>1)return void f.error("Bulk move is currently not supported.");for(_=o.rootNSID,h=[],a=0,l=r.length;l>a;a++)i=r[a],p=i.fq_path.split("/"),m="/"+p.slice(2).join("/"),h.push(n.fileMove(_,m,u).then(function(e){return f.success(O("Move completed.")),t.setPath({path:T.path(),nsId:o.rootNSID})}).catch(function(e){return f.error(e.message)}));return h},B=function(e){var t,n,o,i,r;throw i=e.path,r=e.userId,n=e.namespaceToJournalIdMap,t=e.includeDeletedFiles,o=e.onSuccess,new Error("Not Implemented")},L=function(e){var t,n,o,i,r,s,a,l,u;return l=e.pathName,i=e.folderName,r=e.nsId,u=e.userId,a=e.onSuccess,s=e.onError,t=E("modules/clean/react/browse/actions"),(o=z(i))?(f.error(o),void s()):(n=new b,n.folderCreate(r,l,i).then(function(e){var n;return f.success(O("Folder created.")),n={fq_path:"/"+i},a({changesets:null,createdFolder:n}),t.setPath({path:T.path(),nsId:r})}).catch(function(e){var t,n;return s(),"path"===(null!=(t=e.error)?t[".tag"]:void 0)&&"disallowed_name"===(null!=(n=e.error.path)?n[".tag"]:void 0)?f.error(O("The folder name is invalid.")):f.error(O("Failed to create the folder."))}))},F={},W=function(e){return F=e},{validateFolderName:z,loadPath:H,renameFile:V,copyFiles:M,deleteFiles:U,moveFiles:q,getChangesForDirectory:B,setIcons:W,createNewFolder:L}})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/actions",["modules/clean/react/copy_to_dropbox/api","modules/core/browser"],function(e,t){var n;return new(n=function(){function n(){}return n.prototype.copySharedFile=function(n,o,i){return e.copySharedFile(n,o,i).then(function(e){return t.redirect(e)})},n}())})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/api",["external/rsvp","modules/clean/ajax"],function(e,t){var n,o;return n=e.Promise,o={},o.copySharedFile=function(e,o,i){var r;return r={link_type:e.linkType,link_key:e.linkKey,subpath:e.subPath,secure_hash:e.secureHash,is_package:e.isPackage},e.itemId&&(r.item_id=e.itemId),new n(function(e){return t.WebProgressRequest({url:"/sm/c2d",data:r,progress_text:i,subject_user:o,success:e})})},o})}.call(this),function(){define("modules/clean/react/copy_to_dropbox/modal",["external/react","modules/clean/analytics","modules/clean/em_string","modules/clean/react/copy_to_dropbox/actions","modules/clean/react/modal","modules/clean/viewer","modules/constants/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m;return h=t.WebMiscActivityLogger,c=i.Modal,d=s.ROLE_PERSONAL,p=s.ROLE_WORK,_=a._,m=e.DOM.p,c=e.createFactory(c),u=e.createClass({displayName:"CopyToDropboxModal",propTypes:{shareToken:e.PropTypes.object.isRequired,fileOrFolder:e.PropTypes.object.isRequired,role:e.PropTypes.string.isRequired,userId:e.PropTypes.number,onDismiss:e.PropTypes.func},componentDidMount:function(){return h.log("show-c2d-modal",{filename:this.props.fileOrFolder.filename})},_getTitle:function(){var e,t,o,i,s;if(s=r.get_viewer(),e=this.props.fileOrFolder.filename,!s.is_paired)return t=15,e=n.em_snippet(e,t),_("Save ‘%(filename)s’ to my Dropbox").format({filename:e});switch(this.props.role){case d:return t=10,e=n.em_snippet(e,t),_("Save ‘%(filename)s’ to my personal Dropbox").format({filename:e});case p:return o=s.team_name,i=new n(o).length,t=Math.max(10,15-i),e=n.em_snippet(e,t),_("Save ‘%(filename)s’ to my %(team_name)s Dropbox").format({filename:e,team_name:o})}},_getBodyText:function(){var e;if(e=r.get_viewer(),!e.is_paired)return _(this.props.fileOrFolder.is_dir?"This folder will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.":"This file will be instantly saved to your Dropbox and downloaded to all the computers linked to your account.");switch(this.props.role){case d:return _(this.props.fileOrFolder.is_dir?"This folder will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.":"This file will be instantly saved to your personal Dropbox and downloaded to all the computers linked to your personal account.");case p:return this.props.fileOrFolder.is_dir?_("This folder will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name}):_("This file will be instantly saved to your %(team_name)s Dropbox and downloaded to all the computers linked to your %(team_name)s account.").format({team_name:e.team_name})}},_getAcceptButtonText:function(){var e;if(e=r.get_viewer(),!e.is_paired)return _("Save to my Dropbox");switch(this.props.role){case d:return _("Save to my personal Dropbox");case p:return _("Save to my %(team_name)s Dropbox").format({team_name:e.team_name})}},_getProgressMessage:function(){var e;if(e=r.get_viewer(),!e.is_paired)return _("Saving to your Dropbox...");switch(this.props.role){case d:return _("Saving to your personal Dropbox...");case p:return _("Saving to your %(team_name)s Dropbox...").format({team_name:e.team_name})}},_handleAccept:function(){var e;return e=this._getProgressMessage(),l.success(e),o.copySharedFile(this.props.shareToken,this.props.userId,e)},render:function(){return c({title:this._getTitle(),acceptButtonText:this._getAcceptButtonText(),dismissButtonText:_("Cancel"),onAccept:this._handleAccept,onDismiss:this.props.onDismiss},m({},this._getBodyText()))}})})}.call(this),function(){define("modules/clean/react/file_action_button",["external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite_div","modules/core/i18n"],function(e,t,n,o){var i,r,s,a,l,u;return i=t.BubbleMenuItem,a=o._,l=e.createElement,u=e.DOM,s={COMMENT:"COMMENT",COPY:"COPY",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD",MOVE:"MOVE",OPEN:"OPEN",PREVIOUS_VERSIONS:"PREVIOUS_VERSIONS",REMOVE_LINK:"REMOVE_LINK",RENAME:"RENAME",SHARE:"SHARE",ENABLE_COMMENTS:"ENABLE_COMMENTS",DISABLE_COMMENTS:"DISABLE_COMMENTS",SHOW_RESOLVED_COMMENTS:"SHOW_RESOLVED_COMMENTS",
HIDE_RESOLVED_COMMENTS:"HIDE_RESOLVED_COMMENTS",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},r=e.createClass({displayName:"FileActionButton",propTypes:{type:e.PropTypes.string.isRequired,callback:e.PropTypes.func.isRequired,closeFunc:e.PropTypes.func,className:e.PropTypes.string},getDefaultProps:function(){return{closeFunc:null}},_getIconAndText:function(){switch(this.props.type){case s.COMMENT:return{icon:"s_file_comment",text:a("Comment",{comment:"BUTTON"})};case s.COPY:return{icon:"copy",text:a("Copy…",{comment:"BUTTON"})};case s.DELETE:return{icon:"delete_16",text:a("Delete…",{comment:"BUTTON"})};case s.DOWNLOAD:return{icon:"download_arrow",text:a("Download",{comment:"BUTTON"})};case s.MOVE:return{icon:"move_16",text:a("Move…",{comment:"BUTTON"})};case s.OPEN:return{icon:"open",text:a("Open",{comment:"BUTTON"})};case s.PREVIOUS_VERSIONS:return{icon:"previous_versions",text:a("Previous versions",{comment:"BUTTON"})};case s.REMOVE_LINK:return{icon:"lock",text:a("Remove link",{comment:"BUTTON"})};case s.RENAME:return{icon:"rename",text:a("Rename",{comment:"BUTTON"})};case s.SHARE:return{icon:"s_rainbow",text:a("Share",{comment:"BUTTON"})};case s.ENABLE_COMMENTS:return{icon:"s_file_comment",text:a("Enable comments",{comment:"BUTTON"})};case s.DISABLE_COMMENTS:return{icon:"s_disable",text:a("Disable comments",{comment:"BUTTON"})};case s.SHOW_RESOLVED_COMMENTS:return{icon:"s_resolve",text:a("Show resolved comments",{comment:"BUTTON"})};case s.HIDE_RESOLVED_COMMENTS:return{icon:"s_resolve",text:a("Hide resolved comments",{comment:"BUTTON"})};case s.SUBSCRIBE:return{icon:"s_notifications_on",text:a("Subscribe to notifications",{comment:"BUTTON"})};case s.UNSUBSCRIBE:return{icon:"s_notifications_off",text:a("Unsubscribe from notifications",{comment:"BUTTON"})};default:return null}},render:function(){var e,t,o;return t=this._getIconAndText(),e=t.icon,o=t.text,l(i,{onClick:this.props.callback,closeFunc:this.props.closeFunc,className:this.props.className},l(n,{group:"web",name:e,text:o}))}}),{FileActionButtonType:s,FileActionButton:r}})}.call(this),function(){define("modules/clean/react/file_comments/logger",["modules/clean/ajax","modules/clean/annotations/annotation","modules/core/exception"],function(e,t,n){var o,i,r;return o=t.Annotation,i=function(){function t(){}return t.prototype.log_event=function(t,o,i,r,s,a,l,u,c){return null==l&&(l=null),null==u&&(u=null),null==c&&(c=null),n.assert(t,"event_type not provided"),n.assert(o,"file_activity_key not provided"),e.SilentBackgroundRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:t,file_activity_key:o,comment_activity_key:i,client_origin_type:r,activity_context:a,annotation_type:l,annotation_subtype:u,annotation_page:c},subject_user:s})},t.prototype.log_annotation_event=function(e,t,n,i,r,s){var a,l,u,c;return null==s&&(s=null),null!=s&&(a=o.createAnnotationFromDict(s),c=a.type,u=a.subtype,l=a.getFirstPdfPage()),this.log_event(e,t,n,null,i,r,c,u,l)},t}(),r=new i})}.call(this),function(){var e=[].slice;define("modules/clean/react/file_comments/onboarding",["external/classnames","external/react","modules/core/i18n","modules/clean/react/image","modules/clean/react/onboarding_modal","modules/clean/static_urls"],function(t,n,o,i,r,s){var a,l,u,c,d,p,h,_,m;return h=o._,m=s.static_url,_=n.DOM,c=[{src:m("/static/images/commenting/onboarding_step1-vflB01-Fx.png"),srcHiRes:m("/static/images/commenting/onboarding_step1@2x-vflyooTgN.png")},{src:m("/static/images/commenting/onboarding_step2-vflQHsmaO.png"),srcHiRes:m("/static/images/commenting/onboarding_step2@2x-vflEm4vmD.png")},{src:m("/static/images/commenting/onboarding_step3-vflvKl_oO.png"),srcHiRes:m("/static/images/commenting/onboarding_step3@2x-vfljsqrRb.png")}],u=n.createFactory(r),l=n.createFactory(i),p=n.createClass({displayName:"Slide",mixins:[n.addons.PureRenderMixin],statics:{slideImages:c},propTypes:{heading:n.PropTypes.string.isRequired,subheading:n.PropTypes.string.isRequired,image:n.PropTypes.shape({src:n.PropTypes.string.isRequired,srcHiRes:n.PropTypes.string.isRequired}).isRequired,className:n.PropTypes.string},render:function(){return _.div({className:t("comment-onboarding-slide",this.props.className)},l({src:this.props.image.src,srcHiRes:this.props.image.srcHiRes,className:"comment-onboarding-illustration"}),_.h1({className:"comment-onboarding-heading"},this.props.heading),_.h2({className:"comment-onboarding-subheading"},this.props.subheading))}}),d=n.createFactory(p),a=n.createClass({displayName:"CommentingOnboardingModal",mixins:[n.addons.PureRenderMixin],propTypes:{onOpen:n.PropTypes.func,onClose:n.PropTypes.func},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onOpen?e.onOpen():void 0},getSlides:function(){return[d({className:"comment-slide-1",heading:h("Annotate your files"),subheading:h("Give clear, focused feedback that’s faster than email."),image:c[0]}),d({className:"comment-slide-2",heading:h("Point to what you’re talking about"),subheading:h("Just click anywhere inside the doc, or drag around a specific area."),image:c[1]}),d({className:"comment-slide-3",heading:h("Never lose track of feedback"),subheading:h("Conversations stay with the file, and you can view on any device."),image:c[2]})]},render:function(){return u.apply(null,[{className:"comment-onboarding-modal",slideWidth:600,onClose:this.props.onClose}].concat(e.call(this.getSlides())))}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_comments/shared_link_signup_modals",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/react/file_comments/logger","modules/constants/legacy","modules/core/browser","modules/core/i18n","modules/core/notify"],function(t,n,o,i,r,s,a,l){var u,c,d;return c=o.DBModal,d=a._,u=function(){function t(){this._toggle_form=e(this._toggle_form,this),this._prepare_form=e(this._prepare_form,this),this._reload=e(this._reload,this),this.before_modal=e(this.before_modal,this),this.show_sign_in_modal=e(this.show_sign_in_modal,this),this.show_sign_up_modal=e(this.show_sign_up_modal,this),this.hide_modal=e(this.hide_modal,this),this.init_modals=e(this.init_modals,this),this.show_register=!1,this.init_modals()}return t.POST_COMMENT_VARIANT="post_comment_variant",t.LIKE_COMMENT_VARIANT="like_comment_variant",t.SUBSCRIBE_VARIANT="subscribe_variant",t.prototype.init_modals=function(){return this.default_signup_modal=new c({element_id:"shared-link-default-comments-signup-modal"}),this.default_signup_modal.before_show=this.before_modal},t.prototype.hide_modal=function(){return this.default_signup_modal.hide()},t.prototype.show_sign_up_modal=function(e){return this.show_register=!0,this.variant=e,this.default_signup_modal.show()},t.prototype.show_sign_in_modal=function(e){return this.show_register=!1,this.variant=e,this.default_signup_modal.show()},t.prototype.set_activity_key=function(e){return this.activity_key=e},t.prototype.before_modal=function(e){var t,n;return this._prepare_form(e),e.find(".toggle-form-link").click(function(t){return function(){return t._toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&n.on("db:register:success",function(e){return function(t,n){return e.user=n,l.success(d("Successfully signed up for Dropbox")),i.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this)),t=e.find(".login-form"),t.length?(n.length&&n.on("db:register:user_exists",function(n){return function(o){var i,r,s,a,l;for(n._toggle_form(e),a=o.prefill,l=i=0,s=a.length;s>i;l=++i)r=a[l],t.find(r).val(l);return t.find(o.focus).focus()}}(this)),t.on("db:login:success",function(e){return function(t,n){return e.user=n,l.success(d("Successfully signed in to Dropbox")),i.log_event(r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this))):void 0},t.prototype._reload=function(){return s.reload()},t.prototype._prepare_form=function(e){switch(e.find(".form-component").hide(),e.find(".text-variant").hide(),this.show_register?e.find(".register-form-component").show():e.find(".login-form-component").show(),this.variant){case t.POST_COMMENT_VARIANT:return e.find(".text-variant.post-comment-variant").show();case t.LIKE_COMMENT_VARIANT:return e.find(".text-variant.like-comment-variant").show();case t.SUBSCRIBE_VARIANT:return e.find(".text-variant.subscribe-variant").show();default:return e.find(".text-variant.default-variant").show()}},t.prototype._toggle_form=function(e){var t,n,o;return o=e.find(".register-form-component"),n=e.find(".login-form-component"),o.is(":visible")?(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_MODAL,o.fadeOut({complete:function(){return n.show()}})):(t=r.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,n.fadeOut({complete:function(){return o.show()}})),i.log_event(t,this.activity_key,null,r.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.MODAL_TOGGLE_BUTTON)},t}()})}.call(this),function(){define("modules/clean/react/file_modal_controller",["external/react","external/underscore","modules/clean/filepath","modules/clean/react/browse/api","modules/clean/react/css","modules/clean/react/file_modals","modules/clean/react/modal"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h,_,m,f;return c=r.FileTransferModal,m=r.RestoreFilesModal,_=r.PermanentlyDeleteModal,l=r.DeleteFileModal,a=r.ContentManagerBridgeModal,p=r.NoAccessFolderModal,d=s.Modal,f=e.createElement,h={COPY:"copy",MOVE:"move"},u=function(){function e(){}return e.showCopy=function(e,t,n){var o,i,r,s,a,l,u;return r=null!=(a=n.onSuccess)?a:null,s=null!=(l=n.onUndo)?l:null,i=null!=(u=n.onRequestNotSent)?u:null,o=f(c,{files:t,operation:h.COPY,user:e,onSuccess:r,onUndo:s,onRequestNotSent:i}),d.showInstance(o)},e.showMove=function(e,t,n,o){var i,r,s,a,l,u,p;return s=null!=(l=o.onSuccess)?l:null,a=null!=(u=o.onUndo)?u:null,r=null!=(p=o.onRequestNotSent)?p:null,i=f(c,{files:t,path:n,operation:h.MOVE,user:e,onSuccess:s,onUndo:a,onRequestNotSent:r}),d.showInstance(i)},e.showRestore=function(e,t,n){var o;return o=f(m,{files:t,userId:e.id,onSuccess:n}),d.showInstance(o)},e.showPermanentlyDelete=function(e,t,n){var o;return o=f(_,{files:t,userId:e.id,onSuccess:n}),d.showInstance(o)},e.showDelete=function(e,t,o,i){var r,s,a;return s=n.filename(o.currentFQPath),a=o.isInsideSharedFolder,r=f(l,{files:t,user:e,parentSharedFolderName:a?s:null,onUndo:i}),d.showInstance(r)},e.showContentManagerBridge=function(e,t,n){var o;return o=f(a,{files:e,type:t,isLimitedTeam:n}),d.showInstance(o)},e.showNoAccess=function(e){var t;return t=f(p,{folderName:n.filename(e.fq_path)}),d.showInstance(t)},e}(),{FileModalController:u}})}.call(this),function(){define("modules/clean/react/file_modals",["external/react","external/react-dom","external/underscore","modules/clean/em_string","modules/clean/react/browse/api","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/browse/render_partials","modules/clean/react/browse/store","modules/clean/react/content_manager/api","modules/clean/react/css","modules/clean/react_format","modules/clean/react/modal","modules/clean/react/tree_view","modules/clean/file_operations/notifications","modules/clean/filepath","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/core/browser","modules/core/html","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T){var S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z;return R=r.FileTypes,P=s.File,A=a.FileIcon,S=l.BrowseStore,j=d.reactFormat,D=p.Modal,k=h.FolderTreeView,U=f.SNIPPET_SIZES,V=g.genContentManagerBridgeUri,O=g.GoldenGate,B=w._,z=w.ungettext,q=e.DOM,H=e.createElement,x={COPY:"copy",MOVE:"move"},W=function(){var e,t;return t=S.context(),e=t.isNonUserRelativeContext?u:i},G=function(e){var t;return t=S.context(),t.isNonUserRelativeContext?e[0].fq_path.split("/")[1]:null},M=e.createClass({displayName:"PermanentlyDeleteModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.instanceOf(P)).isRequired,userId:e.PropTypes.number.isRequired},getDefaultProps:function(){return{onSuccess:n.noop}},handlePurged:function(){return _.notifyPurgeSuccess(this.props.files.length),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){return i.purgeFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handlePurged})},isSingleSharedFolder:function(e){return 1===e.length&&e[0].type===R.SHARED_FOLDER},getTitle:function(e){var t;return t=e.length,this.isSingleSharedFolder(e)?B("Remove access to folder?"):z("Permanently delete %(num)s file?","Delete %(num)s items permanently?",t).format({num:t})},renderContent:function(e){var t,n;return t=e.length,1===t?(n=m.filename(e[0].fq_path),this.isSingleSharedFolder(e)?j(B("Are you sure you want to remove your access to <strong>%(filename)s</strong>? It will no longer be viewable in your list of shared folders, and you won’t be able to re-add it to your Dropbox unless you’re re-invited."),{strong:q.strong(),filename:n}):j(B("Are you sure you want to delete <strong>%(filename)s</strong> from your Dropbox permanently?"),{strong:q.strong(),filename:n})):q.span(null,z("Are you sure you want to permanently delete %(num)s item from your Dropbox?","Are you sure you want to permanently delete %(num)s items from your Dropbox?",t).format({num:t}))},render:function(){var e;return e={ref:"modal",title:this.getTitle(this.props.files),acceptButtonText:B(this.isSingleSharedFolder(this.props.files)?"Remove my access":"Delete permanently"),dismissButtonText:B("Cancel"),onAccept:this.handleAccept},H(D,e,this.renderContent(this.props.files))}}),L=e.createClass({displayName:"RestoreFilesModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.instanceOf(P)).isRequired,userId:e.PropTypes.number.isRequired,onSuccess:e.PropTypes.func},getDefaultProps:function(){return{onSuccess:n.noop}},handleRestoreSuccess:function(){return _.notifyRestoreSuccess(this.props.files),this.props.onSuccess.apply(null,arguments)},handleRestoreClick:function(e){return e.preventDefault(),i.restoreFiles({files:this.props.files,userId:this.props.userId,onSuccess:this.handleRestoreSuccess}),this.refs.modal.close()},handleCancelClick:function(e){return e.preventDefault(),this.refs.modal.close()},getTitle:function(e){return z("Restore %(num)s file?","Restore %(num)s items…",e).format({num:e})},renderSingleFileContent:function(e,t){var n;return n=m.filename(e.fq_path),[j(B("The most recent version of <strong>%(filename)s</strong> will be restored."),{strong:q.strong(),filename:n}),q.div({className:"file-modal__single-file-row"},H(A,{file:e,className:"file-modal__single-file-row-icon"}),q.a({href:t,className:"file-modal__single-file-row-link"},n))]},renderMultiFileContent:function(e){return q.span({},z("Are you sure you want to restore %(num)s item?","Are you sure you want to restore %(num)s items?",e.length).format({num:e.length}))},renderButtons:function(e){return q.div({className:"file-modal__buttons"},e?q.div({className:"file-modal__buttons__alt",ref:"revisionButton"},q.a({href:e},B("View other versions"))):void 0,q.div({className:"file-modal__buttons__main"},q.button({className:"button-primary db-modal-button",onClick:this.handleRestoreClick,ref:"primaryButton"},B("Restore")),q.button({className:"button-tertiary db-modal-button",onClick:this.handleCancelClick,ref:"tertiaryButton"},B("Cancel"))))},render:function(){var e,t,n,o;return t=this.props.files.length,o=null,1===t&&(o=i.getFileHistoryUrl({fqPath:this.props.files[0].fq_path,userId:this.props.userId})),n={ref:"modal",title:this.getTitle(t),buttonComponent:this.renderButtons(o)},e=1===t?this.renderSingleFileContent(this.props.files[0],o):this.renderMultiFileContent(this.props.files),H(D,n,e)}}),L=c(L,["/static/css/react/file_modal-vfl5O9OmZ.css"]),N=e.createClass({displayName:"FileTransferModal",statics:{Operations:x},propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,operation:e.PropTypes.oneOf([x.COPY,x.MOVE]).isRequired,user:e.PropTypes.instanceOf(v).isRequired,onSuccess:e.PropTypes.func,onUndo:e.PropTypes.func,onRequestNotSent:e.PropTypes.func,path:e.PropTypes.string},getDefaultProps:function(){return{onSuccess:n.noop}},getInitialState:function(){return{selectedPath:null}},handleOperationSuccess:function(e){var t,n,o,i;return t=e.changesets,o=e.rollbackHints,n=this.props.files.length,i=this.props.user,this.props.operation===x.MOVE?_.notifyMoveSuccess(n,i,t,this.state.selectedPath,o,this.props.onUndo):this.props.operation===x.COPY&&_.notifyCopySuccess(n,i,t,this.state.selectedPath,o,this.props.onUndo),this.props.onSuccess.apply(null,arguments)},handleAccept:function(){var e,t,n,o;if(e=W(),this.props.operation===x.MOVE){if(o=e.moveFiles({path:this.props.path,files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!o)return"function"==typeof(t=this.props).onRequestNotSent?t.onRequestNotSent():void 0}else if(this.props.operation===x.COPY&&(o=e.copyFiles({files:this.props.files,newPath:this.state.selectedPath,userId:this.props.user.id,onSuccess:this.handleOperationSuccess}),!o))return"function"==typeof(n=this.props).onRequestNotSent?n.onRequestNotSent():void 0},handleFolderSelected:function(e){return this.setState({selectedPath:e})},_getTitle:function(){var e,t;return e=this.props.files.length,this.props.operation===x.MOVE?t=this.props.files[0].is_dir?z("Move %(num)s folder to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):z("Move %(num)s file to…","Move %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):this.props.operation===x.COPY&&(t=this.props.files[0].is_dir?z("Copy %(num)s folder to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'}):z("Copy %(num)s file to…","Copy %(num)s items to…",e,{comment:'"items" is a (potential) mix of files and folders'})),t.format({num:e})},_getActionButtonText:function(){return this.props.operation===x.COPY?B("Copy"):this.props.operation===x.MOVE?B("Move"):void 0},handleModalShown:function(){var e;return e=t.findDOMNode(this.refs.treeView),e?e.focus():void 0},render:function(){return H(D,{ref:"modal",title:this._getTitle(),acceptButtonText:this._getActionButtonText(),onAccept:this.handleAccept,acceptButtonDisabled:!this.state.selectedPath,autoFocusPrimaryInput:!1,onShow:this.handleModalShown,dismissButtonText:B("Cancel")},H(k,{ref:"treeView",rootPath:"/",user:this.props.user,onFolderSelected:this.handleFolderSelected,isRootSelectable:!0,treeRootName:G(this.props.files)}))}}),I=e.createClass({displayName:"DeleteFileModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,user:e.PropTypes.instanceOf(v).isRequired,parentSharedFolderName:e.PropTypes.string,onUndo:e.PropTypes.func},getDefaultProps:function(){return{parentSharedFolderName:null}},handleNotify:function(e){var t,n;return t=e.changesets,n=e.rollbackHints,_.notifyDeleteSuccess(this.props.files.length,this.props.user,t,n,this.props.onUndo)},handleAccept:function(){var e;return e=S.context(),e.isNonUserRelativeContext?u.deleteFiles({files:this.props.files,context:e}):i.deleteFiles({files:this.props.files,userId:this.props.user.id,onSuccess:this.handleNotify})},_isRemovingSharedFolder:function(){return 1===this.props.files.length&&this.props.files[0].target_ns},_getTitle:function(){var e;return e=this.props.files,e.length<1?"":this._isRemovingSharedFolder()&&!O.canDeepNest(this.props.user.id)?B("Remove shared folder?"):1===e.length?B(e[0].is_dir?"Delete folder?":"Delete file?"):z("Delete %(item_count)s item?","Delete %(item_count)s items?",e.length).format({item_count:e.length})},_getContents:function(){var e,t,n,o,i;return e=this.props.files,null==(null!=e?e.length:void 0)||e.length<1?"":(n=m.filename(e[0].fq_path),t=e[0].target_ns,null!=this.props.parentSharedFolderName?(o=this.props.parentSharedFolderName,1===e.length&&t&&!O.canDeepNest(this.props.user.id)?(i=T({path:"/work"+e[0].fq_path,query:{shareoptions:1,sharesubfolder:0}}).toString(),j(B("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’? People outside %(team_name)s with whom you’ve shared this folder will stil have access until you remove them from the <memberListLink>member list</memberListLink>."),{filename:n,shared_folder_name:o,team_name:y.get_viewer().team_name,b:q.b(),memberListLink:q.a({href:i})})):1===e.length?j(B("Are you sure you want to delete <b>%(filename)s</b> from the shared folder ‘%(shared_folder_name)s’?"),{filename:n,shared_folder_name:o,b:q.b()}):z("Are you sure you want to delete %(item_count)s item from the shared folder ‘%(shared_folder_name)s’?","Are you sure you want to delete %(item_count)s items from the shared folder ‘%(shared_folder_name)s’?",e.length).format({item_count:e.length,shared_folder_name:o})):1===e.length&&t?j(B("Are you sure you want to remove the shared folder <b>%(filename)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."),{filename:n,b:q.b()}):1===e.length?j(B("Are you sure you want to delete <b>%(filename)s</b> from your Dropbox?"),{filename:n,b:q.b()}):z("Are you sure you want to delete %(item_count)s item from your Dropbox?","Are you sure you want to delete %(item_count)s items from your Dropbox?",e.length).format({item_count:e.length}))},render:function(){return H(D,{ref:"modal",title:this._getTitle(),onAccept:this.handleAccept,acceptButtonText:B(this._isRemovingSharedFolder()?"Remove":"Delete"),dismissButtonText:B("Cancel")},this._getContents())}}),C=e.createClass({displayName:"ContentManagerBridgeModal",propTypes:{files:e.PropTypes.arrayOf(e.PropTypes.shape({fq_path:e.PropTypes.string,is_dir:e.PropTypes.bool})).isRequired,type:e.PropTypes.string,isLimitedTeam:e.PropTypes.bool},handleAccept:function(){var e;return e=V(this.props.isLimitedTeam,this.props.files[0].fq_path),E.open_tab(e.toString())},render:function(){return H(D,{ref:"modal",style:"clean",onAccept:this.handleAccept,acceptButtonText:B("Go to Admin Console"),altAction:q.a({onClick:function(){return D.close()}},B("Cancel")),width:350,showX:!1,className:"content-manager-bridge-modal"},"archive"===this.props.type?B("You can archive team folders in the Admin Console."):"rename"===this.props.type?B("You can rename team folders in the Admin Console."):void 0)}}),F=e.createClass({displayName:"NoAccessFolderModal",propTypes:{folderName:e.PropTypes.string.isRequired},render:function(){return H(D,{ref:"modal",style:"default",acceptButtonText:B("Done"),title:B("No access to the folder “%(folder_name)s”").format({folder_name:o.em_snippet(this.props.folderName,U.FILENAME)})},q.div({},B("You don’t have permission to open the folder “%(folder_name)s”. Contact your team admins to gain access.").format({folder_name:o.em_snippet(this.props.folderName,U.FILENAME)})," ",q.a({href:"/team?_tk=left_nav_team",target:"_blank"},B("See list of admins."))))}}),{FileTransferModal:N,RestoreFilesModal:L,PermanentlyDeleteModal:M,DeleteFileModal:I,ContentManagerBridgeModal:C,NoAccessFolderModal:F}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_uploader/store",["external/immutable","modules/clean/base64","modules/clean/flux/base_store","modules/clean/react/browse/constants","modules/core/browser","modules/core/exception"],function(t,n,o,i,r,s){var a,l,u,c,d,p,h,_,m,f;return a=i.BrowseActionTypes,_=s.assert,f=s.raiseAndReport,p={SET_PATH:"UPLOADER_SET_PATH",SET_USER:"UPLOADER_SET_USER",SET_NUM_DRAGGING_FILES:"SET_NUM_DRAGGING_FILES",QUEUE_UPLOADS:"QUEUE_UPLOADS",START_UPLOAD:"START_UPLOAD",COMPLETE_UPLOAD:"COMPLETE_UPLOAD",CANCEL_UPLOADS:"CANCEL_UPLOADS",SET_CURRENT_UPLOAD_PROGRESS:"SET_CURRENT_UPLOAD_PROGRESS",UPLOAD_ERROR:"UPLOAD_ERROR",SET_IS_UPLOAD_MODAL_OPEN:"SET_IS_UPLOAD_MODAL_OPEN",SET_IS_INLINE_STATUS_DISMISSED:"SET_IS_INLINE_STATUS_DISMISSED",ADD_NEW_FAILED_FILE:"ADD_NEW_FAILED_FILE"},l={PENDING:"PENDING",UPLOADING:"UPLOADING",COMPLETE:"COMPLETE",CANCELLED:"CANCELLED",FAILED:"FAILED"},d={FILE_SIZE_ERROR:"FILE_SIZE_ERROR",HTTP_ERROR:"HTTP_ERROR",CONNECTION_ERROR:"CONNECTION_ERROR",OVER_QUOTA_ERROR:"OVER_QUOTA_ERROR",IGNORED:"IGNORED",EMPTY_OR_FOLDER:"EMPTY_OR_FOLDER",PACKAGE_FILE:"PACKAGE_FILE",GENERIC:"GENERIC"},c=r.msie?"text":"application/x-dropbox-file-list",u=t.Record({uploadId:void 0,dest:"",ns_id:null,ns_path:null,userId:null,name:"",size:0,percentUploaded:0,status:l.PENDING,errorType:d.GENERIC,errorMessage:""}),m=function(){var e,t,o,i;for(e="",t=o=0;15>=o;t=++o)e+=String.fromCharCode(Math.floor(256*Math.random()));return i=n.encode(e),i=i.replace(/\+/g,"-"),i=i.replace(/\//g,"_"),i=i.replace(/\=*$/,"")},h=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,n),o.prototype._init=function(){return this._path="/",this._hasPermissionToUploadToFolder=!0,this._user=null,this._fileList=t.OrderedMap(),this._currentUploadId=null,this._numDraggingFiles=0,this._isInternalTransfer=!1,this._isUploadModalOpen=!1,this._isInlineStatusDismissed=!1,this._numSecondsLeft=0},o.prototype.fileList=function(){return this._fileList},o.prototype.currentUpload=function(){return this._fileList.get(this._currentUploadId)},o.prototype.currentUploadPercentage=function(){return this.currentUpload().percentUploaded},o.prototype.numSecondsLeft=function(){return this._numSecondsLeft},o.prototype.isUploadCancelled=function(e){var t;return(null!=(t=this._fileList.get(e))?t.status:void 0)===l.CANCELLED},o.prototype.isInlineStatusDismissed=function(){return this._isInlineStatusDismissed},o.prototype.path=function(){return this._path},o.prototype.hasPermissionToUploadToFolder=function(){return this._hasPermissionToUploadToFolder},o.prototype.user=function(){return this._user},o.prototype.nextUpload=function(){return this._fileList.find(function(e){return e.status===l.PENDING})},o.prototype.numDraggingFiles=function(){return this._numDraggingFiles},o.prototype.isInternalTransfer=function(){return this._isInternalTransfer},o.prototype.totalSizeOfCompletedUploads=function(){return this._fileList.reduce(function(e,t){return t.status===l.COMPLETE?e+t.size:e},0)},o.prototype.totalSize=function(){return this._fileList.reduce(function(e,t){var n;return(n=t.status)===l.COMPLETE||n===l.PENDING||n===l.UPLOADING?e+t.size:e},0)},o.prototype.isUploadModalOpen=function(){return this._isUploadModalOpen},o.prototype._setUser=function(e){var t;return t=e.user,this._user=t,this.emit_change()},o.prototype._setPath=function(e){var t,n,o;return n=e.path,t=null!=(o=e.hasPermissionToUploadToFolder)?o:!0,this._path=n,this._hasPermissionToUploadToFolder=t,this.emit_change()},o.prototype._initializeEverything=function(e){var t,n,o;return o=e.user,n=e.path,t=e.context,this._user=o,this._path=n,this._hasPermissionToUploadToFolder=t.isCurrentPathWriteable(),this.emit_change()},o.prototype._queueUploads=function(e){var t,n,o,i,r;for(n=e.files,r={},o=0,i=n.length;i>o;o++)t=n[o],r[t.uploadId]=t;return this._fileList=this._fileList.merge(r),this.emit_change()},o.prototype._startUpload=function(e){var t;return t=e.file,_(null==this._currentUpload),_(null!=t),_(this._fileList.get(t.uploadId)===t),this._fileList=this._fileList.update(t.uploadId,function(e){return e.set("status",l.UPLOADING)}),this._currentUploadId=t.uploadId,this.emit_change()},o.prototype._completeUpload=function(e){var t,n;return t=e.uploadId,n=this._fileList.get(t),t===this._currentUploadId&&n.status===l.UPLOADING||f("Tried to mark a file upload that is not currently uploading as complete",{exc_extra:{file:n.toJS(),fileListLength:this._fileList.count(),uploadId:t,currentUploadId:this._currentUploadId}}),this._fileList=this._fileList.update(n.uploadId,function(e){return e.set("status",l.COMPLETE)}),this._currentUploadId=null,this.emit_change()},o.prototype._cancelUploads=function(e){var t,n,o,i;for(n=e.files,o=0,i=n.length;i>o;o++)t=n[o],this._fileList=this._fileList.update(t.uploadId,function(e){var t;return(t=e.status)===l.PENDING||t===l.UPLOADING?e.set("status",l.CANCELLED):e}),t.uploadId===this._currentUploadId&&(this._currentUploadId=null);return this.emit_change()},o.prototype._setCurrentUploadProgress=function(e){var t,n;return n=e.percentComplete,t=e.numSecondsLeft,this._fileList=this._fileList.update(this._currentUploadId,function(e){return e.set("percentUploaded",n)}),this._numSecondsLeft=t,this.emit_change()},o.prototype._handleUploadError=function(e){var t,n,o,i;return i=e.uploadId,n=e.errorType,t=e.errorMessage,o=this._fileList.get(i),o.uploadId!==this._currentUploadId&&f("Error reported for file upload that is not the current upload",{exc_extra:{file:o.toJS(),fileListLength:this._fileList.count(),errorType:n,errorMessage:t}}),this._fileList=this._fileList.update(o.uploadId,function(e){return e.set("status",l.FAILED).set("errorType",n).set("errorMessage",t)}),this._currentUploadId=null,this.emit_change()},o.prototype._setNumDraggingFiles=function(e){var t,n,o;return n=e.numDraggingFiles,t=null!=(o=e.isInternalTransfer)?o:!1,this._numDraggingFiles=n,this._isInternalTransfer=t,this.emit_change()},o.prototype._setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,this._isUploadModalOpen=t,this.emit_change()},o.prototype._setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,this._isInlineStatusDismissed=t,this.emit_change()},o.prototype._addNewFailedFile=function(e){var t,n,o;return o=e.file,n=e.errorType,t=e.errorMessage,null==o.uploadId&&(o=o.set("uploadId",m())),o=o.set("status",l.FAILED).set("errorType",n).set("errorMessage",t),this._fileList=this._fileList.set(o.uploadId,o),this.emit_change()},o.prototype._new_payload=function(e){switch(e.action.type){case a.INITIALIZE_EVERYTHING:return this._initializeEverything(e.action.data);case a.SET_USER:case p.SET_USER:return this._setUser(e.action.data);case a.SET_PATH:case p.SET_PATH:return this._setPath(e.action.data);case p.QUEUE_UPLOADS:return this._queueUploads(e.action.data);case p.START_UPLOAD:return this._startUpload(e.action.data);case p.COMPLETE_UPLOAD:return this._completeUpload(e.action.data);case p.CANCEL_UPLOADS:return this._cancelUploads(e.action.data);case p.SET_CURRENT_UPLOAD_PROGRESS:return this._setCurrentUploadProgress(e.action.data);case p.UPLOAD_ERROR:return this._handleUploadError(e.action.data);case p.SET_NUM_DRAGGING_FILES:return this._setNumDraggingFiles(e.action.data);case p.SET_IS_UPLOAD_MODAL_OPEN:return this._setIsUploadModalOpen(e.action.data);case p.SET_IS_INLINE_STATUS_DISMISSED:return this._setIsInlineStatusDismissed(e.action.data);case p.ADD_NEW_FAILED_FILE:return this._addNewFailedFile(e.action.data)}},o}(o),{UploaderStore:new h,UploaderActionTypes:p,FileUpload:u,FileStatus:l,UploadErrorType:d,generateUploadId:m,INTERNAL_FILE_DATA_TRANSFER_TYPE:c}})}.call(this),function(){define("modules/clean/react/file_viewer/actions",["modules/clean/previews/util","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/dispatcher","modules/clean/react/file_viewer/store","modules/clean/analytics"],function(e,t,n,o,i){var r,s,a,l;return l=e.PreviewHelper,r=t.ActionTypes,a=i.PreviewActivityLogger,new(s=function(){function e(){}return e.prototype.setup=function(e,t,o,i){var s,a,l,u,c;return a=null!=i?i:{},c=a.sharedLinkInfos,u=a.shareTokens,l=a.sharePermissions,s=a.disableFlipping,n.dispatch({type:r.SETUP,data:{files:e,currentIndex:t,user:o,sharedLinkInfos:c,shareTokens:u,sharePermissions:l,disableFlipping:s}})},e.prototype.cleanup=function(){return n.dispatch({type:r.CLEANUP})},e.prototype.updateFiles=function(e){return n.dispatch({type:r.UPDATE_FILES,data:{files:e}})},e.prototype.replaceFile=function(e){
return n.dispatch({type:r.REPLACE_FILE,data:{file:e}})},e.prototype.flipNext=function(){return n.dispatch({type:r.FLIP_NEXT})},e.prototype.flipPrevious=function(){return n.dispatch({type:r.FLIP_PREVIOUS})},e.prototype.openFullscreen=function(){var e;return e={file_ext:l.get_extension(o.currentFile())},this.openFullscreenLogging(e),n.dispatch({type:r.OPEN_FULLSCREEN})},e.prototype.openFullscreenLogging=function(e){return a.log("enter-fullscreen",e)},e.prototype.closeFullscreen=function(){var e;return e={file_ext:l.get_extension(o.currentFile())},this.closeFullscreenLogging(e),n.dispatch({type:r.CLOSE_FULLSCREEN})},e.prototype.closeFullscreenLogging=function(e){return a.log("exit-fullscreen",e)},e.prototype.switchRevision=function(e){return n.dispatch({type:r.SWITCH_REVISION,data:{file:e}})},e.prototype.restoreRevision=function(){return n.dispatch({type:r.RESTORE_REVISION})},e.prototype.fastForwardRevision=function(e){return n.dispatch({type:r.FAST_FORWARD_REVISION,data:{file:e}})},e}())})}.call(this),function(){define("modules/clean/react/file_viewer/coach_mark",["external/react","modules/clean/css","modules/clean/react/flag","modules/clean/react/image"],function(e,t,n,o){var i,r,s,a,l,u,c;return c=e.DOM,s=c.button,a=c.div,l=c.h4,u=c.p,r=e.createFactory(n),i=e.createClass({displayName:"CoachMark",propTypes:{title:e.PropTypes.string.isRequired,imageUrl:e.PropTypes.string.isRequired,imageUrl2x:e.PropTypes.string.isRequired,imageAlt:e.PropTypes.string.isRequired,buttonText:e.PropTypes.string.isRequired,onButtonClick:e.PropTypes.func.isRequired,onShown:e.PropTypes.func},componentWillMount:function(){return t.require_css("/static/css/components/bubble_dropdown-vflbLryNB.css"),t.require_css("/static/css/components/coach_mark-vfl5FeU94.css")},componentDidMount:function(){var e;return"function"==typeof(e=this.props).onShown?e.onShown():void 0},_renderCoachMarkImage:function(){return e.createElement(o,{className:"c-coach-mark__img u-pad-right-xs",src:this.props.imageUrl,srcHiRes:this.props.imageUrl2x,alt:this.props.imageAlt})},_renderCoachMarkMessage:function(){return a({className:"coach-mark_message"},l({},this.props.title),u({refs:"coachmarkBody"},this.props.children),s({className:"button-primary button-small",onMouseUp:this.props.onButtonClick,ref:"coachmarkButton"},this.props.buttonText))},render:function(){return a({className:"c-coach-mark bubble-dropdown top-right",ref:"coachmark"},r({leftAttachment:this._renderCoachMarkImage()},this._renderCoachMarkMessage()),a({className:"bubble-arrow-border"}),a({className:"bubble-arrow"}))}})})}.call(this),function(){define("modules/clean/react/file_viewer/constants",[],function(){var e;return e={},e.ActionTypes={SETUP:"SETUP",CLEANUP:"CLEANUP",UPDATE_FILES:"UPDATE_FILES",REPLACE_FILE:"REPLACE_FILE",FLIP_NEXT:"FLIP_NEXT",FLIP_PREVIOUS:"FLIP_PREVIOUS",OPEN_FULLSCREEN:"OPEN_FULLSCREEN",CLOSE_FULLSCREEN:"CLOSE_FULLSCREEN",SWITCH_REVISION:"SWITCH_REVISION",RESTORE_REVISION:"RESTORE_REVISION",FAST_FORWARD_REVISION:"FAST_FORWARD_REVISION"},e.EventTypes={FILE_VIEWER_OPENED:"FILE_VIEWER_OPENED",FILE_PREVIEW_SESSION_ENDED:"FILE_PREVIEW_SESSION_ENDED",FILE_PREVIEW_ATTEMPT_STARTED:"FILE_PREVIEW_ATTEMPT_STARTED",FILE_PREVIEW_SUPPORT_CONFIRMED:"FILE_PREVIEW_SUPPORT_CONFIRMED",FILE_PREVIEW_SUPPORT_DENIED:"FILE_PREVIEW_SUPPORT_DENIED",FILE_PREVIEW_DOWNLOAD_ATTEMPTED:"FILE_PREVIEW_DOWNLOAD_ATTEMPTED",FILE_PREVIEW_DOWNLOAD_SUCCEEDED:"FILE_PREVIEW_DOWNLOAD_SUCCEEDED",FILE_PREVIEW_DOWNLOAD_FAILED:"FILE_PREVIEW_DOWNLOAD_FAILED",FILE_PREVIEW_RENDER_SUCCEEDED:"FILE_PREVIEW_RENDER_SUCCEEDED",FILE_PREVIEW_RENDER_FAILED:"FILE_PREVIEW_RENDER_FAILED",FILE_PREVIEW_SEEN_STATE_SHOWN:"FILE_PREVIEW_SEEN_STATE_SHOWN",FILE_PREVIEW_PASS_SHOWN:"FILE_PREVIEW_PASS_SHOWN",FILE_PREVIEW_PASS_HOVER:"FILE_PREVIEW_PASS_HOVER",FILE_PREVIEW_PASS_CLICK:"FILE_PREVIEW_PASS_CLICK"},e.SourceContext={BROWSE:"BROWSE",SHARED_LINK_FILE:"SHARED_LINK_FILE",SHARED_LINK_FOLDER:"SHARED_LINK_FOLDER",SHARED_LINK_COLLECTION:"SHARED_LINK_COLLECTION",VERSION_HISTORY:"VERSION_HISTORY"},e.CannedTestFilenames={EXCEL_HTML:"test-workbook.html"},e})}.call(this),function(){define("modules/clean/react/file_viewer/container",["external/react","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/share_helpers"],function(e,t,n,o){var i;return i=e.createClass({displayName:"FileViewerContainer",propTypes:{files:e.PropTypes.array.isRequired,currentIndex:e.PropTypes.number.isRequired,user:e.PropTypes.object,fileViewerProps:e.PropTypes.object.isRequired,sharedLinkInfo:e.PropTypes.object,shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object},componentWillMount:function(){var e;return e={sharedLinkInfos:[this.props.sharedLinkInfo],shareTokens:[this.props.shareToken],sharePermissions:[this.props.sharePermissions],disableFlipping:!1},t.setup(this.props.files,this.props.currentIndex,this.props.user,e)},componentWillUnmount:function(){return t.cleanup()},render:function(){var t;return t=this.props.fileViewerProps,t.shareHelpers=o,e.createElement(n,t)}})})}.call(this),function(){define("modules/clean/react/file_viewer/controller",["external/react","external/react-dom","modules/constants/python","modules/constants/comments_panel","modules/clean/activity/constants","modules/clean/loggers/file_viewer_logger","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_viewer","modules/clean/react/file_viewer/share_helpers","modules/clean/previews/util","modules/core/dom"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f;return p=n.FileViewModeType,h=n.FileViewTargetType,d=i.ActivityContext,f=u.PermissionHelper,_=e.createFactory(a),m={fileViewer:null,targetElementId:"",open:function(e,n,o,i,a){var u,p,m,f,g;return this.targetElementId=i,this.isShown()?void 0:(a.fileViewTarget===h.SHARED_LINK?a.activityContext=d.SHARED_LINK_VIEW:a.fileViewTarget===h.SHARED_CONTENT_LINK?a.activityContext=d.SHARED_CONTENT_LINK_VIEW:(a.activityContext=d.BROWSE_FILE_VIEWER,a.shareHelpers=l),m=a.onCloseViewer,a.onCloseViewer=function(e){return function(){return e.close(),"function"==typeof m?m():void 0}}(this),a.canClose=!0,u=!!a.disableFlipping,g={disableFlipping:u,sharedLinkInfos:a.sharedLinkInfos,shareTokens:a.shareTokens,sharePermissions:a.sharePermissions},s.setup(e,n,o,g),r.start(),c.scroll_lock_document(),p=_(a),f=document.getElementById(this.targetElementId),this.fileViewer=t.render(p,f))},updateFiles:function(e){return this.isShown()?s.updateFiles(e):void 0},close:function(){var e;return this.isShown()?(e=document.getElementById(this.targetElementId),t.unmountComponentAtNode(e),s.cleanup(),c.scroll_unlock_document(),this.fileViewer=null):void 0},isShown:function(){return null!=this.fileViewer}}})}.call(this),function(){define("modules/clean/react/file_viewer/copyright_flag",["external/react","modules/clean/react/title_bubble","modules/constants/env","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i){var r,s,a,l;return s=o._,a=e.createElement,l=e.DOM,r=e.createClass({displayName:"CopyrightFlag",propTypes:{sharedLink:e.PropTypes.string,shareToken:e.PropTypes.shape({linkKey:e.PropTypes.string,linkType:e.PropTypes.string,subPath:e.PropTypes.string,secureHash:e.PropTypes.string})},getCopyrightHref:function(){var e;return e=null!=this.props.sharedLink?{ssu:this.props.sharedLink}:{link_key:this.props.shareToken.linkKey,link_type:this.props.shareToken.linkType,spath:this.props.shareToken.subPath,shash:this.props.shareToken.secureHash},new i({scheme:"https",authority:n.WEBSERVER,path:"/copyright_complaint",query:e})},render:function(){return a(t,{content:s("Flag for copyright"),position:t.POSITIONS.RIGHT,distanceFromTarget:5,isTargetPositionFixed:!0},l.div({className:"react-copyright-complaint-flag"},l.a({href:this.getCopyrightHref(),className:"flag-link",title:s("Flag for copyright"),rel:"nofollow"})))}})})}.call(this),function(){define("modules/clean/react/file_viewer/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){define("modules/clean/react/file_viewer/file_preview",["external/react","modules/constants/legacy","modules/clean/frame_messenger","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/browse/models","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/utils","modules/clean/react/previews/audio/preview_audio","modules/clean/react/previews/constants","modules/clean/react/previews/preview_error","modules/clean/react/previews/preview_html","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_linkfile","modules/clean/react/previews/preview_pdf","modules/clean/react/previews/preview_password_protected","modules/clean/react/previews/preview_video","modules/core/exception","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T){var S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j;return A=o.FilePreviewTimelineLogger,O=r.PermissionHelper,M=r.PreviewHelper,I=s.File,C=a.EventTypes,j=a.SourceContext,P=u.FilePreviewSession,N=u.FileViewerSession,R=c.FlippableHelpers,S=p.ErrorTypes,k=".react-file-viewer__preview iframe",D=e.createFactory(d),F=e.createFactory(h),x=e.createFactory(_),L=e.createFactory(m.PreviewImage),U=e.createFactory(f.PreviewImageWithAnnotations),B=e.createFactory(g.PreviewImageZoom),H=e.createFactory(v.PreviewLinkfile),q=e.createFactory(y),V=e.createFactory(E),W=e.createFactory(b.PreviewVideo),G=e.createClass({displayName:"FilePreview",propTypes:{file:e.PropTypes.shape({preview_type:e.PropTypes.string.isRequired}).isRequired,user:e.PropTypes.object,isFullscreen:e.PropTypes.bool,onCloseViewer:e.PropTypes.func,fileViewTarget:e.PropTypes.number.isRequired,fileViewOrigin:e.PropTypes.number.isRequired,fileViewAction:e.PropTypes.number.isRequired,sharedLinkUrl:e.PropTypes.string,maxFilenameEmLength:e.PropTypes.number.isRequired,areImagePreviewAnnotationsVisible:e.PropTypes.bool,shouldDisplayAnnotationsToolbar:e.PropTypes.bool,areActionablesEnabled:e.PropTypes.bool,index:e.PropTypes.number,count:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,shareToken:e.PropTypes.object,sharedLinkInfo:e.PropTypes.object,sharePermissions:e.PropTypes.object},getDefaultProps:function(){return{user:null,isFullscreen:!1,sharePermissions:null,areActionablesEnabled:!0}},getInitialState:function(){return{hasError:!1,filePreviewSession:null,errorType:null}},componentWillReceiveProps:function(e){return I.areEqual(e.file,this.props.file)?void 0:(this.setState({hasError:!1,errorType:null}),this._viewAttempts=0,this._logPreviewSessionEnded(),this._startNewFilePreviewSession(e.file))},componentWillMount:function(){return this._startNewFilePreviewSession(this.props.file)},componentDidMount:function(){return this._startLogger(),this._viewAttempts=0,this._logView(this.state.hasError),window.addEventListener("beforeunload",this._logPreviewSessionEnded)},componentDidUpdate:function(e,t){return e.file!==this.props.file||t.hasError!==this.state.hasError?this._logView(this.state.hasError):void 0},componentWillUnmount:function(){return this._logPreviewSessionEnded(),this._stopLogger(),this._teardownFilePreviewLogger(),window.removeEventListener("beforeunload",this._logPreviewSessionEnded)},_startLogger:function(){return this._frameMessenger=new n,this._frameMessenger.configureChildMessaging(k,this._onFrameMessage,["pagerendered"]),this._frameMessenger.startListening()},_stopLogger:function(){return this._frameMessenger.stopListening()},_onFrameMessage:function(e){switch(e.action){case"pagerendered":return i.logPageRendered(this.props.file,e.parameters)}},_logView:function(e){var t,n,o,r;return null==e&&(e=!1),this._viewAttempts++,t=0===(null!=(n=this.props.sharePermissions)&&null!=(o=n.canDownloadRoles)?o.length:void 0),r=M.determineSourceContext(),r!==j.SHARED_LINK_COLLECTION?i.logView(this.props.file,this.props.user,this.props.fileViewTarget,this.props.fileViewOrigin,this.props.fileViewAction,this.props.sharedLinkUrl,this._viewAttempts,e,t):void 0},_logPreviewSessionEnded:function(){this.state.filePreviewSession.recordEvent(C.FILE_PREVIEW_SESSION_ENDED)},_setUpFilePreviewLogger:function(e){return null!=this._filePreviewTimelineLogger&&this._filePreviewTimelineLogger.unlistenTo(l),this._filePreviewTimelineLogger=new A(e.id),this._filePreviewTimelineLogger.listenTo(l)},_startNewFilePreviewSession:function(e){var t;return t=P.currentSession=new P({fileViewerSession:N.currentSession,file:e}),this.setState({filePreviewSession:t}),this._setUpFilePreviewLogger(t),t.recordEvent(C.FILE_PREVIEW_ATTEMPT_STARTED)},_teardownFilePreviewLogger:function(){return this._filePreviewTimelineLogger.unlistenTo(l),delete this._filePreviewTimelineLogger},_renderImagePreview:function(){var e,t,n,o,i,r,s;return t=this.props.file,n=M.get_extension(t),i=t.preview_url||t.thumbnail_url_tmpl,null==i?this._renderUnsupportedErrorPreview():(0===(null!=(r=this.props.sharePermissions)&&null!=(s=r.canViewContextMenuRoles)?s.length:void 0)&&(e=this._onContextMenu),this.props.isFullscreen?B({thumbnailUrlTmpl:i,fileExtension:n,isFlippable:!0,filePreviewSession:this.state.filePreviewSession,onContextMenu:e}):(o={"preview-url":i,"file-extension":M.get_extension(t),isFullscreen:this.props.isFullscreen,"should-display-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onError:this._triggerError,onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onContextMenu:e},this.props.areImagePreviewAnnotationsVisible?U(o):L(o)))},_onContextMenu:function(e){return e.preventDefault(),!0},_renderVideoPreview:function(){var e;return e=this.props.file,W({"preview-url":e.video_transcode_url,"thumbnail-url-tmpl":e.thumbnail_url_tmpl,"video-metadata-url":e.video_metadata_url,isFullscreen:this.props.isFullscreen,shouldDisplayAnnotationsToolbar:this.props.shouldDisplayAnnotationsToolbar,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext,filePreviewSession:this.state.filePreviewSession,onError:this._triggerError})},_renderLinkfilePreview:function(){var e;return e=this.props.file,H({filename:M.get_filename(e),data:e.linkfile_data,source:e.linkfile_data.authenticated?"browse":"sharedlink",filePreviewSession:this.state.filePreviewSession})},_renderPDFPreview:function(){var e,t,n;return e=this.props.file,t=M.get_extension(e),q({fileExtension:t,fqPath:e.fq_path,isFullscreen:this.props.isFullscreen,onCloseViewer:this.props.onCloseViewer,onError:this._triggerError,previewStatus:e.doc_preview_status,previewType:e.preview_type,previewUrl:e.preview_url,src:e.direct_blockserver_link,userId:null!=(n=this.props.user)?n.id:void 0,forceServeFromDLDoc:O.force_serve_from_dldoc(),isSharedLink:null!=this.props.sharedLinkUrl,sharePermissions:this.props.sharePermissions,filePreviewSession:this.state.filePreviewSession})},_renderHTMLPreview:function(){var e,n,o,i,r,s;if(e=this.props.file,n=M.get_extension(e),"excel"===e.preview_type){if(o=null!=e.direct_blockserver_link?e.direct_blockserver_link:e.href,i=M.normalize_extension(n),r=M.get_progressive_url(i,o),O.is_password_protected_preview_enabled()&&e.doc_preview_status===t.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC)return this._renderPasswordProtectedPreview(r,n)}else r=null!=e.htmlified_link?e.htmlified_link:e.href;return null==r?this._renderUnsupportedErrorPreview():(s=M.usesFrameMessenger(e.preview_type),x({src:r,previewType:e.preview_type,isFullscreen:this.props.isFullscreen,onError:this._triggerError,fileExtension:n,fileDocPreviewStatus:e.doc_preview_status,filePreviewType:e.preview_type,usesFrameMessenger:s,sharePermissions:this.props.sharePermissions,filePreviewSession:this.state.filePreviewSession}))},_renderAudioPreview:function(){var e;return e=this.props.file,D({src:e.direct_blockserver_link,onError:this._triggerError,filePreviewSession:this.state.filePreviewSession})},_renderPasswordProtectedPreview:function(e,t){var n;return n=this.props.file,V({filename:M.get_filename(n),fileExtension:t,icon:n.icon,size:n.size,created:new Date(1e3*n.ts),fileUrl:e,previewType:n.preview_type})},_renderUnsupportedErrorPreview:function(){return this._renderErrorPreview(S.SUPPORT_ERROR)},_renderErrorPreview:function(e){var t;return t=this.props.shouldDisplayAnnotationsToolbar&&R.isFlippableFile(this.props.file),F({file:this.props.file,maxFilenameEmLength:this.props.maxFilenameEmLength,filePreviewSession:this.state.filePreviewSession,errorType:e,user:this.props.user,areActionablesEnabled:this.props.areActionablesEnabled,sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,shouldDisplayAnnotationsToolbar:t,index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext})},_triggerError:function(e){return this.setState({hasError:!0,errorType:e})},_choosePreview:function(){var e;if(!M.extensionSupported(this.props.file))return this._renderErrorPreview(S.EXTENSION_ERROR);if(!M.filesizeSupported(this.props.file))return this._renderErrorPreview(S.FILE_SIZE_ERROR);if(!M.browserSupported(this.props.file))return this._renderUnsupportedErrorPreview();switch(e=M.get_extension(this.props.file),this.props.file.preview_type){case"photo":return this._renderImagePreview();case"video":return this._renderVideoPreview();case"linkfile":return this._renderLinkfilePreview();case"adobecs":case"doc":return"indd"!==e||O.is_indesign_preview_enabled()?this._renderPDFPreview():this._renderErrorPreview(S.EXTENSION_ERROR);case"excel":return O.use_excel2_for_extension(e)?this._renderPDFPreview():this._renderHTMLPreview();case"html":case"text":return this._renderHTMLPreview();case"audio":return this._renderAudioPreview();default:return w.assert(!1,"Preview type "+this.props.file.preview_type+" in VALID_PREVIEW_TYPES but not implemented")}},render:function(){return this.state.hasError?this._renderErrorPreview(this.state.errorType):this._choosePreview()}})})}.call(this),function(){define("modules/clean/react/file_viewer/file_preview_event_emitter",["modules/clean/event_emitter"],function(e){return new e})}.call(this),function(){define("modules/clean/react/file_viewer/file_preview_update_watcher",["modules/clean/notifications/file_watcher","modules/clean/notifications/updated_file_notification","modules/core/visibility"],function(e,t,n){var o;return o=function(){function o(e,t,n){this.file=e,this.user=t,this.refresh=n,this._watchFile()}return o.prototype.stop=function(){return this._hideUpdatedFileNotification(),this._unwatchFile()},o.prototype._watchFile=function(){return this._subscription=e.subscribe(this.file,this.user,this._onFileUpdate.bind(this))},o.prototype._unwatchFile=function(){var e;return null!=(e=this._subscription)&&e.cancel(),delete this._subscription},o.prototype._showUpdatedFileNotification=function(){return this._subscription?(this._hideUpdatedFileNotification(),this._notification=new t(this._onRefresh.bind(this))):void 0},o.prototype._hideUpdatedFileNotification=function(){var e;return null!=(e=this._notification)&&e.hide(),delete this._notification},o.prototype._onFileUpdate=function(){return n.when().then(this._showUpdatedFileNotification.bind(this))},o.prototype._onRefresh=function(){return this._subscription?(this._hideUpdatedFileNotification(),this.refresh(this._subscription.file)):void 0},o}()})}.call(this),function(){define("modules/clean/react/file_viewer/file_viewer",["jquery","external/keymaster","external/react","external/react-dom","external/underscore","modules/clean/activity/constants","modules/clean/analytics","modules/clean/comments/store","modules/clean/css","modules/clean/file_events","modules/clean/gandalf_util","modules/clean/history","modules/clean/image_preview_util","modules/clean/loggers/file_preview_logger","modules/clean/loggers/file_viewer_logger","modules/clean/previews/util","modules/clean/react/browse/models","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/file_preview","modules/clean/react/file_viewer/file_preview_update_watcher","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/store","modules/clean/react/file_viewer/title_bar","modules/clean/react/file_viewer/utils","modules/clean/react/pass/utils","modules/clean/react/previews/image_helpers","modules/clean/react/previews/preview_quality_popup","modules/clean/web_timing_logger","modules/constants/comments_panel","modules/constants/file_viewer","modules/constants/python","modules/core/dom","modules/core/notify","modules/core/uri","modules/core/visibility","require"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M){var L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$,J,X,ee,te;return L=r.ActivityContext,$=s.ShareTibEventLogger,B=h.FilePreviewTimelineLogger,K=m.PreviewHelper,U=f.File,H=b.FileViewerSession,V=S.FlippableHelpers,z=C.PassHelpers,Y=P.PreviewQualityPopup,ee=o.findDOMNode,X=n.DOM.div,q=n.createFactory(E),Q=n.createFactory(v),J=n.createFactory(T),W="fileviewer",j="",G=35,te="",Z=n.createClass({displayName:"FileViewer",propTypes:{fileViewTarget:n.PropTypes.number.isRequired,fileViewOrigin:n.PropTypes.number.isRequired,fileViewAction:n.PropTypes.number.isRequired,disableRouting:n.PropTypes.bool,skipOuterRouting:n.PropTypes.bool,canClose:n.PropTypes.bool,onCloseViewer:n.PropTypes.func,onComponentDidMount:n.PropTypes.func,onComponentWillUnmount:n.PropTypes.func,shareHelpers:n.PropTypes.object,activityContext:n.PropTypes.number.isRequired,hideComments:n.PropTypes.bool,oref:n.PropTypes.string,shouldFocusCommentInput:n.PropTypes.bool,hidePageChrome:n.PropTypes.bool,isVersionHistoryMode:n.PropTypes.bool,canRestoreRevision:n.PropTypes.bool,onRestoreRevision:n.PropTypes.func,accountMenuOptions:n.PropTypes.object},getDefaultProps:function(){return{onCloseViewer:null,onComponentDidMount:null,onComponentWillUnmount:null,forceFileUnlocked:!1,shouldFocusCommentInput:!1,hideComments:!1,disableRouting:!1,skipOuterRouting:!1,oref:k.OREF_CONSTANTS.BROWSE_UNKNOWN,hidePageChrome:!1,canClose:!1,isVersionHistoryMode:!1,canRestoreRevision:!1,onRestoreRevision:null}},getInitialState:function(){var e;return e=this._getStateFromStore(),e.commentsLoaded=M.defined("modules/clean/comments/components/file_comments_pane_container"),e},componentWillMount:function(){return this._setUpLogging()},componentDidMount:function(){var t,n;return"function"==typeof(t=this.props).onComponentDidMount&&t.onComponentDidMount(),this.props.hidePageChrome||M(["modules/clean/comments/components/file_comments_pane_container"],function(e){return function(){return e.isMounted()?e.setState({commentsLoaded:!0}):void 0}}(this)),this._flipNext=i.throttle(this._flipNext,100),this._flipPrevious=i.throttle(this._flipPrevious,100),this._removeStoreListener=w.addListener(this._onUpdateFromStore),this._watchFile(this.state.currentFile),this._setupPreviewUrl(this.state.currentFile),this._setupKeymaster(),this._preloadImages(this.state.files,this.state.currentIndex),this._setDocumentTitle(K.get_filename(this.state.currentFile),!0),O.scroll_lock_document(),z.setup(this.state.user,this.state.currentFile,this.state.shareToken,null!=(n=this.state.sharedLinkInfo)?n.url:void 0,null,null),e(window).on("beforeunload.fileviewerpresence",function(e){return function(){z.teardown(e.state.user,e.state.currentFile,e.state.shareToken,!1)}}(this)),this._focusInViewer(),_.start()},componentWillUpdate:function(e,t){var n,o;return n=t.currentFile,this._watchFile(n),this._updatePreviewUrl(n),this._setDocumentTitle(K.get_filename(n)),this._preloadImages(t.files,t.currentIndex),key.setScope(W),U.areEqual(n,this.state.currentFile)?void 0:z.setup(t.user,n,t.shareToken,null!=(o=t.sharedLinkInfo)?o.url:void 0,this.state.currentFile,this.state.shareToken)},componentWillUnmount:function(){var t;return this._removeStoreListener(),this._unwatchFile(),this._teardownPreviewUrl(),this._cleanupKeymaster(),this._unsetDocumentTitle(),O.scroll_unlock_document(),z.teardown(this.state.user,this.state.currentFile,this.state.shareToken,!0),e(window).off("beforeunload.fileviewerpresence"),"function"==typeof(t=this.props).onComponentWillUnmount?t.onComponentWillUnmount():void 0},_getStateFromStore:function(){return{files:w.files(),currentIndex:w.currentIndex(),currentFile:w.currentFile(),user:w.user(),sharedLinkInfo:w.sharedLinkInfo(),shareToken:w.shareToken(),sharePermissions:w.sharePermissions(),isFullscreen:w.isFullscreen()}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore())},_getActivityContextData:function(){var e;switch(e=this.state.currentFile,this.props.activityContext){case L.BROWSE_FILE_VIEWER:return e.fq_path;case L.SHARED_LINK_VIEW:return this.state.sharedLinkInfo.url;case L.SHARED_CONTENT_LINK_VIEW:return this.state.sharedLinkInfo.url;default:return null}},_setUpLogging:function(){var e,t,n,o;return n=K.determineSourceContext(),H.currentSession=new H({sourceContext:n}),this.props.fileViewTarget===k.FileViewTargetType.SHARED_CONTENT_LINK&&(o=A.start_time(),e=(new Date).getTime(),t="PREVIEW_PAGE",this.state.user)?$.log(this.state.user.id,"PREVIEW_RENDER",t,{timing:e-o,containing_ns_id:this.state.currentFile.ns_id,sjid:this.state.currentFile.sjid}):void 0},_watchFile:function(e){return c.getGandalfRule("tap_to_refresh")&&null!=this.state.user?(this._unwatchFile(),this.watcher=new y(e,this.state.user,this._loadUpdatedFile)):void 0},_loadUpdatedFile:function(e){return this.watcher?g.replaceFile(e):void 0},_unwatchFile:function(){var e;return null!=(e=this.watcher)&&e.stop(),delete this.watcher},_setupPreviewUrl:function(e){return this.props.skipOuterRouting?void 0:this._setPreviewUrl(e)},_updatePreviewUrl:function(e){return this._setPreviewUrl(e,!1)},_teardownPreviewUrl:function(){return this.props.skipOuterRouting?void 0:this._unsetPreviewUrl()},_setPreviewUrl:function(e,t){var n,o,i,r;return null==t&&(t=!0),this.props.disableRouting?void 0:(i=K.get_filename(e),n=F.parse(d.get_url()),o=F.encode_parts(n.getPath()),r=n.removeQuery("select").updateQuery({preview:i}).getQuery(),t?d.push_state(o,r,{immediatelyRestoreState:!1}):d.replace_state(o,r))},_unsetPreviewUrl:function(){var e,t,n;return this.props.disableRouting?void 0:(e=F.parse(d.get_url()),t=F.encode_parts(e.getPath()),n=e.removeQuery("select").removeQuery("preview").getQuery(),d.push_state(t,n,{immediatelyRestoreState:!1}))},_focusInViewer:function(){var e,t;if(!this.props.shouldFocusCommentInput){if(t=ee(this).querySelector(".button-primary"))return t.focus();if(e=O.getTabbableElementsIn(".react-file-viewer"),e.length)return e[0].focus()}},_flipNext:function(){return g.flipNext()},_flipPrevious:function(){return g.flipPrevious()},_setupKeymaster:function(){return V.isFlippableFile(this.state.currentFile)&&(key("left",W,function(e){return function(t){return e._flipPrevious()}}(this)),key("right",W,function(e){return function(t){return e._flipNext()}}(this))),key("esc",W,function(e){return function(t){var n;return O.focus_in_input()||O.is_input(t.target)||document.querySelector(".annotation-bubble")?void 0:"function"==typeof(n=e.props).onCloseViewer?n.onCloseViewer():void 0}}(this)),j=key.getScope(),key.setScope(W)},_cleanupKeymaster:function(){return key.clearScope(W),key.setScope(j)},_preloadImages:function(e,t){var n,o,i,r,s,a,l,u,c;if(0!==e.length){for(l=[0,1,2,3,4,5,6,-1,-2],c=[],r=0,s=l.length;s>r;r++)o=l[r],i=t+o,i>=0&&i<e.length&&"photo"===(null!=(u=e[i])?u.preview_type:void 0)?(n=e[i],a=n.preview_url||n.thumbnail_url_tmpl,c.push(I.preloadImage(a))):c.push(void 0);return c}},_setDocumentTitle:function(e,t){return null==t&&(t=!1),t&&(te=document.title),document.title=e},_unsetDocumentTitle:function(){return""!==te?document.title=te:void 0},_renderFlippableControls:function(){return V.isFlippableFile(this.state.currentFile)&&!this.state.isFullscreen?q({index:""+(this.state.currentIndex+1),numFlippableFiles:this.state.files.length,onNext:this._flipNext,onPrevious:this._flipPrevious}):void 0},_renderFilePreview:function(){var e,t;return e=!this.props.hidePageChrome,X({className:"react-file-viewer__preview react-file-preview"},X({className:"flex-preview-container"},c.getGandalfRule("docpreview-quality-popup-enabled")?this._renderPreviewQualityPopup():void 0,Q({file:this.state.currentFile,fileViewTarget:this.props.fileViewTarget,fileViewOrigin:this.props.fileViewOrigin,fileViewAction:this.props.fileViewAction,sharedLinkUrl:null!=(t=this.state.sharedLinkInfo)?t.url:void 0,isFullscreen:this.state.isFullscreen,onCloseViewer:this.props.onCloseViewer,user:this.state.user,maxFilenameEmLength:G,areImagePreviewAnnotationsVisible:e,shouldDisplayAnnotationsToolbar:e,areActionablesEnabled:!this.props.hidePageChrome,index:this.state.currentIndex,count:this.state.files.length,onPrevious:this._flipPrevious,onNext:this._flipNext,shareToken:this.state.shareToken,sharePermissions:this.state.sharePermissions,sharedLinkInfo:this.state.sharedLinkInfo})),e?void 0:this._renderFlippableControls())},_renderComments:function(){var e,t,o,i;return this.props.hidePageChrome||this.props.hideComments?null:this.state.commentsLoaded?(t=M("modules/clean/comments/components/file_comments_pane_container"),e=this._getActivityContextData(),o=".react-file-viewer__preview .flex-preview-container",X({className:"react-file-viewer__activity"},n.createElement(t,{actorId:null!=(i=this.state.user)?i.id:void 0,context:this.props.activityContext,contextData:e,currentFile:this.state.currentFile,previewSelector:o,shouldInitiallyFocusInput:this.props.shouldFocusCommentInput}))):this.state.currentFile.feedback_off||a.areCommentsHidden()?X():X({id:"file-comments",className:"file-feedback"},X({className:"comments-holder"}))},_renderTitleBar:function(){return this.props.hidePageChrome?null:X({className:"react-file-viewer__title-bar"},J({shareToken:this.state.shareToken,sharePermissions:this.state.sharePermissions,file:this.state.currentFile,user:this.state.user,maxFilenameEmLength:G,canClose:this.props.canClose,onCloseViewer:this.props.onCloseViewer,shareHelpers:this.props.shareHelpers,sharedLinkInfo:this.state.sharedLinkInfo,isVersionHistoryMode:this.props.isVersionHistoryMode,canRestoreRevision:this.props.canRestoreRevision,onRestoreRevision:this.props.onRestoreRevision,accountMenuOptions:this.props.accountMenuOptions}))},_renderPreviewQualityPopup:function(){return this.props.hidePageChrome?null:null!=this.state.sharedLinkInfo||this.state.user.root_ns!==this.state.currentFile.ns_id?null:n.createElement(Y,{showalways:c.getGandalfRule("docpreview-quality-popup-always"),file:this.state.currentFile})},render:function(){var e;return e=K.get_filename(this.state.currentFile),this.state.isFullscreen?X({className:"react-file-viewer",role:"dialog","aria-label":e},this._renderFilePreview()):X({className:"react-file-viewer",role:"dialog","aria-label":e},this._renderTitleBar(),X({className:"react-file-viewer__content"},this._renderFilePreview(),this._renderComments()))}})})}.call(this),function(){define("modules/clean/react/file_viewer/flippable_controls",["external/react","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n){var o,i,r,s,a;return a=e.DOM,r=a.button,s=a.div,i=n._,o=e.createClass({displayName:"FlippableControls",propTypes:{index:e.PropTypes.string.isRequired,numFlippableFiles:e.PropTypes.number.isRequired,onNext:e.PropTypes.func,onPrevious:e.PropTypes.func},_handlePreviousClick:function(){var e;return"function"==typeof(e=this.props).onPrevious?e.onPrevious():void 0},_handleNextClick:function(){var e;return"function"==typeof(e=this.props).onNext?e.onNext():void 0},render:function(){return this.props.numFlippableFiles>1?s({
className:"react-file-viewer__controls"},r({onClick:this._handlePreviousClick,className:"nav-control"},e.createElement(t,{group:"web",name:"s_flip_left",alt:i("Flip left",{comment:"Flip to the previous file in a series of files"})})),s({className:"nav-text"},i("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index,num_total_files:this.props.numFlippableFiles})),r({onClick:this._handleNextClick,className:"nav-control"},e.createElement(t,{group:"web",name:"s_flip_right",alt:i("Flip right",{comment:"Flip to the next file in a series of files"})}))):null}})})}.call(this),function(){define("modules/clean/react/file_viewer/full_screen_helpers",["jquery","modules/clean/react/file_viewer/actions"],function(e,t){var n;return n={setupFullscreen:function(t){return t&&(e(document).on("fullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("webkitfullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("msfullscreenchange.preview",this._setupExitFullscreenListeners),e(document).on("mozfullscreenchange.preview",this._setupExitFullscreenListeners)),this.setBrowserFullscreen(t)},_setupExitFullscreenListeners:function(){return e(document).off("fullscreenchange.preview"),e(document).off("webkitfullscreenchange.preview"),e(document).off("msfullscreenchange.preview"),e(document).off("mozfullscreenchange.preview"),e(document).on("fullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("webkitfullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("msfullscreenchange.preview",t.closeFullscreen.bind(t)),e(document).on("mozfullscreenchange.preview",t.closeFullscreen.bind(t))},teardownExitFullscreenListeners:function(){return e(document).off("fullscreenchange.preview"),e(document).off("webkitfullscreenchange.preview"),e(document).off("msfullscreenchange.preview"),e(document).off("mozfullscreenchange.preview")},setBrowserFullscreen:function(t){var n;if(n=e("body")[0],t){if(null!=n.requestFullscreen)return n.requestFullscreen();if(null!=n.msRequestFullscreen)return n.msRequestFullscreen();if(null!=n.mozRequestFullScreen)return n.mozRequestFullScreen();if(null!=n.webkitRequestFullscreen)return n.webkitRequestFullscreen()}else{if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()}}},{FullscreenHelpers:n}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/models",["external/immutable","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/uuid","modules/constants/file_viewer","modules/core/exception"],function(t,o,i,r,s,a){var l,u,c,d,p,h;return l=o.EventTypes,h={},p={},p[l.FILE_PREVIEW_ATTEMPT_STARTED]=null,p[l.FILE_PREVIEW_SUPPORT_CONFIRMED]=l.FILE_PREVIEW_ATTEMPT_STARTED,p[l.FILE_PREVIEW_SUPPORT_DENIED]=l.FILE_PREVIEW_ATTEMPT_STARTED,p[l.FILE_PREVIEW_DOWNLOAD_ATTEMPTED]=l.FILE_PREVIEW_SUPPORT_CONFIRMED,p[l.FILE_PREVIEW_DOWNLOAD_SUCCEEDED]=l.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,p[l.FILE_PREVIEW_DOWNLOAD_FAILED]=l.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,p[l.FILE_PREVIEW_RENDER_SUCCEEDED]=l.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,p[l.FILE_PREVIEW_RENDER_FAILED]=l.FILE_PREVIEW_DOWNLOAD_SUCCEEDED,d=t.Record({id:void 0,sourceContext:void 0}),c=function(t){function n(e){var t;t=e.sourceContext,n.__super__.constructor.call(this,{id:r.v4({allowInsecure:!0}),sourceContext:t})}return e(n,t),n.currentSession=null,n}(d),u=function(){function e(e){var t,n;n=e.fileViewerSession,t=e.file,a.assert(n,"FileViewerSession required"),a.assert(t,"File required"),this.id=r.v4({allowInsecure:!0}),this.fileViewerSession=n,this.file=t,this.previewTimeline={},this.lastEvent=null,this.size=null,this.previewSize=void 0}return e.currentSession=null,e.prototype.recordEvent=function(e,t){if(null==t&&(t={}),!(t instanceof Object))throw new Error("extra param of recordEvent should be an object.");return e in l&&!this._isEventInTimeline(e)?e in p&&this.lastEvent!==p[e]?void(s.FILE_VIEWER_LOGGER_ERRORS&&a.raiseAndReport("FilePreviewLogger event called out of order",{tags:["file_preview_logger_bad_event_order"],severity:a.SEVERITY.NONCRITICAL,exc_extra:{event:e,sourceContext:this.fileViewerSession.sourceContext,file:this.file}})):(this._addToTimeline(e),i.emit(e,this,t),this.lastEvent=e):void 0},e.prototype._isEventInTimeline=function(e){return n.call(this.previewTimeline,e)>=0},e.prototype._addToTimeline=function(e){return this.previewTimeline[e]={timestamp:Date.now()}},e}(),h.FileViewerSession=c,h.FilePreviewSession=u,h})}.call(this),function(){define("modules/clean/react/file_viewer/more_dropdown",["external/react","modules/clean/previews/util","modules/clean/react/bubble_menu","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f,g,v,y,E,b,w;return f=t.PreviewHelper,d=n.BubbleMenu,h=o.FileActionButtonType,p=o.FileActionButton,m=r.MoreOptionOrOptionGroup,v=u._,g=e.createFactory(s),w=e.DOM,b=w.div,y=w.button,E=e.createElement,_=e.createClass({displayName:"MoreDropdown",propTypes:{allowRemoveLink:e.PropTypes.bool,file:e.PropTypes.object.isRequired,user:e.PropTypes.object,isPrivate:e.PropTypes.bool.isRequired,onRemoveShareLink:e.PropTypes.func},getInitialState:function(){return this._getStateFromRegistry()},componentDidMount:function(){return this._removeRegistryListener=i.addListener(this._onRegistryUpdate)},componentWillUnmount:function(){return this._removeRegistryListener()},_onRegistryUpdate:function(){return this.setState(this._getStateFromRegistry())},_getStateFromRegistry:function(){return{registeredItems:i.getOptionItems()}},_handleDownloadClick:function(e){var t;return e.preventDefault(),t=c.parse(this.props.file.href).updateQuery({dl:1}).toString(),l.redirect(t)},_handleRemoveLinkClick:function(e){return e.preventDefault(),this.props.onRemoveShareLink()},_handlePreviousVersionClick:function(e){return e.preventDefault(),f.redirectToVersionHistory(this.props.file,this.props.user)},_renderDropdownTarget:function(e){var t,n;return t=null!=(n=(null!=e?e:{}).isDisabled)?n:!1,y({className:"more-button button-secondary control__button",disabled:t},g({group:"web",name:"control_more",alt:v("More actions")}))},_renderRemoveShareLink:function(){return E(p,{className:"more-button__remove",type:h.REMOVE_LINK,callback:this._handleRemoveLinkClick})},_getDropdownItems:function(){var e;return e=[],null!=this.props.onRemoveShareLink&&this.props.allowRemoveLink&&e.push(this._renderRemoveShareLink()),this.props.isPrivate&&(e.push(E(p,{className:"more-button__download",type:h.DOWNLOAD,callback:this._handleDownloadClick})),e.push(E(p,{className:"more-button__version-history",type:h.PREVIOUS_VERSIONS,callback:this._handlePreviousVersionClick}))),e},render:function(){var e,t;return e=this._getDropdownItems(),t=this.state.registeredItems.map(function(e){return E(m,{item:e})}),e=e.concat(t),e.length?b({className:"u-mar-left-xs"},E(a,{content:v("More"),position:a.POSITIONS.BOTTOM,distanceFromTarget:10,className:"react-title-bar--title-bubble",isTargetPositionFixed:!0},E(d,{targetButton:this._renderDropdownTarget(),targetFixed:!0,position:d.POSITIONS.BOTTOM_LEFT,className:"react-file-viewer-dropdown",verticalDisplacement:4,items:e}))):b({className:"u-mar-left-xs"},this._renderDropdownTarget({isDisabled:!0}))}})})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_viewer/more_dropdown/models",["external/immutable","external/underscore"],function(t,n){var o,i,r;return o=t.Record({className:null,fileActionButtonType:null,handler:n.noop}),r=t.Record({options:[]}),i=function(t){function n(e){var t,i,r,s;if(null==e&&(e={options:[]}),s=e.options,!(s instanceof Array))throw new Error("MoreOptionGroup takes an object with an object key as an array");for(t=0,i=s.length;i>t;t++)if(r=s[t],!(r instanceof o))throw new Error("MoreOptionGroup can only be a collection of MoreOption objects");n.__super__.constructor.call(this,e)}return e(n,t),n}(r),{MoreOption:o,MoreOptionGroup:i}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_viewer/more_dropdown/more_option_registry",["external/immutable","external/underscore","modules/clean/react/file_viewer/more_dropdown/models"],function(t,n,o){var i,r,s,a;return i=o.MoreOption,r=o.MoreOptionGroup,a=function(){function e(){this._listeners=[]}return e.prototype.__emitChange=function(){return this._listeners.forEach(function(e){return e()})},e.prototype.addListener=function(e){if("function"!=typeof e)throw new Error("addListener expects a function");return this._listeners.push(e),function(t){return function(){var n;return t._listeners=function(){var t,o,i,r;for(i=this._listeners,r=[],t=0,o=i.length;o>t;t++)n=i[t],n!==e&&r.push(n);return r}.call(t)}}(this)},e}(),new(s=function(n){function o(){o.__super__.constructor.call(this),this._options=t.List()}return e(o,n),o.prototype._isValidMoreOption=function(e){return null!=e.fileActionButtonType},o.prototype._isValidMoreOptionGroup=function(e){var t;return t=e.options,t.length&&t.every(function(e){return function(t){return e._isValidMoreOption(t)}}(this))},o.prototype._isValidOption=function(e){return e instanceof i&&this._isValidMoreOption(e)||e instanceof r&&this._isValidMoreOptionGroup(e)},o.prototype.getOptionItems=function(){return this._options.toArray()},o.prototype.addOption=function(e){if(!this._isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");return this._options=this._options.push(e),this.__emitChange()},o.prototype.removeOption=function(e){var t;if(null!=e&&!this._isValidOption(e))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");return t=this._options.indexOf(e),t>=0?(this._options=this._options.delete(t),this.__emitChange()):void 0},o.prototype.replaceOption=function(e,t){var n;if(null==t)throw new Error("Please provide option to replace it with. Otherwise use removeOption");if(!this._isValidOption(e)||!this._isValidOption(t))throw new Error("Option needs to be a valid MoreOption or MoreOptionGroup");if(!e.equals(t))return n=this._options.indexOf(e),n>=0?(this._options=this._options.set(n,t),this.__emitChange()):void 0},o}(a))})}.call(this),function(){define("modules/clean/react/file_viewer/more_dropdown/views",["external/react","modules/clean/react/bubble_menu","modules/clean/react/file_action_button","modules/clean/react/file_viewer/more_dropdown/models"],function(e,t,n,o){var i,r,s,a,l,u,c,d;return i=t.BubbleMenuItemGroup,r=n.FileActionButton,s=o.MoreOption,l=o.MoreOptionGroup,d=e.createElement,a=e.createClass({displayName:"MoreOption",propTypes:{option:e.PropTypes.instanceOf(s).isRequired,closeFunc:e.PropTypes.func},render:function(){return d(r,{type:this.props.option.fileActionButtonType,className:this.props.option.className,callback:this.props.option.handler,closeFunc:this.props.closeFunc})}}),u=e.createClass({displayName:"MoreOptionGroup",propTypes:{optionGroup:e.PropTypes.instanceOf(l).isRequired,closeFunc:e.PropTypes.func},render:function(){var e;return e=this.props.optionGroup.options,d(i,{items:e.map(function(e){return d(a,{option:e})}),closeFunc:this.props.closeFunc})}}),c=e.createClass({displayName:"MoreOptionOrOptionGroup",propTypes:{item:e.PropTypes.oneOfType([e.PropTypes.instanceOf(s),e.PropTypes.instanceOf(l)]).isRequired,closeFunc:e.PropTypes.func},render:function(){var e;return e=this.props.item,e instanceof s?d(a,{option:e,closeFunc:this.props.closeFunc}):d(u,{optionGroup:e,closeFunc:this.props.closeFunc})}}),{MoreOptionComponent:a,MoreOptionGroupComponent:u,MoreOptionOrOptionGroup:c}})}.call(this),function(){define("modules/clean/react/file_viewer/mounted_file_actions",["external/react","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/title_bar/controls_container","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/core/i18n"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h,_,m,f,g;return _=o.ToggleCommentsContainer,d=r.ShareApiClient,g=s.deleteLinkWithConfirm,m=a._,l=e.createFactory(t),c=e.createFactory(n),h=e.createFactory(_),p=e.createFactory(i),f=e.DOM.button,u=e.createClass({displayName:"MountedFileActions",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,shareHelpers:e.PropTypes.object,isCommentingIntegrated:e.PropTypes.bool},getDefaultProps:function(){return{shareHelpers:null}},getInitialState:function(){return{linkMetadata:null}},componentDidMount:function(){return this._setupShare()},_setupShare:function(){var e;return e=new d({userId:this.props.user.id}),e.sharedLinkInfo({fileIdOrPath:this.props.file.fq_path}).then(function(e){return function(t){return e.isMounted()?e.setState({linkMetadata:t}):void 0}}(this))},_handleShareClick:function(){return this.props.shareHelpers.share(this.props.file.fq_path,this.props.user)},_removeShareLink:function(){var e,t;return e=new d({userId:this.props.user.id}),t=this.state.linkMetadata.url,g({client:e,contentName:this.state.linkMetadata.name,onCancel:null,onDeleteLink:function(e){return function(){return e.setState({linkMetadata:null})}}(this),url:t})},_renderToggleComments:function(){return this.props.isCommentingIntegrated?h():void 0},render:function(){var e;return p({},null!=this.props.shareHelpers?f({className:"share-button button-primary control__button",onClick:this._handleShareClick},m("Share")):void 0,c({file:this.props.file,user:this.props.user}),l({allowRemoveLink:null!=(e=this.state.linkMetadata)?e.link_permissions.can_revoke:void 0,file:this.props.file,user:this.props.user,isPrivate:!0,onRemoveShareLink:this._removeShareLink}),this._renderToggleComments())}})})}.call(this),function(){define("modules/clean/react/file_viewer/open_button",["external/classnames","external/react","external/underscore","modules/clean/open_with","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/open_button_coachmark","modules/clean/react/file_viewer/utils","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d){var p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R;return v=s.OpenWithHelpers,T=s.UnityHelpers,S=c._,N=t.DOM,C=N.a,I=N.button,P=N.div,A=N.li,R=N.ul,p=t.createFactory(i),g=t.createFactory(r),y=t.createFactory(a),E=t.createFactory(l),m="open-button",h=m+"__download",b=m+"__unity",_=m+"__open-with",w=m+"__unity-folder",f=t.createClass({displayName:"OpenButton",propTypes:{file:t.PropTypes.object.isRequired,user:t.PropTypes.object.isRequired,isUnityDisabled:t.PropTypes.bool,isOpenWithDisabled:t.PropTypes.bool,justifyRight:t.PropTypes.bool},getDefaultProps:function(){return{isUnityDisabled:!1,isOpenWithDisabled:!1,justifyRight:!0}},getInitialState:function(){return{coachmarkHidden:!1,unityInfo:null}},componentDidMount:function(){return T.isUnityEnabled()?this._setupUnity():void 0},componentDidUpdate:function(){var e;return null!=(e=this.refs.dropdown)?e.show():void 0},_hideCoachmark:function(){return this.setState({coachmarkHidden:!0})},_setupUnity:function(){return this.props.isUnityDisabled?void this._disableUnity():(T.getUnityFileInfo(this.props.file.ns_id,this.props.file.ns_path,this.props.user.id,function(e){return function(t){return e.isMounted()?e.setState({unityInfo:t}):void 0}}(this),this._disableUnity),window.setTimeout(function(e){return function(){return null===e.state.unityInfo?e._disableUnity():void 0}}(this),1e4))},_disableUnity:function(){return this.isMounted()?this.setState({unityInfo:{can_open_directly:!1,is_locally_available:!1}}):void 0},_hasUnityFolderSupport:function(){return!this.props.isUnityDisabled&&null!=this.state.unityInfo&&this.state.unityInfo.is_locally_available&&T.clientSupportsOpenInFileBrowser()},_hasUnityFileSupport:function(){return!this.props.isUnityDisabled&&null!=this.state.unityInfo&&this.state.unityInfo.can_open_directly!==!1},_hasOpenWithSupport:function(){return!this.props.isOpenWithDisabled&&v.canOpenWith(this.props.file,this.props.user)},_getNumEnabled:function(){return(this._hasOpenWithSupport()?1:0)+(this._hasUnityFileSupport()?1:0)+(this._hasUnityFolderSupport()?1:0)},_isDropdownDisabled:function(){return this._getNumEnabled()<2},_isButtonDisabled:function(){return null===this.state.unityInfo},_getFileBrowserLabel:function(){var e,t;return e=(null!=(t=this.state.unityInfo)?t.file_browser_display_name:void 0)||S("File Browser"),S("Show in %(file_browser)s").format({file_browser:e})},_getNativeAppLabel:function(){var e,t;return e=(null!=(t=this.state.unityInfo)?t.open_application_name:void 0)||S("Desktop"),S("Open in %(app_name)s").format({app_name:e})},_onClickAnyOpenButtonType:function(){return this._hideCoachmark()},_handleUnityFileClick:function(e){var t;return this._onClickAnyOpenButtonType(),t=this.props.file,T.openFile(t.ns_id,t.ns_path,this.props.user.id),null!=e?e.preventDefault():void 0},_handleUnityFolderClick:function(e){var t;return this._onClickAnyOpenButtonType(),t=this.props.file,T.openFile(t.ns_id,t.ns_path,this.props.user.id,!0),null!=e?e.preventDefault():void 0},_handleOpenWithClick:function(e){return this._onClickAnyOpenButtonType(),v.openWith(this.props.file,this.props.user),null!=e?e.preventDefault():void 0},_handleDownloadClick:function(e){var t;return this._onClickAnyOpenButtonType(),t=d.parse(this.props.file.href).updateQuery({dl:1}).toString(),u.redirect(t),null!=e?e.preventDefault():void 0},_renderCoachmark:function(e,t){return P({className:"c-coach-mark__container"},e,this.state.coachmarkHidden?void 0:g({file:this.props.file,user:this.props.user,inDropdown:t}))},_renderMainButton:function(){var t,n,i,r;return t={"button-secondary":!0,"c-split-btn":!this._isDropdownDisabled(),"c-split-btn--left":!this._isDropdownDisabled(),control__button:!0,disabled:this._isButtonDisabled()},this._hasUnityFileSupport()?(t[b]=!0,i=I({ref:"openButton",className:e(t),onClick:this._handleUnityFileClick},S("Open")),o.is_adobe_app(null!=(r=this.state.unityInfo)?r.open_application_identifier:void 0)?this._renderCoachmark(i,!1):i):this._hasUnityFolderSupport()?(t[w]=!0,I({ref:"openButton",className:e(t),onClick:this._handleUnityFolderClick},S("Open"))):this._hasOpenWithSupport()&&!this._isButtonDisabled()?(t[_]=!0,n=I({ref:"openButton",className:e(t),onClick:this._handleOpenWithClick},S("Open")),this._renderCoachmark(n,!1)):this._isButtonDisabled()?I({ref:"openButton",className:e(t)},""):(t[h]=!0,I({ref:"openButton",className:e(t),onClick:this._handleDownloadClick},S("Download")))},_renderSplitButton:function(){var t,n,o,i;return n=v.getOpenWithHandlerData(this.props.file,this.props.user),i=e(["button-secondary","c-split-btn","c-split-btn--right","c-split-btn--dropdown","control__button"]),o=I({className:i},y({group:"web",name:"control_menu",alt:S("More options")})),t=p({targetButton:o,arrow_position:this.props.justifyRight?"top-right":"top",extra_css_class:"react-file-viewer-dropdown",vertical_displacement:4,bubbleDropdownShown:this._hideCoachmark},R({className:"dropdown-contents"},this._hasUnityFileSupport()?A({},C({href:"#",className:b,onClick:this._handleUnityFileClick},E({group:"web",name:"ow_desktop",text:this._getNativeAppLabel()}))):void 0,this._hasOpenWithSupport()?A({},C({href:"#",className:_,onClick:this._handleOpenWithClick},E({group:"web",name:null!=n?n.icon:void 0,text:null!=n?n.name:void 0}))):void 0,this._hasUnityFolderSupport()?A({},C({href:"#",className:w,onClick:this._handleUnityFolderClick},E({group:"web",name:"ow_folder",text:this._getFileBrowserLabel()}))):void 0)),this._renderCoachmark(t,!0)},render:function(){return P({className:"c-split-btn-container "+m},this._renderMainButton(),this._isDropdownDisabled()?void 0:this._renderSplitButton())}})})}.call(this),function(){define("modules/clean/react/file_viewer/open_button_coachmark",["external/modernizr","external/react","modules/clean/previews/util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/coach_mark","modules/clean/react/file_viewer/utils","modules/clean/react_format","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f;return d=n.PreviewHelper,p=r.TooltipHelpers,_=s.reactFormat,f=a.static_url,h=l._,m=function(e){return _(e,{strong:t.DOM.strong()})},u=t.createFactory(i),c=t.createClass({displayName:"OpenButtonCoachmark",propTypes:{file:t.PropTypes.object.isRequired,user:t.PropTypes.object.isRequired,inDropdown:t.PropTypes.bool.isRequired},getInitialState:function(){return{vendor:null,application:null}},setCoachmarkConfig:function(e,t){return this.setState({vendor:e,application:t})},clearCoachmarkConfig:function(){return this.setCoachmarkConfig(null,null)},onReceiveTooltipInfo:function(e){var t,n,o,i;return n=d.get_extension(this.props.file),o=p.getVendorAndApplication(e,n),null!==o?(i=o.vendor,t=o.application,this.setCoachmarkConfig(i,t)):void 0},componentDidMount:function(){return p.fetchTooltipInfo(this.props.user.id,this.onReceiveTooltipInfo)},hasCoachmark:function(){return this.state.vendor&&this.state.application},dismissCoachmark:function(){return this.clearCoachmarkConfig()},onCoachmarkShown:function(){var e;return e=d.get_extension(this.props.file),p.logImpression(e,this.props.user.id,this.state.application)},onCoachmarkButtonClick:function(){return this.dismissCoachmark()},_renderCoachmark:function(e){var t,n,o,i,r,s;return s=e.title,o=e.imageUrl,i=e.imageUrl2x,n=e.imageAlt,r=e.openButtonBody,t=e.dropdownBody,u({title:s,imageUrl:o,imageUrl2x:i,imageAlt:n,buttonText:h("Got it."),onButtonClick:this.onCoachmarkButtonClick,onShown:this.onCoachmarkShown},this.props.inDropdown?t:r)},_renderMsftWord:function(){return this._renderCoachmark({title:h("Edit shared docs together"),imageUrl:f("/static/images/file_viewer/coach_mark_docx-vflGsxySJ.png"),imageUrl2x:f("/static/images/file_viewer/coach_mark_docx@2x-vflJZIQKs.png"),imageAlt:h("An illustration of a Word file"),buttonText:h("Got it."),openButtonBody:m(h("Click <strong>open</strong> to edit together in Microsoft Word Online.")),dropdownBody:m(h("Choose <strong>Microsoft Word Online</strong> to edit together."))})},_renderMsftExcel:function(){return this._renderCoachmark({title:h("Edit shared spreadsheets together"),imageUrl:f("/static/images/file_viewer/coach_mark_xlsx-vflaEwaN7.png"),imageUrl2x:f("/static/images/file_viewer/coach_mark_xlsx@2x-vflkU3Ma1.png"),imageAlt:h("An illustration of an Excel file"),openButtonBody:m(h("Click <strong>open</strong> to edit together in Microsoft Excel Online.")),dropdownBody:m(h("Choose <strong>Microsoft Excel Online</strong> to edit together."))})},_renderMsftPowerpoint:function(){return this._renderCoachmark({title:h("Edit shared presentations together"),imageUrl:f("/static/images/file_viewer/coach_mark_pptx-vfltjppV8.png"),imageUrl2x:f("/static/images/file_viewer/coach_mark_pptx@2x-vflpvn3tE.png"),imageAlt:h("An illustration of a Powerpoint file"),openButtonBody:m(h("Click <strong>open</strong> to edit together in Microsoft PowerPoint Online.")),dropdownBody:m(h("Choose <strong>Microsoft PowerPoint Online</strong> to edit together."))})},_renderAdobeAcrobatOrReader:function(){return this._renderCoachmark({title:h("Want to edit this PDF?"),imageUrl:f("/static/images/file_viewer/coach_mark_pdf-vflIMdX1a.png"),imageUrl2x:f("/static/images/file_viewer/coach_mark_pdf@2x-vflUkcAgn.png"),imageAlt:h("An illustration of a PDF file"),openButtonBody:m(h("You’re looking at a preview. To open this file for editing, click <strong>Open</strong>.")),dropdownBody:h("You’re looking at a preview. To open this file for editing, click here.")})},render:function(){if(this.hasCoachmark&&e.flexbox)switch(this.state.vendor){case"msft":switch(this.state.application){case"word":return this._renderMsftWord();case"excel":return this._renderMsftExcel();case"powerpoint":return this._renderMsftPowerpoint()}break;case"adbe":switch(this.state.application){case"acrobat_or_reader":return this._renderAdobeAcrobatOrReader()}}return null}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/seen_state_facepile",["external/classnames","external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/viewer_avatar","modules/clean/datetime","modules/clean/em_string","modules/clean/loggers/file_preview_logger","modules/clean/previews/util","modules/clean/react/bubble_dropdown","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/file_viewer/models","modules/clean/react/file_viewer/seen_state_coachmark","modules/clean/react/pass/store","modules/clean/react_format","modules/clean/react/title_bubble","modules/clean/viewer","modules/constants/file_viewer","modules/core/i18n","modules/core/user_i18n"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T){var S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$;return W=l.ago,R=c.FilePreviewPassLogger,L=d.PermissionHelper,N=h.EventTypes,k=m.FilePreviewSession,Y=v.reactFormat,V=w._,$=w.ungettext,P=n.createFactory(p),U=n.createFactory(f),q=n.createFactory(y),Q=n.DOM,G=Q.button,z=Q.div,K=Q.li,Z=Q.ul,j=n.DOM,A=2,F=4,x=99,S=32,C="CIRCLE",I=26,D="c-avatar--inactive-photo",O="#7B8994",M="c-avatar--overflow",H=10,B=n.createClass({displayName:"SeenStateFacepile",propTypes:{nsId:n.PropTypes.number.isRequired,sjid:n.PropTypes.number.isRequired,user:n.PropTypes.object.isRequired},componentWillMount:function(){return this._removeStoreListener=g.addListener(this._onUpdateFromStore),this._filePreviewPassLogger=new R,this._filePreviewPassLogger.listenTo(_)},componentDidMount:function(){return this._logFacepileShownEvents()},getInitialState:function(){var e;return e=this._getStateFromStore(this.props.nsId,this.props.sjid),e.showPerFaceTooltips=!0,e},componentWillReceiveProps:function(e){return this.props.nsId!==e.nsId||this.props.sjid!==e.sjid?this.setState(this._getStateFromStore(e.nsId,e.sjid)):void 0},componentDidUpdate:function(e,t){return o.isEqual(e,this.props)||(this._hasSeenStateBeenLogged=!1,this._hasPresenceBeenLogged=!1),this._logFacepileShownEvents()},componentWillUnmount:function(){return this._removeStoreListener(),this._filePreviewPassLogger.unlistenTo(_)},_getStateFromStore:function(e,t){return{presence:g.presence(e,t),seenStateInfo:g.seenStateInfo(e,t)}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore(this.props.nsId,this.props.sjid))},_logFacepileShownEvents:function(){return this.state.seenStateInfo&&L.is_seen_state_enabled(this.props.user)?(this.state.presence&&L.is_presence_enabled(this.props.user)?this._hasPresenceBeenLogged||(this._logPassEvent(N.FILE_PREVIEW_PASS_SHOWN),this._hasPresenceBeenLogged=!0):this._hasSeenStateBeenLogged||this._logPassEvent(N.FILE_PREVIEW_SEEN_STATE_SHOWN),this._hasSeenStateBeenLogged=!0):void 0},_logPassEvent:function(e){return _.emit(e,k.currentSession,{numViewers:this._getNumViewers(),numCurrentViewers:this._getNumCurrentViewers()})},_getNumViewers:function(){return this.state.seenStateInfo.seen_states.length+1},_getNumCurrentViewers:function(){return this.state.presence?1+this.state.presence.length:0},_getAvatarProps:function(e,t,o){return{dimension:S,photoUrl:t,defaultAvatar:n.createElement(s,{dimension:S,initials:T.getInitials(e),name:e,color:o?void 0:O,shape:C}),optionalClass:o?null:D}},_userIsOnline:function(t){var n;return null!=this.state.presence&&(n=t.user_id,e.call(this.state.presence,n)>=0)},_renderAvatar:function(e){return n.createElement(i,this._getAvatarProps(e.seen_state_user.display_name,e.seen_state_user.photo_circle_url,this._shouldShowColor(e)))},_renderOverflowAvatar:function(e){var t,o,i,s;return o=e.length-F,i=o>=x?x+"+":""+o,t=n.createElement(r,{dimension:S,initials:i,color:O,shape:C,optionalClass:M}),s=G({className:"facepile-dropdown-target"},t),this._renderDropdownButton(e,s,0)},_shouldShowColor:function(e){return L.is_presence_enabled(this.props.user)?this._userIsOnline(e.seen_state_user):!0},_renderAvatarWithTooltip:function(e,t){var n,o,i,r,s,a;return a=e[t],n=a.avatar,s=a.tooltipElement,r=G({className:"facepile-dropdown-target"},n),this.state.showPerFaceTooltips&&(r=q({content:s,position:y.POSITIONS.BOTTOM,distanceFromTarget:12,isTargetPositionFixed:!0,onMouseEnter:function(e){return function(){return e._logPassEvent(N.FILE_PREVIEW_PASS_HOVER)}}(this),className:"seen-state-title-bubble"},r)),i=e.length>F?F+1:e.length,o=-((i-(t+1))*I),this._renderDropdownButton(e,r,o)},_renderDropdownButton:function(e,t,n){return P({targetButton:t,arrow_position:"top-right",bubbleDropdownScrollable:!0,closeBubbleDropdownOnWindowScroll:!1,show_arrow:!1,horizontal_displacement:n,vertical_displacement:-4,bubbleDropdownShown:function(e){return function(){return e._logPassEvent(N.FILE_PREVIEW_PASS_CLICK),window.setTimeout(function(){return e.setState({showPerFaceTooltips:!1})},0)}}(this),bubbleDropdownHidden:function(e){return function(){return window.setTimeout(function(){return e.setState({showPerFaceTooltips:!0})},0)}}(this)},this._renderDropdownContents(e))},_renderCoachmark:function(){return U({userId:this.props.user.id})},_renderDropdownContents:function(e){var t,n,o,i;for(t=[],n=0,o=e.length;o>n;n++)i=e[n],t.push(this._renderDropdownRow(i.avatar,i.displayName,i.dropdownText));return z({className:"seen-state-dropdown"},Z({className:"seen-state-dropdown__list"},t))},_renderDropdownRow:function(e,t,n){return K({className:"seen-state-row"},z({className:"seen-state-row__avatar"},e),z({className:"seen-state-row__info"},z({className:"seen-state-row__actor"},t),z({className:"seen-state-row__time"},n)))},_offlineDropdownText:function(e){return W(1e3*e.when_last_seen)},_offlineTooltipElement:function(e){return j.span({},Y(V("<b>%(user_name)s</b> <newline/> viewed %(ago)s",{comment:'Format like "userName <newline> viewed 5 days ago"'}),{user_name:this._truncatedTooltipDisplayName(e.seen_state_user.display_name),ago:W(1e3*e.when_last_seen,!1),b:j.b(),newline:j.br()}))},_onlineDropdownText:function(){return V("Currently viewing")},_onlineTooltipElement:function(e){return j.span({},Y(V("<b>%(user_name)s</b> <newline/> currently viewing",{comment:'Format like "user_name <newline> currently viewing"'}),{user_name:this._truncatedTooltipDisplayName(e),b:j.b(),newline:j.br()}))},_truncatedTooltipDisplayName:function(e){return u.em_snippet(e,H)},_buildUserInfo:function(e,t){var n,o;return n=this._renderAvatar(e),o=e.seen_state_user.display_name,t&&this._userIsOnline(e.seen_state_user)?{avatar:n,displayName:o,tooltipElement:this._onlineTooltipElement(o),dropdownText:this._onlineDropdownText(o)}:{avatar:n,displayName:o,tooltipElement:this._offlineTooltipElement(e),dropdownText:this._offlineDropdownText(e)}},_partitionUserInfoLists:function(){var e,t,n,o,i,r,s;for(i=[],o=[],t=L.is_presence_enabled(this.props.user),
r=this.state.seenStateInfo.seen_states,e=0,n=r.length;n>e;e++)s=r[e],this._userIsOnline(s.seen_state_user)?i.push(this._buildUserInfo(s,t)):o.push(this._buildUserInfo(s,t));return{onlineUserInfoList:i,offlineUserInfoList:o}},_getUserInfoList:function(){var e,t,o,i,r,s,l;return i=[],l=E.get_viewer().get_user_by_id(this.props.user.id),s=this._getAvatarProps(l.display_name,l.photo_url,!0),r=n.createElement(a,s),i.push({avatar:r,displayName:l.display_name,tooltipElement:this._onlineTooltipElement(l.display_name),dropdownText:this._onlineDropdownText()}),o=this._partitionUserInfoLists(),t=o.onlineUserInfoList,e=o.offlineUserInfoList,i.concat(t).concat(e)},render:function(){var e,n,i,r,s,a;return this.state.seenStateInfo&&L.is_seen_state_enabled(this.props.user)?(a=this._getUserInfoList(),s=a.length>F+1,i=s?F:a.length,n=o.range(i),r=n.map(function(e){return function(t){return e._renderAvatarWithTooltip(a,t)}}(this)),s&&r.push(this._renderOverflowAvatar(a)),r.reverse(),e={"react-title-bar__facepile":!0,"facepile-presence-received":null!=this.state.presence,"c-coach-mark__container":!0},z({className:t(e)},r,r.length>=A&&b.FILE_VIEWER_PASS_SHOW_ONBOARDING_COACHMARK?this._renderCoachmark():void 0)):z()}})})}.call(this),function(){define("modules/clean/react/file_viewer/share_helpers",["modules/core/notify","modules/clean/ajax","modules/clean/filepath","modules/clean/sharing/api/client","require"],function(e,t,n,o,i){var r;return r={share:function(t,n){return i(["modules/clean/sharing/share_modal_util"],function(e){var o,i,r,s,a;return i={fqPath:t,isFolder:!1,origin:"PREVIEW_PAGE"},s=e.getSharingInfo(n,i),o=s.browseContext,r=s.contentInfo,a=s.shareModalInfo,e.showTiburonUIIfAllowedNonPublic(n,r,o,a)},function(){return e.error(e.DEFAULT_ERROR)})}}})}.call(this),function(){define("modules/clean/react/file_viewer/shared_file_actions",["external/react","external/underscore","modules/clean/react/share_download/button","modules/clean/react/account_menu/account_menu","modules/clean/react/file_viewer/copyright_flag","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/toggle_comments","modules/clean/react/title_bar/controls_container","modules/clean/react/user_notifications/dropdown","modules/clean/sharing/api/client","modules/clean/sharing/delete_link_modal","modules/clean/viewer","modules/constants/file_viewer","modules/core/browser","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m){var f,g,v,y,E,b,w,T,S,C,I,P,A,N;return S=s.ToggleCommentsContainer,y=u.ShareApiClient,A=c.deleteLinkWithConfirm,N=c.deleteLinkWithConfirmLegacy,I=_._,f=e.createFactory(o),g=e.createFactory(i),v=e.createFactory(r),E=e.createFactory(n),w=e.createFactory(a),T=e.createFactory(S),C=e.createFactory(l),P=e.DOM.a,b=e.createClass({displayName:"SharedFileActions",propTypes:{accountMenuOptions:e.PropTypes.object,shareToken:e.PropTypes.object,sharePermissions:e.PropTypes.object,file:e.PropTypes.object.isRequired,user:e.PropTypes.object,isCommentingIntegrated:e.PropTypes.bool,sharedLinkInfo:e.PropTypes.object},getDefaultProps:function(){return{user:null}},getInitialState:function(){return{tkey:this.props.file.tkey||null}},_handleAccountClick:function(){throw new Error("Not implemented")},_handleSignInClick:function(){throw new Error("Not implemented")},_removeShareLink:function(){var e,t,n,o;return e=new y({userId:this.props.sharePermissions.canRemoveLinkUids[0]}),t=this.state.linkMetadata,o=(null!=(n=this.props.sharePermissions)?n.canRemoveLinkUids.length:void 0)>0?this.props.shareToken.linkKey:null,N({client:e,contentName:this.props.file.filename,onCancel:null,onDeleteLink:function(){return h.redirect("/home")},tkey:o})},_renderDownloadMenu:function(){return this.props.shareToken&&this.props.sharePermissions?E({sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,fileOrFolder:this.props.file}):void 0},_renderAccountMenu:function(){var e;return e=t.extend({},this.props.accountMenuOptions,{arrowPosition:"top-right",user:this.props.user,viewer:d.get_viewer()}),f(e)},_renderMoreDropdown:function(){var e,t;return t=(null!=(e=this.props.sharePermissions)?e.canRemoveLinkUids.length:void 0)>0?this.props.shareToken.linkKey:null,v({allowRemoveLink:null!=t,file:this.props.file,isPrivate:!1,onRemoveShareLink:this._removeShareLink})},_renderToggleComments:function(){return this.props.isCommentingIntegrated?T():void 0},_renderSignIn:function(){return P({className:"button-primary sign-in-link control__button",href:m({path:"/login",query:{cont:h.get_href()}}).toString()},I("Sign in"))},_renderUserNotificationsDropdown:function(){return C({isPagelet:!1,isMaestroDesign:p.MAESTRO_ENABLED})},render:function(){return w({},g({sharedLink:this.props.sharedLinkInfo.url}),null!=this.props.user?[this._renderUserNotificationsDropdown(),this._renderAccountMenu(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments()]:[this._renderSignIn(),this._renderDownloadMenu(),this._renderMoreDropdown(),this._renderToggleComments()])}})})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/file_viewer/store",["external/underscore","modules/clean/flux/flux_store","modules/clean/react/browse/models","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/dispatcher","modules/clean/react/file_viewer/utils"],function(t,n,o,i,r,s){var a,l,u,c,d;return l=o.File,a=i.ActionTypes,c=s.FlippableHelpers,u=function(n){function o(e){o.__super__.constructor.call(this,e),this._files=[],this._currentIndex=0,this._user=null,this._sharedLinkInfos={},this._shareTokens={},this._sharePermissions={},this._isFullscreen=!1,this._cachedLatestRevision=null,this._disableFlipping=!1}return e(o,n),o.prototype.files=function(){return this._files},o.prototype.currentIndex=function(){return this._currentIndex},o.prototype.user=function(){return this._user},o.prototype.sharedLinkInfo=function(){return this._sharedLinkInfos[d(this.currentFile())]},o.prototype.shareToken=function(){return this._shareTokens[d(this.currentFile())]},o.prototype.sharePermissions=function(){return this._sharePermissions[d(this.currentFile())]},o.prototype.isFullscreen=function(){return this._isFullscreen},o.prototype.currentFile=function(){return this._files[this._currentIndex]},o.prototype.isViewingLatestRevision=function(){return!this._cachedLatestRevision},o.prototype._setup=function(e){var t,n,o,i,r,s,a;return o=e.files,t=e.currentIndex,a=e.user,s=e.sharedLinkInfos,r=e.shareTokens,i=e.sharePermissions,n=e.disableFlipping,this._user=a,this._disableFlipping=n,this._updateFiles(o[t],o,s,r,i)},o.prototype._updateFiles=function(e,t,n,o,i){var r,s,a,l,u,p,h;for(null==n&&(n=null),null==o&&(o=null),null==i&&(i=null),this._sharedLinkInfos={},this._shareTokens={},this._sharePermissions={},s=u=0,p=t.length;p>u;s=++u)r=t[s],h=d(r),this._sharedLinkInfos[h]=null!=n?n[s]:void 0,this._shareTokens[h]=null!=o?o[s]:void 0,this._sharePermissions[h]=null!=i?i[s]:void 0;return a=c.isFlippableFile(e),l=this._getFileIndex(t,e)>=0,!this._disableFlipping&&a&&l?(this._files=c.filterFlippableFiles(t),this._currentIndex=this._getFileIndex(this._files,e)):(this._files=[e],this._currentIndex=0),this.__emitChange()},o.prototype._replaceFile=function(e){var n;return n=t.findIndex(this._files,function(t){return t.fq_path===e.fq_path}),null!=n?n===this._currentIndex&&this._cachedLatestRevision?this._cachedLatestRevision=e:(this._files[n]=e,this.__emitChange()):void 0},o.prototype._cleanup=function(){return this._files=[],this._currentIndex=0,this._user=null,this._sharedLinkInfos=[],this._shareTokens=[],this._sharePermissions=[],this._isFullscreen=!1,this._cachedLatestRevision=null},o.prototype._nextFile=function(){return this._restoreRevision(),this._currentIndex=this._currentIndex===this._files.length-1?0:this._currentIndex+1,this.__emitChange()},o.prototype._previousFile=function(){return this._restoreRevision(),this._currentIndex=0===this._currentIndex?this._files.length-1:this._currentIndex-1,this.__emitChange()},o.prototype._setIsFullscreen=function(e){return this._isFullscreen=e,this.__emitChange()},o.prototype._switchRevision=function(e){return this._cachedLatestRevision||(this._cachedLatestRevision=this._files[this._currentIndex]),this._files[this._currentIndex]=e,this.__emitChange()},o.prototype._restoreRevision=function(){return this._cachedLatestRevision?(this._files[this._currentIndex]=this._cachedLatestRevision,this._cachedLatestRevision=null,this.__emitChange()):void 0},o.prototype._fastForwardRevision=function(e){return this._cachedLatestRevision=e,this.__emitChange()},o.prototype._getFileIndex=function(e,t){var n,o,i,r;for(o=i=0,r=e.length;r>i;o=++i)if(n=e[o],l.areEqual(t,n))return o;return-1},o.prototype.__onDispatch=function(e){switch(e.action.type){case a.SETUP:return this._setup(e.action.data);case a.CLEANUP:return this._cleanup();case a.UPDATE_FILES:return this._updateFiles(this.currentFile(),e.action.data.files);case a.REPLACE_FILE:return this._replaceFile(e.action.data.file);case a.FLIP_NEXT:return this._nextFile();case a.FLIP_PREVIOUS:return this._previousFile();case a.OPEN_FULLSCREEN:return this._setIsFullscreen(!0);case a.CLOSE_FULLSCREEN:return this._setIsFullscreen(!1);case a.FAST_FORWARD_REVISION:return this._fastForwardRevision(e.action.data.file);case a.SWITCH_REVISION:return this._switchRevision(e.action.data.file);case a.RESTORE_REVISION:return this._restoreRevision()}},o}(n),d=function(e){return e.ns_id+":"+e.sjid},new u(r)})}.call(this),function(){define("modules/clean/react/file_viewer/title_bar",["external/classnames","external/react","modules/constants/env","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/util","modules/clean/react/file_viewer/mounted_file_actions","modules/clean/react/file_viewer/version_history_file_actions","modules/clean/react/file_viewer/seen_state_facepile","modules/clean/react/file_viewer/shared_file_actions","modules/clean/react/sprite","modules/clean/react/image","modules/clean/react/title_bar/base","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O;return N=i.file_icon,m=i.ICON_SIZES,v=r.PreviewHelper,g=r.PermissionHelper,C=_._,P=t.createElement,k=t.DOM,I=k.a,A=k.div,R=k.h1,O=k.span,f=t.createFactory(s),S=t.createFactory(a),y=t.createFactory(l),E=t.createFactory(u),b=t.createFactory(c),T=t.createFactory(p),w=t.createClass({displayName:"TitleBar",propTypes:{shareToken:t.PropTypes.object,sharePermissions:t.PropTypes.object,file:t.PropTypes.object.isRequired,maxFilenameEmLength:t.PropTypes.number.isRequired,user:t.PropTypes.object,canClose:t.PropTypes.bool,onCloseViewer:t.PropTypes.func,shareHelpers:t.PropTypes.object,sharedLinkInfo:t.PropTypes.object,isVersionHistoryMode:t.PropTypes.bool,canRestoreRevision:t.PropTypes.bool,onRestoreRevision:t.PropTypes.func,accountMenuOptions:t.PropTypes.object},getDefaultProps:function(){return{user:null,canClose:!1,onCloseViewer:null,shareHelpers:null,sharedLinkInfo:null,isVersionHistoryMode:!1,canRestoreRevision:!1,onRestoreRevision:null}},_isSharedFile:function(){return null!=this.props.sharedLinkInfo},_isMountedFile:function(){return!this._isSharedFile()},_redirectToVersionHistory:function(){return v.redirectToVersionHistory(this.props.file,this.props.user)},_renderFileIcon:function(){return b({group:"web",name:N(v.get_filename(this.props.file),{size:m.LARGE}),className:"file-icon u-mar-horizontal-xs",alt:""})},_renderFileInfo:function(){var t,n;return n=this.props.sharedLinkInfo,t=e({fileinfo:!0,"u-pad-top-xxs":null!=n&&null!=n.ownerName&&null!=n.ownerTeamName||null==n&&null!=this.props.file.ts}),A({className:t},this._renderFilename(),null!=this.props.sharedLinkInfo?this._renderSharedFileOwner():null!=this.props.file.ts?this._renderLastModifier():void 0)},_renderFilename:function(){return R({className:"filename"},o.em_snippet(v.get_filename(this.props.file),this.props.maxFilenameEmLength))},_renderSharedFileOwner:function(){var e,t,n;return n=this.props.sharedLinkInfo,e=n.ownerName,t=n.ownerTeamName,null!=e&&null!=t&&this._isSharedFile()?O({className:"file-modifier"},C(" from %(owner)s (%(team)s)").format({owner:e,team:t})):void 0},_renderLastModifier:function(){var e,t,n,o,i;return t=this.props.file,n=t.last_modified_name,e=2,o=t.event_type===e?n?C("%(modifier)s edited ",{comment:"Like 'John Smith edited just now'"}).format({modifier:n}):C("You edited ",{comment:"Like 'You edited just now'"}):C("Modified ",{comment:"Like 'Modified just now"}),i=v.getModifierString(t),O({className:"file-modifier"},o,P(h,{content:C("View file history"),position:h.POSITIONS.BOTTOM,isTargetPositionFixed:!0},I({className:"file-modifier",onClick:this._redirectToVersionHistory,href:"#"},i)))},_renderSeenStates:function(){return this.props.isVersionHistoryMode||null==this.props.user?A():y({nsId:this.props.file.ns_id,sjid:this.props.file.sjid,user:this.props.user})},_renderFileActions:function(){return this._isMountedFile()?this.props.isVersionHistoryMode?S({file:this.props.file,user:this.props.user,canRestoreRevision:this.props.canRestoreRevision,onRestoreRevision:this.props.onRestoreRevision}):f({file:this.props.file,user:this.props.user,shareHelpers:this.props.shareHelpers,isCommentingIntegrated:g.is_commenting_integrated()}):E({accountMenuOptions:this.props.accountMenuOptions,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,file:this.props.file,user:this.props.user,isCommentingIntegrated:g.is_commenting_integrated(),sharedLinkInfo:this.props.sharedLinkInfo,shareHelpers:this.props.shareHelpers})},render:function(){var e;return T({title:[this._renderFileIcon(),this._renderFileInfo()],controls:[this._renderSeenStates(),this._renderFileActions()],customLogoUrl:null!=(e=this.props.sharedLinkInfo)?e.ownerTeamLogo:void 0,canClose:this.props.canClose,onClose:this.props.onCloseViewer})}})})}.call(this),function(){define("modules/clean/react/file_viewer/toggle_comments",["external/classnames","external/react","modules/clean/comments/flux","modules/clean/comments/store","modules/clean/comments/action_creators","modules/clean/components/scooter/badge","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f,g,v,y;return f=n.connect,u=r.CounterBadge,h=l._,c=t.createFactory(s),y=t.DOM,g=y.div,_=y.button,m=t.createElement,d=t.createClass({displayName:"ToggleComments",mixins:[t.addons.PureRenderMixin],propTypes:{areCommentsHidden:t.PropTypes.bool.isRequired,canEnableComments:t.PropTypes.bool,isCommentingEnabled:t.PropTypes.bool.isRequired,isCommentingReady:t.PropTypes.bool.isRequired,isStoreInitialized:t.PropTypes.bool.isRequired,unreadCommentCount:t.PropTypes.number},getDefaultProps:function(){return{canEnableComments:!1,unreadCommentCount:0}},_onShowCommentsClick:function(){return i.showComments()},_onHideCommentsClick:function(){return i.hideComments()},render:function(){var n,o,i;if(!this.props.isStoreInitialized||this.props.isCommentingReady&&!this.props.isCommentingEnabled){if(!this.props.canEnableComments)return g();n=h("Comments are disabled"),i=c({group:"web",name:"control_comments_on",alt:n}),o=null}else this.props.areCommentsHidden?(n=h("Show Comments"),i=c({group:"web",name:"control_comments_off",alt:n}),o=this._onShowCommentsClick):(n=h("Hide Comments"),i=c({group:"web",name:"control_comments_on",alt:n}),o=this._onHideCommentsClick);return g({className:"toggle-comments u-mar-left-xs"},m(a,{content:n,position:a.POSITIONS.BOTTOM_ALIGN_RIGHT,distanceFromTarget:10,isTargetPositionFixed:!0,className:"react-title-bar--title-bubble"},g({},_({className:e({"button-secondary":!0,"toggle-comments__button":!0,control__button:!0,disabled:this.props.isCommentingReady&&!this.props.isCommentingEnabled}),onClick:o},i),this.props.unreadCommentCount?t.createElement(u,{variant:"loud",count:this.props.unreadCommentCount,maxCount:99,position:u.POSITIONS.TOP_RIGHT}):void 0)))}}),v=function(){return{areCommentsHidden:o.areCommentsHidden(),canEnableComments:o.canEnableComments(),isCommentingEnabled:o.isCommentingEnabled(),isCommentingReady:o.isFileActivityReady(),isStoreInitialized:o.isStoreInitialized(),unreadCommentCount:o.unreadCommentCount()}},p=f(o,v)(d),{ToggleComments:d,ToggleCommentsContainer:p}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_viewer/utils",["modules/clean/ajax","modules/clean/gandalf_util","modules/clean/open_with","modules/clean/unity/check_file_cache","modules/clean/unity/features","modules/constants/legacy","modules/core/browser"],function(t,n,o,i,r,s,a){var l,u,c,d,p;return l=["photo","video"],u={isFlippableFile:function(t){var n;return n=t.preview_type,e.call(l,n)>=0},filterFlippableFiles:function(e){var t;return Array.isArray(e)?function(){var n,o,i;for(i=[],n=0,o=e.length;o>n;n++)t=e[n],this.isFlippableFile(t)&&i.push(t);return i}.call(this):[]}},c={canOpenWith:function(e,t){return n.getGandalfRule("wopi-button-visible")&&e.doc_preview_status!==s.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC&&e.bytes<=o.MAX_SUPPORTED_FILE_SIZE_B&&null!==o.get_open_handler_for(e,t)},getOpenWithHandlerData:function(e,t){return o.get_open_handler_for(e,t)},openWith:function(e,t){var n,o;return n=this.getOpenWithHandlerData(e,t),o=n.uri+"?hpt_click_ts="+Date.now(),a.redirect(o)}},d={fetchTooltipInfo:function(e,n){var o;return o=t.SilentBackgroundRequest({url:"/ow/get_available_tooltips",dataType:"json",success:function(e){return n(e)},subject_user:e})},getVendorAndApplication:function(t,n){var o,i,r,s,a;for(s in t){a=t[s];for(r in a)if(o=a[r],i=o.extensions,e.call(i,n)>=0)return{vendor:s,application:r}}return null},logImpression:function(e,n,o){return"acrobat_or_reader"===o?t.SilentBackgroundRequest({url:"/ow/log_adobe_tooltip_impression",data:{app_name:o,extension:e},subject_user:n}):t.SilentBackgroundRequest({url:"/ow/msft/log_tooltip_impression",data:{app_type:o,extension:e},subject_user:n})}},p={isUnityEnabled:function(){return null!=r},isFileInUnityCache:function(e,t){return!!i.is_cached_and_locally_available(e,t)},clientSupportsOpenInFileBrowser:function(){return r.client_supports_open_in_file_browser()},getFileInfoFromUnityCache:function(e,t){return i.get(e,t)},_fetchFileBrowserDisplayName:function(e,t){var n,o;return o=function(n){return e.file_browser_display_name=n,t(e)},n=function(){return t(e)},r.file_browser_display_name(o,n)},fetchUnityFileInfo:function(e,t,n,o,i){var s;return s=function(e){return function(t){return t.is_locally_available?e._fetchFileBrowserDisplayName(t,o):o(t)}}(this),r.check_file(e,t,n,s,i)},getUnityFileInfo:function(e,t,n,o,i){var r;return this.isFileInUnityCache(e,t)?(r=this.getFileInfoFromUnityCache(e,t),r.is_locally_available&&null==r.file_browser_display_name?this._fetchFileBrowserDisplayName(r,o):o(r)):this.fetchUnityFileInfo(e,t,n,o,i)},openFile:function(e,t,n,o){return r.open_file(e,t,n,r.standard_open_file_handler,function(e){return r.standard_open_file_handler(!1)},o)}},{FlippableHelpers:u,OpenWithHelpers:c,TooltipHelpers:d,UnityHelpers:p}})}.call(this),function(){define("modules/clean/react/file_viewer/version_history_file_actions",["external/react","modules/clean/react/file_viewer/more_dropdown","modules/clean/react/file_viewer/open_button","modules/clean/react/title_bar/controls_container","modules/core/i18n"],function(e,t,n,o,i){var r,s,a,l,u;return l=i._,r=e.createFactory(n),s=e.createFactory(o),u=e.DOM.button,a=e.createClass({displayName:"VersionHistoryFileActions",propTypes:{file:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,canRestoreRevision:e.PropTypes.bool.isRequired,onRestoreRevision:e.PropTypes.func.isRequired},render:function(){return s({},this.props.canRestoreRevision?u({ref:"restoreButton",className:"button-primary control__button restore-button",onClick:this.props.onRestoreRevision},l("Restore")):void 0,r({file:this.props.file,user:this.props.user,isUnityDisabled:!0,isOpenWithDisabled:!0}))}})})}.call(this),function(){define("modules/clean/react/flag",["external/classnames","external/underscore","external/react","modules/clean/react/css"],function(e,t,n,o){var i,r;return r=n.DOM,i=n.createClass({displayName:"Flag",propTypes:{alignment:n.PropTypes.oneOf(["top","middle","bottom"]),leftAttachment:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node]),rightAttachment:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node]),spacing:n.PropTypes.oneOf(["xs","s","m","l","xl"]),children:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.node])},getDefaultProps:function(){return{alignment:"middle"}},render:function(){var t,n,o,i,s,a;return i={"o-flag":!0},i["o-flag--"+this.props.alignment]=this.props.alignment,t=i,s={"o-flag__flex":!0},s["u-pad-left-"+this.props.spacing]=this.props.spacing&&this.props.leftAttachment,s["u-pad-right-"+this.props.spacing]=this.props.spacing&&this.props.rightAttachment,n=s,o=this.props.leftAttachment?r.div({className:"o-flag__fix"},this.props.leftAttachment):void 0,a=this.props.rightAttachment?r.div({className:"o-flag__fix"},this.props.rightAttachment):void 0,r.div({className:e(t)},o,r.div({className:e(n)},this.props.children),a)}}),i=o(i,["/static/css/scooter/scooter-scoped-vflx8uhBs.css"])})}.call(this),function(){define("modules/clean/react/free_positioned",["jquery","external/react","external/react-dom","external/underscore"],function(e,t,n,o){var i,r,s,a;return s=t.DOM,r={TOP_LEFT:1,TOP:2,TOP_RIGHT:3,LEFT_TOP:4,LEFT:5,LEFT_BOTTOM:6,RIGHT_TOP:7,RIGHT:8,RIGHT_BOTTOM:9,BOTTOM_LEFT:10,BOTTOM:11,BOTTOM_RIGHT:12,TOP_ALIGN_LEFT:13,TOP_ALIGN_RIGHT:14,LEFT_ALIGN_TOP:15,LEFT_ALIGN_BOTTOM:16,RIGHT_ALIGN_TOP:17,RIGHT_ALIGN_BOTTOM:18,BOTTOM_ALIGN_LEFT:19,BOTTOM_ALIGN_RIGHT:20},a=function(t){var n,o,i,s,a;return a=t.targetNode,n=t.isTargetFixed,i=t.position,o=null!=(s=t.offset)?s:{},function(t){var s;if(null==a)return null;if(s=e(a).offset(),n&&(s.top-=e(window).scrollTop()),null==t)return{top:s.top,left:s.left};switch(o.vertical&&(s.top+=o.vertical),o.horizontal&&(s.left+=o.horizontal),i){case r.TOP_LEFT:return{top:s.top-t.offsetHeight,left:s.left+.5*a.offsetWidth-.75*t.offsetWidth};case r.TOP:return{top:s.top-t.offsetHeight,left:s.left+.5*(a.offsetWidth-t.offsetWidth)};case r.TOP_RIGHT:return{top:s.top-t.offsetHeight,left:s.left+.5*a.offsetWidth-.25*t.offsetWidth};case r.LEFT_TOP:return{top:s.top+.5*a.offsetHeight-.75*t.offsetHeight,left:s.left-t.offsetWidth};case r.LEFT:return{top:s.top+.5*(a.offsetHeight-t.offsetHeight),left:s.left-t.offsetWidth};case r.LEFT_BOTTOM:return{top:s.top+.5*a.offsetHeight-.25*t.offsetHeight,left:s.left-t.offsetWidth};case r.RIGHT_TOP:return{top:s.top+.5*a.offsetHeight-.75*t.offsetHeight,left:s.left+a.offsetWidth};case r.RIGHT:return{top:s.top+.5*(a.offsetHeight-t.offsetHeight),left:s.left+a.offsetWidth};case r.RIGHT_BOTTOM:return{top:s.top+.5*a.offsetHeight-.25*t.offsetHeight,left:s.left+a.offsetWidth};case r.BOTTOM_LEFT:return{top:s.top+a.offsetHeight,left:s.left+.5*a.offsetWidth-.75*t.offsetWidth};case r.BOTTOM:return{top:s.top+a.offsetHeight,left:s.left+.5*(a.offsetWidth-t.offsetWidth)};case r.BOTTOM_RIGHT:return{top:s.top+a.offsetHeight,left:s.left+.5*a.offsetWidth-.25*t.offsetWidth};case r.TOP_ALIGN_LEFT:return{top:s.top-t.offsetHeight,left:s.left};case r.TOP_ALIGN_RIGHT:return{top:s.top-t.offsetHeight,left:s.left+a.offsetWidth-t.offsetWidth};case r.LEFT_ALIGN_TOP:return{top:s.top,left:s.left-t.offsetWidth};case r.LEFT_ALIGN_BOTTOM:return{top:s.top+a.offsetHeight-t.offsetHeight,left:s.left-t.offsetWidth};case r.RIGHT_ALIGN_TOP:return{top:s.top,left:s.left+a.offsetWidth};case r.RIGHT_ALIGN_BOTTOM:return{top:s.top+a.offsetHeight-t.offsetHeight,left:s.left+a.offsetWidth};case r.BOTTOM_ALIGN_LEFT:return{top:s.top+a.offsetHeight,left:s.left};case r.BOTTOM_ALIGN_RIGHT:return{top:s.top+a.offsetHeight,left:s.left+a.offsetWidth-t.offsetWidth}}}},i=t.createClass({displayName:"FreePositioned",statics:{STICKY_POSITION:r,makeStickyPositioner:a},propTypes:{getPositioning:t.PropTypes.func.isRequired,isTargetFixed:t.PropTypes.bool,initialPositioning:t.PropTypes.shape({top:t.PropTypes.number,left:t.PropTypes.number}),onReposition:t.PropTypes.func},getDefaultProps:function(){return{isTargetFixed:!1,initialPositioning:null}},getInitialState:function(){return{positioning:this.props.initialPositioning}},componentDidMount:function(){return e(window).on("resize.freePositioned",this._handleWindowResize),this._updatePositioning()},componentDidUpdate:function(e){return this.props!==e?this._updatePositioning():void 0},componentWillUnmount:function(){return e(window).off("resize.freePositioned",this._handleWindowResize)},render:function(){return s.div({style:this._getStyle(),tabIndex:-1},this.props.children)},_getStyle:function(){return o.extend({outline:0,position:this.props.isTargetFixed?"fixed":"absolute"},this.state.positioning)},_handleWindowResize:function(){return o.throttle(this._updatePositioning(),30)},_updatePositioning:function(){var e;return e=this.props.getPositioning(n.findDOMNode(this)),null!=e?this.setState({positioning:e},function(e){return function(){var t;return"function"==typeof(t=e.props).onReposition?t.onReposition(e.state.positioning):void 0}}(this)):void 0}})})}.call(this),function(){define("modules/clean/react/helpers",["external/immutable","external/underscore"],function(e,t){var n;return Object.is||(Object.is=function(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}),n=function(e,t){var n,o,i,r,s,a,l,u,c,d,p;if(e===t)return!0;if(s=Object.keys(e),a=Object.keys(t),s.length!==a.length)return!1;for(o=0,u=s.length;u>o;o++)if(l=s[o],d=e[l],p=t[l],Array.isArray(d)&&Array.isArray(p)){if(d.length!==p.length)return!1;for(i=r=0,c=d.length;c>r;i=++r)if(n=d[i],d[i]!==p[i])return!1}else if(!Object.is(d,p))return!1;return!0},{compareStateAndProps:function(e,n){return!t.isEqual(this.state,n)||!t.isEqual(this.props,e)},shallowCompareStateAndProps:function(e,t){return!n(this.state,t)||!n(this.props,e)}}})}.call(this),function(){define("modules/clean/react/hidden",["external/react","external/underscore"],function(e,t){var n,o,i,r;return r=e.DOM,i=e.createElement,n=e.createClass({displayName:"Hidden",render:function(){return r.div({className:"hidden-option"},this.props.children)}}),o=e.createClass({displayName:"HiddenSelect",propTypes:{options:e.PropTypes.arrayOf(e.PropTypes.any).isRequired,value:e.PropTypes.any},render:function(){var e;return i(n,{},r.select(t.omit(this.props,"options"),function(){var t,n,o,i;for(o=this.props.options,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(r.option({key:e,label:e,value:e}));return i}.call(this)))}}),{Hidden:n,HiddenSelect:o}})}.call(this),function(){define("modules/clean/react/image",["external/react","external/underscore","modules/core/exception"],function(e,t,n){var o,i,r,s,a;return i=n.assert,r=e.DOM,a=function(e){return-1!==e.indexOf("-vfl")},s=function(e){return e.endsWith(".svg")},o=e.createClass({displayName:"Image",propTypes:{alt:e.PropTypes.string,src:e.PropTypes.string.isRequired,srcHiRes:e.PropTypes.string,onLoad:e.PropTypes.func,className:e.PropTypes.string,id:e.PropTypes.string,width:e.PropTypes.number,height:e.PropTypes.number},getDefaultProps:function(){return{alt:""}},render:function(){var e;return i(a(this.props.src),"Non-VFL path: "+this.props.src),s(this.props.src)===!1&&this.props.srcHiRes&&i(a(this.props.srcHiRes),"Non-VFL path: "+this.props.srcHiRes),e={src:this.props.src,srcSet:s(this.props.src)===!1||this.props.srcHiRes?this.props.srcHiRes+" 2x":this.props.src,alt:this.props.alt,id:this.props.id,className:this.props.className,onLoad:this.props.onLoad,width:this.props.width,height:this.props.height},t.extend(e,t.pick(this.props,function(e,t){return t.match(/^(aria|data)-/)})),r.img(e)}})})}.call(this),function(){define("modules/clean/react/onboarding_modal",["external/classnames","external/react","modules/core/i18n","modules/core/exception","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/slider"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C;return T=n._,S=o.assert,l=i.button,h=r.Modal,d=s.IndicatorGroup,w=s.Slides,E=s.Slider,m=s.NavButtonGroup,C=t.DOM,p=t.createFactory(h),a=t.createFactory(l),y=t.createFactory(E),b=t.createFactory(w),c=t.createFactory(d),_=t.createFactory(m),u=640,v=t.createClass({displayName:"OnboardingSlider",mixins:[t.addons.PureRenderMixin],propTypes:{width:t.PropTypes.number.isRequired,height:t.PropTypes.number,className:t.PropTypes.string,onSlideChange:t.PropTypes.func,onSlideEnd:t.PropTypes.func,initialSlideIndex:t.PropTypes.number,children:function(e,n,o){var i;return i=t.Children.count(e[n]),S(i>0,o+" has no slide to show")}},getDefaultProps:function(){return{initialSlideIndex:0}},getInitialState:function(){return{currentSlideIndex:this.props.initialSlideIndex}},isAtLastSlide:function(){return this.state.currentSlideIndex+1===this.getSlideCount()},getSlideCount:function(){return t.Children.count(this.props.children)},gotoSlide:function(e){return e!==this.state.currentSlideIndex?(S(e>=0&&e<this.getSlideCount(),"Invalid slide index: "+e),this.setState({currentSlideIndex:e},function(t){return function(){var n;return"function"==typeof(n=t.props).onSlideChange?n.onSlideChange(e):void 0}}(this))):void 0},prevSlide:function(){return this.gotoSlide(this.state.currentSlideIndex-1)},nextSlide:function(){return this.gotoSlide(this.state.currentSlideIndex+1)},render:function(){return y({className:this.props.className},b({width:this.props.width,height:this.props.height,currentSlideIndex:this.state.currentSlideIndex},this.props.children),c({slideCount:this.getSlideCount(),currentSlideIndex:this.state.currentSlideIndex,onIndicatorClick:this.gotoSlide}),_(null,this.isAtLastSlide()?a({className:"is-done",onClick:this.props.onSlideEnd},T("Got it")):a({className:"is-next",onClick:this.nextSlide},T("Next"))))}}),g=t.createFactory(v),f=t.createClass({displayName:"OnboardingModal",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,onClose:t.PropTypes.func,slideWidth:t.PropTypes.number,slideHeight:t.PropTypes.number,initialSlideIndex:t.PropTypes.number},getDefaultProps:function(){return{slideWidth:u}},closeModal:function(){var e;return h.close(),"function"==typeof(e=this.props).onClose?e.onClose():void 0},render:function(){return p({acceptButtonText:null,onDismiss:this.props.onClose,style:"clean",className:this.props.className,clickOutToClose:!1},g({initialSlideIndex:this.props.initialSlideIndex,width:this.props.slideWidth,height:this.props.slideHeight,onSlideEnd:this.closeModal},this.props.children))}})})}.call(this),function(){define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,n){var o,i,r,s,a,l;return l=n.mergeProps,s=e.createElement,a=e.DOM,r=function(n,o,i,r){var a,u,c;return a=null!=(c=n.displayName)?c:"UnnamedComponent",e.createClass({displayName:"Outside"+o+"Handled"+a,propTypes:(u={},u[""+i]=e.PropTypes.func,u[""+r]=e.PropTypes.func,u),componentDidMount:function(){return document.addEventListener(o,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(o,this._handleOutsideEvent,!1)},render:function(){var e,o;return o=l(t.omit(this.props,i,r,"children"),(e={},e[""+i]=this._handleInsideEvent,e)),s(n,o,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[r]?t[r](e):void 0},_handleInsideEvent:function(e){var t,n;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(n=this.props)[i]?n[i](e):void 0}})},o=r("div","click","onClick","onOutsideClick"),
i=r("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:o,OutsideMouseDownHandler:i,addOutsideEventHandling:r}})}.call(this),function(){define("modules/clean/react/overlay",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/keycode","modules/clean/react/css","modules/clean/react/free_positioned","modules/clean/react/portal","modules/core/dom"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_;return _=n.DOM,h=n.createElement,p=n.createClass({displayName:"Overlay",propTypes:{children:n.PropTypes.node.isRequired,overlayRoot:n.PropTypes.instanceOf(HTMLElement),overlayTarget:n.PropTypes.instanceOf(HTMLElement),isFullScreen:n.PropTypes.bool,shouldTrapKeyboardFocus:n.PropTypes.bool,isContentFocusable:n.PropTypes.bool,shouldAutoFocusOverlayContent:n.PropTypes.bool,position:n.PropTypes.shape({top:n.PropTypes.number,left:n.PropTypes.number}),onRendered:n.PropTypes.func,onBlur:n.PropTypes.func,className:n.PropTypes.string},getDefaultProps:function(){return{overlayRoot:null,overlayTarget:null,isFullScreen:!1,shouldTrapKeyboardFocus:!1,isContentFocusable:!0,shouldAutoFocusOverlayContent:!0,position:null,onRendered:i.noop,onBlur:i.noop}},componentWillMount:function(){return this._rootContainer=document.body,this.overlayTarget=this.props.overlayTarget||document.activeElement},overlayContentDidMount:function(){return this.$overlayContent=e(o.findDOMNode(this.refs.overlayContent)),this.props.isContentFocusable&&(this._focusElementInOverlay(),this._bindOverlayHandlers()),this.props.isFullScreen&&(this._maskElementsBehindOverlay(this.$overlayContent),u.scroll_lock_document()),this.props.onRendered()},componentDidUpdate:function(e){return this.$overlayContent&&!e.isContentFocusable&&this.props.isContentFocusable?(this._focusElementInOverlay(),this._bindOverlayHandlers()):void 0},componentWillUnmount:function(){return this._unbindOverlayHandlers(),this.props.isFullScreen?(this._unmaskElementsBehindOverlay(this.$overlayContent),u.scroll_unlock_document()):void 0},_bindOverlayHandlers:function(){return this.$overlayContent.on("keydown",this._handleKeyDown),window.addEventListener("mousedown",this._handleFocusOutOverlay,!0),window.addEventListener("blur",this._handleFocusIntoIframe,!0)},_unbindOverlayHandlers:function(){return this.$overlayContent.off("keydown"),window.removeEventListener("mousedown",this._handleFocusOutOverlay,!0),window.removeEventListener("blur",this._handleFocusIntoIframe,!0)},_getContentStyle:function(){return this.props.position&&!this.props.isFullScreen?{top:this.props.position.top,left:this.props.position.left}:{}},_maskElementsBehindOverlay:function(e){return this._setScreenReaderHiddenForSiblingsAndAncestors(e,!0)},_unmaskElementsBehindOverlay:function(e){return this._setScreenReaderHiddenForSiblingsAndAncestors(e,!1)},_setScreenReaderHiddenForSiblingsAndAncestors:function(e,t){var n,o;return o=e.siblings().not("#accessible-announce"),t?o.attr("aria-hidden",!0):o.removeAttr("aria-hidden"),n=e.parent(),n.is(this._rootContainer)?void 0:this._setScreenReaderHiddenForSiblingsAndAncestors(n,t)},_focusElementInOverlay:function(){var e,t;return e=this.$overlayContent.children().first(),null==e.attr("tabindex")&&(e=this.$overlayContent),this.props.shouldAutoFocusOverlayContent&&(t=u.getTabbableElementsIn(this.$overlayContent),t.length>0&&(e=t[0])),e.focus()},_handleKeyDown:function(e){return this.props.isContentFocusable?e.which===r.TAB?this._handleTabNavigate(e):e.which===r.ESC?this._blur(e,this.overlayTarget):void 0:void 0},_handleFocusOutOverlay:function(e){return this.props.isContentFocusable?e.target===this.overlayTarget||this.overlayTarget.contains(e.target)||this.$overlayContent.get(0).contains(e.target)?void 0:this._blur(e,e.target||this.overlayTarget):void 0},_handleFocusIntoIframe:function(e){return"IFRAME"===document.activeElement.tagName?this._blur(e,document.activeElement):void 0},_handleTabNavigate:function(e){var t,n,o,i,r,s,a,l;return this.props.shouldTrapKeyboardFocus||this.props.isFullScreen?u.keepFocusIn(this.$overlayContent,e):(r=u.getTabbableElementsIn(this.$overlayContent),t=r[0],o=r[r.length-1],!e.shiftKey||(s=e.target)!==this.$overlayContent.get(0)&&s!==t?e.shiftKey||(a=e.target)!==this.$overlayContent.get(0)&&a!==o?void 0:(n=u.getFocusableElementsIn(this.overlayTarget.parentNode),l=n.index(this.overlayTarget),i=l<n.length-1?n[l+1]:this.overlayTarget,this._blur(e,i)):this._blur(e,this.overlayTarget))},_blur:function(e,t){return e.preventDefault(),e.stopPropagation(),t.focus(),this.props.onBlur(e)},render:function(){var e,n;return e=t([this.props.className,{"react-overlay":!0,"react-overlay--is-fullscreen":this.props.isFullScreen}]),n={ref:"overlayContent",tabIndex:-1,className:e,style:this._getContentStyle()},this.props.isFullScreen&&(n.role="dialog"),h(l,{parentElement:this.props.overlayRoot||this._rootContainer,onRendered:this.overlayContentDidMount},_.div(n,this.props.children))}}),c=s(p,["/static/css/react/portal_overlay-vflCJkoX6.css"]),d=n.createClass({displayName:"PositionedOverlay",statics:{POSITIONS:a.STICKY_POSITION},propTypes:{targetNode:n.PropTypes.instanceOf(HTMLElement).isRequired,isTargetPositionFixed:n.PropTypes.bool,isContentFocusable:n.PropTypes.bool,position:n.PropTypes.oneOf(i.values(a.STICKY_POSITION)).isRequired,positionOffset:n.PropTypes.shape({horizontal:n.PropTypes.number,vertical:n.PropTypes.number}),className:n.PropTypes.string},getDefaultProps:function(){return{isTargetPositionFixed:!1,isContentFocusable:!0}},getInitialState:function(){return{readyToFocusInOverlay:!1}},_handlePositionUpdated:function(e){return!this.currentPositioning&&this.props.isContentFocusable&&this.setState({readyToFocusInOverlay:!0}),this.currentPositioning=e},render:function(){var e;return e=i.omit(this.props,["children","position"]),h(c,i.defaults({},{overlayTarget:this.props.targetNode,isFullScreen:!1,isContentFocusable:this.state.readyToFocusInOverlay,className:this.props.className},e),h(a,i.defaults({},{getPositioning:a.makeStickyPositioner({targetNode:this.props.targetNode,isTargetFixed:this.props.isTargetPositionFixed,position:this.props.position,offset:this.props.positionOffset}),isTargetFixed:this.props.isTargetPositionFixed,onReposition:this._handlePositionUpdated},e),this.props.children))}}),{Overlay:c,PositionedOverlay:d}})}.call(this),function(){define("modules/clean/react/paging_list",["external/classnames","external/react","external/react-dom","jquery","external/underscore"],function(e,t,n,o,i){var r,s;return s=t.DOM,r=t.createClass({displayName:"PagingList",propTypes:{customClass:t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.instanceOf(e)]),itemSize:t.PropTypes.number.isRequired,pageSize:t.PropTypes.number.isRequired,threshold:t.PropTypes.number,useTranslate3d:t.PropTypes.bool},getDefaultProps:function(){return{threshold:100,useTranslate3d:!1}},getInitialState:function(){return{from:0,size:this._constrainSize(this.props.pageSize,this.props.children,0)}},componentWillReceiveProps:function(e){var t,n;return t=this._constrainFrom(this.state.from,e.children.length),n=this._constrainSize(this.state.size,e.children,t),this.setState({from:t,size:n})},componentDidMount:function(){return window.addEventListener("resize",this.updateFrame),n.findDOMNode(this).addEventListener("scroll",this.updateFrame),this.updateFrame()},shouldComponentUpdate:function(e,t){return!i.isEqual(e,this.props)||!i.isEqual(t,this.state)},componentDidUpdate:function(){return this.updateFrame()},componentWillUnmount:function(){return window.removeEventListener("resize",this.updateFrame),n.findDOMNode(this).removeEventListener("scroll",this.updateFrame)},_getScroll:function(){var e,t,o;return t=n.findDOMNode(this.refs.scroller).getBoundingClientRect().top,e=n.findDOMNode(this.refs.container).getBoundingClientRect().top,o=e-t},_setScroll:function(e){return n.findDOMNode(this.refs.container).scrollTop+=e-this._getScroll()},_getViewportSize:function(){return n.findDOMNode(this.refs.container).clientHeight},_getStartAndEnd:function(){var e,t;return t=Math.max(0,this._getScroll()-this.props.threshold),e=t+this._getViewportSize()+2*this.props.threshold,{start:t,end:e}},updateFrame:function(){var e,t,n,o,i,r;return o=this._getStartAndEnd(),r=o.start,e=o.end,n=this.props.itemSize,t=this._constrainFrom(Math.floor(r/n),this.props.children.length),i=this._constrainSize(Math.ceil((e-r)/n)+1,this.props.children,t),this.setState({from:t,size:i})},_getSpaceBefore:function(e){return e*this.props.itemSize},_constrainFrom:function(e,t){return e?Math.max(Math.min(e,t-1),0):0},_constrainSize:function(e,t,n){var o,i;return o=t.length,i=this.props.pageSize,Math.min(Math.max(e,i),o-n)},scrollTo:function(e){return this._setScroll(this._getSpaceBefore(e))},scrollAround:function(e){var t,n,o;return t=this._getScroll(),n=this._getSpaceBefore(e),t>n?this._setScroll(n):(o=n-this._getViewportSize()+this.props.itemSize,o>t?this._setScroll(o):void 0)},_renderItems:function(){var e;return e=this.state.from+this.state.size-1,this.props.children.slice(this.state.from,+e+1||9e9)},render:function(){var t,n,o,i;return n={position:"relative",height:this._getSpaceBefore(this.props.children.length)},i=this._getSpaceBefore(this.state.from),o=this.props.useTranslate3d?"translate3d(0px, "+i+"px, 0)":"translate(0px, "+i+"px)",t={MsTransform:o,WebkitTransform:o,transform:o},s.div({className:e("paging-list",this.props.customClass),ref:"container"},s.div({style:n,ref:"scroller"},s.ul({style:t},this._renderItems())))}})})}.call(this),function(){define("modules/clean/react/pass/actions",["modules/clean/react/pass/constants","modules/clean/react/pass/dispatcher"],function(e,t){var n,o;return n=e.ActionTypes,new(o=function(){function e(){}return e.prototype.receivePresenceDelta=function(e,o,i,r,s){return t.dispatch({type:n.RECEIVE_PRESENCE_DELTA,data:{userId:e,nsId:o,sjid:i,onlineUniqueUsers:r,offlineUniqueUsers:s}})},e.prototype.receivePresenceSnapshot=function(e,o,i,r){return t.dispatch({type:n.RECEIVE_PRESENCE_SNAPSHOT,data:{userId:e,nsId:o,sjid:i,onlineUniqueUsers:r}})},e.prototype.resetPassInfo=function(e,o){return t.dispatch({type:n.RESET_PASS_INFO,data:{nsId:e,sjid:o}})},e.prototype.updateSeenStateInfo=function(e,o,i){return t.dispatch({type:n.UPDATE_SEEN_STATE_INFO,data:{nsId:e,sjid:o,seenStateInfo:i}})},e}())})}.call(this),function(){define("modules/clean/react/pass/constants",[],function(){var e;return e={},e.ActionTypes={RECEIVE_PRESENCE_DELTA:"RECEIVE_PRESENCE_DELTA",RECEIVE_PRESENCE_SNAPSHOT:"RECEIVE_PRESENCE_SNAPSHOT",RESET_PASS_INFO:"RESET_PASS_INFO",UPDATE_SEEN_STATE_INFO:"UPDATE_SEEN_STATE_INFO"},e})}.call(this),function(){define("modules/clean/react/pass/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/react/pass/event_bus_queue",["jquery","external/underscore","modules/clean/event_emitter","modules/constants/env","modules/constants/file_viewer","modules/core/uri"],function(n,o,i,r,s,a){var l,u;return l=function(){function t(t,n){this.getDelay=e(this.getDelay,this),this.fail=e(this.fail,this),this.reset=e(this.reset,this),this.numberOfRetries=0,this.slotTime=t,this.maxExponent=Math.floor(Math.log(n/this.slotTime)/Math.log(2))}return t.prototype.reset=function(){return this.numberOfRetries=0},t.prototype.fail=function(){return this.numberOfRetries+=1},t.prototype.getDelay=function(){var e,t;return t=Math.min(Math.floor(this.numberOfRetries*Math.sqrt(this.numberOfRetries)),this.maxExponent),e=Math.floor(Math.random()*Math.pow(2,t))*this.slotTime},t}(),u=function(i){function s(t){this._handlePollError=e(this._handlePollError,this),this._handlePollSuccess=e(this._handlePollSuccess,this),this._longPoll=e(this._longPoll,this),s.__super__.constructor.call(this),this.queueInfo=t,this.host=r.HARMONY_SERVER,this.backoff=new l(100,3e5),this.lastEventId="-1"}return t(s,i),s.prototype.start=function(){return this._started?void 0:(this._started=!0,this._longPoll())},s.prototype.end=function(e){return this._started=!1,null!=this._longPollXhr?this._longPollXhr.abort():o.defer(function(e){return function(){return e.emit("close")}}(this)),n.ajax({contentType:"application/json",url:this._longPollUri().toString(),type:"DELETE",beforeSend:function(e){return function(t){return e._setEventBusAuthHeader(t)}}(this),async:e})},s.prototype._longPoll=function(){return this._started?this._longPollXhr=n.ajax({contentType:"application/json",url:this._longPollUri().toString(),type:"POST",processData:!1,data:JSON.stringify({last_event_id:this.lastEventId}),timeout:6e4,beforeSend:function(e){return function(t){return e._setEventBusAuthHeader(t)}}(this),success:this._handlePollSuccess,error:this._handlePollError}):void 0},s.prototype._longPollUri=function(){return a({scheme:"https",authority:this.host,path:"/api/v1/events"})},s.prototype._setEventBusAuthHeader=function(e){var t,n,o;return n=this.queueInfo.queue_id,o=this.queueInfo.queue_token,t=window.btoa(n+":"+o),e.setRequestHeader("HTTP-X-EVENTQUEUE-AUTHORIZATION","Basic "+t)},s.prototype._handlePollSuccess=function(e){return e=JSON.parse(e),this._longPollXhr=null,"success"===e.result&&null!=e.events&&e.events.length>0?(this.emit("poll"),this.backoff.reset(),o.defer(this._longPoll),this.lastEventId=e.events[e.events.length-1].id,"heartbeat"!==e.events[0].type?this.emit("events",e.events):void 0):(this.backoff.fail(),window.setTimeout(this._longPoll,this.backoff.getDelay()))},s.prototype._handlePollError=function(e,t){return this._longPollXhr=null,this._started?e.status>=400&&e.status<500?(this.emit("error",e.status),this.emit("close",!0)):(this.backoff.fail(),window.setTimeout(this._longPoll,this.backoff.getDelay())):this.emit("close",!1)},s}(i)})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/pass/store",["external/underscore","modules/clean/flux/flux_store","modules/clean/react/pass/constants","modules/clean/react/pass/dispatcher","modules/clean/react/pass/utils"],function(t,o,i,r,s){var a,l,u,c;return a=i.ActionTypes,c=s.SeenStateHelpers,u=function(){function e(){this._userIdToUniqueIds={}}return e.prototype.addUniqueUser=function(e,t){return e in this._userIdToUniqueIds||(this._userIdToUniqueIds[e]={}),this._userIdToUniqueIds[e][t]=!0},e.prototype.removeUniqueUser=function(e,t){return e in this._userIdToUniqueIds&&t in this._userIdToUniqueIds[e]&&(delete this._userIdToUniqueIds[e][t],!Object.keys(this._userIdToUniqueIds[e]).length)?delete this._userIdToUniqueIds[e]:void 0},e.prototype.getOnlineUserIds=function(){return Object.keys(this._userIdToUniqueIds)},e}(),new(l=function(o){function i(e){i.__super__.constructor.call(this,e),this._seenStateInfos={},this._presenceInfos={}}return e(i,o),i.prototype.presence=function(e,t){var n;return n=this._fileKey(e,t),n in this._presenceInfos?this._presenceInfos[n].getOnlineUserIds():null},i.prototype.seenStateInfo=function(e,t){var n;return n=this._fileKey(e,t),this._seenStateInfos[n]||null},i.prototype._resetPassInfo=function(e,t){var n;return n=this._fileKey(e,t),delete this._seenStateInfos[n],delete this._presenceInfos[n],this.__emitChange()},i.prototype._fileKey=function(e,t){return e+":"+t},i.prototype._receivePresenceDelta=function(e,t,n,o,i){var r,s;return r=this._fileKey(t,n),s=this._getOnlineUsersForFileKey(r),this._updatePresenceInfos(r,o,i),this._updateSeenStateInfoWithUpdatedPresence(e,t,n,r,s)},i.prototype._receivePresenceSnapshot=function(e,t,n,o){var i,r;return i=this._fileKey(t,n),r=this._getOnlineUsersForFileKey(i),this._presenceInfos[i]=new u,this._updatePresenceInfos(i,o,[]),this._updateSeenStateInfoWithUpdatedPresence(e,t,n,i,r)},i.prototype._getOnlineUsersForFileKey=function(e){return e in this._presenceInfos||(this._presenceInfos[e]=new u),this._presenceInfos[e].getOnlineUserIds()},i.prototype._updatePresenceInfos=function(e,t,n){var o,i,r,s,a,l;for(i in n){l=n[i];for(a in l)o=l[a],this._presenceInfos[e].removeUniqueUser(i,a)}s=[];for(r in t)l=t[r],s.push(function(){var t;t=[];for(a in l)o=l[a],t.push(this._presenceInfos[e].addUniqueUser(r,a));return t}.call(this));return s},i.prototype._updateSeenStateInfoWithUpdatedPresence=function(e,n,o,i,r){var s,a,l,u;return l=this._getOnlineUsersForFileKey(i),s=t.difference(r,l),a=t.difference(l,r),u=this._makeSeenStateAgreeWithUpdatedPresence(i,l,s,a),this._fetchUnknownSeenStatesOrEmitChange(e,n,o,i,u)},i.prototype._makeSeenStateAgreeWithUpdatedPresence=function(e,t,o,i){var r,s,a,l,u,c,d,p,h,_,m,f;if(!(e in this._seenStateInfos))return[];for(m=[],f=this._seenStateInfos[e].seen_states,d=[],u=[],l=[],c=Date.now()/1e3,s=r=0,a=f.length;a>r;s=++r)h=f[s],_=h.seen_state_user.user_id,m.push(_),n.call(i,_)>=0?(h.when_last_seen=c,u.push(h)):n.call(o,_)>=0?(h.when_last_seen=c,l.push(h)):d.push(h);return this._seenStateInfos[e].seen_states=u.concat(l,d),function(){var e,o,i;for(i=[],e=0,o=t.length;o>e;e++)p=t[e],n.call(m,p)<0&&i.push(p);return i}()},i.prototype._fetchUnknownSeenStatesOrEmitChange=function(e,t,n,o,i){return i.length?c.fetchSeenStateUsers(e,this._seenStateInfos[o],i,t,n):this.__emitChange()},i.prototype._updateSeenStateInfo=function(e,t,n){return this._seenStateInfos[this._fileKey(e,t)]=n,this.__emitChange()},i.prototype.__onDispatch=function(e){var t;switch(t=e.action.data,e.action.type){case a.RECEIVE_PRESENCE_DELTA:return this._receivePresenceDelta(t.userId,t.nsId,t.sjid,t.onlineUniqueUsers,t.offlineUniqueUsers);case a.RECEIVE_PRESENCE_SNAPSHOT:return this._receivePresenceSnapshot(t.userId,t.nsId,t.sjid,t.onlineUniqueUsers);case a.RESET_PASS_INFO:return this._resetPassInfo(t.nsId,t.sjid);case a.UPDATE_SEEN_STATE_INFO:return this._updateSeenStateInfo(t.nsId,t.sjid,t.seenStateInfo)}},i}(o))(r)})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/pass/utils",["external/rsvp","external/underscore","modules/clean/ajax","modules/clean/api_v2/client","modules/clean/api_v2/error","modules/clean/beacon","modules/clean/previews/util","modules/clean/react/pass/event_bus_queue","modules/core/exception","modules/clean/react/pass/actions","modules/clean/uuid","modules/clean/viewer","modules/constants/file_viewer","modules/constants/python"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D;return A=t.Promise,g=i.ApiV2Client,D=r.catchApiError,m=s.Agent,f=s.AgentStatus,S=s.Platforms,I=s.PresenceParams,P=s.PresenceType,N=s.Receiver,O=s.Transmitter,k=s.Source,T=a.PermissionHelper,v=_.BEACON_OFFLINE_STATUS,y=_.BEACON_ONLINE_STATUS,w={setup:function(e,t,n,o,i,r){var s,a;if(T.is_seen_state_enabled(e)&&T.is_presence_enabled(e))return R.fetchSeenStateInfo(e.id,t.ns_id,t.sjid,o),C.updatePresence(t.ns_id,t.sjid,e.id,o),h.FILE_VIEWER_PRESENCE_USE_BEACON?(s=new E(t,n),a=null!=i?new E(i,r):null,b.updatePresence(s,a,e)):void 0},teardown:function(e,t,n,o){var i;if(T.is_seen_state_enabled(e)&&T.is_presence_enabled(e))return C.shutdownPresence(o),h.FILE_VIEWER_PRESENCE_USE_BEACON?(i=new E(t,n),b.shutdown(i,e.account_id)):void 0}},E=function(){function e(e,t){t?this.authKey="pass_"+t.linkType+"-"+t.linkKey:this.authKey="pass",this.nsId=e.ns_id,this.sjid=e.sjid,this.context=e.beacon_context}return e}(),b={_BEACON_APP:"harmony",_BEACON_PLATFORM:S.WEB,_BEACON_SURFACE:"file_viewer",_receiver:null,_transmitter:null,_identifier:null,updatePresence:function(e,t,n){return this._transmitBeaconData(e,t,n.account_id),h.FILE_VIEWER_PRESENCE_RECEIVE_BEACON?this._receiveBeaconData(e,n):void 0},shutdown:function(e,t){return this._transmitter&&(e&&this._transmitter.add_or_update_agents([this._getAgentStatusForFile(t,e,v)]),this._transmitter.stop(),delete this._transmitter,delete this._identifier),this._receiver?(this._receiver.stop(),delete this._receiver):void 0},_receiveBeaconData:function(e,t){return this._receiver&&this._receiver.stop(),o.SilentBackgroundRequest({url:"/get_pass_receiver_token",type:"GET",data:{account_id:t.account_id,auth_key:e.authKey,context:e.context},success:function(n){return function(o){var i,r;return r=o,i=[new I(P.Context,t.account_id,n._BEACON_APP,e.context,r)],n._receiver=new N(i,function(o){return n._onUpdate(o,t.id,e)},function(){return n._receiveBeaconData(e,t)}),n._receiver.start()}}(this)})},_onUpdate:function(e,t,n){var o,i;return o=e[0],o.delta?(i=this._parseBeaconUpdates(o.delta),c.receivePresenceDelta(t,n.nsId,n.sjid,i.onlineUniqueUsers,i.offlineUniqueUsers)):o.snapshot?(i=this._parseBeaconUpdates(o.snapshot),c.receivePresenceSnapshot(t,n.nsId,n.sjid,i.onlineUniqueUsers)):void 0},_parseBeaconUpdates:function(t){var n,o,i,r,s,a,l,u;for(a={},s={},i=0,r=t.length;r>i;i++)o=t[i],n=o.agent,u=n.user_id,e.call(p.get_viewer().get_account_ids(),u)<0&&(l=n.source.identifier,o.status===y?(u in a||(a[u]={}),a[u][l]=!0):o.status===v&&(u in s||(s[u]={}),s[u][l]=!0));return{onlineUniqueUsers:a,offlineUniqueUsers:s}},_transmitBeaconData:function(e,t,n){var o;return this._transmitter?(o=[],t&&o.push(this._getAgentStatusForFile(n,t,v)),o.push(this._getAgentStatusForFile(n,e,y)),this._transmitter.add_or_update_agents(o)):(this._identifier=d.v4({allowInsecure:!0}),this._fetchTransmitterToken(n,e))},_getAgentStatusForFile:function(e,t,n){var o,i;return i=new k(this._BEACON_PLATFORM,this._BEACON_SURFACE,this._identifier),o=new m(e,this._BEACON_APP,t.context,i),new f(o,n,t.authKey)},_fetchTransmitterToken:function(e,t){return o.SilentBackgroundRequest({url:"/get_pass_transmitter_token",type:"GET",data:{account_id:e},success:function(n){return function(o){var i;return i=o,n._transmitter?n._transmitter.update_token(i):n._transmitter=new O(i,function(){return n._fetchTransmitterToken(e,t)}),t&&n._transmitter.add_or_update_agents([n._getAgentStatusForFile(e,t,y)]),n._transmitter.start()}}(this)})}},C={PRESENCE_STATES:{OFFLINE:"offline",VIEWER:"viewer",MODIFIER:"modifier",IDLE:"idle"},_eventBusQueue:null,_isOnline:function(t){return u.assert(e.call(n.values(this.PRESENCE_STATES),t)>=0,"Status "+t+" is invalid."),t===this.PRESENCE_STATES.VIEWER||t===this.PRESENCE_STATES.MODIFIER||t===this.PRESENCE_STATES.IDLE},_parsePresenceData:function(t){var n,o,i,r,s,a,l;for(r={},i={},n=0,o=t.length;o>n;n++)s=t[n],l=s.user_id,e.call(p.get_viewer().get_account_ids(),l)<0&&(a=s.unique_id,this._isOnline(s.status)?(l in r||(r[l]={}),r[l][a]=!0):(l in i||(i[l]={}),i[l][a]=!0));return{onlineUniqueUsers:r,offlineUniqueUsers:i}},shutdownPresence:function(e){return null!=this._eventBusQueue?(this._eventBusQueue.end(e),delete this._eventBusQueue):void 0},updatePresence:function(e,t,n,i){return o.SilentBackgroundRequest({url:"/update_presence/update_web_presence",dataType:"json",data:{ns_id:e,sjid:t,status:this.PRESENCE_STATES.VIEWER,queue_id:null!=this._eventBusQueue?this._eventBusQueue.queueInfo.queue_id:null,url:i||null},success:function(o){return function(r){var s;return null==o._eventBusQueue||o._eventBusQueue.queueInfo.queue_id!==r.bolt_data.queue_id?(o.shutdownPresence(),o._eventBusQueue=new l(r.bolt_data),h.FILE_VIEWER_PRESENCE_RECEIVE_BEACON||o._eventBusQueue.start()):(o._eventBusQueue.removeAllListeners("events"),o._eventBusQueue.removeAllListeners("error")),h.FILE_VIEWER_PRESENCE_RECEIVE_BEACON?void 0:(o._eventBusQueue.on("events",function(i){var r;return r=o._parsePresenceData(i),o._receivePresenceDelta(n,e,t,r.onlineUniqueUsers,r.offlineUniqueUsers)}),o._eventBusQueue.on("error",function(r){return 403===r?(o.shutdownPresence(),o.updatePresence(e,t,n,i)):void 0}),s=o._parsePresenceData(r.presence_data),o._receivePresenceDelta(n,e,t,s.onlineUniqueUsers,s.offlineUniqueUsers))}}(this),error:function(){return c.resetPassInfo(e,t)},subject_user:n})},_receivePresenceDelta:function(e,t,n,o,i){return c.receivePresenceDelta(e,t,n,o,i)}},R={_constructFakeSeenStateInfo:function(e,t,n){var o,i,r,s,a;for(a=n.seen_states,i=0,r=e.length;r>i;i++)s=e[i],o={seen_state_user:s,when_last_seen:t},a.unshift(o);return n.seen_states=a,n},fetchSeenStateUsers:function(e,t,n,o,i){var r,s;return r=Date.now()/1e3,s=(new g).rpc(e,"seen_state/get_seen_state_users",{user_ids:n}).catch(D(function(){return c.resetPassInfo(o,i),A.reject()})).then(function(e){return function(n){var s;return s=e._constructFakeSeenStateInfo(n,r,t),c.updateSeenStateInfo(o,i,s)}}(this))},fetchSeenStateInfo:function(e,t,n,o){var i,r;return i="sjid:"+n,r=(new g).rpc(e,"seen_state/get_seen_state_info",{file_infos:[{ns_id:t,file_identifier:i,url:o}]}).catch(D(function(){return c.resetPassInfo(t,n),A.reject()})).then(function(e){var o;return o=e[0].seen_state_info,c.updateSeenStateInfo(t,n,o)})},getCoachmark:function(e,t){var n;return n=(new g).rpc(e,"seen_state/get_coachmark_info",null).catch(D(function(){return A.reject()})).then(function(e){var n;return n=e.type_with_data[".tag"],t(n),A.resolve()})},logCoachmarkInteraction:function(e,t,n){var o;return o=(new g).rpc(e,"seen_state/log_coachmark_interaction",{type:t,interaction:n}).catch(D(function(){return A.reject()})).then(function(){return A.resolve()})},filterSeenStates:function(t,n){var o,i,r,s,a,l,u;for(o=[],a={},i=0,r=t.length;r>i;i++)u=t[i],l=u.seen_activity_user,null==u.when_last_seen||(s=l.id,e.call(n.get_user_ids(),s)>=0)||l.paired_user_id in a||(o.push(u),a[l.id]=!0);return o},orderSeenStates:function(t,n){return t.sort(function(t,o){var i,r;if(null!=n){if(i=t.seen_activity_user.id,e.call(n,i)>=0)return-1;if(r=o.seen_activity_user.id,e.call(n,r)>=0)return 1}return t.when_last_seen>o.when_last_seen?-1:1}),t}},{BeaconFileData:E,BeaconPresenceHelpers:b,PassHelpers:w,PresenceHelpers:C,SeenStateHelpers:R}})}.call(this),function(){define("modules/clean/react/portal",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/react/css"],function(e,t,n,o,i,r){var s;return s=n.createClass({displayName:"Portal",propTypes:{parentElement:n.PropTypes.instanceOf(HTMLElement).isRequired,onRendered:n.PropTypes.func,children:n.PropTypes.element.isRequired},getDefaultProps:function(){return{onRendered:i.noop}},createRenderTargetNode:function(t){var n,o;return t?(o=document.createElement("div"),o.className="react-portal-container",n=e(t).children().not(".react-portal-container").first(),t.insertBefore(o,n.get(0)),o):null},componentDidMount:function(){return this.props.parentElement?this._renderPortalContainerAndContents():void 0},componentWillUnmount:function(){return this._closeCurrentPortal()},componentDidUpdate:function(e){return e.parentElement===this.props.parentElement?this._renderPortalContentsInContainer(this._portalContainerNode):this._renderPortalContainerAndContents()},_closeCurrentPortal:function(){return this._portalContainerNode?(o.unmountComponentAtNode(this._portalContainerNode),this._portalContainerNode.parentNode.removeChild(this._portalContainerNode),this._portalContainerNode=null):void 0},_renderPortalContainerAndContents:function(){return this._closeCurrentPortal(),this._portalContainerNode=this.createRenderTargetNode(this.props.parentElement),this._renderPortalContentsInContainer(this._portalContainerNode)},_renderPortalContentsInContainer:function(e){return e?o.render(n.Children.only(this.props.children),e,this.props.onRendered):void 0},render:function(){return null}}),r(s,["/static/css/react/portal_overlay-vflCJkoX6.css"])})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio",["external/classnames","external/react","external/react-dom","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/average_counter","modules/clean/react/file_viewer/constants","modules/clean/react/previews/audio/preview_audio_play_button","modules/clean/react/previews/audio/preview_audio_details","modules/clean/react/previews/audio/preview_audio_visuals","modules/clean/react/previews/audio/preview_audio_volume","modules/clean/react/previews/audio/utils","modules/clean/web_timing_logger"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m){var f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D;return k=r._,b=u.EventTypes,I=_.PreviewAudioHelpers,R=_.PreviewAudioWaveformHelpers,O=t.DOM,D=t.PropTypes,A=t.createFactory(p),P=t.createFactory(c),C=t.createFactory(d),N=t.createFactory(h),g=2,f=1,T=1e3,v=100,w=.85,y=500,E="dropbox_duc_id",S=t.createClass({displayName:"PreviewAudio",propTypes:{src:D.string.isRequired,onError:D.func,filePreviewSession:t.PropTypes.object},getInitialState:function(){return{time:0,duration:0,bufferedLength:0,isPlaying:!1,isReady:!1,isMuted:!1,volumeLevel:1,rawWaveformHeights:[],waveformWidth:0,isContainerSet:!1}},componentDidMount:function(){var e;return this._logFilePreviewEvent(b.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(b.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),e=this._getAudioNode(),e.addEventListener("timeupdate",this._updateTime),e.addEventListener("durationchange",this._updateDuration),e.addEventListener("ended",this._pauseFile),e.addEventListener("canplay",this._setReady),e.addEventListener("progress",this._updateProgress),e.addEventListener("error",this._throwError),this._setWaveformWidth(),window.addEventListener("resize",this._getDebouncedWaveformWidthFunction()),this._sendWaveFormRequest()},componentWillUnmount:function(){var e,t;return e=this._getAudioNode(),e.removeEventListener("timeupdate",this._updateTime),e.removeEventListener("durationchange",this._updateDuration),e.removeEventListener("ended",this._pauseFile),e.removeEventListener("canplay",this._setReady),e.removeEventListener("progress",this._updateProgress),e.removeEventListener("error",this._throwError),window.removeEventListener("resize",this._getDebouncedWaveformWidthFunction()),null!=(null!=(t=this._audioContext)?t.close:void 0)?this._audioContext.close():void 0},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_getAudioNode:function(){return n.findDOMNode(this.refs.audio)},_getDebouncedWaveformWidthFunction:function(){return this._debouncedWaveformWidthFunction||(this._debouncedWaveformWidthFunction=o.debounce(this._setWaveformWidth,100)),this._debouncedWaveformWidthFunction},_setWaveformWidth:function(){return this.isMounted()?this.setState({waveformWidth:n.findDOMNode(this.refs.audioWrapper).offsetWidth}):void 0},_getSrcUrl:function(){var e,t;return e=a.parse(this.props.src),e.updateQuery("duc_id",E),t=e.toString(),"//"===t.slice(0,2)&&(t="https:"+t),t},_setReady:function(){return this.props["log-time-to-interactive"]&&(m.mark_time_to_view(),m.mark_time_to_interactive()),this.setState({isReady:!0}),this._logFilePreviewEvent(b.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(b.FILE_PREVIEW_RENDER_SUCCEEDED),setTimeout(this._setContainer.bind(this),y)},_setContainer:function(){return this.setState({isContainerSet:!0})},_getBufferProgress:function(){var e;return e=this._getAudioNode(),e.duration&&e.buffered.length?e.buffered.end(e.buffered.length-1):0},_updateProgress:function(){var e;return e=this._getBufferProgress(),this.setState({bufferedLength:e})},_updateTime:function(){return this.setState({time:this._getAudioNode().currentTime})},_updateTimeTo:function(e){return this._getAudioNode().currentTime=e,this.setState({time:e})},_updateDuration:function(){var e;return e=this._getBufferProgress(),this.setState({duration:this._getAudioNode().duration,bufferedLength:e})},_playOrPause:function(){return this.state.isPlaying?this._pauseFile():this._playFile()},_playFile:function(){return this._getAudioNode().play(),this.setState({isPlaying:!0})},_pauseFile:function(){return this._getAudioNode().pause(),
this.setState({isPlaying:!1})},_toggleMute:function(){var e,t;return t=this.state.isMuted?this.state.volumeLevel||.1:0,this._getAudioNode().volume=t,e={isMuted:!this.state.isMuted},0===this.state.volumeLevel&&(e.volumeLevel=t),this.setState(e)},_changeVolumeTo:function(e){return this._getAudioNode().volume=e,this.setState({volumeLevel:e,isMuted:!e})},_sendWaveFormRequest:function(){var e;return this._setAudioContext(),null==this._audioContext?this._logFailedWaveformGeneration():(e=new XMLHttpRequest,e.open("GET",this._getSrcUrl()),e.responseType="arraybuffer",e.withCredentials=!0,e.onreadystatechange=function(t){return function(){return 4===e.readyState&&t.isMounted()?200===e.status?t._audioContext.decodeAudioData(e.response,t._parseWaveFormBuffer,t._logFailedWaveformGeneration):t._logFailedWaveformGeneration():void 0}}(this),e.send())},_throwError:function(){return s.error(k("An audio error occurred")),i.reportException({err:new Error("Audio file failed to play"),tags:["audioPreviews"],severity:i.SEVERITY.NONCRITICAL}),this._logFilePreviewEvent(b.FILE_PREVIEW_DOWNLOAD_FAILED),this.props.onError()},_updateWaveformState:function(e){return this.isMounted()?this.setState({rawWaveformHeights:e}):void 0},_logFailedWaveformGeneration:function(){return i.reportException({err:new Error("Audio could not be decoded"),tags:["audioPreviews"],severity:i.SEVERITY.NONCRITICAL})},_parseWaveFormBuffer:function(e){return this._setWaveformWidth(),R.buildFromBuffer(e,T,v,this.isMounted.bind(this),this._updateWaveformState)},_setAudioContext:function(){var e;return e=window.AudioContext||window.webkitAudioContext,e?this._audioContext=new e:void 0},_renderAudioTag:function(){return O.audio({src:this._getSrcUrl(),preload:"auto",ref:"audio"})},_generateWaveform:function(){var e;return e=Math.floor((this.state.waveformWidth-f)/(g+f)),R.returnWaveform(this.state.rawWaveformHeights,e,w)},_renderRadio:function(){var t,n;return n=0!==this.state.rawWaveformHeights.length,t=e({"preview-audio__radio":!0,"preview-audio__radio--hidden":!this.state.isReady||n}),O.div({className:t},I.getRadioImage())},_renderLoading:function(){return O.div({className:"preview-audio__load-wheel"},I.getLoaderWheel())},_renderWaveForm:function(){return A({generateWaveform:this._generateWaveform,time:this.state.time,duration:this.state.duration,bufferedLength:this.state.bufferedLength,updateTime:this._updateTimeTo,barWidth:g,barSpacing:f,waveformWidth:this.state.waveformWidth,isWaveformReady:0!==this.state.rawWaveformHeights.length,isPlayerReady:this.state.isReady,isContainerSet:this.state.isContainerSet})},_renderToolbar:function(){return O.div({className:"toolbar"},this._renderPlayButton(),this._renderDetails(),this._renderVolume())},_renderPlayButton:function(){return P({isPlaying:this.state.isPlaying,onChange:this._playOrPause})},_renderDetails:function(){return C({time:this.state.time,duration:this.state.duration})},_renderVolume:function(){return N({isMuted:this.state.isMuted,volumeLevel:this.state.volumeLevel,onVolumeChange:this._changeVolumeTo,onMuteToggle:this._toggleMute})},render:function(){var t;return t=e({"preview-audio__container":!0,"preview-audio__container--loading":!this.state.isReady}),O.div({className:"flex-preview-container"},O.div({className:"preview-audio preview-content preview-content--center"},O.div({className:"preview-audio__wrapper",ref:"audioWrapper"},O.div({className:"preview-audio__aspect-container"},O.div({className:t},this._renderAudioTag(),this._renderRadio(),this.state.isReady?[this._renderWaveForm(),this._renderToolbar()]:this._renderLoading())))))}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_details",["external/react","modules/clean/datetime","modules/core/i18n"],function(e,t,n){var o,i,r,s,a;return s=t.formatAudioTime,i=n._,r=e.DOM,a=e.PropTypes,o=e.createClass({displayName:"PreviewAudioDetails",propTypes:{time:a.number.isRequired,duration:a.number.isRequired},_formatString:function(e){return i("%(time)s").format({time:s(e)})},_getDisplayString:function(){return r.span({className:"toolbar-details__time"},this._formatString(this.props.time)+" / "+this._formatString(this.props.duration))},render:function(){return r.div({className:"toolbar-details vertical-align"},r.div({className:"toolbar-details__string vertical-align__child"},this._getDisplayString()))}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_play_button",["external/react","modules/clean/react/previews/audio/utils"],function(e,t){var n,o,i,r;return o=t.PreviewAudioHelpers,i=e.DOM,r=e.PropTypes,n=e.createClass({displayName:"PreviewAudioControls",propTypes:{isPlaying:r.bool.isRequired,onChange:r.func.isRequired},_getIconString:function(){return this.props.isPlaying?"pause":"play"},_renderButtonImage:function(){return o.getSprite(this._getIconString())},render:function(){return i.button({className:"toolbar-controller vertical-align",onClick:this.props.onChange},i.div({className:"toolbar-controller__button vertical-align__child"},this._renderButtonImage()))}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_visuals",["external/classnames","external/react","external/react-dom"],function(e,t,n){var o,i,r,s;return r=t.DOM,s=t.PropTypes,o=.4,i=t.createClass({displayName:"PreviewAudioVisuals",propTypes:{generateWaveform:s.func.isRequired,time:s.number.isRequired,duration:s.number.isRequired,bufferedLength:s.number.isRequired,updateTime:s.func.isRequired,barWidth:s.number.isRequired,barSpacing:s.number.isRequired,waveformWidth:s.number.isRequired,isWaveformReady:s.bool.isRequired,isPlayerReady:s.bool.isRequired,isContainerSet:s.bool.isRequired},getInitialState:function(){return{scrubPercentage:0,isMouseDown:!1}},_getSeekPercentageFromEvent:function(e){var t,o;return t=n.findDOMNode(this.refs.waveform).getBoundingClientRect(),o=e.pageX-t.left,o/t.width},_getProgress:function(){return this.props.time/(this.props.duration||1)},_getBuffered:function(){return this.state.scrubPercentage>0?this.state.scrubPercentage:this.props.isContainerSet?this.props.bufferedLength/(this.props.duration||1):0},_getWidthObject:function(e){return{width:e+"%"}},_scrubTime:function(e){var t;return t=this._getSeekPercentageFromEvent(e),this._updateWaveformScrubToPercentage(t),this.state.isMouseDown?this._updateTime(e):void 0},_resetScrub:function(){return this._updateWaveformScrubToPercentage(0),this._setMouseUp()},_updateWaveformScrubToPercentage:function(e){return this.setState({scrubPercentage:e})},_updateTime:function(e){var t,n;return n=this._getSeekPercentageFromEvent(e),t=n*this.props.duration,this.props.updateTime(t)},_setMouseDown:function(){return this.setState({isMouseDown:!0})},_setMouseUp:function(){return this.setState({isMouseDown:!1})},_getScrubObject:function(e){return{onClick:this._updateTime,onMouseMove:this._scrubTime,onMouseLeave:this._resetScrub,onMouseDown:this._setMouseDown,onMouseUp:this._setMouseUp,className:e}},_getWavebarClasses:function(t){return e({wavebar__single:!0,"wavebar__single--scrubbed":t})},_renderWaveBar:function(e,t){var n,o,i,s,a,l,u;return s=1-e,l={top:100*s+"%",height:100*e+"%"},u=this.props.waveformWidth,n=(t+1)*(this.props.barWidth+this.props.barSpacing)-this.props.barWidth,this.state.scrubPercentage>0?(a=this.state.scrubPercentage*u,o=this._getWavebarClasses(a>n)):(i=this._getProgress()*u,o=this._getWavebarClasses(i>n)),[r.div({className:"wavebar__single wavebar__space"}),r.div({className:o,style:l})]},_renderWaveBars:function(){var t,n,o,i;return n=e({wavebar__container:!0,"wavebar__container--ready":this.props.isWaveformReady}),o=this.props.isWaveformReady?this._getScrubObject(n):{className:n},r.div(o,function(){var e,n,o,r;for(o=this.props.generateWaveform(),r=[],i=e=0,n=o.length;n>e;i=++e)t=o[i],r.push(this._renderWaveBar(t,i));return r}.call(this))},_renderWaveForm:function(){var e;return e=this.props.isWaveformReady?this._getWidthObject(100*this.state.scrubPercentage):this._getWidthObject(0),r.div({className:"waveform"},r.div({className:"waveform__scrub",style:e,ref:"waveformScrub"}),this._renderWaveBars())},_renderProgressBar:function(){var t,n,o;return o=100*this._getProgress(),t=100*this._getBuffered(),n=e({"audio-progress-bar__done":!0,"audio-progress-bar__showing":o}),r.div(this._getScrubObject("audio-progress-bar"),r.div({className:"audio-progress-bar__buffered",style:this._getWidthObject(t)}),r.div({className:n,style:this._getWidthObject(o)}))},render:function(){return r.div({className:"visuals",ref:"waveform"},this._renderWaveForm(),this._renderProgressBar())}})})}.call(this),function(){define("modules/clean/react/previews/audio/preview_audio_volume",["external/react","external/react-dom","modules/clean/react/previews/audio/utils"],function(e,t,n){var o,i,r,s;return o=n.PreviewAudioHelpers,r=e.DOM,s=e.PropTypes,i=e.createClass({displayName:"PreviewAudioVolume",propTypes:{isMuted:s.bool.isRequired,volumeLevel:s.number.isRequired,onVolumeChange:s.func.isRequired,onMuteToggle:s.func.isRequired},getInitialState:function(){return{isMouseDown:!1}},_setMouseDown:function(){return this.setState({isMouseDown:!0})},_setMouseUp:function(){return this.setState({isMouseDown:!1})},_getVolumePercentageFromEvent:function(e){var n,o;return o=t.findDOMNode(this.refs.volumebar).getBoundingClientRect(),n=e.pageX-o.left,n/o.width},_safeChangeVolume:function(e){return this.state.isMouseDown?this._changeVolume(e):void 0},_changeVolume:function(e){var t;return t=this._getVolumePercentageFromEvent(e),this.props.onVolumeChange(t)},_getIconString:function(){return this.props.isMuted?"volumeMuted":"volume"},_renderVolumeImage:function(){var e;return e=o.getSprite(this._getIconString()),r.div({className:"toolbar-volume__button vertical-align__child"},r.button({onClick:this.props.onMuteToggle},e))},_renderVolumeBar:function(){var e,t;return t=this.props.isMuted?0:100*this.props.volumeLevel,e={width:t+"%"},r.div({className:"volume-bar vertical-align__child",onMouseUp:this._setMouseUp,onMouseDown:this._setMouseDown,onMouseLeave:this._setMouseUp,onMouseMove:this._safeChangeVolume,onClick:this._changeVolume},r.div({className:"volume-bar__container",ref:"volumebar"},r.div({className:"volume-bar__selected",style:e})))},render:function(){return r.div({className:"toolbar-volume vertical-align"},this._renderVolumeImage(),this._renderVolumeBar())}})})}.call(this),function(){define("modules/clean/react/previews/audio/utils",["external/react","external/underscore","modules/clean/average_counter","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,s){var a,l,u,c;return c=r.static_url,u=s._,a={getSprite:function(t){var n;return n=u("%(state)s").format({state:t}),e.createElement(i,{group:"web",name:t,alt:n})},getLoaderWheel:function(){return e.createElement(o,{src:c("/static/images/icons/spinner-blue-overlay-vflLgNAM7.gif"),srcHiRes:c("/static/images/icons/spinner-blue-overlay@2x-vflpi64gx.gif")})},getRadioImage:function(){return e.createElement(o,{src:c("/static/images/icons/waveformEmpty-vflZHW9X-.png"),srcHiRes:c("/static/images/icons/waveformEmpty@2x-vflZvenXO.png")})}},l={buildFromBuffer:function(e,t,o,i,r){var s,a,l;return a=e.getChannelData(0),l=new Array(t),s=function(e){return function(){var u,c,d,p,h,_;return e>=t?void r(l):(d=Math.ceil(e*a.length/t),c=Math.ceil((e+1)*a.length/t),h=c-d,p=h>o?function(){var e,t,n;for(n=[],_=e=0,t=o;t>=0?t>e:e>t;_=t>=0?++e:--e)n.push(Math.abs(a[parseInt(Math.random()*h)+d]));return n}():a.slice(d,c),u=new n,u.addArray(p),l[e]=u.getAverage(),i()?setTimeout(s(e+1),0):void 0)}},setTimeout(s(0),0)},returnWaveform:function(e,o,i){var r,s,a,l,u,c,d,p,h,_,m;if(null==i&&(i=1),_=[],0===e.length||0>=o)return _;for(l=0,p=0,s=function(){var e,t,i;for(i=[],m=e=0,t=o;t>=0?t>e:e>t;m=t>=0?++e:--e)i.push(new n);return i}(),u=c=0,d=e.length;d>c;u=++c)h=e[u],a=Math.floor(u*o/e.length),r=s[a],r.add(h),_[a]=r.getAverage(),a!==p&&(l=Math.max(l,_[p]),p=a);return l=Math.max(l,_[o-1]),t.map(_,function(e){return e*i/l})},generateRandomWaveform:function(e){var t;return function(){var n,o,i;for(i=[],t=n=0,o=e;o>=0?o>n:n>o;t=o>=0?++n:--n)i.push(Math.random());return i}()}},{PreviewAudioHelpers:a,PreviewAudioWaveformHelpers:l}})}.call(this),function(){define("modules/clean/react/previews/constants",[],function(){var e;return e={},e.ErrorTypes={LOAD_ERROR:"LOAD_ERROR",SUPPORT_ERROR:"SUPPORT_ERROR",EXTENSION_ERROR:"EXTENSION_ERROR",NEED_FLASH_ERROR:"NEED_FLASH_ERROR",FILE_SIZE_ERROR:"FILE_SIZE_ERROR",PASSWORD_PROTECTED_ERROR:"PASSWORD_PROTECTED_ERROR"},e})}.call(this),function(){define("modules/clean/react/previews/image_helpers",["modules/clean/photos/thumbnail_url_util"],function(e){var t,n,o;return o=e.thumbnailUrlForSize,t=[[480,320],[640,480],[800,600],[1024,768],[1280,960],[1600,1200],[2048,1536]],n={IMG_SIZES_ATTR:"90vw",getSrcSet:function(e){return t.map(function(t){var n,i;return i=t[0],n=t[1],o(e,i,n,3)+(" "+i+"w")}).join(", ")},getFallbackSrc:function(e){return o(e,800,600,3)},preloadImage:function(e){var t;t=new Image,t.srcset=this.getSrcSet(e),t.sizes=this.IMG_SIZES_ATTR,t.src=this.getFallbackSrc(e)}}})}.call(this),function(){define("modules/clean/react/previews/password_component",["external/react","external/react-dom"],function(e,t){var n,o,i,r;return r=e.DOM,i=r.input,o=r.form,n=e.createClass({displayName:"PasswordComponent",propTypes:{onPasswordSubmit:e.PropTypes.func.isRequired},_handleSubmit:function(e){var n,o;return e.preventDefault(),o=t.findDOMNode(this.refs.password).value,o&&"function"==typeof(n=this.props).onPasswordSubmit?n.onPasswordSubmit(o):void 0},render:function(){return o({className:"preview-blank-title",onSubmit:this._handleSubmit},[i({ref:"password",type:"password",defaultValue:"",autocomplete:"off"}),i({type:"submit",value:"Submit"})])}})})}.call(this),function(){define("modules/clean/react/previews/preview_blank",["external/classnames","external/react","jquery","modules/core/i18n","modules/core/uri","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_viewer/constants","modules/clean/react/sprite","modules/clean/web_timing_logger"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m;return d=l.EventTypes,m=t.DOM,_=t.createElement,h=o._,p=t.createClass({displayName:"PreviewBlank",propTypes:{filename:t.PropTypes.string.isRequired,maxFilenameEmLength:t.PropTypes.number.isRequired,icon:t.PropTypes.string.isRequired,created:t.PropTypes.object,size:t.PropTypes.string,isFallbackForLoadError:t.PropTypes.bool,filePreviewSession:t.PropTypes.object,shouldDisplayAnnotationsToolbar:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func},getDefaultProps:function(){return{isFallbackForLoadError:!1}},componentDidMount:function(){return this._logPreviewSupportDenied(),c.mark_time_to_view(),c.mark_time_to_interactive()},componentWillReceiveProps:function(){return this._logPreviewSupportDenied()},_logPreviewSupportDenied:function(){var e;return this.props.isFallbackForLoadError?void 0:null!=(e=this.props.filePreviewSession)?e.recordEvent(d.FILE_PREVIEW_SUPPORT_DENIED):void 0},_renderAnnotationsToolbar:function(){return m.div({className:"preview-toolbar-container"},t.createElement(r,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},render:function(){var t,n;return t=e({"preview-content":!0,"preview-content--center":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar}),m.div({className:"flex-preview-container"},m.div({className:t},m.div({className:"preview-blank-wrapper"},m.div({className:"preview-blank-icon"},_(u,{group:"web",name:this.props.icon,alt:""})),m.div({className:"preview-blank-title"},a.em_snippet(this.props.filename,this.props.maxFilenameEmLength)),m.div({className:"preview-blank-info"},null==this.props.created||isNaN(null!=(n=this.props.created)?n.getTime():void 0)?void 0:[m.span({},""+s.format_date(this.props.created,"MMMM dd, yyyy hh:mm a")),m.span({className:"bottom-dot"}," · ")],null!=this.props.size&&""!==this.props.size?m.span({},""+this.props.size):void 0)),this.props.shouldDisplayAnnotationsToolbar?this._renderAnnotationsToolbar():void 0))}})})}.call(this),function(){define("modules/clean/react/previews/preview_error",["external/classnames","external/react","modules/core/i18n","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/util","modules/clean/react_format","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/open_button","modules/clean/react/image","modules/clean/react/previews/constants","modules/clean/react/share_download/button","modules/clean/static_urls"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v,y,E,b,w,T,S,C,I;return w=n._,v=s.PermissionHelper,E=s.PreviewHelper,C=a.reactFormat,m=l.EventTypes,_=d.ErrorTypes,I=h.static_url,S=t.DOM,T=t.createElement,g=t.createFactory(u),b=t.createFactory(p),f=t.createFactory(c),y=t.createClass({displayName:"PreviewError",propTypes:{file:t.PropTypes.object.isRequired,maxFilenameEmLength:t.PropTypes.number.isRequired,filePreviewSession:t.PropTypes.object,errorType:t.PropTypes.oneOf(Object.keys(_)),user:t.PropTypes.object,areActionablesEnabled:t.PropTypes.bool,sharedLinkInfo:t.PropTypes.object,shareToken:t.PropTypes.object,sharePermissions:t.PropTypes.object,shouldDisplayAnnotationsToolbar:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func},getDefaultProps:function(){return{errorType:_.LOAD_ERROR,areActionablesEnabled:!0}},componentDidMount:function(){return this._logPreviewSupportDenied()},_isSharedFile:function(){return null!=this.props.sharedLinkInfo},_renderActionable:function(){return this.props.areActionablesEnabled?this._isSharedFile()?b({sharedLinkInfo:this.props.sharedLinkInfo,shareToken:this.props.shareToken,sharePermissions:this.props.sharePermissions,fileOrFolder:this.props.file,justifyRight:!1}):g({file:this.props.file,user:this.props.user,justifyRight:!1}):S.div()},_renderFileInfo:function(){var e;return e=E.get_filename(this.props.file),S.div({className:"preview-error__info"},i.em_snippet(e,this.props.maxFilenameEmLength),S.span({className:"bottom-dot"}," · "),this.props.file.size)},_renderErrorInfo:function(e,t){return S.div({},S.div({className:"u-mar-bottom-s"},e),S.div({className:"preview-error__message u-mar-xs"},t))},_getBadFiletypeErrorImage:function(){return f({src:I("/static/images/previews/error/filetypeNA_1x-vflTFvhxk.png"),srcHiRes:I("/static/images/previews/error/filetypeNA_2x-vflMDSiZI.png")})},_getTooBigErrorImage:function(){return f({src:I("/static/images/previews/error/large_1x-vflkPYeXF.png"),srcHiRes:I("/static/images/previews/error/large_2x-vflueyc5P.png")})},_getPasswordProtectedErrorImage:function(){return f({src:I("/static/images/previews/error/password_1x-vflYknWoW.png"),srcHiRes:I("/static/images/previews/error/password_2x-vflJBbjf_.png")})},_getNoPreviewErrorImage:function(){return f({src:I("/static/images/previews/error/previewNA_1x-vflUN_j0k.png"),srcHiRes:I("/static/images/previews/error/previewNA_2x-vflHuyT9c.png")})},_renderAnnotationsToolbar:function(){return S.div({className:"preview-toolbar-container"},t.createElement(o,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},_renderError:function(){var e,t,n,o;switch(o=E.get_filename(this.props.file),this.props.errorType){case _.EXTENSION_ERROR:return t=r.file_extension(o,e=!0),n=t?S.span({},C(w("<span>.%(extension)s</span> files can’t be previewed",{comment:"Like '.exe files can’t be previewed'"}),{span:S.span({className:"preview-error__message--bold"}),extension:t})):w("Extensionless files can’t be previewed"),this._renderErrorInfo(this._getBadFiletypeErrorImage(),n);case _.FILE_SIZE_ERROR:return this._renderErrorInfo(this._getTooBigErrorImage(),w("This file is too big to preview"));case _.PASSWORD_PROTECTED_ERROR:return this._renderErrorInfo(this._getPasswordProtectedErrorImage(),w("This file is password-protected"));case _.NEED_FLASH_ERROR:return this._renderErrorInfo(this._getNoPreviewErrorImage(),C(w("Install <a>Adobe Flash Player</a> to preview this video."),{a:S.a({href:"https://get.adobe.com/flashplayer/"})}));default:return this._renderErrorInfo(this._getNoPreviewErrorImage(),w("This file can’t be previewed"))}},_logPreviewSupportDenied:function(){var e;return this.props.errorType!==_.LOAD_ERROR&&null!=(e=this.props.filePreviewSession)?e.recordEvent(m.FILE_PREVIEW_SUPPORT_DENIED,{errorType:this.props.errorType}):void 0},render:function(){var t;return t=e({"preview-content":!0,"preview-content--center":!0,"preview-error":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar}),S.div({className:t},S.div({className:"c-modal c-modal--unibody preview-error__wrapper"},S.div({className:"c-modal__content preview-error__content"},this._renderError(),this._renderFileInfo(),this._renderActionable())),this.props.shouldDisplayAnnotationsToolbar?this._renderAnnotationsToolbar():void 0)}})})}.call(this),function(){define("modules/clean/react/previews/preview_flippable",["external/react","jquery","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_image","modules/clean/react/previews/preview_image_with_annotations","modules/clean/react/previews/preview_video","modules/clean/react/sprite","modules/constants/comments_panel","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f;return p=o.PreviewImage,h=i.PreviewImageWithAnnotations,_=r.PreviewVideo,f=e.DOM,m=l._,c=100,d=e.createClass({statics:{isFlippable:function(e){return"photo"===e||"video"===e}},displayName:"PreviewFlippable",propTypes:{"preview-type":e.PropTypes.oneOf(["photo","video"]),"file-extension":e.PropTypes.string.isRequired,"thumbnail-url-tmpl":e.PropTypes.string.isRequired,"preview-url":e.PropTypes.string,onLoad:e.PropTypes.func,onError:e.PropTypes.func,index:e.PropTypes.number,count:e.PropTypes.number,totalFiles:e.PropTypes.number,onPrevious:e.PropTypes.func,onNext:e.PropTypes.func,onContextMenu:e.PropTypes.func,"preview-url":e.PropTypes.string,"video-metadata-url":e.PropTypes.string,"file-meta":e.PropTypes.shape({filename:e.PropTypes.string,mtime:e.PropTypes.number,formattedSize:e.PropTypes.string}).isRequired},getDefaultProps:function(){return{onContextMenu:null}},onImageLoad:function(){var e;return null!=(e=this.refs.previewImageWithAnnotations)?e._onImageLoad():void 0},componentWillMount:function(){return this.isImagePreviewAnnotationCreationEnabled=a.ALLOW_ANNOTATION_IMAGE_PREVIEWS},_onPrevious:function(){var e;return"function"==typeof(e=this.props).onPrevious?e.onPrevious():void 0},_onNext:function(){var e;return"function"==typeof(e=this.props).onNext?e.onNext():void 0},_flipLabelText:function(){var e;return e=this.props.totalFiles===c?"+":"",m("%(cur_file_num)s of %(num_total_files)s").format({cur_file_num:this.props.index+1,num_total_files:this.props.count})+e},_reactElementForPreviewType:function(o){var i,r;switch(o){case"photo":return r={"preview-url":this.props["preview-url"],"file-extension":this.props["file-extension"],"file-meta":this.props["file-meta"],onLoad:this.props.onLoad,onError:this.props.onError,onContextMenu:this.props.onContextMenu},this.isImagePreviewAnnotationCreationEnabled?(r=t.extend(r,{ref:"previewImageWithAnnotations",index:this.props.index,count:this.props.count,onPrevious:this._onPrevious,onNext:this._onNext,"should-display-annotations-toolbar":!0,onContextMenu:this.props.onContextMenu}),e.createElement(h,r)):e.createElement(p,r);case"video":return e.createElement(_,{"preview-url":this.props["preview-url"],"thumbnail-url-tmpl":this.props["thumbnail-url-tmpl"],onLoad:this.props.onLoad,index:this.props.index,count:this.props.count,onPrevious:this._onPrevious,onNext:this._onNext,shouldDisplayAnnotationsToolbar:this.isImagePreviewAnnotationCreationEnabled});default:return i=this.props["file-meta"],e.createElement(n,{filename:i.filename,created:new Date(1e3*i.mtime),size:i.formattedSize})}},render:function(){return f.div({className:"preview-flip-container"},[this._reactElementForPreviewType(this.props["preview-type"]),this.props.count>1&&!this.isImagePreviewAnnotationCreationEnabled?f.div({className:"flip-controls"},f.button({className:"flip-button-prev",onClick:this._onPrevious},e.createElement(s,{group:"web",name:"s_flip_left",alt:m("Flip left",{comment:"Flip to the previous file in a series of files"})})),f.div({className:"flip-label"},this._flipLabelText()),f.button({className:"flip-button-next",onClick:this._onNext},e.createElement(s,{group:"web",name:"s_flip_right",alt:m("Flip right",{comment:"Flip to the next file in a series of files"})}))):void 0])}}),{PreviewFlippable:d}})}.call(this),function(){define("modules/clean/react/previews/preview_html",["external/react","external/react-dom","jquery","modules/clean/frame_messenger","modules/clean/previews/preview_actions_helper","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/preview_toolbar_container","modules/clean/web_timing_logger","modules/constants/file_viewer","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f,g,v,y,E,b;return f=i.PreviewActions,h=r.EventTypes,p=r.CannedTestFilenames,_=s.FullscreenHelpers,b=e.DOM,y=b.div,E=b.iframe,m="previewhtml",d=["failed","viewer-ready"],v=e.createFactory(a),g=e.createClass({displayName:"PreviewHTML",propTypes:{src:e.PropTypes.string.isRequired,previewType:e.PropTypes.string.isRequired,isFullscreen:e.PropTypes.bool.isRequired,fileExtension:e.PropTypes.string.isRequired,onError:e.PropTypes.func,filePreviewType:e.PropTypes.number,usesFrameMessenger:e.PropTypes.bool,sharePermissions:e.PropTypes.object,filePreviewSession:e.PropTypes.object},getDefaultProps:function(){return{onError:null,filePreviewType:"",usesFrameMessenger:!0,sharePermissions:null}},_getIframeProps:function(){var e;return e={type:"text/html",src:this._getIframeSrc(),sandbox:"",className:m,ref:"iframe"},this.props.usesFrameMessenger&&(e.sandbox="allow-modals allow-scripts allow-forms"),e},_getIframeSrc:function(){var e;return e=c.parse(this.props.src),"excel"===this.props.previewType&&u.FORCE_TEST_EXCEL_HTML&&e.updateQuery({canned_file_name:p.EXCEL_HTML}),e.toString()},_handleTrustedMessageFromChild:function(e){var t;switch(e.action){case"failed":return this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(h.FILE_PREVIEW_RENDER_FAILED),"function"==typeof(t=this.props).onError?t.onError():void 0;case"viewer-ready":return this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(h.FILE_PREVIEW_RENDER_SUCCEEDED),this.props.isFullscreen?this._frameMessenger.postMessageToChildren("enter-fullscreen"):this._frameMessenger.postMessageToChildren("exit-viewer-fullscreen")}},componentDidMount:function(){var e,i;return this._logFilePreviewEvent(h.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.props.usesFrameMessenger&&(this._frameMessenger=new o,this._frameMessenger.configureChildMessaging("iframe."+m,this._handleTrustedMessageFromChild,d),this._frameMessenger.startListening(),_.setupFullscreen(this.props.isFullscreen),n(document).on("keydown",null!=(i=this.refs.previewToolbarContainer)?i.onKeydown:void 0)),e=t.findDOMNode(this.refs.iframe),e.onload=this._handleIframeLoad,e.onerror=this._handleIframeError},componentWillUnmount:function(){var e;return this.props.usesFrameMessenger&&(this._frameMessenger.stopListening(),n(document).off("keydown",null!=(e=this.refs.previewToolbarContainer)?e.onKeydown:void 0),this.props.isFullscreen)?_.teardownExitFullscreenListeners():void 0},_handleIframeLoad:function(){return this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this.props.usesFrameMessenger||this._logFilePreviewEvent(h.FILE_PREVIEW_RENDER_SUCCEEDED),l.mark_time_to_view(),l.mark_time_to_interactive()},_handleIframeError:function(){return this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_FAILED),l.mark_time_to_view(),l.mark_time_to_interactive()},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_renderToolbarContainer:function(){return v({ref:"previewToolbarContainer",previewToolbarProps:{actions:f,fileExtension:this.props.fileExtension,fileHref:this.props.src,filePreviewType:this.props.previewType,sharePermissions:this.props.sharePermissions},isFullscreen:this.props.isFullscreen})},render:function(){var e;return e=this._getIframeProps(),y({className:"preview-content"},E(e),this._renderToolbarContainer())}})})}.call(this),function(){define("modules/clean/react/previews/preview_image",["external/classnames","external/react","external/underscore","jquery","modules/clean/analytics","modules/clean/image_preview_util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v,y,E;return m=i.PreviewActivityLogger,_=a.EventTypes,g=u.PreviewImageZoom,E=t.DOM,y=h._,v=t.createFactory(c),f=t.createClass({displayName:"PreviewImage",propTypes:{"preview-url":t.PropTypes.string.isRequired,"file-extension":t.PropTypes.string.isRequired,onLoad:t.PropTypes.func,onError:t.PropTypes.func,filePreviewSession:t.PropTypes.object,isFullscreen:t.PropTypes.bool},getInitialState:function(){return{imageVisible:!0}},_logFilePreviewEvent:function(e,t){return null==t&&(t=this.props.filePreviewSession),null!=t?t.recordEvent(e):void 0},_logOpen:function(){return m.log("open",{file_ext:this.props["file-extension"]})},_markWebTiming:function(){return d.mark_time_to_view(),d.mark_time_to_interactive()},_onImageLoad:function(){var e,t,n;return this._logFilePreviewEvent(_.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(_.FILE_PREVIEW_RENDER_SUCCEEDED),this._markWebTiming(),t=o(".preview-image-container"),e=t.find(".preview-image"),this.setState({imageVisible:!0}),this._shouldDisableZoom()||e.off("click").on("click",this._onFullscreen),"function"==typeof(n=this.props).onLoad?n.onLoad():void 0},_onFullscreen:function(){return null!=this.props.isFullscreen?s.openFullscreen():g.open(this.props["preview-url"],this.props["file-extension"])},_onImageError:function(){return this._logFilePreviewEvent(_.FILE_PREVIEW_DOWNLOAD_FAILED),this._markWebTiming(),null!=this.props.onError?this.props.onError():void 0},_shouldDisableZoom:function(){return p.msie_version_at_most(9)},componentWillUnmount:function(){return null==this.props.isFullscreen?g.close():void 0},componentDidMount:function(){var e;return this._logFilePreviewEvent(_.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(_.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this._logOpen(),(null!=(e=r.getPreviewImageElement())?e.complete:void 0)?this._onImageLoad():void 0},componentWillReceiveProps:function(e){var t;return this.props["preview-url"]!==e["preview-url"]?(t=e.filePreviewSession,this._logFilePreviewEvent(_.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this._logFilePreviewEvent(_.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this._logOpen(),this.setState({imageVisible:!1})):void 0},_renderPreviewImage:function(){var t,n;return n={},n[""+r.PREVIEW_IMAGE_CONTAINER]=!0,n["flex-preview-container"]=!0,n["flex-preview-container--padded"]=!0,n["image-visible"]=this.state.imageVisible,n["zoom-disabled"]=this._shouldDisableZoom(),t=n,E.div({className:e(t)},E.div({className:r.PREVIEW_IMAGE_WRAPPER+" preview-content"},v({thumbnailUrlTmpl:this.props["preview-url"],className:r.PREVIEW_IMAGE+" absolute-center",onLoad:this._onImageLoad,onError:this._onImageError})))},render:function(){
return this._renderPreviewImage()}}),{PreviewImage:f}})}.call(this),function(){define("modules/clean/react/previews/preview_image_with_annotations",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/analytics","modules/clean/react/image","modules/clean/image_preview_util","modules/clean/image_annotations","modules/clean/static_urls","modules/clean/photos/thumbnail_url_util","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/previews/preview_blank","modules/clean/react/previews/preview_image_zoom","modules/clean/react/previews/preview_toolbar_container","modules/clean/react/previews/responsive_image","modules/clean/web_timing_logger","modules/core/browser","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y){var E,b,w,T,S,C,I,P,A,N,R,k,O;return w=r.PreviewActivityLogger,O=u.static_url,k=c.fullSizeUrl,E=p.EventTypes,C=_.PreviewImageZoom,N=t.createElement,R=t.DOM,A=y._,P=1.25,b=16,I=t.createFactory(f),T=t.createFactory(h),S=t.createClass({displayName:"PreviewImageWithAnnotations",propTypes:{"preview-url":t.PropTypes.string.isRequired,"file-extension":t.PropTypes.string.isRequired,onLoad:t.PropTypes.func,onError:t.PropTypes.func,filePreviewSession:t.PropTypes.object,isFullscreen:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func,"should-display-annotations-toolbar":t.PropTypes.bool,onContextMenu:t.PropTypes.func},getDefaultProps:function(){return{onContextMenu:null}},getInitialState:function(){return this.props["should-display-annotations-toolbar"]?{imageVisible:!1,width:"",height:"",zoomPercent:0,minimumZoomPercent:0,margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1}:{imageVisible:!1}},_logFilePreviewEvent:function(e,t){return null==t&&(t=this.props.filePreviewSession),null!=t?t.recordEvent(e):void 0},_logOpen:function(){return w.log("open",{file_ext:this.props["file-extension"]})},_onImageLoad:function(){var e;return this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(E.FILE_PREVIEW_RENDER_SUCCEEDED),g.mark_time_to_view(),g.mark_time_to_interactive(),this.setState({imageVisible:!0,shouldLoadFullSizeImage:!0}),this.imageAnnotations.onImageLoad(this.onResizeImage),"function"==typeof(e=this.props).onLoad?e.onLoad():void 0},_onImageClick:function(){return this._shouldDisableZoom()?void 0:this._openFullscreen()},_openFullscreen:function(){var e;return e={file_ext:this.props["file-extension"]},null!=this.props.isFullscreen?d.openFullscreen(e):C.open(this.props["preview-url"],this.props["file-extension"],this.props.onContextMenu)},_onImageError:function(){return this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_FAILED),null!=this.props.onError?this.props.onError():void 0},_shouldDisableZoom:function(){return v.msie_version_at_most(9)||this.props["should-display-annotations-toolbar"]},_getImageDOMNode:function(){return this.state.shouldDisplayFullSizeImage?n.findDOMNode(this.refs.previewImageFullSize):n.findDOMNode(this.refs.previewImage)},_onFullSizeLoad:function(){var e;return e=this._calculateZoomPercent(this._getImageDOMNode().height),this.setState({zoomPercent:e,minimumZoomPercent:e})},onResizeImage:function(){var e;return""===this.state.width&&""===this.state.height?(e=this._calculateZoomPercent(this._getImageDOMNode().height),this.setState({zoomPercent:e,minimumZoomPercent:e})):void 0},_onZoom:function(e,t){var o,i,r,s,l,u,c,d,p,h,_,m,f,g,v,y,E;if(e+"px"!==this.state.width)return E=this._calculateZoomPercent(t),E<this.state.minimumZoomPercent?void this._onZoomFit():E>b?(r=b*(null!=(_=n.findDOMNode(this.refs.previewImageFullSize))?_.naturalWidth:void 0),i=b*(null!=(m=n.findDOMNode(this.refs.previewImageFullSize))?m.naturalHeight:void 0),void this._onZoom(r,i)):(p=this._getImageDOMNode().width,h=e/p,o=a.getPreviewImageWrapper(),c=o.scrollLeft(),d=o.scrollTop(),g=o.width(),f=o.height(),l=g*(h-1)/2+c*h,u=f*(h-1)/2+d*h,y=t>=f?"0":"auto",v=e>=g?"0":"auto",s=y+" "+v,this.setState({shouldDisplayFullSizeImage:null!=this.refs.previewImageFullSize,width:e+"px",height:t+"px",margin:s,zoomPercent:E,zoomFit:!1},function(){var e;return o.scrollLeft(l),o.scrollTop(u),this.imageAnnotations.onResize(e=!1)}))},_onZoomIn:function(){var e,t;return t=this._getImageDOMNode().width*P,e=this._getImageDOMNode().height*P,this._onZoom(t,e)},_onZoomOut:function(){var e,t;return t=this._getImageDOMNode().width/P,e=this._getImageDOMNode().height/P,this._onZoom(t,e)},_onZoomOriginalOrFit:function(){return 1===this.state.zoomPercent?this._onZoomFit():this._onZoomOriginal()},_onZoomOriginal:function(){var e,t,o,i;return t=null!=(o=n.findDOMNode(this.refs.previewImageFullSize))?o.naturalWidth:void 0,e=null!=(i=n.findDOMNode(this.refs.previewImageFullSize))?i.naturalHeight:void 0,this._onZoom(t,e)},_onZoomFit:function(){return""!==this.state.width?this.setState({width:"",height:"",margin:"auto",zoomFit:!0},function(){var e,t;return this.imageAnnotations.onResize(e=!1),t=this._calculateZoomPercent(this._getImageDOMNode().height),this.setState({zoomPercent:t,minimumZoomPercent:t})}):void 0},_calculateZoomPercent:function(e){var t,o;if(null!=this.refs.previewImageFullSize)return t=n.findDOMNode(this.refs.previewImageFullSize).naturalHeight,e&&t?o=e/t:void 0},componentWillUnmount:function(){var e;return null==this.props.isFullscreen&&C.close(),null!=(e=this.imageAnnotations)?e.reset():void 0},componentWillMount:function(){return this.imageAnnotations=new l},componentDidMount:function(){var e;return this._logFilePreviewEvent(E.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this._logOpen(),(null!=(e=this._getImageDOMNode())?e.complete:void 0)?this._onImageLoad():void 0},componentWillReceiveProps:function(e){var t;return e["preview-url"]!==this.props["preview-url"]&&(t=e.filePreviewSession,this._logFilePreviewEvent(E.FILE_PREVIEW_SUPPORT_CONFIRMED,t),this._logFilePreviewEvent(E.FILE_PREVIEW_DOWNLOAD_ATTEMPTED,t),this._logOpen(),this.setState({imageVisible:!1}),this.props["should-display-annotations-toolbar"])?(this.imageAnnotations.removeAnnotations(),this.setState({width:"",height:"",margin:"auto",zoomFit:!0,shouldDisplayFullSizeImage:!1,shouldLoadFullSizeImage:!1})):void 0},_renderToolbarContainer:function(){return N(m,{previewToolbarProps:{index:this.props.index,count:this.props.count,zoomPercent:this.state.zoomPercent,minimumZoomPercent:this.state.minimumZoomPercent,maximumZoomPercent:b,onPrevious:this.props.onPrevious,onNext:this.props.onNext,onFullscreen:this._openFullscreen,onZoomIn:this._onZoomIn,onZoomOut:this._onZoomOut,onZoomOriginalOrFit:this._onZoomOriginalOrFit},isFullscreen:this.props.isFullscreen,shouldUseImageToolbar:!0})},_renderPreviewImage:function(){var t,n,i,r,l,u;return i={},i[""+a.PREVIEW_IMAGE_CONTAINER]=!0,i["flex-preview-container"]=!0,i["image-visible"]=this.state.imageVisible,i["annotations-visible"]=!0,i["zoom-disabled"]=this._shouldDisableZoom(),i["has-annotations-toolbar"]=this.props["should-display-annotations-toolbar"],i["zoom-fit"]=this.state.zoomFit,l=i,u=this.state.width&&this.state.height&&this.props["should-display-annotations-toolbar"]?{maxWidth:this.state.width,maxHeight:this.state.height,width:this.state.width,height:this.state.height,margin:this.state.margin}:{},r={},r[""+a.PREVIEW_IMAGE]=this.state.shouldDisplayFullSizeImage,r["absolute-center"]=!0,t=r,n=o.extend({},u),this.state.shouldDisplayFullSizeImage||(n=o.extend(n,{visibility:"hidden"})),R.div({className:e(l)},R.div({className:a.PREVIEW_IMAGE_WRAPPER+" preview-content"},this.state.imageVisible?void 0:R.div({className:"loading-icon-container"},N(s,{className:"loading-icon",src:O("/static/images/icons/fileviewer-loading-vflHF9-Ot.gif"),srcHiRes:O("/static/images/icons/fileviewer-loading@2x-vflW5elqb.gif"),alt:A("Loading")})),this.state.shouldLoadFullSizeImage?R.img({ref:"previewImageFullSize",src:k(this.props["preview-url"]),className:e(t),style:n,onLoad:this._onFullSizeLoad,onClick:this._onImageClick}):void 0,this.state.shouldDisplayFullSizeImage?void 0:I({ref:"previewImage",thumbnailUrlTmpl:this.props["preview-url"],className:a.PREVIEW_IMAGE+" absolute-center",style:u,onLoad:this._onImageLoad,onError:this._onImageError,onClick:this._onImageClick,onContextMenu:this.props.onContextMenu})),this.props["should-display-annotations-toolbar"]?this._renderToolbarContainer():void 0)},render:function(){return this._renderPreviewImage()}}),{PreviewImageWithAnnotations:S}})}.call(this),function(){define("modules/clean/react/previews/preview_image_zoom",["external/jquery.mousewheel","external/jquery.fs.zoomer","external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/photos/thumbnail_url_util","modules/clean/react/image","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/file_preview_event_emitter","modules/clean/react/helpers","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/responsive_image","modules/clean/static_urls","modules/core/browser","modules/core/dom","modules/core/exception","modules/core/uri","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E){var b,w,T,S,C,I,P,A,N,R;return N=a.fullSizeUrl,w=c.EventTypes,P=p.compareStateAndProps,R=m.static_url,A=o.DOM,I=E._,C=o.createFactory(_),S=o.createFactory(h),b="preview-image-zoomzoom-wrapper",T=o.createClass({statics:{open:function(e,t,n){var r,a,l;return l=s("<div />",{id:b}),s(document.body).append(l),a=o.createElement(T,{thumbnailUrlTmpl:e,fileExtension:t,isFlippable:!1,onContextMenu:n}),r={file_ext:t},u.openFullscreenLogging(r),i.render(a,l.get(0))},close:function(){var e;return e=document.getElementById(b),e?i.unmountComponentAtNode(e):void 0},SETUP_IMAGE_WAIT_TIME:100},displayName:"PreviewImageZoom",propTypes:{thumbnailUrlTmpl:o.PropTypes.string,fileExtension:o.PropTypes.string,isFlippable:o.PropTypes.bool,filePreviewSession:o.PropTypes.object,onContextMenu:o.PropTypes.func},getDefaultProps:function(){return{onContextMenu:null}},getInitialState:function(){return{loadedFullResolutionImageUrl:null,zoomOutDisabled:!0,zoomInDisabled:!1,dragDisabled:!0}},componentDidMount:function(){return this._logFilePreviewEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this._delayedSetupImage(this.props.thumbnailUrlTmpl)},componentWillReceiveProps:function(e){return e.thumbnailUrlTmpl!==this.props.thumbnailUrlTmpl?(this._logFilePreviewEvent(w.FILE_PREVIEW_SUPPORT_CONFIRMED),this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),this.setState({loadedFullResolutionImageUrl:null}),this._destroyZoomer(),this._delayedSetupImage(e.thumbnailUrlTmpl)):void 0},componentWillUnmount:function(){return this._destroyZoomer(),s(window).off("resize.zommer")},shouldComponentUpdate:P,_delayedSetupImage:function(e){return setTimeout(function(t){return function(){return t.isMounted()&&t.props.thumbnailUrlTmpl===e?t._setupImage(e):void 0}}(this),T.SETUP_IMAGE_WAIT_TIME)},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_setupImage:function(e){return this.fullResolutionImage=new window.Image,this.fullResolutionImage.onload=function(t){return function(){return t.props.thumbnailUrlTmpl===e?t._onFullResolutionImageLoaded():void 0}}(this),this.fullResolutionImage.onerror=this._onFullResolutionImageError,this.fullResolutionImage.src=N(e)},_onFullResolutionImageLoaded:function(){return this.isMounted()?(this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._logFilePreviewEvent(w.FILE_PREVIEW_RENDER_SUCCEEDED),this.setState({loadedFullResolutionImageUrl:this.fullResolutionImage.src},this._bindZoomer)):void 0},_onFullResolutionImageError:function(){return this._logFilePreviewEvent(w.FILE_PREVIEW_DOWNLOAD_FAILED),v.assert("Error loading full resoltuion image in zoom view")},_bindZoomer:function(){var e,t;if(null!=this.state.loadedFullResolutionImageUrl)return t=s(".preview-zoom").width(),e=this._getPreviewZoomerElement(),window.zoomer(e,{controls:{zoomIn:s(i.findDOMNode(this.refs.previewZoomContainer.refs.zoomControlZoomIn)),zoomOut:s(i.findDOMNode(this.refs.previewZoomContainer.refs.zoomControlZoomOut)),zoomLabel:s(i.findDOMNode(this.refs.previewZoomContainer.refs.zoomLabel)),zoomLabelContainer:s(i.findDOMNode(this.refs.previewZoomContainer.refs.zoomLabelContainer))},customClass:"preview-zoomer-style",retina:window.devicePixelRatio>1,onZoomCallback:this._onZoomCallback,startWidth:t,onContextMenu:this.props.onContextMenu}),null==this.fitToZoom&&(this.fitToZoom=this._getZoomPercent()),s(window).off("resize.zoomer").on("resize.zoomer",function(t){return function(){return zoomer(e,"resize"),t.fitToZoom=t._getZoomPercent()}}(this)),e.off("mousewheel.zoom").on("mousewheel.zoom",function(e){return function(t,n){return t.preventDefault(),e._zoomScroll(n*t.deltaFactor)}}(this))},_destroyZoomer:function(){return window.zoomer(this._getPreviewZoomerElement(),"destroy")},_onZoomCallback:function(e){return this.setState({zoomOutDisabled:e.atMinZoom,zoomInDisabled:e.atMaxZoom,dragDisabled:e.atMinZoom})},_getPreviewZoomerElement:function(){return s(".preview-zoomer")},_getZoomPercent:function(){return parseFloat(s(i.findDOMNode(this.refs.previewZoomContainer.refs.zoomLabel)).text())},_zoomToFit:function(){return s(i.findDOMNode(this.refs.previewZoomContainer.refs.zoomControlZoomOut)).trigger("zoomout")},_zoom100:function(e,t){return zoomer(this._getPreviewZoomerElement(),"zoom100",e,t)},_zoomScroll:function(e){return zoomer(this._getPreviewZoomerElement(),"zoomScroll",e)},_unmount:function(){var e,t;return this.props.isFlippable?u.closeFullscreen():(t=i.findDOMNode(this).parentNode,i.unmountComponentAtNode(t),s(t).remove(),e={file_ext:this.props.fileExtension},u.closeFullscreenLogging(e))},_onImageDoubleClick:function(e){var t;return s(e.target).hasClass("zoomer")?void 0:this._getZoomPercent()<100?(t=e.target.getBoundingClientRect(),this._zoom100(e.pageX-t.left,e.pageY-t.top)):this._zoomToFit()},_renderImage:function(){return A.div({ref:"previewZoomer",className:"preview-zoomer",style:{textAlign:"center"},onDoubleClick:null!=this.state.loadedFullResolutionImageUrl?this._onImageDoubleClick:void 0},null!=this.state.loadedFullResolutionImageUrl?A.img({className:"preview-zoom",src:this.state.loadedFullResolutionImageUrl,style:{maxHeight:s(".preview-zoom").height(),maxWidth:s(".preview-zoom").width()},onContextMenu:this.props.onContextMenu}):C({thumbnailUrlTmpl:this.props.thumbnailUrlTmpl,className:"preview-zoom",onContextMenu:this.props.onContextMenu}))},_renderLoading:function(){return A.div({className:"preview-zoomer-loading"},o.createElement(l,{alt:I("Loading..."),src:R("/static/images/icons/white-on-dark-spinner-vflInam4o.gif"),srcHiRes:R("/static/images/icons/white-on-dark-spinner@2x-vfltkzAUn.gif")}))},render:function(){var e;return e=null!=this.state.loadedFullResolutionImageUrl?"zoomer-image":null!=f.mozilla?"preview-zoomer-loading":"preview-zoom",S({isFlippable:this.props.isFlippable||!1,renderZoomControls:null!=this.state.loadedFullResolutionImageUrl,onClose:this._unmount,containerClass:e,zoomOutCallback:this._zoomToFit,zoomInDisabled:this.state.zoomInDisabled,zoomOutDisabled:this.state.zoomOutDisabled,dragDisabled:this.state.dragDisabled,ref:"previewZoomContainer"},null!=f.mozilla&&null==this.state.loadedFullResolutionImageUrl?this._renderLoading():this._renderImage())}}),{PreviewImageZoom:T}})}.call(this),function(){define("modules/clean/react/previews/preview_linkfile",["external/classnames","external/react","jquery","modules/clean/analytics","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/previews/file_viewer_utils","modules/clean/react/file_viewer/constants","modules/clean/referrer_cleansing_redirect","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y;return _=o.LinkfileActivityLogger,y=s.filename_without_extension,v=s.file_extension,h=l.EventTypes,f=d._,g=t.DOM,m=t.createClass({displayName:"PreviewLinkfile",propTypes:{filename:t.PropTypes.string.isRequired,data:t.PropTypes.shape({url:t.PropTypes.string,authenticated:t.PropTypes.bool.isRequired}).isRequired,source:t.PropTypes.string.isRequired,filePreviewSession:t.PropTypes.object},FILE_VIEWER_OPEN_PREVIEW_EVENT:"db:filepreview:open",FILE_VIEWER_CLOSE_PREVIEW_EVENT:"db:filepreview:close",SPINNER_FADE_DELAY_MSEC:150,MAX_DISPLAYED_FILENAME_CHARS:21,getInitialState:function(){return{description:null,hadError:!1,link:null}},_logEvent:function(e,t,n,o){var i;return null==o&&(o={}),i=null!=t?p.parse(t).getAuthority():null,_.log(e,v(this.props.filename),i,n,this.props.source,o)},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_markWebTiming:function(){return c.mark_time_to_view(),c.mark_time_to_interactive()},_isFileDataFetched:function(){return null==this.state.description},componentDidMount:function(){var e;return this._logFilePreviewEvent(h.FILE_PREVIEW_SUPPORT_CONFIRMED),e=a.getFileViewerElement(),e.on(this.FILE_VIEWER_OPEN_PREVIEW_EVENT,this.handlePreviewOpen),e.on(this.FILE_VIEWER_CLOSE_PREVIEW_EVENT,this.handlePreviewClose),null!=this.props.data.url?this.requestLinkfileData(this.props.data.url):void 0},componentWillUnmount:function(){var e,t,n;return e=a.getFileViewerElement(),e.off("db:filepreview:open",this.handlePreviewOpen),e.off("db:filepreview:close",this.handlePreviewClose),this._logEvent("destroy",t=this.state.link,n=!0)},requestLinkfileData:function(e){var t,n,o;return this._logEvent("requestlinkdata",t=null,o=!0),this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),n={url:e,dataType:"json",success:this.handleLinkDataSuccess,error:this.handleLinkDataError},this.props.data.authenticated?(n.xhrFields={withCredentials:!0},i.SilentBackgroundRequest(n)):i.Request(n)},handlePreviewOpen:function(e,t,n,o){return null!=t.linkfile_data?this.requestLinkfileData(t.linkfile_data.url):this.handleLinkDataError()},handlePreviewClose:function(){var e,t;return this._logEvent("close",e=this.state.link,t=!0)},handleLinkDataSuccess:function(e){var t,n;return null==e.uri?void this.handleLinkDataError():(this._logEvent("displaylinkdata",t=e.uri,n=!0),this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),this._markWebTiming(),this.setState({description:e.uri,hadError:!1,link:e.uri}),this._logFilePreviewEvent(h.FILE_PREVIEW_RENDER_SUCCEEDED))},handleLinkDataError:function(){var e,t;return this._logEvent("displaylinkerror",e=null,t=!1),this._logFilePreviewEvent(h.FILE_PREVIEW_DOWNLOAD_FAILED),this._markWebTiming(),this.isMounted()?this.setState({description:f("Can’t show link. Something’s wrong with this file."),hadError:!0,link:null}):void 0},handleClickOpenLinkButton:function(e){var t,n,o;if(null!=this.state.link)return this._logEvent("navlink",t=this.state.link,o=!0),n=u.get_redirect_uri(this.state.link),window.open(n,"_blank")},render:function(){var t,n,o,i,s,a,l,u;return t={"preview-linkfile-content":!0,"loading-content":this._isFileDataFetched()},u={"preview-linkfile-button-openlink":!0,"button-primary":!0,"has-link":null!=this.state.link},i="-",a="",null!=this.props.filename&&(i=y(this.props.filename),a=v(this.props.filename),""!==a&&(a="."+a)),l=this.MAX_DISPLAYED_FILENAME_CHARS-a.length,s=r.em_snippet(i,l),o=null!=this.state.description?this.state.description:"-",n={"preview-linkfile-description":!0,"force-show-all-text":this.state.hadError},g.div({className:"flex-preview-container"},g.div({className:"preview-content preview-content--center"},g.div({className:"preview-linkfile-box"},g.div({className:e(t),ref:"content"},g.div({className:"preview-linkfile-icon"},g.img({src:"/static/images/icons128/page_white_linkfile-vfloEntlU.png",alt:""})),g.div({className:"preview-linkfile-title"},g.span({className:"preview-linkfile-filebase",ref:"fileBase"},s),g.span({className:"preview-linkfile-fileext",ref:"fileExt"},a)),g.div({className:"preview-linkfile-info"},g.div({className:e(n),ref:"description"},o),g.button({className:e(u),onMouseUp:this.handleClickOpenLinkButton,ref:"openLinkButton"},f("Open in new tab")))))))}}),{PreviewLinkfile:m}})}.call(this),function(){define("modules/clean/react/previews/preview_password_protected",["external/react","jquery","modules/clean/datetime","modules/clean/frame_messenger","modules/clean/react/previews/password_component","modules/clean/react/previews/preview_html","modules/clean/react/sprite","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f,g;return f=e.DOM,m=f.div,g=f.span,_=a._,d=e.createFactory(i),p=e.createFactory(r),c="previewhtml",u=["incorrect_password"],h=e.createClass({displayName:"PreviewPasswordProtected",propTypes:{icon:e.PropTypes.string.isRequired,filename:e.PropTypes.string.isRequired,fileExtension:e.PropTypes.string.isRequired,created:e.PropTypes.object,size:e.PropTypes.string,fileUrl:e.PropTypes.instanceOf(l),previewType:e.PropTypes.string.isRequired},getInitialState:function(){return{hasLoadError:!1,passwordSubmitted:!1,passwordAttempts:0,passwordStr:null}},_passwordChanged:function(e){return this.setState({passwordSubmitted:!0,passwordStr:e})},_handleTrustedMessageFromChild:function(e){switch(e.action){case"incorrect_password":return this.setState({passwordSubmitted:!1,passwordAttempts:this.state.passwordAttempts+1})}},componentDidMount:function(){return this._frameMessenger=new o,this._frameMessenger.configureChildMessaging("iframe."+c,this._handleTrustedMessageFromChild,u),this._frameMessenger.startListening()},componentWillUnmount:function(){return this._frameMessenger.stopListening()},_onLoadError:function(){return this.setState({hasLoadError:!0,passwordSubmitted:!1})},_renderCreatedTime:function(){return[g({},n.format_date(this.props.created,"MMMM dd, yyyy hh:mm a")),g({className:"bottom-dot"}," · ")]},_renderSize:function(){return g({},this.props.size)},_renderLoadError:function(){return g({className:"preview-password-protected-error"},_("Failed to generate preview"))},_renderInvalidPassword:function(){return g({className:"preview-password-protected-error"},_("Invalid password, please try again."))},_renderPasswordMessage:function(){return g({className:"preview-blank-title"},_("Please enter this document’s password to view it."))},_renderHtml:function(){var e,t,n;return n=this.props.fileUrl,n.updateQuery({generate_preview:1}),n.updateQuery({password_str:this.state.passwordStr}),n.setAuthority(n.getAuthority().replace("dl-web","dl-doc")),e=this._onLoadError,t=this.props.previewType,p({src:n,previewType:t,onError:e,isFullscreen:!1,fileExtension:this.props.fileExtension})},render:function(){var t;return this.state.passwordSubmitted?this._renderHtml():m({className:"preview-blank-container"},m({className:"preview-blank-wrapper"},m({className:"preview-blank-icon"},e.createElement(s,{group:"web",name:this.props.icon})),m({className:"preview-blank-title"},this.props.filename),m({className:"preview-blank-info"},null==this.props.created||isNaN(null!=(t=this.props.created)?t.getTime():void 0)?void 0:this._renderCreatedTime(),null!=this.props.size&&""!==this.props.size?this._renderSize():void 0),this.state.hasLoadError?this._renderLoadError():this.state.passwordAttempts>0?this._renderInvalidPassword():this._renderPasswordMessage(),this.state.hasLoadError?void 0:d({onPasswordSubmit:this._passwordChanged})))}})})}.call(this),function(){define("modules/clean/react/previews/preview_pdf",["external/react","jquery","modules/constants/legacy","modules/core/i18n","modules/core/uri","modules/clean/ajax","modules/clean/filepath","modules/clean/keycode","modules/clean/previews/pdf_loader","modules/clean/previews/preview_actions_helper","modules/clean/previews/preview_status_watcher","modules/clean/previews/util","modules/clean/react/helpers","modules/clean/react/image","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/previews/constants","modules/clean/react/previews/preview_toolbar_container","modules/clean/static_urls","modules/clean/web_timing_logger"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y){var E,b,w,T,S,C,I,P,A,N,R,k,O,D,F;return N=o._,C=u.PreviewActions,S=d.PermissionHelper,I=d.PreviewHelper,R=p.compareStateAndProps,b=_.EventTypes,w=m.FullscreenHelpers,E=f.ErrorTypes,F=v.static_url,D=e.DOM,k=D.div,O=D.iframe,A=e.createFactory(g),T=e.createFactory(h),P=e.createClass({displayName:"PreviewPDF",propTypes:{src:e.PropTypes.string.isRequired,fileExtension:e.PropTypes.string.isRequired,fqPath:e.PropTypes.string,onCloseViewer:e.PropTypes.func,onError:e.PropTypes.func,onLogView:e.PropTypes.func,previewStatus:e.PropTypes.number,previewType:e.PropTypes.string,previewUrl:e.PropTypes.string,userId:e.PropTypes.number,isFullscreen:e.PropTypes.bool,forceServeFromDLDoc:e.PropTypes.bool,isSharedLink:e.PropTypes.bool,sharePermissions:e.PropTypes.object,filePreviewSession:e.PropTypes.object},getDefaultProps:function(){return{fqPath:null,onError:null,onLogView:null,previewStatus:n.DOC_PREVIEW_IN_PROGRESS,previewType:"",previewUrl:null,userId:0,forceServeFromDLDoc:!1,sharePermissions:null}},getInitialState:function(){return{keydownRegistered:!1,isIframeLoading:!0}},componentWillMount:function(){return this.pdfLoader=new l,this.pdfLoader.setIsFullscreen(this.props.isFullscreen),this.pdfLoader.setExitFullscreenCallback(this._exitFullscreenCallback),this.pdfLoader.setOnDownloadAttempted(this._onDownloadAttempted),this.pdfLoader.setOnDownloadFailed(this._onDownloadFailed),this.pdfLoader.setOnDownloadSucceeded(this._onDownloadSucceeded),this.pdfLoader.setOnRenderFailed(this._onRenderFailed),this.pdfLoader.setOnRenderSucceeded(this._onRenderSucceeded)},componentDidMount:function(){var e,o,i,r,s,a,l;if(this._logFilePreviewEvent(b.FILE_PREVIEW_SUPPORT_CONFIRMED),this.pdfLoader.startListening(),s=I.extCanGeneratePreview(this.props.fileExtension),this.props.previewStatus===n.DOC_PREVIEW_AVAILABLE)"function"==typeof(e=this.props).onLogView&&e.onLogView(!1);else if(this.props.previewStatus!==n.DOC_PREVIEW_UNAVAILABLE_BAD_FILE&&s)"function"==typeof(o=this.props).onLogView&&o.onLogView(!1);else if(this.props.previewStatus===n.DOC_PREVIEW_IN_PROGRESS&&null!=this.props.userId&&null!=this.props.fqPath)this.statusWatcher=new c,this.statusWatcher.start(this.props.userId,this.props.fqPath,this._didFinishStatusCheck,this._failedStatusCheck);else{if(this.props.previewStatus!==n.DOC_PREVIEW_UNAVAILABLE_PROTECTED_DOC)return void("function"==typeof(r=this.props).onError&&r.onError());"function"==typeof(i=this.props).onError&&i.onError(E.PASSWORD_PROTECTED)}return w.setupFullscreen(this.props.isFullscreen),a=null!=(l=this.refs.previewToolbarContainer)?l.onKeydown:void 0,!this.state.keydownRegistered&&a?(t(document).on("keydown",a),this.setState({keydownRegistered:!0})):void 0},shouldComponentUpdate:R,componentDidUpdate:function(){var e;return this.state.loading||this.state.keydownRegistered?void 0:(t(document).on("keydown",null!=(e=this.refs.previewToolbarContainer)?e.onKeydown:void 0),this.setState({keydownRegistered:!0}))},componentWillUnmount:function(){var e,n;return this.pdfLoader.stopListening(),null!=(e=this.statusWatcher)&&e.stop(),this.props.isFullscreen&&w.teardownExitFullscreenListeners(),t(document).off("keydown",null!=(n=this.refs.previewToolbarContainer)?n.onKeydown:void 0)},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_didFinishStatusCheck:function(){var e;return"function"==typeof(e=this.props).onLogView&&e.onLogView(!0),this.setState({loading:!1})},_failedStatusCheck:function(){var e,t;return"function"==typeof(e=this.props).onLogView&&e.onLogView(!0),"function"==typeof(t=this.props).onError?t.onError():void 0},_exitFullscreenCallback:function(){return w.setBrowserFullscreen(!1),C.exitFullscreen()},_onDownloadAttempted:function(){return this.setState({isIframeLoading:!1}),this._logFilePreviewEvent(b.FILE_PREVIEW_DOWNLOAD_ATTEMPTED)},_onDownloadFailed:function(){var e;return this._logFilePreviewEvent(b.FILE_PREVIEW_DOWNLOAD_FAILED),"function"==typeof(e=this.props).onError?e.onError():void 0},_onDownloadSucceeded:function(e){var t;return null!=(t=this.props.filePreviewSession)&&(t.previewSize=e.size),this._logFilePreviewEvent(b.FILE_PREVIEW_DOWNLOAD_SUCCEEDED)},_onRenderFailed:function(){var e;return this._logFilePreviewEvent(b.FILE_PREVIEW_RENDER_FAILED),"function"==typeof(e=this.props).onError&&e.onError(),y.mark_time_to_view(),y.mark_time_to_interactive()},_onRenderSucceeded:function(){return y.mark_time_to_view(),this._logFilePreviewEvent(b.FILE_PREVIEW_RENDER_SUCCEEDED),y.mark_time_to_interactive()},_generatePreviewUrl:function(e){var t;return e=I.normalize_extension(this.props.fileExtension),t=I.get_progressive_url(e,this.props.src),(this.props.previewStatus!==n.DOC_PREVIEW_AVAILABLE||this.props.forceServeFromDLDoc)&&(t=t.updateQuery({generate_preview:1}),this._serveFromDLDoc(t)),t},_getIframeUrl:function(e,t){var n;return n=I.get_pdf_js_url(e,t),n=I.update_url_with_user_id(n,this.props.userId),n=I.update_url_for_annotation(n),n.toString()},_renderLoading:function(){var e;return e=T({src:F("/static/images/icons/spinner-blue-overlay-vflLgNAM7.gif"),className:"loading-wheel__indicator"}),k({className:"loading-wheel__wrapper"},e)},_renderPreview:function(){var e,t;return e=I.normalize_extension(this.props.fileExtension),t=this.props.previewUrl||this._generatePreviewUrl(e),this.pdfLoader.openFile(t,{presentationMode:"ppt"===e}),O({type:"application/pdf",className:"pdfjs",id:"pdf-embed-iframe",src:this._getIframeUrl(t,e)})},_renderToolbarContainer:function(){var e;return e=this.props.isSharedLink?this.props.src:null,A({ref:"previewToolbarContainer",previewToolbarProps:{actions:C,afterFileViewerExit:this.props.onCloseViewer,fileExtension:this.props.fileExtension,fileDocPreviewStatus:this.props.previewStatus,fileHref:this.props.src,filePreviewType:this.props.previewType,pdfLink:e,sharePermissions:this.props.sharePermissions},isFullscreen:this.props.isFullscreen})},render:function(){return k({className:"preview-content preview-pdf"},this.state.isIframeLoading?this._renderLoading():void 0,[this._renderToolbarContainer(),this._renderPreview()])},_serveFromDLDoc:function(e){return e.setAuthority(e.getAuthority().replace("dl-web","dl-doc"))}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/previews/preview_quality_popup",["external/react","modules/core/i18n","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/analytics","jquery","modules/clean/em_string","modules/clean/filepath","modules/core/notify","modules/clean/react_format","modules/clean/viewer","modules/constants/legacy","modules/core/exception","external/underscore"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b,w,T,S;return E=n._,m=o.Modal,g=r.PreviewQualityPopupLogger,S=c.reactFormat,w=h.assert,b={ASK_IF_OK:0,ASK_TO_DONATE:1,THANK_YOU:2,FADEOUT_POPUP:3,HIDDEN:4},T=t.DOM,y=t.createFactory(i),v=t.createClass({displayName:"PreviewQualitySendFeedbackModal",statics:{showInstance:function(e){return m.showInstance(e)}},getInitialState:function(){return{file_selected:!0}},propTypes:{filename:t.PropTypes.string.isRequired,done_callback:t.PropTypes.func.isRequired,dismiss_callback:t.PropTypes.func.isRequired},render:function(){var e,n;return n=a.em_snippet(l.filename(this.props.filename),32),e=l.file_icon(this.props.filename),t.createElement(m,{title:E("Tell us what’s wrong"),acceptButtonText:E("Send feedback"),dismissButtonText:E("Cancel"),autoClose:!1,showX:!0,onAccept:this._onDone,onDismiss:this._onDismiss,ref:"modal"},T.div({className:"send_feedback_modal_content"},T.textarea({className:"feedback",
name:"feedback",id:"feedback",maxLength:255,readOnly:!1,placeholder:E("My document doesn’t look right because...")}),T.div({className:"file_selection",onClick:this._fileCheckClick},T.div({className:"file_check"},T.input({type:"checkbox",checked:this.state.file_selected,onClick:this._checkboxClick,id:"file_selection_checkbox"})),T.div({className:"file_image"},y({group:"web",name:e+"_32"})),T.div({className:"file_desc"},T.div({className:"file_desc_container"},T.div({className:"main"},S(E("Include <b>%(filename)s</b>"),{filename:n,b:T.b()})),T.div({className:"disclaimer"},E("The Dropbox team will review your document. It will only be used to help improve previews.")))))))},_onDone:function(){var e;return e=s("#feedback").val(),this.props.done_callback(this.state.file_selected,e),this.refs.modal.close()},_onDismiss:function(){return this.props.dismiss_callback(),this.refs.modal.close()},_checkboxClick:function(e){return this.setState({file_selected:!this.state.file_selected}),e.stopPropagation()},_fileCheckClick:function(e){return this.setState({file_selected:!this.state.file_selected}),e.stopPropagation()}}),f=t.createClass({displayName:"PreviewQualityPopup",propTypes:{showalways:t.PropTypes.bool,file:t.PropTypes.object},getDefaultProps:function(){return{showalways:!1,file:null}},_SHOW_THRESHOLD:1,_BLOCKED_FILE_EXTENSIONS:["url","webloc","website"],componentDidMount:function(){return null==this.props.file?s(document).on("db:filepreview:previewupdate",this._handleStateChange):this._handleFile(this.props.file)},componentWillUnmount:function(){return null==this.props.file?s(document).off("db:filepreview:previewupdate",this._handleStateChange):void 0},getInitialState:function(){return{page_state:b.HIDDEN,file_nsid:null,file_sjid:null,filename:null,doc_preview_status:null,feedback:"",is_file_donated:!1}},render:function(){return this.state.page_state===b.ASK_IF_OK?T.div({id:"preview-quality-popup",className:"preview-quality-bar fadeout"},T.div({className:"container"},T.div({className:"title"},E("Does this document look right?"),T.div({className:"resolution"},T.a({className:"looks-good-link",onMouseUp:this.handleLooksGood},E("Yes")),T.span({className:""},E("•")),T.a({className:"something-wrong-link",onMouseUp:this.handleMarkedBad},E("No")))),T.div({className:"hide_button"},T.a({onMouseUp:this.handleDismissPopup},y({group:"web",name:"x"})))),T.hr({className:"separator"})):T.div({id:"preview-quality-dummy",className:"hidden"})},handleDismissPopup:function(e){return this._logCurrentState("dismiss_popup"),this.setState({page_state:b.HIDDEN})},handleLooksGood:function(e){return this._logCurrentState("good"),this.setState({page_state:b.HIDDEN})},handleMarkedBad:function(e){var n;return this._logCurrentState("marked_bad"),this.setState({page_state:b.ASK_TO_DONATE}),n=t.createElement(v,{filename:this.state.filename,done_callback:this._modal_callback_ok,dismiss_callback:this._modal_callback_dismiss}),v.showInstance(n)},_modal_callback_ok:function(e,t){return e?this._logCurrentState("bad_donated",t):this._logCurrentState("bad_no_donate",t),u.success(E("Thanks! Your feedback will help improve Dropbox."),3),this.forceUpdate(),this.setState({page_state:b.THANK_YOU})},_modal_callback_dismiss:function(){return this._logCurrentState("cancel_dialog"),this.setState({page_state:b.ASK_IF_OK})},_randomNum:function(e,t){return null==t&&(t=0),Math.random()*(e-t)+t},_shouldShow:function(t){var n,o;return o=t.toLowerCase(),e.call(this._BLOCKED_FILE_EXTENSIONS,o)>=0?!1:this.props.showalways===!0?!0:(n=this._randomNum(100),n<=this._SHOW_THRESHOLD)},_handlePreviewOpen:function(e,t){return this._shouldShow(t)?(this.setState({page_state:b.ASK_IF_OK,file_nsid:e.ns_id,file_sjid:e.sjid,filename:l.filename(e.fq_path),doc_preview_status:e.doc_preview_status}),this._log("popup_shown",this._getActiveUser(e.ns_id),e.ns_id,e.sjid,t,e.doc_preview_status)):void 0},_handlePreviewFail:function(e,t){return this._log("popup_failed",this._getActiveUser(e.ns_id),e.ns_id,e.sjid,t,e.doc_preview_status)},_handleStateChange:function(t,n){var o,i,r,s,a;if(r=n.preview_state,o=n.file_obj,"open"===r){if(i=d.get_viewer().get_users(),a=_.pluck(i,"root_ns"),s=o.ns_id,e.call(a,s)>=0)return this._handleFile(o)}else if("closed"===r)return this.setState({page_state:b.HIDDEN,file_nsid:null,file_sjid:null,filename:null,doc_preview_status:null})},_handleFile:function(e){var t,n;return t=l.file_extension(l.filename(e.fq_path),!0),(n=e.doc_preview_status)===p.DOC_PREVIEW_AVAILABLE||n===p.DOC_PREVIEW_UNAVAILABLE_OTHER?this._handlePreviewOpen(e,t):this._handlePreviewFail(e,t)},_getActiveUser:function(e){var t,n,o,i,r;for(i=d.get_viewer().get_users(),n=t=0,o=i.length;o>t;n=++t)if(r=i[n],e===r.root_ns)return r;return w(!1,"bad state - must have a valid user to match ns_id")},_logCurrentState:function(e,t,n){return null==t&&(t=""),null==n&&(n=!1),this._log(e,this._getActiveUser(this.state.file_nsid),this.state.file_nsid,this.state.file_sjid,l.file_extension(this.state.filename,!0),this.state.doc_preview_status,t)},_log:function(e,t,n,o,i,r,s){return null==s&&(s=""),g.log(e,t,n,o,i,r,s)}}),{PreviewQualityPopup:f,CARD_TYPES:b}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/previews/preview_toolbar",["external/keymaster","external/react","jquery","modules/clean/analytics","modules/clean/frame_messenger","modules/clean/keycode","modules/clean/previews/file_view_rams_common","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/full_screen_helpers","modules/clean/react/sprite","modules/core/dom","modules/core/exception","modules/core/i18n"],function(t,n,o,i,r,s,a,l,u,c,d,p,h){var _,m,f,g,v,y,E,b,w;return f=i.PreviewActivityLogger,_=u.FullscreenHelpers,E=p.assert,b=n.createElement,w=n.DOM,y=h._,g={DEFAULT:"default",SPP:"spp",SPREADSHEET:"spreadsheet",HTML:"html"},m={},m[s.ESC]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.SPACE]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PAGE_UP]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PAGE_DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.LEFT]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.UP]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.RIGHT]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.DOWN]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.EQUALS]={altKey:!0,ctrlKey:!0,metaKey:!0},m[70]={altKey:!1,ctrlKey:!0,metaKey:!0},m[80]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PLUS_EQUALS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.MINUS_FF]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PLUS_EQUALS_FF_GERMAN]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.MINUS_FF_MAC]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.PLUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},m[s.MINUS_CHROME]={altKey:!0,ctrlKey:!0,metaKey:!0},v=n.createClass({displayName:"PreviewToolbar",propTypes:{actions:n.PropTypes.func.isRequired,fileExtension:n.PropTypes.string.isRequired,pdfLink:n.PropTypes.string,afterFileViewerExit:n.PropTypes.func,fileDocPreviewStatus:n.PropTypes.number,fileHref:n.PropTypes.string,filePreviewType:n.PropTypes.string,isHidden:n.PropTypes.bool,shouldDisplayRegionCreationButton:n.PropTypes.bool,onRegionCreationClick:n.PropTypes.func,sharePermissions:n.PropTypes.object},_TOOLBAR_ENTRY_CLASSES:{PAGE_INDICATOR:"page-indicator",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",FULLSCREEN:"fullscreen",PRINT:"print",ENABLE_REGION_CREATION:"enable-region-creation"},_ELEMENT_CONFIGURATIONS:{default:["page-indicator","zoom-in","zoom-out","page-up","page-down","fullscreen","print","enable-region-creation"],spp:["page-indicator","page-up","page-down","fullscreen","print","enable-region-creation"],spreadsheet:["zoom-in","zoom-out","fullscreen","print"],html:["fullscreen","print"]},_PARENT_TO_IFRAME_ACTIONS:{ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_VIEWER_FULLSCREEN:"exit-viewer-fullscreen",PRINT:"print",CLEAR_MOUSE_TRACKING:"clear-mouse-tracking",SCROLL_DOWN:"scroll-down",SCROLL_UP:"scroll-up",SCROLL_LEFT:"scroll-left",SCROLL_RIGHT:"scroll-right",SCREEN_DOWN:"screen-down",SCREEN_UP:"screen-up",ENABLE_REGION_CREATION:"enable-region-creation"},_FADE_TIME_MSEC:400,_IDLE_TIME_MSEC:1500,_trustedIframeDomain:null,_fadeTimeout:null,_fullscreeningTimeout:null,_idleTimeout:null,_previewOpen:!1,_frameMessenger:null,getInitialState:function(){var e;return e={pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:g.DEFAULT,sharePermissions:null}},_reset:function(){return this._clearAllTimeouts(),this.setState({pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:g.DEFAULT})},_setFullscreen:function(e,t){var n,o;return(o=e?this.props.actions.enterFullscreen():this.props.actions.exitFullscreen())?(this._clearFullscreeningTimeout(),e?(l.openFullscreenLogging(t),this.fadeOut()):(l.closeFullscreenLogging(t),this.fadeIn(),this._startIdleTimeout()),this.setState({fullscreening:!0}),this._startFullscreeningTimeout(),_.setBrowserFullscreen(e),n=e?this._PARENT_TO_IFRAME_ACTIONS.ENTER_FULLSCREEN:this._PARENT_TO_IFRAME_ACTIONS.EXIT_VIEWER_FULLSCREEN,this._frameMessenger.postMessageToChildren(n)):void 0},_isViewerFullscreen:function(){return this.props.actions.isFullscreen()},_isBrowserFullscreen:function(){return null!=document.fullScreen?document.fullScreen:null!=document.webkitIsFullScreen?document.webkitIsFullScreen:null!=document.mozFullScreen?document.mozFullScreen:null!=document.msFullscreenElement||null!=document.fullscreenElement},_handleClick:function(e){var t,n,i,r,s,a;for(s={input_method:"click",file_ext:this.props.fileExtension},t=o(e.currentTarget),a=this.state.disabledClasses,i=0,r=a.length;r>i;i++)if(n=a[i],t.hasClass(n))return;return t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN)?this._zoomIn(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT)?this._zoomOut(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP)?this._pageUp(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN)?this._pageDown(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN)?this._toggleFullscreen(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.PRINT)?this._printDocument(s):t.hasClass(this._TOOLBAR_ENTRY_CLASSES.ENABLE_REGION_CREATION)&&this._onRegionCreationClick(s),this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING)},_handleMessageFromChild:function(e){var t,n,o,i,r,s,a;switch(o={input_method:"child-message",file_ext:this.props.fileExtension},e.action){case"page-change":if(a=this._isToolbarReadyToShow(),t=this._sanitizePageNumber(e.parameters.current_page),i=this._sanitizePageNumber(e.parameters.pages_count),0>=t||0>=i)return;if(null!=e.parameters.doc_type&&this.setState({docType:e.parameters.doc_type}),n=[],1>=t&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP),t>=i&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN),0===(null!=(r=this.props.sharePermissions)&&null!=(s=r.canPrintRoles)?s.length:void 0)&&n.push(this._TOOLBAR_ENTRY_CLASSES.PRINT),this.setState({currentPage:t,pagesCount:i,disabledClasses:n}),!a&&this._isToolbarReadyToShow())return this.fadeIn(),this._startIdleTimeout();break;case"idle-mouse":return this.fadeOut(),f.log("idle-mouse",o);case"active-mouse":return this.fadeIn();case"exit-parent-fullscreen":return this._setFullscreen(!1,o);case"keydown":if(null!=e.parameters)return this.onKeydown(e.parameters);break;case"get-keydown-keys-handled-by-parent":return this._frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:m})}},onPreviewOpen:function(){return this._previewOpen?!0:(o(document).on("keydown",this.onKeydown),o(document).on("fullscreenchange",this.onBrowserFullscreenChange),o(document).on("webkitfullscreenchange",this.onBrowserFullscreenChange),o(document).on("msfullscreenchange",this.onBrowserFullscreenChange),o(document).on("mozfullscreenchange",this.onBrowserFullscreenChange),this._previewOpen=!0,!0)},onPreviewClose:function(){return this._previewOpen?(o(document).off("keydown",this.onKeydown),o(document).off("fullscreenchange",this.onBrowserFullscreenChange),o(document).off("webkitfullscreenchange",this.onBrowserFullscreenChange),o(document).off("msfullscreenchange",this.onBrowserFullscreenChange),o(document).off("mozfullscreenchange",this.onBrowserFullscreenChange),this._reset(),this._frameMessenger.resetOriginsForPosting(),this._previewOpen=!1,!0):!0},componentDidMount:function(){return window.addEventListener("message",this.handleViewerMessage),this._frameMessenger=new r,this._frameMessenger.configureChildMessaging(this.props.actions.getIframeQuery(),o.proxy(this._handleMessageFromChild,this),["page-change","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent"]),this._frameMessenger.startListening()},componentWillUnmount:function(){return this._clearAllTimeouts(),this._frameMessenger.stopListening(),window.removeEventListener("message",this.handleViewerMessage)},renderPageIndicatorText:function(){var e;return this.state.currentPage<1||this.state.pagesCount<1?"":(e=y(this.state.docType===g.SPP?"Slide %(current_page)s of %(pages_count)s":"Page %(current_page)s of %(pages_count)s"),e.format({current_page:this.state.currentPage,pages_count:this.state.pagesCount}))},_renderToolbarButton:function(t,n,o,i){var r,s;return e.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],t)<0?w.span({style:{display:"none"}}):(r=t+" toolbar-button-entry",s=e.call(this.state.disabledClasses,t)>=0,w.div({className:r,onMouseUp:this._handleClick},w.div({className:"toolbar-tooltip"},w.div({className:"toolbar-tooltip-container"},w.div({className:"toolbar-tooltip-pointer-border"})),w.div({className:"toolbar-tooltip-container"},w.div({className:"toolbar-tooltip-body"},i)),w.div({className:"toolbar-tooltip-container"},w.div({className:"toolbar-tooltip-pointer"}))),b(c,{group:n,name:o,className:s?"disabled":"",alt:i})))},_renderPageIndicator:function(){var t;return t=this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR,e.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],t)>=0?w.div({className:this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR},this.renderPageIndicatorText()):void 0},render:function(){var e,t,n,o,i,r,s,a,l;return e="preview-toolbar-overlay-container ",this.state.visible&&!this.props.isHidden||(e+="hide "),this.state.fadingOut&&(e+="fadeout "),t={className:e},r=y(this.state.docType===g.SPP?"Previous slide":"Page up"),o=y(this.state.docType===g.SPP?"Next slide":"Page down"),i=this.state.docType===g.SPP?"left":"up",n=this.state.docType===g.SPP?"right":"down",s=y(0===(null!=(a=this.props.sharePermissions)&&null!=(l=a.canPrintRoles)?l.length:void 0)?"Printing is turned off for this file.":"Print"),w.div(t,w.div({className:"preview-toolbar-overlay",onMouseEnter:this.onMouseEnterToolbar},w.div({className:"preview-toolbar-content"},this._renderPageIndicator(),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT,"web","zoomout",y("Zoom out")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN,"web","zoom",y("Zoom in")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP,"web",i,r),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN,"web",n,o),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN,"web","fullscreen",y("Fullscreen")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PRINT,"web","print",s),this.props.shouldDisplayRegionCreationButton?this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ENABLE_REGION_CREATION,"web","ic_comment_area_large",y("Comment on specific areas")):void 0)))},_sanitizePageNumber:function(e){var t;return null==e?0:(t=parseInt(e),isNaN(t)?0:t)},_getOriginFromUrl:function(e){var t;return t=document.createElement("a"),t.href=e,"https://"+t.hostname},fadeOut:function(){return this.state.fadingOut||this._clearFadeTimeout(),this.setState({fadingOut:!0,tooltipClass:null}),this._startFadeTimeout()},fadeIn:function(){return this._clearIdleTimeout(),this._isViewerFullscreen()||o("html").hasClass("no-flexbox")?void 0:this._isToolbarReadyToShow()?(this._clearFadeTimeout(),this.setState({visible:!0,fadingOut:!1})):void 0},onMouseEnterToolbar:function(){return this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING),this._clearIdleTimeout()},onKeydown:function(e){var t,n,i,r;return n=!1,!this._frameMessenger.childIsValidated()||"dbmodal"===key.getScope()||d.focus_in_input()||d.is_input(e.target)||null!=e.target&&(t=o("#file-comments"),1!==t.length&&(t=o("#photo-comments")),1===t.length&&(e.target===t[0]||o.contains(t[0],e.target)))?void 0:(r={input_method:"keydown",file_ext:this.props.fileExtension,extra:JSON.stringify({keycode:e.keyCode})},i=e.keyCode,this.state.docType!==!g.SPP||i!==s.EQUALS&&i!==s.PLUS_EQUALS_FF&&i!==s.PLUS_CHROME&&i!==s.PLUS_EQUALS_FF_GERMAN?this.state.docType!==!g.SPP||i!==s.MINUS_FF_MAC&&i!==s.MINUS_FF&&i!==s.MINUS_CHROME?i===s.LEFT?(this.state.docType===g.SPP?this._pageUp(r):this._scrollLeft(r),n=!0):i===s.RIGHT?(this.state.docType===g.SPP?this._pageDown(r):this._scrollRight(r),n=!0):i===s.PAGE_UP?(this.state.docType===g.SPP?this._pageUp(r):this._screenUp(r),n=!0):i===s.SPACE||i===s.PAGE_DOWN?(this.state.docType===g.SPP?this._pageDown(r):this._screenDown(r),n=!0):i===s.UP?(this.state.docType===g.SPP?this._pageUp(r):this._scrollUp(r),n=!0):i===s.DOWN?(this.state.docType===g.SPP?this._pageDown(r):this._scrollDown(r),n=!0):70!==i||e.ctrlKey||e.metaKey?70===i&&(e.ctrlKey||e.metaKey)?this._searchInline(r):80===i?(this._printDocument(r),n=!0):i===s.ESC&&(this._isViewerFullscreen()?this._exitFullscreen(r):this.props.afterFileViewerExit&&!this._isAnnotationBubbleShown()&&this._exitPreview(r),n=!0):(this._isViewerFullscreen()?this._exitFullscreen(r):this._enterFullscreen(r),n=!0):(this._zoomOut(r),n=!0):(this._zoomIn(r),n=!0),n&&null!=e.preventDefault&&e.preventDefault(),!n)},_isAnnotationBubbleShown:function(){return o(".annotation-bubble-container .bubble-dropdown").length>0},_startFadeTimeout:function(){return this._fadeTimeout=setTimeout(function(e){return function(){return e._fadeTimeout=null,e.setState({visible:!1,fadingOut:!1})}}(this),this._FADE_TIME_MSEC)},_clearFadeTimeout:function(){return null!=this._fadeTimeout?(clearTimeout(this._fadeTimeout),this._fadeTimeout=null):void 0},_startFullscreeningTimeout:function(){var e;return e=function(e){return function(){return e._fullscreeningTimeout=null,e.setState({fullscreening:!1})}}(this),this._fullscreeningTimeout=setTimeout(o.proxy(e,this),a.RAMS_FULLSCREEN_TRANSITION_TIME_MSEC)},_clearFullscreeningTimeout:function(){return null!=this._fullscreeningTimeout?(clearTimeout(this._fullscreeningTimeout),this._fullscreeningTimeout=null):void 0},onIdleTimeout:function(){return this._clearIdleTimeout(),this.fadeOut()},_startIdleTimeout:function(){return this._clearIdleTimeout(),this._idleTimeout=setTimeout(o.proxy(this.onIdleTimeout,this),this._IDLE_TIME_MSEC)},_clearIdleTimeout:function(){return null!=this._idleTimeout?(clearTimeout(this._idleTimeout),this._idleTimeout=null):void 0},_clearAllTimeouts:function(){return this._clearFadeTimeout(),this._clearFullscreeningTimeout(),this._clearIdleTimeout()},_isToolbarReadyToShow:function(){return this.state.currentPage>0&&this.state.pagesCount>0},onBrowserFullscreenChange:function(e){var t;return t={input_method:"browser-fullscreen-exit",file_ext:this.props.fileExtension},this._isViewerFullscreen&&!this._isBrowserFullscreen()?this._setFullscreen(!1,t):void 0},_logData:function(e,t){return"string"==typeof t.input_method?f.log(e,t):E(!1,"logData not correctly formed"),"string"==typeof t.input_method},_logAndPostMessage:function(e,t,n){return this._logData(t,n)?this._frameMessenger.postMessageToChildren(e):void 0},_zoomIn:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_IN,"zoom-in",e)},_zoomOut:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_OUT,"zoom-out",e)},_pageUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.PAGE_UP,"page-up",e)},_pageDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.PAGE_DOWN,"page-down",e)},_screenUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_UP,"screen-up",e)},_screenDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_DOWN,"screen-down",e)},_scrollUp:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_UP,"scroll-up",e)},_scrollDown:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_DOWN,"scroll-down",e)},_scrollRight:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_RIGHT,"scroll-right",e)},_scrollLeft:function(e){return this._logAndPostMessage(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_LEFT,"scroll-left",e)},_toggleFullscreen:function(e){return this._isViewerFullscreen()?this._exitFullscreen(e):this._enterFullscreen(e)},_enterFullscreen:function(e){return this._setFullscreen(!0,e)},_exitFullscreen:function(e){return this._setFullscreen(!1,e)},_exitPreview:function(e){var t;return this._logData("exit-preview",e)&&"function"==typeof(t=this.props).afterFileViewerExit?t.afterFileViewerExit():void 0},_printDocument:function(e){var t;return this._logData("print",e)&&(t=this.props.pdfLink?this.props.actions.nativePdfPrint(this.props.pdfLink):this.props.actions.nativePdfPrint({doc_preview_status:this.props.fileDocPreviewStatus,href:this.props.fileHref,preview_type:this.props.filePreviewType}),!t)?this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.PRINT):void 0},_searchInline:function(e){return this._logData("search-inline",e)},_onRegionCreationClick:function(){return this.props.onRegionCreationClick()}}),{ReactPreviewToolbarClass:v,PreviewToolbarDocType:g}})}.call(this),function(){define("modules/clean/react/previews/preview_toolbar_container",["external/react","external/underscore","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/react/previews/preview_toolbar","modules/clean/react/previews/preview_toolbar_region_creation","modules/clean/comments/action_creators","modules/clean/comments/constants","modules/clean/comments/logging","modules/clean/comments/store","modules/clean/comments/utils","modules/constants/comments_panel"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f;return _=o.ReactPreviewToolbarClass,p=s.FileActivityLogEventType,d=s.FileActivityLogClientOriginType,m=e.createElement,f=e.DOM,h=e.createClass({displayName:"PreviewToolbarContainer",propTypes:{previewToolbarProps:e.PropTypes.object.isRequired,isFullscreen:e.PropTypes.bool,shouldUseImageToolbar:e.PropTypes.bool},getInitialState:function(){return this.getComponentState()},getComponentState:function(){return{canAnnotate:u.canAnnotate(this.props.isFullscreen),regionCreationEnabled:l.state.regionCreationEnabled}},onStateChange:function(){return this.setState(this.getComponentState())},componentDidMount:function(){return this.unsubscribeStore=l.listen(this.onStateChange)},componentWillUnmount:function(){return this.unsubscribeStore(),r.setRegionCreationEnabled(!1)},_logRegionCreationClick:function(e){return a.logEvent(e,d.ANNOTATION_MODE_BUTTON_IN_TOOLBAR)},_onRegionCreationClick:function(){return this._logRegionCreationClick(p.CLIENT_ANNOTATION_MODE_ENABLED),r.setRegionCreationEnabled(!0)},_onRegionCreationDoneClick:function(){return this._logRegionCreationClick(p.CLIENT_ANNOTATION_MODE_DISABLED),r.setRegionCreationEnabled(!1)},onKeydown:function(e){var t;return null!=(t=this.refs.previewToolbar)?t.onKeydown(e):void 0},render:function(){var e,o;return o=this.state.regionCreationEnabled&&this.state.canAnnotate,e=c.ALLOW_VIEW_ANNOTATE_MODES&&this.state.canAnnotate,f.div({className:"preview-toolbar-container"},this.props.shouldUseImageToolbar?o?void 0:m(n,t.extend({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this._onRegionCreationClick,canEnableRegionCreation:e})):m(_,t.extend({},this.props.previewToolbarProps,{ref:"previewToolbar",onRegionCreationClick:this._onRegionCreationClick,isHidden:o,shouldDisplayRegionCreationButton:e})),o?m(i,{ref:"previewToolbarRegionCreation",onRegionCreationDoneClick:this._onRegionCreationDoneClick}):void 0)}})})}.call(this),function(){define("modules/clean/react/previews/preview_toolbar_region_creation",["external/react","modules/core/dom","modules/core/i18n"],function(e,t,n){var o,i,r;return r=e.DOM,i=n._,o=e.createClass({displayName:"PreviewToolbarRegionCreation",propTypes:{onRegionCreationDoneClick:e.PropTypes.func.isRequired},_renderDoneButton:function(){return r.div({className:"done-button",onMouseUp:this.props.onRegionCreationDoneClick},i("Done"))},_renderHint:function(){return r.div({className:"region-creation-hint"},i("Click and drag to comment on areas"))},render:function(){return r.div({className:"preview-toolbar-overlay-container"},r.div({className:"preview-toolbar-overlay"},r.div({className:"region-creation-toolbar-content"},this._renderHint(),this._renderDoneButton())))}})})}.call(this),function(){define("modules/clean/react/previews/preview_video",["external/classnames","external/react","external/react-dom","jquery","modules/clean/annotations/preview_image_annotations_toolbar","modules/clean/image_size","modules/clean/previews/util","modules/clean/react_format","modules/clean/react/helpers","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/previews/preview_zoom_container","modules/clean/react/previews/constants","modules/clean/static_urls","modules/clean/web_timing_logger","modules/core/i18n","modules/core/uri","require"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g){var v,y,E,b,w,T,S,C,I,P,A;return I=r.image_best_fit_size,E=s.PermissionHelper,P=a.reactFormat,S=l.compareStateAndProps,y=c.EventTypes,v=p.ErrorTypes,A=h.static_url,T=m._,C=t.DOM,w=t.createFactory(d),b=t.createClass({displayName:"PreviewVideo",propTypes:{"preview-url":t.PropTypes.string,"thumbnail-url-tmpl":t.PropTypes.string,"video-metadata-url":t.PropTypes.string,onLoad:t.PropTypes.func,isFullscreen:t.PropTypes.bool,filePreviewSession:t.PropTypes.object,shouldDisplayAnnotationsToolbar:t.PropTypes.bool,index:t.PropTypes.number,count:t.PropTypes.number,onError:t.PropTypes.func,onPrevious:t.PropTypes.func,onNext:t.PropTypes.func},_logFilePreviewEvent:function(e){var t;return null!=(t=this.props.filePreviewSession)?t.recordEvent(e):void 0},_getSizedImageUrl:function(){return f.parse(this.props["thumbnail-url-tmpl"]).updateQuery({size:I(o(window).width(),o(window).height()),size_mode:2}).toString()},_shutdown:function(){var e,t,n;if(o(".vjs-big-play-button").blur(),null!=this._player){try{this._player.trigger("shutdown"),"Hls"===this._player.techName&&null!=(n=this._player.tech.sourceBuffer)&&n.abort(),this._player.dispose()}catch(t){e=t}return this._player=null}},_onCanPlay:function(){return this._logFilePreviewEvent(y.FILE_PREVIEW_RENDER_SUCCEEDED),_.mark_time_to_interactive()},_onReady:function(e){var t;return this._player=e,t=function(){return o(".vjs-poster").show(),o(".vjs-big-play-button").show(),o(".vjs-big-play-button").focus()},setTimeout(t,0),this._logFilePreviewEvent(y.FILE_PREVIEW_DOWNLOAD_SUCCEEDED),_.mark_time_to_view()},_onPlay:function(){return o(".vjs-poster").hide(),o(".vjs-big-play-button").hide()},_onEnded:function(){return o(".vjs-poster").show(),o(".vjs-big-play-button").show(),o(".vjs-loading-spinner").hide()},_onError:function(e){var t,n;return this._shutdown(),this._logFilePreviewEvent(y.FILE_PREVIEW_DOWNLOAD_FAILED),_.mark_time_to_view(),_.mark_time_to_interactive(),"needflash"===e?"function"==typeof(t=this.props).onError?t.onError(v.NEED_FLASH_ERROR):void 0:"function"==typeof(n=this.props).onError?n.onError():void 0},_embedVideoLoader:function(){var e;return e=o(n.findDOMNode(this.refs.previewVideoPlayer)),g(["modules/clean/video_loader"],function(t){return function(n){return t._logFilePreviewEvent(y.FILE_PREVIEW_DOWNLOAD_ATTEMPTED),t._player=n.embed(e,{src:t.props["preview-url"],type:E.use_hls_video()?"application/vnd.apple.mpegurl":"video/flv",useFlash:!E.use_hls_video(),controls:!0,playbackRates:[.5,1,1.5,2],preload:"auto",poster:t._getSizedImageUrl(),metadata_link:t.props["video-metadata-url"],metadata:null,onCanPlay:t._onCanPlay,onEnd:t._onEnd,onError:t._onError,onReady:t._onReady,onPlay:t._onPlay})}}(this))},componentDidMount:function(){var e;return this._embedVideoLoader(),"function"==typeof(e=this.props).onLoad&&e.onLoad(),this._logFilePreviewEvent(y.FILE_PREVIEW_SUPPORT_CONFIRMED)},componentWillUpdate:function(e){return e["preview-url"]!==this.props["preview-url"]?this._shutdown():void 0},componentDidUpdate:function(e){var t;return e["preview-url"]!==this.props["preview-url"]?(this._embedVideoLoader(),"function"==typeof(t=this.props).onLoad&&t.onLoad(),this._logFilePreviewEvent(y.FILE_PREVIEW_SUPPORT_CONFIRMED)):void 0},componentWillUnmount:function(){return this._shutdown()},shouldComponentUpdate:S,_renderAnnotationsToolbar:function(){return C.div({className:"preview-toolbar-container"},t.createElement(i,{index:this.props.index,count:this.props.count,onPrevious:this.props.onPrevious,onNext:this.props.onNext}))},_renderPlayer:function(){return C.div({ref:"previewVideoPlayer",className:"video-player"})},render:function(){var t;return t={"flex-preview-container":!0,"flex-preview-container--padded":!0,"has-annotations-toolbar":this.props.shouldDisplayAnnotationsToolbar},this.props.isFullscreen?w({isFlippable:!0,renderZoomControls:!1,onClose:function(){return u.closeFullscreen()},containerClass:"video-player"},this._renderPlayer()):C.div({ref:"previewVideoContainer",className:e(t)},C.div({className:"preview-content preview-video"},C.div({className:"preview-video__wrapper"},C.div({className:"preview-video__aspect-container"},C.div({className:"preview-video__container"},this._renderPlayer())))),this.props.shouldDisplayAnnotationsToolbar&&this.props.count>1?this._renderAnnotationsToolbar():void 0)}}),{PreviewVideo:b}})}.call(this),function(){define("modules/clean/react/previews/preview_zoom_container",["external/keymaster","external/classnames","external/react","external/underscore","jquery","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/flippable_controls","modules/clean/react/file_viewer/store","modules/clean/react/sprite","modules/clean/react/title_bubble","modules/core/dom","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d){var p,h,_,m,f,g,v,y;return v=n.createElement,y=n.DOM,g=d._,f=n.createFactory(l),p=n.createFactory(s),_="",h="previewzoomcontainer",m=n.createClass({displayName:"PreviewZoomContainer",propTypes:{isFlippable:n.PropTypes.bool.isRequired,renderZoomControls:n.PropTypes.bool.isRequired,onClose:n.PropTypes.func.isRequired,containerClass:n.PropTypes.string,zoomOutCallback:n.PropTypes.func,zoomInDisabled:n.PropTypes.bool,zoomOutDisabled:n.PropTypes.bool,dragDisabled:n.PropTypes.bool},getDefaultProps:function(){return{zoomInDisabled:!0,zoomOutDisabled:!0,dragDisabled:!0}},getInitialState:function(){return{controlsHidden:!1}},componentDidMount:function(){return this._flipNext=o.throttle(this._flipNext,100),this._flipPrevious=o.throttle(this._flipPrevious,100),key("esc",h,this.props.onClose),null!=this.props.zoomOutCallback&&key("space",h,this.props.zoomOutCallback),this.props.isFlippable&&(key("left",h,function(e){return function(){return e._startControlsTimer(),e._flipPrevious()}}(this)),key("right",h,function(e){return function(){return e._startControlsTimer(),e._flipNext()}}(this))),_=key.getScope(),key.setScope(h),this._startControlsTimer(),this._hideCursor()},componentWillUpdate:function(){return key.setScope(h)},componentWillUnmount:function(){return key.clearScope(h),key.setScope(_),clearTimeout(this.controlsHideTimer),this._showCursor()},_startControlsTimer:function(){return this._showControls(),clearTimeout(this.controlsHideTimer),this.controlsHideTimer=setTimeout(function(e){
return function(){return e._hideControls()}}(this),3e3)},_showControls:function(){return this._showCursor(),this.setState({controlsHidden:!1})},_hideControls:function(){return this._hideCursor(),this.setState({controlsHidden:!0})},_showCursor:function(){return i("html").removeClass("no-cursor")},_hideCursor:function(){return i("html").addClass("no-cursor")},_flipNext:function(){return r.flipNext()},_flipPrevious:function(){return r.flipPrevious()},_onClick:function(e){var t;return t="."+this.props.containerClass+", .preview-toolbar-overlay, .preview-zoomer-close",i(e.target).is(t)||0!==i(e.target).parents(t).length?void 0:(e.preventDefault(),this.props.onClose())},_onMouseMove:function(e){return 0===i(e.target).parents(".preview-toolbar-overlay").length?this._startControlsTimer():clearTimeout(this.controlsHideTimer)},_renderControls:function(){var e,n,o;return n={"toolbar-button-entry":!0,"zoom-in":!0,disabled:this.props.zoomInDisabled},o={"toolbar-button-entry":!0,"zoom-out":!0,disabled:this.props.zoomOutDisabled},e={"preview-toolbar-container":!0,hidden:this.state.controlsHidden},y.div({ref:"previewZoomerToolbarContainer",className:t(e)},y.div({className:"preview-toolbar-overlay-container"},y.div({className:"preview-toolbar-overlay"},y.div({className:"preview-toolbar-content"},this.props.isFlippable?p({index:""+(a.currentIndex()+1),numFlippableFiles:a.files().length,onNext:this._flipNext,onPrevious:this._flipPrevious}):void 0,this.props.renderZoomControls?[y.div({ref:"zoomControlZoomOut",className:t(o)},f({alt:g("Zoom out"),group:"web",name:"zoomout"})),y.div({ref:"zoomLabelContainer",className:"toolbar-button-entry"},v(u,{content:g("View actual size"),position:u.POSITIONS.TOP,isTargetPositionFixed:!0,distanceFromTarget:16},y.span({ref:"zoomLabel",className:"zoom-label"}))),y.div({ref:"zoomControlZoomIn",className:t(n)},f({alt:g("Zoom in"),group:"web",name:"zoom"}))]:void 0))))},_renderClose:function(){var e;return e={"preview-zoomer-close":!0,hidden:this.state.controlsHidden},y.button({ref:"previewZoomerClose",className:t(e),onClick:this.props.onClose},f({alt:g("Close"),group:"web",name:"lightbox_close"}))},render:function(){var e;return e={"preview-zoomer-container":!0,"zoomer-drag-disabled":this.props.dragDisabled},y.div({ref:"previewZoomerContainer",className:t(e),onClick:this._onClick,onMouseMove:this._onMouseMove},this.props.children,this._renderClose(),this._renderControls())}})})}.call(this),function(){define("modules/clean/react/previews/responsive_image",["external/react","modules/clean/react/previews/image_helpers"],function(e,t){var n,o;return o=e.DOM,n=e.createClass({displayName:"ResponsiveImage",propTypes:{thumbnailUrlTmpl:e.PropTypes.string.isRequired,className:e.PropTypes.string,style:e.PropTypes.object,onLoad:e.PropTypes.func,onError:e.PropTypes.func,onClick:e.PropTypes.func,onContextMenu:e.PropTypes.func},getDefaultProps:function(){return{onContextMenu:null}},render:function(){var e;return e=this.props.onContextMenu?this.props.className+" disabled-context-menu":this.props.className,o.img({srcSet:t.getSrcSet(this.props.thumbnailUrlTmpl),sizes:t.IMG_SIZES_ATTR,src:t.getFallbackSrc(this.props.thumbnailUrlTmpl),className:e,style:this.props.style,onLoad:this.props.onLoad,onError:this.props.onError,onClick:this.props.onClick,onContextMenu:this.props.onContextMenu})}})})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/radio",["external/classnames","external/react","external/react-dom","modules/clean/teams/prop_types"],function(t,n,o,i){var r,s,a,l,u,c,d;return c=n.DOM,d=n.PropTypes,a={Normal:"normal",Large:"large"},u=Object.keys(a).map(function(e){return a[e]}),l=d.oneOfType([d.string,d.number,d.bool]),s=n.createClass({displayName:"RadioItem",propTypes:{className:d.string,value:l,_radioGroupData:d.shape({variant:d.oneOf(u),name:d.string.isRequired,radioGroupValue:l,onSelect:d.func})},_handleClick:function(){var e;this._isSelected()||(o.findDOMNode(this.refs.input).focus(),"function"==typeof(e=this.props._radioGroupData).onSelect&&e.onSelect(this.props.value))},_handleChange:function(){var e;"function"==typeof(e=this.props._radioGroupData).onSelect&&e.onSelect(this.props.value)},_getId:function(){return this.props._radioGroupData.name+"_"+this.props.value},_isSelected:function(){return this.props._radioGroupData.radioGroupValue===this.props.value},render:function(){var o,i,r,s;return i=this.props._radioGroupData,s=["c-radio-wrapper",this.props.className],o={"c-radio":!0},r=i.variant,e.call(u,r)>=0&&i.variant!==a.Normal&&(o["c-radio--"+i.variant]=!0),n.createElement("div",{className:t(s),onClick:this._handleClick},n.createElement("input",{id:this._getId(),ref:"input",type:"radio",name:i.name,value:this.props.value,checked:this._isSelected(),onChange:this._handleChange}),n.createElement("div",{className:t(o)},n.createElement("div",{className:"c-radio__inner"})),n.createElement("label",{className:"c-radio-content",htmlFor:this._getId()},this.props.children))}}),r=n.createClass({displayName:"RadioGroup",propTypes:{className:d.string,variant:d.oneOf(u),name:d.string,legend:d.string.isRequired,align:d.oneOf(["top","bottom","middle","baseline"]),displayLegend:d.bool,valueLink:i.valueLink(l).isRequired},getDefaultProps:function(){return{className:null,type:a.Normal,align:"middle",displayLegend:!1}},_onRadioItemSelect:function(e){var t;null!=(t=this.props.valueLink)&&t.requestChange(e)},render:function(){var e,o,i,r;return o=this.props.name||"radio-"+Math.floor(1e9*Math.random()),e=n.Children.map(this.props.children,function(e){return function(t){return t.type===s?n.cloneElement(t,{_radioGroupData:{variant:e.props.variant,name:o,radioGroupValue:e.props.valueLink.value,onSelect:e._onRadioItemSelect}}):t}}(this)),i={"c-radio-group__legend":!0,"ax-visually-hidden":!this.props.displayLegend},r=["c-radio-group","align-"+this.props.align,this.props.className],n.createElement("fieldset",{className:t(r)},n.createElement("legend",{className:t(i)},this.props.legend),e)}}),{RadioGroup:r,RadioItem:s,RadioItemVariant:a}})}.call(this),function(){define("modules/clean/react/select",["external/classnames","external/react","external/react-dom","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/hidden","modules/clean/react/sprite","modules/clean/react/util"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f;return c=a.HiddenSelect,p=t.DOM,d=t.createElement,h=function(e,t){var n,o,i,r;return r=e.scrollTop(),i=r+e.height(),o=t.position().top+r,n=o+t.height(),r>o?e.scrollTop(o):n>i?e.scrollTop(n-e.height()):void 0},f=t.PropTypes.oneOfType([t.PropTypes.string,t.PropTypes.number]),m=t.createClass({displayName:"selectOption",propTypes:{id:t.PropTypes.string,className:t.PropTypes.string,disabled:t.PropTypes.bool,title:t.PropTypes.string,value:f,error:t.PropTypes.shape({message_text:t.PropTypes.string,message_html:t.PropTypes.string})},getInitialState:function(){return{id:o.uniqueId("option")}},componentWillReceiveProps:function(e){return null!=e.id?this.setState({id:e.id}):void 0},render:function(){var t,n,o;return t={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled},null!=this.props.className&&(t[this.props.className]=!0),o=this.props.value,n=i.extend(!0,{},this.props),delete n.value,p.div(i.extend({"data-value":o},n,{id:this.state.id,role:"option",className:e(t),"aria-disabled":this.props.disabled}),this.props.children)}}),_=t.createClass({displayName:"selectInput",mixins:[s],mouseInput:!0,propTypes:{name:t.PropTypes.string,onChange:t.PropTypes.func,defaultValue:f,style:t.PropTypes.object,value:f,variant:t.PropTypes.string,className:t.PropTypes.string,ariaLabelId:t.PropTypes.string,ariaDescriptionId:t.PropTypes.string,valueLink:t.PropTypes.object,isDisabled:t.PropTypes.bool},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",ariaLabelId:"",ariaDescriptionId:"",style:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",selectOptionId:o.uniqueId("selected-option"),listboxId:o.uniqueId("listbox"),value:this.props.defaultValue}},_getFilteredChildren:function(){return o.isArray(this.props.children)?o.filter(this.props.children,function(e){return e}):this.props.children},render:function(){var n,o,i,r,s,a,u;return o={"select-input":!0,"select-input-dropdown-shown":this.state.open,"select-input-disabled":this.props.isDisabled},this.props.variant&&(o[this.props.variant]=!0),this.props.className&&(o[this.props.className]=!0),r={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},i=this.renderErrorIfEnabled(),n=this.props.ariaDescriptionId,((null!=(s=this.props.error)?s.message_text:void 0)||null!=(null!=(a=this.props.error)?a.message_html:void 0))&&(n=i.props.id),u=this.selectedOption(),p.div({className:e(o),style:this.props.style,ref:"wrapperDiv"},i,p.button({className:"select-input-button","aria-expanded":this.state.open,"aria-describedby":n,"aria-controls":this.state.listboxId,"aria-labelledby":this.props.ariaLabelId+" "+u.props.id,ref:"selectButton",tabIndex:0,onClick:this.handleClickOnInputButton},p.div({className:"select-input-input filter-item__filter-input",ref:"label"},u,p.div({className:"select-input-dropdown-arrow"},d(l,{group:"web",name:"arrow-down-gray",alt:""})))),d(c,{name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue(),options:function(e){return function(){var n;return n=[],t.Children.forEach(e._getFilteredChildren(),function(e){return n.push(e.props.value)}),n}}(this)()}),p.div({className:"hidden-option-container"},p.div({id:this.state.listboxId,className:e(r),role:"listbox",onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,tabIndex:-1,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t,n;if(!this.props.isDisabled)return e.pageX===t&&e.pageY===n||(this.mouseInput=!0),t=e.pageX,n=e.pageY},_commonPrefixLen:function(e,t){var n;for(e=i.trim(e).toLowerCase(),t=i.trim(t).toLowerCase(),n=0;n<e.length&&n<t.length&&e.charAt(n)===t.charAt(n);)n++;return n},_keyboardSelect:function(e){var t,n,i,r,s;return s=o.sortedIndex(this.sortedOptions,{text:e.toLowerCase()},"text"),i=this.sortedOptions[Math.max(s-1,0)],t=this.sortedOptions[Math.min(s,this.sortedOptions.length-1)],r=this._commonPrefixLen(e,i.text),n=this._commonPrefixLen(e,t.text),r>=n?this.setState({keyboarsSelectPrefix:e,focused:i.value}):this.setState({keyboarsSelectPrefix:e,focused:t.value})},handleKeydown:function(e){var t,n,i;if(!this.props.isDisabled){switch(this.mouseInput=!1,e.keyCode){case r.TAB:return this.setState({open:!1,focused:null}),!0;case r.ENTER:case r.SPACE:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case r.ESC:this.state.open&&(i=this.getValue(),this.setValue(i),this.setState({open:!1}));break;case r.UP:this.state.open?this.setState({focused:this.prev(this.state.focused)}):this.setState({open:!0});break;case r.DOWN:this.state.open?this.setState({focused:this.next(this.state.focused)}):this.setState({open:!0});break;default:if(!this.state.open)return!0;o.contains(o.values(r),e.keyCode)||(t=String.fromCharCode(e.which),n=this.state.keyboarsSelectPrefix+t,this._keyboardSelect(n),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout(function(e){return function(){return e.setState({keyboarsSelectPrefix:""}),e._keyboardSelect_timeout=null}}(this),500))}return!1}},prev:function(e){var n,o;return n=null,o=null,t.Children.forEach(this._getFilteredChildren(),function(t){return function(t){return o||t.props.disabled||(o=t),t.props.value===e&&(n=o),t.props.disabled?void 0:o=t}}(this)),null!=n?n.props.value:void 0},next:function(e){var n,o,i;return n=null,o=null,t.Children.forEach(this._getFilteredChildren(),function(t){return function(t){return t.props.disabled?void 0:((null!=o?o.props.value:void 0)===e&&(n=t),o=t)}}(this)),null!=(i=n||o)?i.props.value:void 0},menuChildren:function(){var n,o;return o=this.getValue(),n=t.Children.map(this._getFilteredChildren(),function(n){return function(i){var r;return r=t.cloneElement(i,{onMouseEnter:function(){return n.mouseInput?n.setState({focused:i.props.value}):void 0},onClick:function(){return i.props.disabled?void 0:(n.setState({open:!1}),n.setValue(i.props.value))},className:e({"focused-option":null!=n.state.focused&&n.state.focused===i.props.value,"selected-option":o===i.props.value},i.props.className)})}}(this))},componentWillMount:function(){var e;return e=t.Children.map(this._getFilteredChildren(),function(e){return{value:e.props.value,text:u.getText(e).trim().toLowerCase()}}),this.sortedOptions=o.sortBy(e,"text")},componentDidMount:function(){return this.globalMenuCloser=function(e){return function(t){var o;return e.state.open&&(o=i(t.target).closest(".select-input"),!o.length||o[0]!==n.findDOMNode(e.refs.wrapperDiv))?e.setState({open:!1,focused:null}):void 0}}(this),i(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return i(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(e,t){var o,r,s,a,l;return r=i(n.findDOMNode(this.refs.dropdown)),s=i(n.findDOMNode(this.refs.selectButton)),this.state.open&&(o=r.find("[data-value='"+this.state.focused+"']"),r.attr("aria-activedescendant",o.attr("id"))),this.state.open&&this.state.focused&&(o=r.find("[data-value='"+this.state.focused+"']"),r.attr("aria-activedescendant",o.attr("id")),h(r,o)),l=t.open&&!this.state.open,a=!t.open&&this.state.open,a&&r.focus(),l?s.focus():void 0},selectedOption:function(){var e;return e=null,t.Children.forEach(this._getFilteredChildren(),function(t){return function(n){return e||(e=n),(null!=n?n.props.value:void 0)===t.getValue()?e=n:void 0}}(this)),e?t.cloneElement(e,{id:this.state.selectOptionId}):null},handleClickOnInputButton:function(e){return e.preventDefault(),this.toggle()},toggle:function(){return this.props.isDisabled?void 0:this.state.open?this.setState({open:!1,focused:null}):this.setState({open:!0,focused:this.getValue()})},getValue:function(){var e,t,n,o;return null!=(e=null!=(t=null!=(n=this.props.value)?n:null!=(o=this.props.valueLink)?o.value:void 0)?t:this.state.value)?e:this.props.defaultValue},setValue:function(e){var t,n;return n=this.getValue(),this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),n!==e&&"function"==typeof(t=this.props).onChange?t.onChange(n,e):void 0}}),{input:_,option:m}})}.call(this),function(){var e=[].slice,t={}.hasOwnProperty;define("modules/clean/react/selectable_list",["jquery","external/underscore","external/react","external/react-dom","external/immutable","external/keymaster","modules/clean/keycode","modules/clean/react/outside_event","modules/core/browser","modules/core/exception","modules/clean/react/helpers"],function(n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E,b,w,T,S,C,I,P;return E=u.addOutsideEventHandling,b=d.assert,P=p.shallowCompareStateAndProps,f="",g=i.PropTypes,y=s.Record({selected:new s.OrderedSet,anchor:null}),S=function(e,t){return null==e&&(e=[]),null==t&&(t=null),new y({selected:new s.OrderedSet(e),anchor:t||e[0]})},m="up",_="down",I=function(e){return c.mac&&e.metaKey||!c.mac&&e.ctrlKey},w=function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],function(){var e,n,i,r;for(r=[],n=0,i=t.length;i>n;n++)e=t[n],o.isFunction(e)&&r.push(e.apply(this,arguments));return r}},v={onMouseEnter:"handleMouseEnterRow",onMouseDown:"handleMouseDownInRow",onMouseUp:"handleMouseUpInRow",onToggleRowSelected:"handleToggleRowSelected",onFocus:"handleInitialTab"},h={onMouseDown:"handleMouseDownInCheckbox",onToggleRowSelected:"handleToggleRowSelected",onMouseEnter:"noop",onMouseUp:"noop"},C=function(){var e;return"INPUT"===(e=document.activeElement.tagName)||"TEXTAREA"===e||"SELECT"===e||"BUTTON"===e},T=function(e,a){var l,u;return u=null!=(l=(null!=a?a:{}).shouldComponentUpdate)?l:P,e=E(e,"mouseup","onMouseUp","onOutsideMouseUp"),i.createClass({displayName:"Selectable"+e.displayName,propTypes:{allItemIds:i.PropTypes.instanceOf(s.List),onSelectionChange:i.PropTypes.func,selection:i.PropTypes.instanceOf(y),defaultSelection:i.PropTypes.instanceOf(y),keyScope:i.PropTypes.string,linkedOutsideClasses:i.PropTypes.array,addTabbingClassWhenKeyboardNavigating:i.PropTypes.bool,isCheckboxes:i.PropTypes.bool},getDefaultProps:function(){return{onSelectionChange:o.noop,selection:null,defaultSelection:new y,keyScope:"SelectableList",linkedOutsideClasses:[],addTabbingClassWhenKeyboardNavigating:!0}},getInitialState:function(){return{selection:this.props.defaultSelection}},componentWillMount:function(){return this._focusedItem=null,this._handlerCache={},this._isFocused=!1,this._mostRecentMousedownTarget=null,this._isSelecting=!1},componentDidMount:function(){return this._setupKeyboardShortcuts(),this._focusItem(this._selection().anchor),n(r.findDOMNode(this)).on("focusin.SelectableList",this.getFocusHandler(!0)).on("focusout.SelectableList",this.getFocusHandler(!1))},shouldComponentUpdate:u,componentDidUpdate:function(e,t){var n,o;return(null!=(n=e.selection)?n.anchor:void 0)!==(null!=(o=this.props.selection)?o.anchor:void 0)&&this._selection().selected.size&&(this._focusedItem=this._selection().anchor),this._focusedItem?(this._focusItem(this._focusedItem),this._focusedItem=null):void 0},componentWillUnmount:function(){return this._handlerCache=null,f!==this.props.keyScope&&(key.clearScope(this.props.keyScope),key.setScope(f)),n(r.findDOMNode(this)).off(".SelectableList")},getFocusHandler:function(e){return function(t){return function(){return t._isFocused=e,!0}}(this)},_setupKeyboardShortcuts:function(){var e,t,n,o,i,s,a,l,u;return f=key.getScope(),f!==this.props.keyScope&&key.setScope(this.props.keyScope),s=function(e){return function(t){return e._isFocused&&"BUTTON"!==t.target.tagName}}(this),i=function(e){return function(t){return!document.activeElement||document.activeElement===document.body||r.findDOMNode(e).contains(t.target)&&"INPUT"!==t.target.nodeName}}(this),o=function(e,t){return function(n){return e(n)?(n.preventDefault(),t(n)):null}},u=function(e){return function(){return e._selectNeighboringItem({direction:m})}}(this),n=function(e){return function(){return e._extendSelectionRange({direction:m})}}(this),l=function(e){return function(){return e._selectNeighboringItem({direction:_})}}(this),t=function(e){return function(){return e._extendSelectionRange({direction:_})}}(this),a=function(e){return function(){return e._selectAllItems()}}(this),e=function(e){return function(){return e._deselectAllItems()}}(this),key("up",this.props.keyScope,o(i,u)),key("shift+up",this.props.keyScope,o(i,n)),key("down",this.props.keyScope,o(i,l)),key("shift+down",this.props.keyScope,o(i,t)),key("escape",this.props.keyScope,o(i,e)),c.mac?key("command+a",this.props.keyScope,o(s,a)):key("ctrl+a",this.props.keyScope,o(s,a))},_focusItem:function(e){var t;return t=this.refs[e],t?r.findDOMNode(t).focus():void 0},_itemIds:function(){var e;return this.props.allItemIds?this.props.allItemIds:(e=[],i.Children.forEach(this.props.children,function(t){var n;return(null!=t&&null!=(n=t.props)?n.selectableListId:void 0)?e.push(t.props.selectableListId):(null!=t?t.key:void 0)?e.push(t.key):void 0}),s.List(e))},_selection:function(){return this.props.selection?this.props.selection:this.state.selection},_updateState:function(e){return this.setState({isSelecting:!1}),s.is(this._selection(),e)?void 0:(this.props.selection||this.setState({selection:e}),this.props.onSelectionChange(e))},_selectAllItems:function(){return this.setSelectedItems({itemIds:this._itemIds().toArray()})},_deselectAllItems:function(){return this.setSelectedItems({itemIds:[]}),r.findDOMNode(this).contains(document.activeElement)?document.activeElement.blur():void 0},_toggleItemSelected:function(e){var t,n,o,i,r,s,a,l,u,c,d;if(o=e.itemId,d=this._selection(),d.selected.has(o)){for(d=d.update("selected",function(e){return function(t){return e.setState({isSelecting:!0}),t.delete(o)}}(this)),a=null,t=this._itemIds().indexOf(o),n=r=l=t+1,u=this._itemIds().count();u>=l?u>r:r>u;n=u>=l?++r:--r)if(i=this._itemIds().get(n),d.selected.has(i)){a=i;break}if(!a)for(n=s=c=t-1;0>=c?0>=s:s>=0;n=0>=c?++s:--s)if(i=this._itemIds().get(n),d.selected.has(i)){a=i;break}a||(a=this._itemIds().get(0)),d=d.set("anchor",a)}else d=d.update("selected",function(e){return function(t){return e.setState({isSelecting:!0}),t.add(o)}}(this)).set("anchor",o);return this._updateState(d)},_selectItemsInRangeTo:function(e){var t,n,o,i,r,s,a,l,u,c,d,p,h;return s=e.itemId,p=this._selection(),(t=null!=(c=p.anchor)?c:this._itemIds().get(0))?(n=this._itemIds().indexOf(t),u=this._itemIds().indexOf(s),d=this._rangeOfSelectedBlockSurrounding(t),h=d.startIndex,o=d.endIndex,a=function(){var e,t,n,s;for(n=this._itemIds().toArray(),s=[],r=e=0,t=n.length;t>e;r=++e)i=n[r],r>=h&&o>=r&&s.push(i);return s}.call(this),l=function(){var e,t,o,s;for(o=this._itemIds().toArray(),s=[],r=e=0,t=o.length;t>e;r=++e)i=o[r],(r>=u&&n>=r||r>=n&&u>=r)&&s.push(i);return s}.call(this),n>u&&l.reverse(),p=p.update("selected",function(e){return function(t){return e.setState({isSelecting:!0}),t.subtract(a).union(l)}}(this)),this._updateState(p)):void 0},_selectNeighboringItem:function(e){var t,o,i,r;return t=e.direction,i=this._itemIds().indexOf(this._selection().selected.last()),o=0,t===m?o=Math.max(0,i-1):t===_&&(o=Math.min(this._itemIds().count()-1,i+1)),r=this._itemIds().get(o),this._focusedItem=r,this.setSelectedItems({itemIds:[r]}),this.props.addTabbingClassWhenKeyboardNavigating?n(document.body).addClass("tabbing"):void 0},_extendSelectionRange:function(e){var t,o,i,r,s,a,l,u,c;return i=e.direction,u=s=this._selection(),(t=null!=(a=u.anchor)?a:this._itemIds().get(0))?(o=this._itemIds().indexOf(t),l=this._rangeOfSelectedBlockSurrounding(t),c=l.startIndex,r=l.endIndex,this.setState({isSelecting:!0}),i===m?o===r?c-1>=0&&(u=u.update("selected",function(e){return function(t){return t.add(e._itemIds().get(c-1))}}(this))):u=u.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(r))}}(this)):i===_&&(o===c||o!==r?r+1<this._itemIds().count()&&(u=u.update("selected",function(e){return function(t){return t.add(e._itemIds().get(r+1))}}(this))):u=u.update("selected",function(e){return function(t){return t.delete(e._itemIds().get(c))}}(this))),u!==s&&(this._focusedItem=u.selected.last(),this._updateState(u)),this.props.addTabbingClassWhenKeyboardNavigating?n(document.body).addClass("tabbing"):void 0):void 0},_rangeOfSelectedBlockSurrounding:function(e){var t,n,o,i;for(n=this._itemIds().indexOf(e);;)if(i=n,n-=1,0>n||!this._selection().selected.has(this._itemIds().get(n)))break;for(n=i;;){if(o=this._itemIds().get(n),null==o||!this._selection().selected.has(o))break;t=n,n+=1}return{startIndex:i,endIndex:t}},setSelectedItems:function(e){var t,n,o;return n=e.itemIds,this.setState({isSelecting:!0}),o=this._selection().set("selected",s.OrderedSet(n)),t=n.length>0?n[0]:this._itemIds().get(0),this._updateState(o.set("anchor",t))},handleMouseEnterRow:function(e,t){return this._isSelecting?this._selectItemsInRangeTo({itemId:e}):void 0},handleMouseDownInRow:function(e,t){return 2===t.button?void(this._selection().selected.has(e)||this.setSelectedItems({itemIds:[e]})):t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):I(t)?void this._toggleItemSelected({itemId:e}):(this._selection().selected.has(e)||(this.setSelectedItems({itemIds:[e]}),this._isSelecting=!0),this._mostRecentMousedownTarget=e)},handleMouseUpInRow:function(e,t,n){return e===this._mostRecentMousedownTarget&&this.setSelectedItems({itemIds:[e]}),this._isSelecting=!1},handleInitialTab:function(e){return this._itemIds().first()!==e||this._selection().selected.has(e)||this.state.isSelecting?void 0:this.setSelectedItems({itemIds:[e]})},handleToggleRowSelected:function(e,t){return this._toggleItemSelected({itemId:e})},handleOutsideMouseUp:function(e){var t;return this._isSelecting=!1,this._mostRecentMousedownTarget=null,t=r.findDOMNode(this),t.contains(e.target)||n(e.target).closest(this.props.linkedOutsideClasses.join()).length||this._mostRecentMousedownTarget?void 0:this._deselectAllItems()},handleMouseDownInCheckbox:function(e,t){return t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e})},noop:function(e,t){},render:function(){var n,r,s,a;return r=this._handlerCache,this._handlerCache={},n=i.Children.map(this.props.children,function(e){return function(n){var s,a,l,u,c,d,p,_,m;if(!(null!=n&&null!=(p=n.props)?p.selectableListId:void 0)&&!(null!=n?n.key:void 0))return n;d=null!=(_=null!=n&&null!=(m=n.props)?m.selectableListId:void 0)?_:n.key,u={},c=e.props.isCheckboxes?h:v;for(l in c)t.call(c,l)&&(a=c[l],b(!n.props[l],"SelectableList does not support children having seperate "+l+" listeners"),s=l+d,u[l]=r[s]||e[a].bind(e,d),e._handlerCache[s]=u[l]);return i.cloneElement(n,o.extend(u,{ref:d,isSelected:e._selection().selected.has(d)}))}}(this)),s=Object.keys(this.constructor.propTypes),a=o.extend({},o.omit(this.props,s),{selection:this._selection(),onOutsideMouseUp:this.props.isCheckboxes?o.noop():this.handleOutsideMouseUp}),i.createElement(e,a,n)}})},{createSelectableList:T,createSelection:S}})}.call(this),function(){define("modules/clean/react/share_download/actions",["external/react","external/rsvp","modules/clean/downloads","modules/clean/multiaccount_login","modules/clean/react/copy_to_dropbox/modal","modules/clean/react/modal","modules/clean/sharing/signup_modal_proxy","modules/clean/viewer","modules/constants/env","modules/constants/viewer","modules/core/browser","modules/core/exception","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v;return f=t.Promise,_=r.Modal,m=l.PUBSERVER,g=u.ROLE_ANONY,h=e.createFactory(i),new(v=function(){function e(){}return e.prototype.direct=function(e){var t;return t=function(){var t;return t=p.parse(e.url).updateQuery({dl:1}).toString(),n.get({url:t,expected_domain:m})},s.signupForDirectDownload().then(t)},e.prototype.toDropbox=function(e,t,n,i){var r,l,u;return null==i&&(i=null),r=null,u=null,n===g?(l=s.signup(),u=c.reload):l=new f(function(e){var t;return t=a.get_viewer(),t.is_user_signed_in(i)?e(i.id):o.show_modal({role:n,on_success:function(){return e(i.id)}})}),l.then(function(o){var i;return i=h({shareToken:e,fileOrFolder:t,userId:o,role:n,onDismiss:u}),_.showInstance(i)})},e}())})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/share_download/button",["external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/share_download/models","modules/clean/react/sprite","modules/clean/react/sprite_div","modules/clean/viewer","modules/constants/viewer","modules/core/i18n"],function(t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y,E,b,w,T;return c=o.BubbleMenu,d=o.BubbleMenuItem,v=i.ShareDownloadActionOption,m=l.ROLE_ANONY,f=l.ROLE_PERSONAL,g=l.ROLE_WORK,b=u._,T=n.DOM,w=n.createElement,d=n.createFactory(d),E=n.createFactory(s),h=n.createClass({displayName:"DownloadMainButton",propTypes:{className:n.PropTypes.string,isDisabled:n.PropTypes.bool,onClick:n.PropTypes.func},getDefaultProps:function(){return{isDisabled:!1}},render:function(){var e;return e=t([this.props.className,"button-secondary","download-button","control__button"]),T.button({id:"download-menu-button",className:e,disabled:this.props.isDisabled,onClick:this.props.onClick},this.props.children)}}),_=n.createClass({displayName:"DownloadSimpleButton",propTypes:{targetText:n.PropTypes.string.isRequired,option:n.PropTypes.instanceOf(v).isRequired},render:function(){var e;return e=function(e){return function(t){return t.preventDefault(),e.props.option.handler()}}(this),w(h,{onClick:e},this.props.targetText)}}),p=n.createClass({displayName:"DownloadDropdown",propTypes:{targetText:n.PropTypes.string.isRequired,options:n.PropTypes.arrayOf(n.PropTypes.instanceOf(v)).isRequired,isDisabled:n.PropTypes.bool,justifyRight:n.PropTypes.bool},getDefaultProps:function(){return{justifyRight:!0}},_renderMoreOptionsButton:function(){var e;return e=t({"button-secondary":!0,"c-split-btn":!0,"c-split-btn--right":!0,"c-split-btn--dropdown":!0,control__button:!0,disabled:this.props.isDisabled}),T.button({className:e},w(r,{group:"web",name:"control_menu",alt:b("More options")}))},render:function(){var e,n,o,i;return n=this.props.options[0],e=t({"c-split-btn":!0,"c-split-btn--left":!0,disabled:n.isDisabled}),i=t({"c-split-btn-container":!0,disabled:this.props.isDisabled,"c-title-bubble":this.props.isDisabled,"c-title-bubble--respect-line-break":this.props.isDisabled,"u-font-center":this.props.isDisabled}),T.div({className:i,"data-title":b("The owner turned off the option to download.")},w(h,{className:e,isDisabled:n.isDisabled,onClick:n.isDisabled?void 0:n.handler},this.props.targetText),w(c,{targetButton:this._renderMoreOptionsButton(),position:this.props.justifyRight?c.POSITIONS.BOTTOM_ALIGN_RIGHT:c.POSITIONS.BOTTOM,verticalDisplacement:4,disabled:this.props.isDisabled,items:function(){var e,t,n,i;for(n=this.props.options,i=[],e=0,t=n.length;t>e;e++)o=n[e],i.push(d({onClick:o.handler,disabled:o.isDisabled},E({group:"web",name:o.spriteName,text:o.text})));return i}.call(this)}))}}),y=n.createClass({displayName:"ShareDownloadButton",propTypes:{sharedLinkInfo:n.PropTypes.object.isRequired,shareToken:n.PropTypes.object.isRequired,sharePermissions:n.PropTypes.shape({canCopyToDropboxRoles:n.PropTypes.array.isRequired,canDownloadRoles:n.PropTypes.array.isRequired}),fileOrFolder:n.PropTypes.object.isRequired,justifyRight:n.PropTypes.bool},_getDetailOptions:function(){var t,n,o,i,r,s,l,u,c,d,p,h,_,f,g;if(d=this.props.sharePermissions,r=d.canDownloadRoles,i=d.canCopyToDropboxRoles,n=v.buildDirectOption,o=v.buildToDropboxOption,c=[],t=function(t,n){var r;return r=e.call(i,n)<0,c.push(o(h,s,g,t,n,r))},r.length>0&&c.push(n(this.props.sharedLinkInfo)),i.length>0){for(p=this.props,h=p.shareToken,s=p.fileOrFolder,g=a.get_viewer(),f=g.get_users(!0),l=0,u=f.length;u>l;l++)_=f[l],t(_,_.role);e.call(i,m)>=0&&t(null,m)}return c},_getTargetText:function(){return b(this.props.sharePermissions.canDownloadRoles.length>0?"Download":"Add to Dropbox")},render:function(){var e;return e=this._getDetailOptions(),0===e.length?w(p,{targetText:b("Download"),isDisabled:!0,options:[{isDisabled:!0}],justifyRight:this.props.justifyRight}):1===e.length?w(_,{targetText:this._getTargetText(),option:e[0]}):w(p,{targetText:this._getTargetText(),options:e,justifyRight:this.props.justifyRight})}})})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/share_download/models",["external/immutable","modules/clean/react/share_download/actions","modules/constants/viewer","modules/core/i18n"],function(t,n,o,i){var r,s,a,l,u,c,d;return r=o.ROLE_ANONY,s=o.ROLE_PERSONAL,a=o.ROLE_WORK,c=i._,d={},u=t.Record({text:void 0,handler:void 0,spriteName:void 0,isDisabled:void 0}),l=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.buildDirectOption=function(e){return new o({text:c("Direct download"),handler:function(){return n.direct(e)},spriteName:"download_arrow"})},o.buildToDropboxOption=function(e,t,i,r,l,u){var d,p;if(null==u&&(u=!1),i.is_paired)switch(l){case s:p=c("Save to personal Dropbox"),d="s_house";break;case a:p=c("Save to %(team_name)s Dropbox").format({team_name:i.team_name}),d="s_briefcase"}else p=c("Save to my Dropbox"),d="dropbox";return new o({text:p,handler:function(){return n.toDropbox(e,t,l,r)},spriteName:d,isDisabled:u})},o}(u),
d.ShareDownloadActionOption=l,d})}.call(this),function(){define("modules/clean/react/slider",["external/classnames","external/react","modules/clean/css"],function(e,t,n){var o,i,r,s,a,l;return l=n.require_css,a=t.DOM,o=t.createClass({displayName:"IndicatorGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string,currentSlideIndex:t.PropTypes.number.isRequired,slideCount:t.PropTypes.number.isRequired,onIndicatorClick:t.PropTypes.func},render:function(){var t;return a.ul({className:e("c-slider__indicator-group",this.props.className)},function(){t=[];for(var e=0,n=this.props.slideCount;n>=0?n>e:e>n;n>=0?e++:e--)t.push(e);return t}.apply(this).map(function(t){return function(n){return a.li({key:"indicator-"+n,className:e({"c-slider__indicator":!0,"is-active":n===t.props.currentSlideIndex}),onClick:function(){var e;return"function"==typeof(e=t.props).onIndicatorClick?e.onIndicatorClick(n):void 0}})}}(this)))}}),i=t.createClass({displayName:"NavButtonGroup",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},render:function(){return a.div({className:e("c-slider__nav-button-group",this.props.className)},this.props.children)}}),s=t.createClass({displayName:"Slides",mixins:[t.addons.PureRenderMixin],propTypes:{currentSlideIndex:t.PropTypes.number.isRequired,width:t.PropTypes.number.isRequired,height:t.PropTypes.number},getSlideCount:function(){return t.Children.count(this.props.children)},render:function(){var n;return a.div({className:"c-slider__window",style:{width:this.props.width+"px",height:null!=(n=this.props.height)?n:"auto"}},a.div({className:"c-slider__slides"},t.Children.map(this.props.children,function(t){return function(n,o){return a.div({className:e({"c-slider__slide":"c-slider__slide","is-active":t.props.currentSlideIndex===o}),style:{width:t.props.width+"px",transform:"translateX("+100*-t.props.currentSlideIndex+"%)"}},n)}}(this))))}}),r=t.createClass({displayName:"Slider",mixins:[t.addons.PureRenderMixin],propTypes:{className:t.PropTypes.string},componentWillMount:function(){return l("/static/css/components/slider-vflbeTc0k.css")},render:function(){return a.div({className:e("c-slider",this.props.className)},this.props.children)}}),{NavButtonGroup:i,Slider:r,IndicatorGroup:o,Slides:s}})}.call(this),function(){define("modules/clean/react/sprite_div",["external/classnames","external/react","modules/clean/react/sprite"],function(e,t,n){var o,i,r;return i=t.createElement,r=t.DOM.div,o=t.createClass({displayName:"SpriteDiv",propTypes:{group:t.PropTypes.string.isRequired,name:t.PropTypes.string.isRequired,text:t.PropTypes.string,alt:t.PropTypes.string,spritePosition:t.PropTypes.oneOf(["left","right"])},getDefaultProps:function(){return{alt:"",spritePosition:"left"}},render:function(){var t,o,s,a,l,u,c,d;switch(s=this.props.group,l=this.props.name,d=this.props.text,t=this.props.alt,c=e(["sprite-frame","small","icon-"+this.props.spritePosition]),u=r({className:c,key:0},i(n,{group:s,name:l,alt:t})),a=r({className:"sprite-text",key:1},d),this.props.spritePosition){case"left":o=[u,a];break;case"right":o=[a,u]}return r({className:"sprite-div"},o)}})})}.call(this),function(){define("modules/clean/react/teams/modals/limited_team_folder_settings_modal",["external/react","external/underscore","modules/core/i18n","modules/clean/analytics","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_upsell_modal_banner","modules/clean/sharing/folder_settings_modal","modules/constants/python"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p;return d=n._,c=o.TeamsWebActionsLogger,l=i.Modal,u=s.SharedFolderSettingsModal,p=e.createElement,{showWithProps:function(e){var n,o;return n={altAction:p(r,{upsellText:d("Want to access these settings as well as other admin controls? Upgrade to %(trademark_business)s.").format({trademark_business:a.TRADEMARK_BUSINESS}),upgradeButtonText:d("Upgrade now"),redirectQuery:{tk:"team_settings",_camp:"modal"},logEventName:"team_folder_settings_upsell"})},o=l.showInstance(p(u,t(e).extend(n))),c.log("team_folder_settings",null,null,null,!1,c.LOG_CATEGORY.TEAM_INFO),o}}})}.call(this),function(){define("modules/clean/react/teams/modals/limited_team_share_folder_modal",["external/react","modules/core/i18n","modules/clean/analytics","modules/clean/filepath","modules/clean/react/modal","modules/core/browser","modules/core/uri"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h;return c=t._,u=n.TeamsWebActionsLogger,l=i.Modal,h=e.DOM,p=e.createElement,d=function(e){return u.log(e,null,null,null,!1,u.LOG_CATEGORY.TEAM_INFO)},a=e.createClass({mixins:[e.addons.PureRenderMixin],displayName:"LimitedTeamShareFolderModal",propTypes:{fqPath:e.PropTypes.string.isRequired},_navigateToTeam:function(){return d("team_folder_share_invite"),r.redirect(s({path:"/team",query:{invite_members:"",tk:"team_folder_share_invite",_camp:"modal"}}))},render:function(){var e;return e=o.filename(this.props.fqPath),p(l,{title:c("Share %(folder_name)s").format({folder_name:e}),acceptButtonText:c("Invite"),onAccept:this._navigateToTeam,showButtonDivider:!0},h.div({},c("To share the %(folder_name)s with someone, invite them to join your team!").format({folder_name:e})))}}),{showModalInstance:function(e){var t;return t=l.showInstance(p(a,e)),d("team_folder_share"),t}}})}.call(this),function(){define("modules/clean/react/teams/modals/limited_team_upsell_modal_banner",["external/react","modules/core/browser","modules/core/uri","modules/clean/react/button","modules/clean/analytics"],function(e,t,n,o,i){var r,s,a,l,u,c;return a=o.button,s=i.TeamsWebActionsLogger,u=e.DOM,l=e.createElement,c=e.PropTypes,r=e.createClass({mixins:[e.addons.PureRenderMixin],propTypes:{upgradeButtonText:c.string.isRequired,upsellText:c.string.isRequired,logEventName:c.string,redirectUrl:c.string,redirectQuery:c.shape({tk:c.string,_camp:c.string})},displayName:"LimitedTeamUpsellModalBanner",_handleCTAClick:function(){return this.props.logEventName&&s.log(this.props.logEventName,{},null,null,!1,s.LOG_CATEGORY.UPGRADE),t.redirect(n({path:this.props.redirectUrl?this.props.redirectUrl:"/team/upgrade",query:this.props.redirectQuery}))},render:function(){return u.div({className:"modal-upsell-bar"},u.div({className:"modal-upsell-bar__message"},this.props.upsellText),u.div({className:"modal-upsell-bar__action"},l(a,{className:"modal-upsell-bar__cta-button",onClick:this._handleCTAClick},this.props.upgradeButtonText)))}})})}.call(this),function(){define("modules/clean/react/title_bar/base",["external/react","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/constants/env","modules/core/i18n"],function(e,t,n,o,i,r){var s,a,l,u,c,d,p,h,_,m;return m=o.static_url,a=i.WEBSERVER,l=r._,_=e.DOM,u=_.a,c=_.button,p=_.div,h=_.img,d=e.createElement,s=e.createClass({displayName:"TitleBarBase",propTypes:{title:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node,e.PropTypes.arrayOf(e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node]))]),controls:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node,e.PropTypes.arrayOf(e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.node]))]),customLogoUrl:e.PropTypes.string,canClose:e.PropTypes.bool,onClose:e.PropTypes.func},getDefaultProps:function(){return{canClose:!1}},_renderCornerIcon:function(){return this.props.canClose?this._renderClose():this._renderLogo()},_handleClose:function(){var e;"function"==typeof(e=this.props).onClose&&e.onClose()},_renderClose:function(){return c({className:"react-title-bar__close u-mar-horizontal-xxs",title:l("Close"),onClick:this._handleClose},d(n,{group:"web",name:"control_close",alt:l("Close")}))},_renderLogo:function(){var e,n;return n="title-bar-icon__img",e=this.props.customLogoUrl?h({alt:"Logo",src:this.props.customLogoUrl,className:n}):d(t,{alt:"Dropbox",src:m("/static/images/header/header_logo_shmodel-vflsZ7QsE.png"),srcHiRes:m("/static/images/header/header_logo_shmodel@2x-vflvJX68X.png"),className:n}),u({href:"//"+a+"?src=shmodel",className:"title-bar-icon u-mar-horizontal-xxs"},e)},render:function(){var t,n,o;return n=function(e){return e},o=e.Children.map(this.props.title,n),t=e.Children.map(this.props.controls,n),p({className:"react-title-bar"},p({className:"react-title-bar__title-wrap"},this._renderCornerIcon(),o?p({className:"react-title-bar__divider u-mar-vertical-xs"}):void 0,o),p({className:"react-title-bar__action-wrap"},t))}})})}.call(this),function(){define("modules/clean/react/title_bar/controls_container",["external/react"],function(e){var t,n;return n=e.DOM.div,t=e.createClass({displayName:"TitleBarControlsContainer",render:function(){return n({className:"react-title-bar__controls u-mar-right-xs"},this.props.children)}})})}.call(this),function(){define("modules/clean/react/title_bubble",["jquery","external/classnames","external/react","external/react-dom","external/underscore","modules/clean/react/css","modules/clean/react/overlay"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h,_;return l=s.PositionedOverlay,h=n.DOM,p=n.createElement,u={TOP:l.POSITIONS.TOP,BOTTOM:l.POSITIONS.BOTTOM,LEFT:l.POSITIONS.LEFT,RIGHT:l.POSITIONS.RIGHT,BOTTOM_ALIGN_RIGHT:l.POSITIONS.BOTTOM_ALIGN_RIGHT},_={},_[""+u.TOP]="top",_[""+u.BOTTOM]="bottom",_[""+u.LEFT]="left",_[""+u.RIGHT]="right",_[""+u.BOTTOM_ALIGN_RIGHT]="bottom-align-right",a=_,d=n.createClass({displayName:"TitleBubble",propTypes:{content:n.PropTypes.oneOfType([n.PropTypes.element,n.PropTypes.string]).isRequired,children:n.PropTypes.element.isRequired,position:n.PropTypes.oneOf(i.values(u)).isRequired,distanceFromTarget:n.PropTypes.number,isTargetPositionFixed:n.PropTypes.bool,onMouseEnter:n.PropTypes.func,shouldReadContents:n.PropTypes.bool,className:n.PropTypes.string},getDefaultProps:function(){return{distanceFromTarget:0,isTargetPositionFixed:!1,onMouseEnter:i.noop,shouldReadContents:!1,className:null}},getInitialState:function(){return{isVisible:!1,targetNode:null}},componentWillMount:function(){return this.titleBubbleId=i.uniqueId("react-title-bubble-")},componentDidMount:function(){var e;return this._getTargetNode(),e=function(e){return function(t){return e.setState({isVisible:t})}}(this),this._setVisibility=i.throttle(e,100)},componentDidUpdate:function(){return this.state.targetNode?void 0:this._getTargetNode()},_getTargetNode:function(){var t;return t=o.findDOMNode(this.refs.titleBubbleContainer).childNodes[0],"NOSCRIPT"!==t.tagName&&(this.setState({targetNode:t}),this.props.shouldReadContents)?e(t).attr("aria-describedby",this.titleBubbleId):void 0},_getPositionOffset:function(){var e;return e={horizontal:0,vertical:0},a[this.props.position].match(/^top/)?e.vertical=-this.props.distanceFromTarget:a[this.props.position].match(/^bottom/)?e.vertical=this.props.distanceFromTarget:a[this.props.position].match(/^left/)?e.horizontal=-this.props.distanceFromTarget:a[this.props.position].match(/^right/)&&(e.horizontal=this.props.distanceFromTarget),e},render:function(){var o;return o=t("react-title-bubble","react-title-bubble--"+a[this.props.position],this.props.className),h.div({ref:"titleBubbleContainer",className:"react-title-bubble__container",onClick:function(e){return function(){return e._setVisibility(!1)}}(this),onFocus:function(e){return function(){return e._setVisibility(!0)}}(this),onBlur:function(e){return function(){return e._setVisibility(!1)}}(this),onMouseEnter:function(e){return function(){return e.props.onMouseEnter(),e._setVisibility(!0)}}(this),onMouseLeave:function(t){return function(){return e(t.state.targetNode).is(":focus")||e(t.state.targetNode).children(":focus").length?void 0:t._setVisibility(!1)}}(this)},n.Children.only(this.props.children),this.state.isVisible?p(l,{className:"react-title-bubble--disable-pointer",targetNode:this.state.targetNode,isTargetPositionFixed:this.props.isTargetPositionFixed,position:this.props.position,positionOffset:this._getPositionOffset(),isContentFocusable:!1},h.div({id:this.titleBubbleId,className:o},this.props.content)):void 0)}}),c=r(d,["/static/css/components/title_bubble-vflPlqg7n.css"]),c.POSITIONS=u,c})}.call(this),function(){define("modules/clean/react/tooltip",["external/react","external/react-dom","external/underscore","jquery"],function(e,t,n,o){var i,r,s,a,l,u,c,d,p,h;return c={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},p=e.DOM,s="tooltip-holder",i=7,a=1e4,r="data-event-id",d=function(){var e,t;return e=s,t=o("#"+e),t.length||(t=o("<div />").attr({id:e,style:"z-index: "+a}).prependTo("body")),t[0]},u=e.createClass({displayName:"TooltipBubble",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(h in c)e.push(c[h]);return e}()),tooltip_target_ref:e.PropTypes.object,contents:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.string]),className:e.PropTypes.string,mouse_move_cb:e.PropTypes.func,mouse_out_cb:e.PropTypes.func},_getDimensionsOfElement:function(e){var t,n,o;return n=e.offset(),o=e.outerWidth(),t=e.outerHeight(),{left_x:n.left,right_x:n.left+o,top_y:n.top,bottom_y:n.top+t,width:o,height:t}},render:function(){var e,n,r,s,a;return n=this._getDimensionsOfElement(o(t.findDOMNode(this.props.tooltip_target_ref))),r=o(window),a=o(window).scrollTop(),s=o(window).scrollLeft(),e=function(){switch(this.props.position){case c.TOP:return{bottom:r.height()-n.top_y+i+a};case c.BOTTOM:return{top:n.bottom_y+i-a};case c.LEFT:return{right:r.width()-n.left_x+i+s};case c.RIGHT:return{left:n.right_x+i-s}}}.call(this),p.div({className:"tooltip-bubble "+(this.props.className||""),ref:"tooltip",style:e,onMouseMove:this.props.mouse_move_cb?this.props.mouse_move_cb:void 0,onMouseLeave:this.props.mouse_out_cb?this.props.mouse_out_cb:void 0},p.div({className:"tooltip-inner"},this.props.contents))},componentDidMount:function(){return this._centerAndShow()},componentDidUpdate:function(){return this._centerAndShow()},_centerAndShow:function(){var e,n,i,r,s,a,l,u,d;return e=o(t.findDOMNode(this.refs.tooltip)),l=this._getDimensionsOfElement(o(t.findDOMNode(this.props.tooltip_target_ref))),u=this._getDimensionsOfElement(e),a=o(window).scrollTop(),s=o(window).scrollLeft(),(i=this.props.position)===c.TOP||i===c.BOTTOM?(n=l.left_x+l.width/2-u.width/2-s,e.css("left",n+"px")):(r=this.props.position)!==c.LEFT&&r!==c.RIGHT||(d=l.top_y+l.height/2-u.height/2-a,e.css("top",d+"px")),e.show()}}),l=e.createClass({displayName:"Tooltip",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(h in c)e.push(c[h]);return e}()),tooltip_contents:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.string]),tooltip_classname:e.PropTypes.string,hide_delay:e.PropTypes.number,interaction_enabled:e.PropTypes.bool},render:function(){return p.div({className:"tooltip-target",onMouseMove:function(e){return function(t){return e._show(t)}}(this),onMouseLeave:this._on_mouse_leave(),id:this.state.tooltip_id,ref:"tooltipTarget"},this.props.children)},componentDidMount:function(){return o(document).bind("scroll."+this.state.event_id,function(e){return function(t){return e._hide(t)}}(this))},componentDidUpdate:function(){return this.state.visible?this._render_tooltip():void 0},componentWillUnmount:function(){var e;return o(document).unbind("scroll."+this.state.event_id),e=d(),t.unmountComponentAtNode(e)},_on_mouse_leave:function(e){return function(e){return function(t){return e.props.hide_delay>0?e._scheduleHide(e.props.hide_delay):e._hide(t)}}(this)},_render_tooltip:function(){var n,i;return i=d(),o("#"+s).css("position","fixed"),o("#"+s).css("left","0"),o("#"+s).css("right","0"),this.props.hide_delay>0&&o("#"+s).attr(r,this.state.event_id),this.props.position===c.TOP?(o("#"+s).css("top","auto"),o("#"+s).css("bottom","0")):(o("#"+s).css("top","0"),o("#"+s).css("bottom","auto")),n=e.createElement(u,{position:this.props.position,contents:this.props.tooltip_contents,tooltip_target_ref:this.refs.tooltipTarget,className:this.props.tooltip_classname,mouse_move_cb:this.props.interaction_enabled?this._clear_timeout:void 0,mouse_out_cb:this.props.interaction_enabled?this._on_mouse_leave():void 0}),t.unmountComponentAtNode(i),t.render(n,i)},_show:function(){return!this.state.visible||this._last_timeout?(this._render_tooltip(),this.setState({visible:!0}),this._clear_timeout()):void 0},_hide:function(){var e,n;if(this.state.visible)return n=d(),this._last_timeout?(e=o(n).attr(r),e===this.state.event_id&&(t.unmountComponentAtNode(n),null!=this._clear_timeout())):t.unmountComponentAtNode(n),this.setState({visible:!1})},_scheduleHide:function(e){return this.state.visible?this._last_timeout=setTimeout(this._hide,e):void 0},_clear_timeout:function(){return this._last_timeout?(clearTimeout(this._last_timeout),this._last_timeout=null):void 0},getInitialState:function(){return{visible:!1,event_id:n.uniqueId()}},getDefaultProps:function(){return{interaction_enabled:!1,hide_delay:0}}}),{Tooltip:l,TooltipPosition:c}})}.call(this),function(){define("modules/clean/react/tree_view",["jquery","external/immutable","external/underscore","external/classnames","external/react","external/react-dom","modules/clean/ajax","modules/clean/em_string","modules/clean/filepath","modules/clean/react/css","modules/clean/react/browse/store","modules/clean/react/image","modules/clean/react/sprite","modules/clean/viewer","modules/core/i18n","modules/core/notify","modules/clean/keycode"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f){var g,v,y,E,b,w,T,S,C,I,P,A,N,R,k;return k=l.filename,g=c.BrowseStore,A=_._,R=i.DOM,N=i.createElement,E=20,y=15,b={None:"None",TreeItem:"TreeItem",HeaderItem:"HeaderItem",StaticHeader:"StaticHeader"},C=t.Record({key:void 0,label:"",icon:null,disabled:!1,canExpand:!1,forceExpanded:!1}),w=t.Record({childItemsByParentKey:t.Map(),parentItemByChildKey:t.Map(),items:t.Map(),rootItem:new C}),w.createWithRootItem=function(e){return new w({rootItem:e,items:t.Map([[e.key,e]])})},w.prototype.getParentItem=function(e){var t;if(e)return t=this.parentItemByChildKey.get(e.key),t?this.items.get(t):null},w.prototype.getChildItems=function(e){return this.childItemsByParentKey.get(e.key)||null},w.prototype.isParent=function(e){return this.childItemsByParentKey.has(e.key)},w.prototype.setChildItems=function(e,n){return this.withMutations(function(o){var i;return n=t.List(n),i=t.Map(n.map(function(e){return[e.key,e]})),o.set("items",o.items.merge(i)),o.set("childItemsByParentKey",o.childItemsByParentKey.set(e.key,n)),n.forEach(function(t){return o.set("parentItemByChildKey",o.parentItemByChildKey.set(t.key,e.key))})})},T=i.createClass({displayName:"TreeGroupView",propTypes:{ariaLabel:i.PropTypes.string},render:function(){return R.ul({className:"tree-view__group",role:"group"},this.props.children)}}),I=i.createClass({displayName:"TreeItemView",propTypes:{item:i.PropTypes.instanceOf(C).isRequired,id:i.PropTypes.string.isRequired,isSelected:i.PropTypes.bool,isExpanded:i.PropTypes.bool,canExpand:i.PropTypes.bool,level:i.PropTypes.number,onClick:i.PropTypes.func,onExpandButtonClick:i.PropTypes.func,showAsHeader:i.PropTypes.bool},getDefaultProps:function(){return{isSelected:!1,isExpanded:!1,canExpand:!1,level:0,onClick:n.noop,onExpandButtonClick:n.noop,showAsHeader:!1}},handleClick:function(e){var t;return e.preventDefault(),e.stopPropagation(),this.props.item.disabled||(null!=(t=r.findDOMNode(this.refs.expandButton))?t.contains(e.target):0)?void 0:this.props.onClick(this.props.item)},handleExpandClick:function(e){return e.preventDefault(),this.props.item.disabled?void 0:this.props.onExpandButtonClick(this.props.item,!this.props.isExpanded)},_renderExpandButton:function(){return R.div({className:"tree-view__expand-button",onClick:this.handleExpandClick,ref:"expandButton",role:"button"},N(p,{group:"web",name:this.props.isExpanded?"bullet_minus":"bullet_plus",alt:A(this.props.isExpanded?"Collapse":"Expand")}))},_renderIcon:function(){return R.div({className:"tree-view__icon-wrapper"},N(p,{className:"tree-view__item-icon",group:"web",name:this.props.item.icon,alt:""}))},render:function(){var e,t,n;return t=!this.props.canExpand,e=o({"tree-view__item":!0,"tree-view__item--leaf":t,"tree-view__item--disabled":this.props.item.disabled}),n={key:this.props.item.key,id:this.props.id,className:e,onClick:this.handleClick,role:"treeitem","aria-disabled":this.props.item.disabled,"aria-label":this.props.item.label,"aria-level":this.props.level+1},this.props.canExpand&&!this.props.showAsHeader&&(n["aria-expanded"]=this.props.isExpanded),this.props.isSelected&&(n["aria-selected"]=!0),R.li(n,R.span({className:"tree-view__item-row",style:{paddingLeft:this.props.showAsHeader?0:this.props.level*y}},this.props.showAsHeader||t?void 0:this._renderExpandButton(),this.props.item.icon?this._renderIcon():void 0,this.props.item.label?R.span({className:"tree-view__item-label"},a.em_snippet(this.props.item.label,E)):void 0),this.props.children)}}),S=i.createClass({displayName:"TreeHeaderView",propTypes:{item:i.PropTypes.instanceOf(C).isRequired,id:i.PropTypes.string.isRequired},_renderIcon:function(){return this.props.item.icon?N(p,{className:"tree-view__header-icon",group:"web",name:this.props.item.icon,alt:""}):null},render:function(){return R.div({className:"tree-view__item-row"},this._renderIcon(),R.h3({className:"tree-view__header",id:this.props.id},this.props.item.label))}}),P=i.createClass({displayName:"TreeView",propTypes:{tree:i.PropTypes.instanceOf(w).isRequired,rootStyle:i.PropTypes.oneOf(n.keys(b)),onItemSelected:i.PropTypes.func,onItemExpanded:i.PropTypes.func},getDefaultProps:function(){return{rootStyle:b.None,treeItemView:I,onItemSelected:function(){},onItemExpanded:function(){}}},getInitialState:function(){return{selectedItemKey:null,expandedItemKeys:t.Set([this.props.tree.rootItem.key]),showFocused:!1}},componentDidMount:function(){return e(r.findDOMNode(this)).on("keydown",this.handleKeyDown)},componentWillUnmount:function(){return e(r.findDOMNode(this)).off("keydown")},componentDidUpdate:function(t,n){var o,i;return this.state.selectedItemKey&&this.state.selectedItemKey!==n.selectedItemKey&&(o=e(r.findDOMNode(this)),i=o.find('[aria-selected="true"]').eq(0),i.length)?this._scrollElementIntoViewIfNeeded(i,o):void 0},_scrollElementIntoViewIfNeeded:function(e,t){var n,o,i,r,s,a,l;return i=t.scrollTop(),s=i+e.position().top,l=s-i,0>l?void t.scrollTop(s):(n=t.innerHeight(),o=i+n,r=e.innerHeight(),a=s+r,a>o?t.scrollTop(s-n+r):void 0)},_hasSelectableRootItem:function(){var e;return e=this.props.rootStyle,e===b.TreeItem||e===b.HeaderItem},_getHTMLIdPrefix:function(){return this._HTMLIdPrefix||(this._HTMLIdPrefix="tree-view-"+Math.floor(16777215*Math.random()).toString(16))},selectItem:function(e){return this.setState({selectedItemKey:null!=e?e.key:void 0}),this.props.onItemSelected(e)},_getLastLeafOf:function(e){var t;return t=this.props.tree.getChildItems(e),this.state.expandedItemKeys.contains(e.key)&&t.size>0?this._getLastLeafOf(t.last()):e},_getPrevItem:function(e){var t,n,o,i;return(o=this.props.tree.getParentItem(e))?(i=this.props.tree.getChildItems(o),n=i.indexOf(e),n>0?this._getLastLeafOf(i.get(n-1)):0===n?(t=o===this.props.tree.rootItem,t&&!this._hasSelectableRootItem()?null:o):null):null},_getNextItem:function(e,t){var n,o,i,r,s,a;return null==t&&(t=!0),e?(i=this.state.expandedItemKeys.contains(e.key),n=i&&this.props.tree.isParent(e),t&&n?this.props.tree.getChildItems(e).first():(s=this.props.tree.getParentItem(e))?(a=this.props.tree.getChildItems(s),r=a.size-1,o=a.indexOf(e),o===r?this._getNextItem(s,!1):o>=0&&r>o?a.get(o+1):null):null):null},advanceSelection:function(e){var t,n,o;return null==e&&(e=!1),this.state.selectedItemKey?(o=this.props.tree.items.get(this.state.selectedItemKey),n=e?this._getPrevItem(o):this._getNextItem(o),n?(this.selectItem(n),!0):void 0):(t=this._hasSelectableRootItem()?this.props.tree.rootItem:this.props.tree.getChildItems(this.props.tree.rootItem).first(),this.selectItem(t),!0)},_getValidHTMLIdForItem:function(e){return(""+this._getHTMLIdPrefix()+e.key).replace(/\s+/g,"_")},_setItemExpanded:function(e,t){return t?this.state.expandedItemKeys.add(e):this.state.expandedItemKeys.delete(e)},_canItemExpand:function(e){return e&&(e.canExpand||this.props.tree.isParent(e))},handleExpandButtonClick:function(e,t){return this.setState({expandedItemKeys:this._setItemExpanded(e.key,t)}),this.props.onItemExpanded(e,t)},handleKeyDown:function(e){var t;switch(e.which){case f.UP:if(this.advanceSelection(!0))return e.preventDefault();break;case f.DOWN:if(this.advanceSelection(!1))return e.preventDefault();break;case f.RIGHT:if(t=this.props.tree.items.get(this.state.selectedItemKey),this._canItemExpand(t))return this.handleExpandButtonClick(t,!0),e.preventDefault();break;case f.LEFT:if(t=this.props.tree.items.get(this.state.selectedItemKey),this._canItemExpand(t))return this.handleExpandButtonClick(t,!1),e.preventDefault()}},_renderSingleItem:function(e,t,o,i){var r,s;return null==o&&(o=null),null==i&&(i={}),r={id:this._getValidHTMLIdForItem(e),key:e.key,item:e,isSelected:this.state.selectedItemKey===e.key,isExpanded:this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,canExpand:this._canItemExpand(e)&&!e.forceExpanded,level:t,onClick:this.selectItem,onExpandButtonClick:this.handleExpandButtonClick},s=n.extend({},r,i),N(this.props.treeItemView,s,o)},_renderItemAndDescendants:function(e,t){var n,o;return o=this.state.expandedItemKeys.contains(e.key)||e.forceExpanded,this.props.tree.isParent(e)&&o&&(n=this._renderChildrenOfItemAsGroup(e,t+1)),this._renderSingleItem(e,t,n)},_renderChildrenOfItemAsGroup:function(e,t){var n;return e&&this.props.tree.isParent(e)?(n=this.props.tree.getChildItems(e).map(function(e){return function(n){return e._renderItemAndDescendants(n,t)}}(this)),N(T,null,n.toJS())):null},render:function(){var e,t,n,i,r;if(t={role:"tree",tabIndex:0,onFocus:function(e){return function(){return e.setState({showFocused:!0})}}(this),onBlur:function(e){return function(){return e.setState({showFocused:!1})}}(this),className:o("tree-view","ax-focusable",{"is-focused":this.state.showFocused})},n=this.props.tree.rootItem,this.state.selectedItemKey&&(i=this.props.tree.items.get(this.state.selectedItemKey),t["aria-activedescendant"]=this._getValidHTMLIdForItem(i)),this.props.rootStyle===b.TreeItem)r=N(T,null,this._renderItemAndDescendants(n,0));else if(this.props.rootStyle===b.HeaderItem)e=this._getValidHTMLIdForItem(n),r=N(T,null,this._renderSingleItem(n,0,null,{showAsHeader:!0,id:e}),this._renderChildrenOfItemAsGroup(n,0));else if(this.props.rootStyle===b.StaticHeader)e=this._getValidHTMLIdForItem(n),r=N(T,null,N(S,{item:n,id:e}),this._renderChildrenOfItemAsGroup(n,0));else{if(this.props.rootStyle!==b.None)throw new Error("Unknown root style: "+this.props.rootStyle);r=this._renderChildrenOfItemAsGroup(this.props.tree.rootItem,0)}return e&&(t["aria-labelledby"]=e),R.div(t,r,this.props.children)}}),P=u(P,["/static/css/react/tree_view-vflYm8QKP.css","/static/css/accessibility-vflRPMGHg.css"]),v=i.createClass({displayName:"FolderTreeView",propTypes:{user:i.PropTypes.object.isRequired,rootPath:i.PropTypes.string,onFolderSelected:i.PropTypes.func,showReadOnly:i.PropTypes.bool,isRootSelectable:i.PropTypes.bool,treeRootName:i.PropTypes.string},getDefaultProps:function(){return{rootPath:"/",showReadOnly:!0,onFolderSelected:function(){},isRootSelectable:!1,treeRootName:null}},getInitialState:function(){return{showLoadingScreen:!1,tree:null}},componentWillMount:function(){var e;return this.state.tree?void 0:(e=this._constructRootItem(),this.setState({tree:w.createWithRootItem(e)}))},componentDidMount:function(){return this._isMounted=!0,this.asyncFetchSubFoldersForItem(this.state.tree.rootItem)},componentWillUnmount:function(){return this._isMounted=!1,this._pendingAjaxRequest?(this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=null):void 0},_constructRootItem:function(){var e,t;return t=this.props.treeRootName||h.get_role_title(this.props.user)||A("Dropbox"),e=h.get_viewer().is_paired?this.props.user.is_team?"s_briefcase":"s_house":"dropbox",new C({key:this.props.rootPath,icon:e,label:t})},_parseFolderList:function(e,n){var o,i,r,s,a,l;for(null==n&&(n=!1),a=JSON.parse(e),l=[],i=0,s=a.length;s>i;i++)o=a[i],o.read_only&&n||(r=o.path,l.push(new C({key:r,label:k(o.path),canExpand:o.has_subdirs,icon:o.icon,disabled:o.read_only})));return t.List(l)},asyncFetchSubFoldersForItem:function(e){var t,n,o,i,r;return i=e.key,o=e===this.state.tree.rootItem,o&&this.setState({showLoadingScreen:!0}),t=g.context(),t.isNonUserRelativeContext?(r="/browse_util/tree_view_team_folder_contents",n={ns_id:t.rootNSID,ns_path:i}):(r="/browse_util/tree_view_folders",n={folder:i}),this._pendingAjaxRequest&&this._pendingAjaxRequest.abort(),this._pendingAjaxRequest=s.WebRequestOref({url:r,type:"POST",subject_user:this.props.user.id,data:n,success:function(t){return function(n){var o,i,r;return r=!t.props.showReadOnly,o=t._parseFolderList(n,r),i=t.state.tree.setChildItems(e,o),t.setState({tree:i})}}(this),error:function(){return m.error(A("An error occurred while trying to load your folder."))},complete:function(e){return function(){return e._pendingAjaxRequest=null,e._isMounted&&o?e.setState({showLoadingScreen:!1}):void 0}}(this)})},handleItemSelected:function(e){return this.props.onFolderSelected(e.key)},handleExpandButtonClick:function(e,t){return t&&!this.state.tree.isParent(e)?this.asyncFetchSubFoldersForItem(e):void 0},_renderLoadingMessage:function(){return R.span({className:"tree-view__loading-label"},A("Loading your folders…"))},render:function(){var e;return e=this.props.isRootSelectable?b.HeaderItem:b.StaticHeader,N(P,{tree:this.state.tree,rootStyle:e,onItemSelected:this.handleItemSelected,onItemExpanded:this.handleExpandButtonClick},this.state.showLoadingScreen?this._renderLoadingMessage():void 0)}}),{INDENT_SIZE_PX:y,MAX_LABEL_LENGTH:E,RootStyle:b,FolderTreeView:v,TreeView:P,TreeItemView:I,TreeItem:C,Tree:w}})}.call(this),function(){define("modules/clean/react/user_notifications/actions",["external/underscore","modules/clean/browse_interface","modules/clean/loggers/notification_logger","modules/clean/notserver","modules/clean/react/user_notifications/api","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/clean/referrer_cleansing_redirect","modules/clean/sharing/api/client","modules/clean/sharing/notifications","modules/clean/viewer","modules/constants/notifications","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f){var g,v,y,E,b,w;return E=n.NotificationLogger,y=o.NotClients,g=r.ActionTypes,v=a.BluenoteAction,w=_._,new(b=function(){function n(){}return n.prototype.load=function(){return s.dispatch({type:g.LOAD_REQUEST}),i.getAll(l.getCursor(),this._activeUserOnlyMode).then(function(e){var t;return t=[],t=t.concat(e.notifications),E.logReceive(t),s.dispatch({type:g.LOAD_SUCCESS,data:e}),e},function(){return s.dispatch({type:g.LOAD_FAILURE})})},n.prototype.loadOnceAndWatch=function(e){return this._hasLoadedOnce?void 0:(this._hasLoadedOnce=!0,this._activeUserOnlyMode=e,this.load(),this._watch())},n.prototype._acknowledgeAll=function(){return 0!==l.getUnacknowledgedCount()?(s.dispatch({type:g.ACKNOWLEDGEMENT_REQUEST}),i.ackAll(this._activeUserOnlyMode).then(function(e){return s.dispatch({type:g.ACKNOWLEDGEMENT_SUCCESS,data:{notifications:e}})},function(){return s.dispatch({type:g.ACKNOWLEDGEMENT_FAILURE})})):void 0},n.prototype._acknowledge=function(e){return i.ack(e)},n.prototype._markAllAsSeen=function(){var e;return e=l.getUnseen(),0!==e.length?(i.markAsSeen(e),s.dispatch({type:g.MARK_AS_SEEN_REQUEST})):void 0},n.prototype.resetAcknowledgements=function(){return s.dispatch({type:g.RESET_ACKNOWLEDGEMENTS})},n.prototype._watch=function(){return e.each(y,function(e){return function(t,n){var o,i,r;return o="undefined"!=typeof ensemble&&null!==ensemble&&null!=(r=ensemble.viewer)?r.getActiveUser():void 0,e._activeUserOnlyMode&&(null!=o?o.userId:void 0)!==parseInt(n)?void 0:i=t.subscribe_user({name:"UserNotificationsActions",
handler:function(){return e.load().then(function(e){return t.handler_success(i,{nid:e.cursor[n]})},function(){return t.handler_failure(i)})}})}}(this))},n.prototype.viewNotifications=function(){return h.ACK_WEB_NOTIFICATIONS_ON_CLICK?this._markAllAsSeen():this._acknowledgeAll()},n.prototype._maybeAckNotification=function(e){return h.ACK_WEB_NOTIFICATIONS_ON_CLICK&&e.isUnread?this._acknowledge(e):void 0},n.prototype.triggerGenericLegacyNotificationAction=function(e){return this._maybeAckNotification(e)},n.prototype.dismissLegacySharingNotification=function(e,t){return this._maybeAckNotification(e),d.register_dismiss(t)},n.prototype.mountFromLegacySharingNotification=function(e,t){return this._maybeAckNotification(e),d.register_mount(t)},n.prototype.upgradeToMountFromLegacySharingNotification=function(e){return this._maybeAckNotification(e),d.upgrade_to_mount()},n.prototype.triggerBluenoteAction=function(e,t){return this._maybeAckNotification(e),t.actionType===v.BLUENOTE_ACTION_TYPES.OPEN_URL?this._performBluenoteOpenUrlAction(t.params):t.actionType===v.BLUENOTE_ACTION_TYPES.MOUNT_SHARED_FOLDER?this._performBluenoteMountSharedFolder(e,t.params):void 0},n.prototype._performBluenoteOpenUrlAction=function(e){return u.redirect(e.urlPath)},n.prototype._performBluenoteMountSharedFolder=function(e,n){var o,i;return i=p.get_viewer().get_user_by_id(e.userId),o=new c.FolderShareApiClient({userId:i.id}),m.info(w("Adding shared folder ...")),o.mount({contentId:n.nsId,origin:"NOTIFICATION_WEB"}).then(function(e){var n;return n=f({path:t.get_browse_root(i)+e.path_lower}).toString(),u.redirect(n),m.clear(),m.success(w("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))},function(e){var t,n;return m.clear(),"insufficient_quota"===(null!=e&&null!=(t=e.error)?t[".tag"]:void 0)?(m.info(w("Continue upgrading to add the shared folder to your Dropbox.")),n=f({path:"/pro/buy"}),n.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),u.redirect(n.toString())):null!=(null!=e?e.message:void 0)?m.error(e.message):m.error(w("Failed to add the shared folder."))})},n}())})}.call(this),function(){define("modules/clean/react/user_notifications/api",["modules/clean/ajax","modules/clean/react/user_notifications/models"],function(e,t){var n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v;return n=t.BluenoteAction,o=t.BluenoteAvatarIcon,i=t.BluenoteData,r=t.BluenoteGenericIcon,s=t.BluenoteMountFolderActionParams,a=t.BluenoteOpenUrlActionParams,u=t.SharedFolderInviteData,c=t.UserNotification,m={},l=100,v=function(e){return new c({id:e.nid,userId:e.user_id,typeId:e.type_id,typeData:g(e),targetObjectKey:e.target_object_key,status:e.status,seenState:e.seen_state,feedTimeInSec:e.feed_time,rawDropdownRowHtml:e.notification_div,roleLabel:e.role_label})},g=function(e){switch(e.type_id){case c.TYPES.SHARED_FOLDER_INVITE:return f(e);case c.TYPES.BLUENOTE:return h(e)}},f=function(e){return new u({overQuotaStatus:e.sf_invite_overquota})},h=function(e){var t;return t=e.bluenote_payload,null!=t?new i({templateType:t.template_type,templateVersion:t.template_version,displayMessage:t.home_params.message,icon:_(t.image),surfaceAction:d(t.home_params.surface_action),buttonActions:t.home_params.button_actions.map(d)}):void 0},_=function(e){return null!=e?"avatar"===e.type?o({avatarInitials:e.avatar_initials,avatarUrl:e.avatar_url}):r({lowResIconUrl:e.system_url32,highResIconUrl:e.system_url64}):void 0},d=function(e){var t;return null!=e?(t=void 0,"open_url"===e.action_name?t=n.BLUENOTE_ACTION_TYPES.OPEN_URL:"mount_shared_folder"===e.action_name&&(t=n.BLUENOTE_ACTION_TYPES.MOUNT_SHARED_FOLDER),new n({buttonLabel:e.label,actionType:t,params:p(t,e.params)})):void 0},p=function(e,t){if(null!=t){if(e===n.BLUENOTE_ACTION_TYPES.OPEN_URL)return new a({urlPath:t.url_path});if(n.BLUENOTE_ACTION_TYPES.MOUNT_SHARED_FOLDER)return new s({nsId:t.ns_id})}},m.getAll=function(t,n){var o,i,r,s;return null==n&&(n=!1),o={count:l,template_version:3},null!=t&&(o.last_received_nid_by_user_id=JSON.stringify(t)),s=n?e.WebRequest({url:"/web/notifications/retrieve_user",data:o,subject_user:"undefined"!=typeof ensemble&&null!==ensemble&&null!=(i=ensemble.viewer)&&null!=(r=i.getActiveUser())?r.userId:void 0,dataType:"json"}):e.WebRequest({url:"/web/notifications/retrieve",data:o,dataType:"json"}),s.then(function(e){var t;return t=e.notifications.map(v),{cursor:e.latest_nid,notifications:t}})},m.ackAll=function(t){var n,o,i;return null==t&&(t=!1),i=t?e.WebRequest({url:"/web/notifications/ack_all_user",subject_user:"undefined"!=typeof ensemble&&null!==ensemble&&null!=(n=ensemble.viewer)&&null!=(o=n.getActiveUser())?o.userId:void 0,dataType:"json"}):e.WebRequest({url:"/web/notifications/ack_all",dataType:"json"}),i.then(function(e){var t;return t=e.map(v)})},m.ack=function(t){return e.SilentBackgroundRequest({url:"/web/notifications/ack",subject_user:t.userId,data:{nids:JSON.stringify([t.id])},dataType:"json"})},m.markAsSeen=function(t){var n,o,i,r,s;for(s={},o=0,i=t.length;i>o;o++)r=t[o],(s[r.userId]||(s[r.userId]=[])).push(r.id);return n={nids_by_user_id:JSON.stringify(s)},e.WebRequest({url:"/web/notifications/mark_seen",data:n,dataType:"json"})},m})}.call(this),function(){define("modules/clean/react/user_notifications/avatar_icon",["external/react","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/user_notifications/models"],function(e,t,n,o,i){var r,s,a;return a=n.VALID_AVATAR_DIMENSIONS,s=i.BluenoteAvatarIcon,r=e.createClass({displayName:"AvatarIcon",propTypes:{avatarIconRecord:e.PropTypes.instanceOf(s).isRequired,thumbStore:e.PropTypes.instanceOf(o).isRequired,className:e.PropTypes.string,size:e.PropTypes.oneOf(a)},componentDidMount:function(){return this._bindAvatarUrl(this.props)},componentWillUnmount:function(){return this._unbindAvatarUrl()},componentWillReceiveProps:function(e){var t,n;return t=this.props.avatarIconRecord,n=e.avatarIconRecord,t.avatarUrl!==n.avatarUrl?(this._unbindAvatarUrl(),this._bindAvatarUrl(e)):void 0},getInitialState:function(){var e,t;return e=void 0,t=this.props.avatarIconRecord,null!=t.avatarUrl&&(e=this.props.thumbStore.get_thumb(t.avatarUrl)),{avatarImage:e}},getDefaultProps:function(){return{size:32}},_bindAvatarUrl:function(e){var t;return t=e.avatarIconRecord,null!=t.avatarUrl?this._thumbRequestId=e.thumbStore.bind_url(t.avatarUrl,{onSuccess:function(n){return function(){var o;return o=e.thumbStore.get_thumb(t.avatarUrl),n.state.avatarImage!==o?n.setState({avatarImage:o}):void 0}}(this)}):void 0},_unbindAvatarUrl:function(){return this.props.thumbStore.unbind_url(this._thumbRequestId)},render:function(){var n;return n=this.props.avatarIconRecord,null!=this.state.avatarImage?e.createElement("img",{className:this.props.className,src:this.state.avatarImage,width:this.props.size,height:this.props.size}):e.createElement(t,{name:n.avatarInitials,dimension:this.props.size,initials:n.avatarInitials,shape:"CIRCLE",optionalClass:this.props.className})}})})}.call(this),function(){define("modules/clean/react/user_notifications/constants",function(){var e;return e={},e.ActionTypes={LOAD_REQUEST:"USER_NOTIFICATIONS_LOAD_REQUEST",LOAD_SUCCESS:"USER_NOTIFICATIONS_LOAD_SUCCESS",LOAD_FAILURE:"USER_NOTIFICATIONS_LOAD_FAILURE",ACKNOWLEDGEMENT_REQUEST:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_REQUEST",ACKNOWLEDGEMENT_SUCCESS:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_SUCCESS",ACKNOWLEDGEMENT_FAILURE:"USER_NOTIFICATIONS_ACKNOWLEDGEMENT_FAILURE",RESET_ACKNOWLEDGEMENTS:"USER_NOTIFICATIONS_RESET_ACKNOWLEDGEMENTS",MARK_AS_SEEN_REQUEST:"USER_NOTIFICATIONS_MARK_AS_SEEN_REQUEST"},e.EventTypes={RENDERED_NOTIFICATIONS:"USER_NOTIFICATIONS_RENDERED_NOTIFICATIONS"},e})}.call(this),function(){define("modules/clean/react/user_notifications/dispatcher",["modules/clean/flux/dispatcher"],function(e){return e})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown",["external/classnames","external/react","modules/clean/react/bubble_dropdown","modules/clean/react/css","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/dropdown_bell","modules/clean/react/user_notifications/dropdown_body","modules/clean/react/user_notifications/store","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f;return h=l._,u=t.createFactory(n),d=t.createFactory(r),p=t.createFactory(s),f=t.DOM,_=f.button,m=f.div,c=t.createClass({displayName:"UserNotificationsDropdown",propTypes:{isPagelet:t.PropTypes.bool,isMaestroDesign:t.PropTypes.bool},getDefaultProps:function(){return{isPagelet:!1,isMaestroDesign:!1}},getInitialState:function(){return this._getStateFromStore()},componentDidMount:function(){return i.loadOnceAndWatch(this.props.isPagelet),this._removeStoreListener=a.addListener(this._onUpdateFromStore)},componentWillUnmount:function(){return this._removeStoreListener()},_getStateFromStore:function(){return{actionableCount:a.getActionableCount()}},_onUpdateFromStore:function(){return this.setState(this._getStateFromStore())},render:function(){var t;return t=_({className:"header-nav-link sprite-button notification-button",title:h("Notifications menu")},d({actionableCount:this.state.actionableCount,isMaestroDesign:this.props.isMaestroDesign})),u({targetButton:t,arrow_position:"top-right",vertical_displacement:this.props.isMaestroDesign?-5:2,extra_css_class:e({"no-padding":!0,"notifications-dropdown":!0}),container_css_class:e({maestro:this.props.isMaestroDesign}),bubbleDropdownScrollable:!0},m({className:"notifications-header"},h("Notifications")),p({isMaestroDesign:this.props.isMaestroDesign}))}}),c=o(c,["/static/css/notifications-vflpPzyW2.css"])})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_bell",["external/classnames","external/react","modules/clean/components/scooter/badge","modules/clean/css","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i,r){var s,a,l,u,c,d,p,h,_;return s=n.CounterBadge,c=r._,_=r.ungettext,l=t.createFactory(i),p=t.DOM,h=p.span,d=p.div,a=500,u=t.createClass({displayName:"UserNotificationsDropdownBell",propTypes:{actionableCount:t.PropTypes.number.isRequired,isMaestroDesign:t.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},getInitialState:function(){var e;return e=this.props.actionableCount>0,e&&this._scheduleShakeReset(),{isShaking:e}},componentWillMount:function(){return o.require_css("/static/css/scooter/scooter-scoped-vflx8uhBs.css")},componentWillReceiveProps:function(e){var t;return t=e.actionableCount>0&&e.actionableCount!==this.props.actionableCount,t?(this.setState({isShaking:!0}),this._scheduleShakeReset()):void 0},_scheduleShakeReset:function(){return clearTimeout(this._shakeResetTimeout),this._shakeResetTimeout=setTimeout(function(e){return function(){return e.setState({isShaking:!1})}}(this),a)},render:function(){var n,o;return o=null,this.props.actionableCount>0&&(o=_("%(count)s new","%(count)s new",this.props.actionableCount,{comment:"new notification count"}).format({count:this.props.actionableCount})),n=e({web:!0,"notifications-bell":!0,shake:this.state.isShaking}),h({className:"notification-button-bell-container"},h({className:"ax-visually-hidden"},o),l({group:"web",name:"notifications_icon_blue",className:n,alt:c("Notifications")}),this.props.isMaestroDesign?this.props.actionableCount?d({className:"badge-red-dot"}):void 0:t.createElement(s,{count:this.props.actionableCount,position:s.POSITIONS.TOP_RIGHT}))}})})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_bluenote_row",["external/classnames","external/purify","external/react","modules/clean/avatar/initials_avatar_with_color","modules/clean/datetime","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/button","modules/clean/react/image","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/avatar_icon","modules/clean/react/user_notifications/generic_icon","modules/clean/static_urls"],function(e,t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E,b,w;return f=s.button,h=u.BluenoteAvatarIcon,_=u.UserNotification,w=p.static_url,E=n.DOM,v=E.div,b=E.span,y=E.img,g=n.createElement,m=n.createClass({displayName:"UserNotificationsDropdownBluenoteRow",propTypes:{notification:n.PropTypes.instanceOf(_).isRequired,thumbStore:n.PropTypes.instanceOf(r).isRequired,isMaestroDesign:n.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},_renderNotificationText:function(e){return v({className:"feed-text--button-wrapper"},n.DOM.button({className:"u-unbutton u-font-left feed-text__button",dangerouslySetInnerHTML:{__html:t.sanitize(e.typeData.displayMessage)}}))},_renderImage:function(e){var t,n;return n=e.typeData.icon,t="feed-image feed-image--bluenote",n instanceof h?g(c,{avatarIconRecord:n,thumbStore:this.props.thumbStore,className:t}):g(d,{genericIconRecord:n,className:t})},_feedTimeString:function(e){var t;return t=Date.now()-e,t>6048e5?i.nice_date_with_month_name(e,!1):i.ago(e)},_renderTimeAndRoleLabel:function(e){var t;return t=this._feedTimeString(e.feedTime),e.roleLabel&&!this.props.isMaestroDesign&&(t=t+" · "+e.roleLabel),b({className:"feed-time"},t)},_handleSurfaceAction:function(e){var t;return t=e.typeData.surfaceAction,null!=t?l.triggerBluenoteAction(e,t):void 0},_renderButton:function(e,t,n){return g(f,{className:"u-mar-right-xs u-mar-top-xs",importance:n>0?"tertiary":void 0,onClick:function(t){var o;return o=e.typeData.buttonActions[n],l.triggerBluenoteAction(e,o),t.stopPropagation()}},t)},_renderButtonActions:function(e){var t,n,o,i,r,s;for(n=[],s=e.typeData.buttonActions,i=o=0,r=s.length;r>o;i=++o)t=s[i],n.push(this._renderButton(e,t.buttonLabel,i));return n.length>0?b({className:"feed-action action-available"},n):void 0},render:function(){var t,n,o,i;return i=this.props.notification,t=i.typeData,o=e({"feed-row":!0,clickable:null!=t.surfaceAction,read:i.isRead}),n=v({onClick:this._handleSurfaceAction.bind(this,i),className:o},this._renderImage(i),this._renderNotificationText(i),this._renderTimeAndRoleLabel(i),this._renderButtonActions(i))}})})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_body",["external/react","external/react-dom","jquery","modules/clean/loggers/folder_invite_impression_logger","modules/clean/loggers/notification_logger","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/static_urls","modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dropdown_row","modules/clean/react/user_notifications/dropdown_bluenote_row","modules/clean/react/user_notifications/event_emitter","modules/clean/react/user_notifications/models","modules/clean/react/user_notifications/store","modules/core/i18n","require"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m){var f,g,v,y,E,b,w,T,S,C,I,P,A,N,R;return y=i.NotificationLogger,R=s.static_url,f=l.EventTypes,b=p.UserNotification,S=_._,N=R,A=e.DOM,I=A.div,P=A.img,g=10,v=10,E=10,w=e.createFactory(c),T=e.createClass({displayName:"UserNotificationsDropdownBody",propTypes:{isMaestroDesign:e.PropTypes.bool},getDefaultProps:function(){return{isMaestroDesign:!1}},componentWillMount:function(){return this._folderInviteImpressionLogger=new o,this._folderInviteImpressionLogger.listenTo(d)},componentDidMount:function(){return this._removeStoreListener=h.addListener(this._onUpdateFromStore),this._addEventHandlers(),this._setStateFromStore(),this._legacyRender(),a.viewNotifications()},shouldComponentUpdate:function(){return!1},componentWillUnmount:function(){return this._removeStoreListener(),this._folderInviteImpressionLogger.unlistenTo(d),a.resetAcknowledgements()},_onUpdateFromStore:function(){return this._setStateFromStore(),this._legacyRender()},_addEventHandlers:function(){var e;return e=n(t.findDOMNode(this)),e.scroll(this._onScroll),e.on("mousewheel",this._onMouseScroll),e.on("DOMMouseScroll",this._onMouseScroll)},_setStateFromStore:function(){var e;return e=h.getAll().sort(C),this._notifications=e.filter(function(e){return!e.isInvisible}),this._isLoading=h.isLoading()},_removeNotifications:function(){var e;return e=n(t.findDOMNode(this)),e.find("#event-feed").empty(),this._hasMore=this._notifications.length>0},_appendNotifications:function(e){var o,i,s,a,l;return null==e&&(e=v),m(["dropbox"]),o=n(t.findDOMNode(this)),s=o.find(".feed-row").size(),a=this._notifications.slice(s,s+e),y.logRender(a,s),l=new r,a.forEach(function(e){return function(n){var i,r,s,a,c;return s=h.isAcknowledged(n),n.rawDropdownRowHtml?(i=u.buildLegacyElement(n,s),r=i,o.find("#event-feed").append(r)):n.typeId===b.TYPES.BLUENOTE?(a=document.createElement("div"),c=a,o.find("#event-feed").append(c),t.render(w({notification:n,thumbStore:l,isMaestroDesign:e.props.isMaestroDesign}),c)):void 0}}(this)),i=s+a.length,this._hasMore=i<this._notifications.length,o.toggleClass("empty",0===i),d.emit(f.RENDERED_NOTIFICATIONS,{notifications:a})},_onScroll:function(){return this._hasMore&&this._scrollWithinOffsetToBottom(E)?this._appendNotifications():void 0},_onMouseScroll:function(e){var n,o,i;return i=e.originalEvent||e,n=i.detail?-40*i.detail:i.wheelDelta,o=t.findDOMNode(this),!this._hasMore&&0>=n&&this._scrollWithinOffsetToBottom(0)?e.preventDefault():n>=0&&0===o.scrollTop?e.preventDefault():void 0},_scrollWithinOffsetToBottom:function(e){var n,o;return n=t.findDOMNode(this),o=n.scrollHeight-n.scrollTop-n.offsetHeight,e>=o},_legacyRender:function(){return this._isLoading?void 0:(this._removeNotifications(),this._appendNotifications(g))},render:function(){return I({id:"event-feed-container",className:"show"},I({id:"event-feed"},I({id:"notification-loading"},P({src:N("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:S("Loading...")}))),I({id:"event-feed-empty"},P({src:N("/static/images/empty_notifications-vflQy8YVJ.png"),alt:""}),I({id:"event-feed-empty-text"},S("We’ll let you know when we’ve got something new for you!"))))}}),C=function(e,t){return t.feedTime-e.feedTime},T})}.call(this),function(){define("modules/clean/react/user_notifications/dropdown_row",["external/underscore","jquery","modules/clean/datetime","modules/clean/react/user_notifications/legacy_thumb_loader","modules/clean/react/user_notifications/actions","modules/clean/sprite"],function(e,t,n,o,i,r){var s,a,l;return l=new o,s=6048e5,a={buildLegacyElement:function(e,n){var o;return o=t(e.rawDropdownRowHtml),this._initImages(o),this._setTimeLabel(o,e.feedTime),this._addClientStateClasses(o,e,n),this._initActionHandlers(e,o),o},_initImages:function(e){return e.find("img").each(function(e){return function(n,o){var i;return i=t(o),i.attr("alt",""),e._loadImage(i)}}(this))},_setTimeLabel:function(e,t){var o,i;return o=e.find("#feed-time-label"),null!=o?(i=Date.now()-t,i>s?o.text(n.nice_date_with_month_name(t,!1)):o.text(n.ago(t))):void 0},_loadImage:function(t){var n;return(n=t.data("src"))?l.load(n).progress(function(){return t.data("src",null),t.data("loading-src",n)}).then(function(n){var o;return t.data("loading-src",null),o=function(){return t.addClass("thumbnail"),t.parent(".feed-thumbnail").addClass("has-frame")},0===n.indexOf("data:image")?o():(t.load(o),t.error(e.once(function(){var e;return e=t.data("fail-src")||r.SPACER,t.attr("src",e)}))),t.attr("src",n)}):void 0},_addClientStateClasses:function(e,t,n){var o;return o=e.hasClass("feed-row")?e:e.find(".feed-row"),t.isInvisible&&o.addClass("invisible"),t.isRead&&!n?o.addClass("read"):void 0},_initActionHandlers:function(e,t){return t.on("click",function(){return i.triggerGenericLegacyNotificationAction(e),!0}),t.on("click",".share-content-dismiss",function(){return i.dismissLegacySharingNotification(e,this),!1}),t.on("click",".share-content-mount",function(){return i.mountFromLegacySharingNotification(e,this),!1}),t.on("click",".share-content-upgrade-mount",function(){return i.upgradeToMountFromLegacySharingNotification(e),!1})}}})}.call(this),function(){define("modules/clean/react/user_notifications/event_emitter",["modules/clean/event_emitter"],function(e){var t;return new(t=e)})}.call(this),function(){define("modules/clean/react/user_notifications/generic_icon",["external/react","modules/clean/react/image","modules/clean/react/user_notifications/models","modules/clean/static_urls"],function(e,t,n,o){var i,r,s;return i=n.BluenoteGenericIcon,s=o.static_url,r=e.createClass({displayName:"GenericIcon",propTypes:{genericIconRecord:e.PropTypes.instanceOf(i),className:e.PropTypes.string},render:function(){var n,o,i;return o=this.props.genericIconRecord,i=null!=o?o.lowResIconUrl:void 0,n=null!=o?o.highResIconUrl:void 0,null!=i&&null!=n||(i=s("/static/images/icons32/system_notification_default_icon-vflY4Rt4U.png"),n=s("/static/images/icons64/system_notification_default_icon-vflc0pSwy.png")),e.createElement("div",{className:this.props.className},e.createElement(t,{src:i,srcHiRes:n}))}})})}.call(this),function(){define("modules/clean/react/user_notifications/legacy_thumb_loader",["external/underscore","jquery","modules/clean/photos/batch_thumb_loader"],function(e,t,n){var o,i,r;return r=16,i=24,o=function(){function o(){var t;this._cache={},t=new n({batch_size:r,max_parallel_request:i}),this._queueThumb=function(e,n,o){return t.queue_thumb(e,n,{onrequest:o})},this._flushQueue=e.debounce(function(){return t.flush()},0)}return o.prototype.load=function(e){var n;return this._cache[e]||(n=new t.Deferred,this._queueThumb(e,n.resolve,n.notify),this._flushQueue(),this._cache[e]=n.promise()),this._cache[e]},o}()})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/user_notifications/models",["external/immutable"],function(t){var n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E;return E={},h={UNREAD:0,READ:1,INVISIBLE:2},d={UNSEEN:1,SEEN:2},_={0:"unread",1:"read",2:"invisible"},g={SHARED_FOLDER_INVITE:100,BLUENOTE:2200},n={OPEN_URL:1,MOUNT_SHARED_FOLDER:2},y=t.Record({id:void 0,userId:void 0,typeId:void 0,typeData:void 0,targetObjectKey:void 0,status:void 0,feedTimeInSec:void 0,rawDropdownRowHtml:void 0,roleLabel:void 0,seenState:void 0}),v=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.SEEN_STATE=d,n.STATUSES=h,n.STATUS_STRINGS=_,n.TYPES=g,Object.defineProperties(n.prototype,{key:{get:function(){return this.userId+" "+this.typeId+" "+this.targetObjectKey}},isUnread:{get:function(){return this.status===h.UNREAD}},isRead:{get:function(){return this.status===h.READ}},isInvisible:{get:function(){return this.status===h.INVISIBLE}},isSeen:{get:function(){return null!=this.seenState?this.seenState===d.SEEN:!this.isUnread}},type:{get:function(){return this.typeId}},feedTime:{get:function(){return new Date(1e3*this.feedTimeInSec)}}}),n}(y),p={ALREADY_OVER:"overquota",WILL_BE_OVER:"will_be_overquota"},f=t.Record({overQuotaStatus:void 0}),m=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.OVER_QUOTA_STATUSES=p,n}(f),a=t.Record({templateType:void 0,templateVersion:void 0,displayMessage:void 0,icon:void 0,surfaceAction:void 0,buttonActions:void 0}),l=t.Record({lowResIconUrl:void 0,highResIconUrl:void 0}),s=t.Record({avatarInitials:void 0,avatarUrl:void 0}),r=t.Record({actionType:void 0,buttonLabel:void 0,params:void 0}),o=function(t){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,t),o.BLUENOTE_ACTION_TYPES=n,o}(r),i=t.Record({urlPath:void 0}),c=t.Record({urlPath:void 0}),u=t.Record({nsId:void 0}),E.UserNotification=v,E.SharedFolderInviteData=m,E.BluenoteData=a,E.BluenoteGenericIcon=l,E.BluenoteAvatarIcon=s,E.BluenoteAction=o,E.BluenoteActionParams=i,E.BluenoteOpenUrlActionParams=c,E.BluenoteMountFolderActionParams=u,E})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/react/user_notifications/store",["external/underscore","external/immutable","modules/clean/flux/flux_store","modules/clean/react/user_notifications/constants","modules/clean/react/user_notifications/dispatcher","modules/constants/notifications"],function(t,n,o,i,r,s){var a,l;return a=i.ActionTypes,new(l=function(o){function i(e){i.__super__.constructor.call(this,e),this._isLoading=!1,this._userNotifications=new n.List,this._acknowledgedNotificationKeys=new n.Set,this._additionalSeenNotificationKeys=new n.Set,this._cursor=null}return e(i,o),i.prototype.isLoading=function(){return this._isLoading},i.prototype.getActionableCount=function(){return s.ACK_WEB_NOTIFICATIONS_ON_CLICK?this._getUnseen().size:this._getUnacknowledged().size},i.prototype.getUnacknowledgedCount=function(){return this._getUnacknowledged().size},i.prototype.getCursor=function(){return this._cursor},i.prototype.getAll=function(){return this._userNotifications.toArray()},i.prototype.isAcknowledged=function(e){return this._acknowledgedNotificationKeys.has(e.key)},i.prototype._getUnacknowledged=function(){var e;return e=this._userNotifications.filter(function(e){return e.isUnread}),e.filter(function(e){return function(t){return!e.isAcknowledged(t)}}(this))},i.prototype.getUnseen=function(){return this._getUnseen().toArray()},i.prototype._getUnseen=function(){var e;return e=this._userNotifications.filter(function(e){return!e.isSeen}),e.filter(function(e){return function(t){return!e._additionalSeenNotificationKeys.has(t.key)}}(this))},i.prototype._onLoadRequest=function(){return this._isLoading?void 0:(this._isLoading=!0,this.__emitChange())},i.prototype._onLoadSuccess=function(e){var o,i,r,s,a;if(this._isLoading&&(this._isLoading=!1,this.__emitChange()),t.isEqual(e.cursor,this._cursor)||(this._cursor=e.cursor,this.__emitChange()),e.notifications.length>0){for(this._additionalSeenNotificationKeys=this._additionalSeenNotificationKeys.clear(),a=new n.OrderedMap,s=e.notifications.concat(this._userNotifications.toArray()),o=0,i=s.length;i>o;o++)r=s[o],a.has(r.key)||(a=a.set(r.key,r));return this._userNotifications=a.toList(),this.__emitChange()}},i.prototype._onLoadFailure=function(){return this._isLoading?(this._isLoading=!1,this.__emitChange()):void 0},i.prototype._onAcknowledgementRequest=function(){var e;return e=new n.Set(this._getUnacknowledged().map(function(e){return e.key})),this._acknowledgedNotificationKeys.equals(e)?void 0:(this._acknowledgedNotificationKeys=e,this.__emitChange())},i.prototype._onAcknowledgementSuccess=function(e){var t,o;return o=new n.Set(e),t=o.map(function(e){return e.key}),t.equals(this._acknowledgedNotificationKeys)?void 0:(this._acknowledgedNotificationKeys=t,this.__emitChange())},i.prototype._onResetAcknowledgements=function(){var e;return e=new n.Set,e.equals(this._acknowledgedNotificationKeys)?void 0:(this._acknowledgedNotificationKeys=e,this.__emitChange())},i.prototype._onMarkAsSeenRequest=function(){return this._additionalSeenNotificationKeys=new n.Set(this._getUnseen().map(function(e){return e.key})),this.__emitChange()},i.prototype.__onDispatch=function(e){switch(e.action.type){case a.LOAD_REQUEST:return this._onLoadRequest();case a.LOAD_SUCCESS:return this._onLoadSuccess(e.action.data);case a.LOAD_FAILURE:return this._onLoadFailure();case a.ACKNOWLEDGEMENT_REQUEST:return this._onAcknowledgementRequest();case a.ACKNOWLEDGEMENT_SUCCESS:return this._onAcknowledgementSuccess(e.action.data.notifications);case a.RESET_ACKNOWLEDGEMENTS:return this._onResetAcknowledgements();case a.MARK_AS_SEEN_REQUEST:return this._onMarkAsSeenRequest()}},i}(o))(r)})}.call(this),define("modules/clean/react_format",["require","exports","external/react","external/underscore","modules/core/exception","modules/clean/js_environment"],function(e,t,n,o,i,r){"use strict";function s(e,t){null==t&&(t={});for(var i=new RegExp(["%%","(%\\(([a-zA-Z0-9_]+)\\)s)","(<\\s*([a-zA-Z0-9_]+)\\s*\\/>)","(<\\s*([a-zA-Z0-9_]+)\\s*>)","(<\\s*\\/\\s*([a-zA-Z0-9_]+)\\s*>)"].join("|"),"g"),r=0,s=[{name:"root",components:[]}];;){var l=i.exec(e);if(!l)break;var u=s[s.length-1].components;if(u.push(e.slice(r,l.index)),"%%"===l[0])u.push("%");else if(l[1]){var c=t[l[2]];null==c?a('No substitution was given for the placeholder "'+l[2]+'".'):u.push(String(c))}else if(l[3]){var c=t[l[4]];null==c?a('No substitution was given for the self-closing tag "'+l[4]+'".'):n.isValidElement(c)?u.push(c):a('The substitution given for the self-closing tag "'+l[4]+'" was not a valid React element.')}else if(l[5]){var d=l[6];s.push({name:d,components:[]})}else if(l[7]){var d=l[8];if(s.length<=1)a('Trying to close a "'+d+'" tag, but there was no preceding open tag.');else{var p=s.pop(),h=p.name,_=p.components,m=_.filter(function(e){return""!==e});if(h!==d)a('Trying to close a "'+d+'" tag, but the matching open tag was a "'+h+'".');else if(null==t[d])a('No substitution was given for the tag "'+d+'".');else if(o.isFunction(t[d])){var f=t[d](m);n.isValidElement(f)?s[s.length-1].components.push(f):a('A thunk was passed as the substitution for the "'+d+'" tag, but the thunk did not resolve to a valid React element.')}else n.isValidElement(t[d])?n.cloneElement?s[s.length-1].components.push(n.cloneElement(t[d],{},m)):s[s.length-1].components.push(n.addons.cloneWithProps(t[d],{children:m})):a('The substitution given for the tag "'+d+'" was not a valid React element.')}}r=l.index+l[0].length}s.length>1&&a("Not all XML tags were closed properly! For standalone tags without a corresponding close tag, please use XML self-closing tag syntax. This string contains "+(s.length-1)+" unclosed tags.");var g=s[0].components;return g.push(e.slice(r,e.length)),g.filter(function(e){return""!==e})}function a(e){(r.isTest||u>l)&&(l++,i.raiseAndReport("reactFormat: "+e,{tags:["reactFormat"]}))}t.reactFormat=s;var l=0,u=20}),function(){define("modules/clean/referrer_cleansing_redirect",["external/sjcl","modules/constants/request","modules/core/browser","modules/core/cookies","modules/core/uri"],function(e,t,n,o,i){var r,s,a,l;return l=function(n){var i,r,s,a;return i=e.codec.utf8String.toBits(o.read(t.JS_CSRF_COOKIE)),a=e.codec.utf8String.toBits(n),r=new e.misc.hmac(i),s=r.encrypt(n),e.codec.base64.fromBits(s)},s=function(e){var t,n;return t=i.parse(e).scheme,t&&"http"!==t&&"https"!==t?"#":(n=new i({path:"/referrer_cleansing_redirect"}),n.setQuery({url:e,hmac:l(e)}),n)},a=function(e){return n.redirect(s(e))},r={get_redirect_uri:s,redirect:a}})}.call(this),function(){define("modules/clean/revisions/file_revisions_iterator",["jquery","modules/clean/ajax","modules/clean/react/browse/models"],function(e,t,n){var o,i,r,s,a;return o=n.File,s=50,i=function(){function e(e){this.file=e.file}return e}(),a=function(e){return new i({file:o.fromServerObject(e.preview_info)})},r=function(){function n(e,t,n){this.fqPath=e,this.userId=t,null==n&&(n={}),this.cursor=n.initialCursor||null,this.deserializer=n.deserializer||a}return n.prototype.next=function(n){var o,i;return null==n&&(n=s),i=new e.Deferred,o={path:this.fqPath,limit:n},this.cursor&&(o.cursor=this.cursor),t.WebRequest({url:"/file_revisions",type:"GET",subject_user:this.userId,data:o,success:function(e){return function(t){var n,r;return o=JSON.parse(t),e.cursor=o.cursor,r=function(){var e,t,i,r;for(i=o.revisions,r=[],e=0,t=i.length;t>e;e++)n=i[e],r.push(this.deserializer(n));return r}.call(e),i.resolve({revisions:r,hasMore:o.more})}}(this),error:function(e){return i.reject({errorText:e.error_text})}}),i.promise()},n}()})}.call(this),function(){define("modules/clean/search/search_helpers",["jquery","modules/clean/analytics","modules/clean/history"],function(e,t,n){var o,i;return o=t.SearchClientActivityLogger,i={buildSearchURL:function(e,t,o){var r;return r=i.queryParams(t,o),n.construct_url("/search/"+e.role,r)},queryParams:function(e,t){var n;return null==e&&(e=""),null==t&&(t=""),
n=e.toLowerCase().trim().replace(/\ +/g," "),{query:n,query_unnormalized:e,last_fq_path:t}},logSearchAction:function(e,t,n,i){var r;return null==i&&(i="full-view"),r={file_nsid:e.ns_id,file_sjid:e.sjid,firefly:!0,match_type:e.match_type,position:e.sort_rank,request_id:e.request_id,viewport:i,action_type:n},o.log("result_action",t.id,r)},highlightMatch:function(t,n){var o,i,r,s,a,l,u,c;if(!n)return e("<span />").text(t);for(r=0,a=0,i=e("<span />");r<t.length;)u=n[a],a>=n.length?(l=!1,s=r+t.length):u.pos>r?(l=!1,s=u.pos):(l=!0,s=u.pos+u.len),c=t.substring(r,s),o=e("<span/>").text(c),o.addClass(""),l&&(o.addClass("highlighted"),o.addClass("is-highlighted")),i.append(o),r=s,l&&a++;return i},highlightMatchWithEmoji:function(t,n){var o,i,r,s,a,l,u,c,d;if(!n)return e("<span />").text(t);for(i=e("<span />"),r=t,a=l=0,u=n.length;u>l;a=++l)s=n[a],c=r.indexOf(s.string),0>c||(i.append(e("<span/>").text(r.substring(0,c))),d=r.substring(c,c+s.string.length),o=e("<span/>").text(d),o.addClass("highlighted"),o.addClass("is-highlighted"),i.append(o),r=r.substring(c+s.string.length,r.length));return r&&i.append(e("<span/>").text(r)),i},highlightMatchString:function(e,t){var n;return n=/[\uD800-\uDBFF][\uDC00-\uDFFF]/,n.test(e)?this.highlightMatchWithEmoji(e,t)[0].innerHTML:this.highlightMatch(e,t)[0].innerHTML}}})}.call(this),function(){define("modules/clean/search/search_type",function(){var e;return e={COMPLETION:"completion",DELETED:"deleted",FULLTEXT:"full-text"}})}.call(this),function(){define("modules/clean/sharing/action_types",["modules/clean/flux/action_type"],function(e){var t,n;return n=e.withActionNamespace,t=n("share-modal-actions",{SHARE_MODAL_OPEN:"share-modal-open",SHARE_MODAL_CLOSE:"share-modal-close",RESET_MODAL_STATE:"reset-modal-state",OPEN_LINK_SETTINGS_MODAL:"open-link-settings-modal",OPEN_FOLDER_SETTINGS_MODAL:"open-folder-settings-modal",OPEN_SHARED_LINK_MODAL:"open-shared-link-modal",CLOSE_LINK_SETTINGS_MODAL:"close-link-settings-modal",CLOSE_FOLDER_SETTINGS_MODAL:"close-folder-settings-modal",CLOSE_SHARED_LINK_MODAL:"close-shared-link-modal",CLEAR_METADATA:"clear-metadata",FETCH_METADATA_REQUEST:"metadata-request",FETCH_METADATA_SUCCESS:"metadata-success",FETCH_METADATA_FAILURE:"metadata-failure",CLEAR_LINK_METADATA:"clear-link-metadata",FETCH_LINK_METADATA_REQUEST:"link-metadata-request",FETCH_LINK_METADATA_SUCCESS:"link-metadata-success",FETCH_LINK_METADATA_FAILURE:"link-metadata-failure",CLEAR_SHARING_PREFS:"clear-sharing-prefs",FETCH_SHARING_PREFS_REQUEST:"sharing-prefs-request",FETCH_SHARING_PREFS_SUCCESS:"sharing-prefs-success",FETCH_SHARING_PREFS_FAILURE:"sharing-prefs-failure",SET_COMMENT_CHECKBOX_PREF_REQUEST:"set-comment-checkbox-pref-request",SET_COMMENT_CHECKBOX_PREF_SUCCESS:"set-comment-checkbox-pref-success",SET_COMMENT_CHECKBOX_PREF_FAILURE:"set-comment-checkbox-pref-failure",SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:"set-comment-checkbox-pref-help-request",SET_COMMENT_CHECKBOX_HELP_PREF_SUCCESS:"set-comment-checkbox-pref-help-success",SET_COMMENT_CHECKBOX_HELP_PREF_FAILURE:"set-comment-checkbox-pref-help-failure",ERROR_MESSAGE:"error-message",ERROR_MESSAGE_CLEAR:"error-message-clear",CLEAR_FILE_MEMBERSHIP:"clear-file-membership",FETCH_FILE_MEMBERSHIP_REQUEST:"fetch-file-membership-request",FETCH_FILE_MEMBERSHIP_SUCCESS:"fetch-file-membership-success",FETCH_FILE_MEMBERSHIP_FAILURE:"fetch-file-membership-failure",CLEAR_FOLDER_MEMBERSHIP:"clear-folder-membership",FETCH_FOLDER_MEMBERSHIP_REQUEST:"fetch-folder-membership-request",FETCH_FOLDER_MEMBERSHIP_SUCCESS:"fetch-folder-membership-success",FETCH_FOLDER_MEMBERSHIP_FAILURE:"fetch-folder-membership-failure",FETCH_USER_ACCOUNTS_REQUEST:"fetch-user-accounts-request",FETCH_USER_ACCOUNTS_SUCCESS:"fetch-user-accounts-success",FETCH_USER_ACCOUNTS_FAILURE:"fetch-user-accounts-failure",FETCH_USER_ACCOUNTS_CONTINUED_REQUEST:"fetch-user-accounts-continued-request",FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:"fetch-user-accounts-continued-success",CHANGE_RECIPIENTS:"change-recipients",CHANGE_RECIPIENT_MESSAGE:"change-recipient-message",CHANGE_RECIPIENT_ACCESS:"change-recipient-access",CREATE_LINK_REQUEST:"create-link-request",CREATE_LINK_SUCCESS:"create-link-success",CREATE_LINK_FAILURE:"create-link-failure",DISPLAY_CONTENT_NAME_INFO:"display-content-name-info",SEND_SHARE_START:"send-share-start",SEND_SHARE_SUCCESS:"send-share-success",SEND_SHARE_FAILURE:"send-share-failure",SHARE_FILE_REQUEST:"share-file-request",SHARE_FILE_SUCCESS:"share-file-success",SHARE_FILE_FAILURE:"share-file-failure",SHARE_FOLDER_REQUEST:"share-folder-request",SHARE_FOLDER_SUCCESS:"share-folder-success",SHARE_FOLDER_FAILURE:"share-folder-failure",SEND_FOLDER_SHARE_REQUEST:"send-folder-share-request",SEND_FOLDER_SHARE_SUCCESS:"send-folder-share-success",SEND_FOLDER_SHARE_FAILURE:"send-folder-share-failure",SEND_FILE_SHARE_REQUEST:"send-file-share-request",SEND_FILE_SHARE_SUCCESS:"send-file-share-success",SEND_FILE_SHARE_FAILURE:"send-file-share-failure",CHANGE_MEMBER_ACCESS_REQUEST:"change-member-access-request",CHANGE_MEMBER_ACCESS_SUCCESS:"change-member-access-success",CHANGE_MEMBER_ACCESS_FAILURE:"change-member-access-failure",REMOVE_MEMBER_REQUEST:"remove-member-request",REMOVE_MEMBER_SUCCESS:"remove-member-success",REMOVE_MEMBER_FAILURE:"remove-member-failure",REMOVE_MEMBER_KEEP_ACCESS:"remove-member-keep-access",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_MEMBER_COUNTS_REQUEST:"fetch-member-counts-request",FETCH_MEMBER_COUNTS_SUCCESS:"fetch-member-counts-success",HANDLE_CONTENT_NAME_CHANGE:"handle-content-name-change",HANDLE_CONTENT_NAME_FOCUS_CHANGE:"handle-content-name-focus-change",UPDATE_BANNER:"update-banner",UPDATE_FILE_POLICY:"update-file-policy",VALIDATE_CONTENT_NAME_SUCCESS:"validate-content-name-success",VALIDATE_CONTENT_NAME_ERROR:"validate-content-name-error",SET_UI_MODE:"set-ui-mode",SET_SHARED_FOLDER_ID:"set-shared-folder-id"}),{ShareModalActionTypes:t}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/actions/share_modal",["require","external/rsvp","external/underscore","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/flux/dispatcher","modules/clean/react/browse/actions","modules/clean/react/browse/constants","modules/clean/react/browse/store","modules/clean/react/file_viewer/store","modules/clean/react/modal","modules/clean/react/pass/actions","modules/clean/react/pass/utils","modules/clean/sharing/action_types","modules/clean/sharing/api","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/constants","modules/clean/sharing/share_page/action_types","modules/clean/sharing/shared_content_link_settings_modal","modules/clean/sharing/stores/sharing_info","modules/clean/sharing/ui_util","modules/clean/components/ajax_form","modules/core/i18n","modules/core/notify"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C){var I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z;return x=n.Promise,q=i.SharingExperimentsLogger,P=r.AppError,W=r.catchApiError,U=l.SharedWithActionTypes,A=u.BrowseStore,O=d.Modal,D=h.PassHelpers,M=_.ShareModalActionTypes,H=m.SharingApi,R=f.GroupMembershipInfo,F=f.PassPolicy,j=g.memberAccessLevelApiToRecord,I=v.ACCESS_LEVEL,k=v.MEMBER_ACTION,L=y.SharePageActionTypes,z=E.showSharedContentLinkModal,N=w.GoldenGate,G=w.logTiburonEvent,V=S.i18n_default_project("sharing")._,B=function(){function n(t,n,o){this.refreshSharedWithColumnContentData=e(this.refreshSharedWithColumnContentData,this),this.recipientsChange=e(this.recipientsChange,this),this.handleLoadingError=e(this.handleLoadingError,this),this.changeRecipientAccess=e(this.changeRecipientAccess,this),this.changeAccess=e(this.changeAccess,this),this._sharingKey=t,this._client=n,this._user=o,this._hasLoggedTypeContentName=!1,this._hasLoggedAddContacts=!1}return n.prototype.initializeShareModal=function(e,t){var n,o;return null==t&&(t=!1),this._dispatch(M.SHARE_MODAL_OPEN,{contentInfo:e,user:this._user}),o=this.getSharingInfo(),this._beginTime=Date.now(),n=[],o.isTeamPolicyLoaded()||n.push(this._fetchTeamPolicy()),n.push(this._fetchSharingPrefs()),!o.canShareLink()||o.isLinkMetadataLoaded()||t||z(this._user.id)||n.push(this.fetchLinkMetadata()),x.all(n)},n.prototype.getSharingInfo=function(){return b.getSharingInfo(this._sharingKey)},n.prototype._getContentInfo=function(){return this.getSharingInfo().contentInfo()},n.prototype._dispatch=function(e,t){return null==t&&(t={}),s.dispatch({type:e,sharingKey:this._sharingKey,content:t})},n.prototype.canRelinquishMembership=function(){return this._dispatch(M.CAN_RELINQUISH_MEMBERSHIP)},n.prototype.changeAccess=function(e,t,n,o,i,r){var s,a,l,u,c;return null==r&&(r=!1),u=x.resolve(),l=e.memberId(),a=this._getContentInfo(),s=a.id,c=this.getSharingInfo(),(c.isTeamSharedFolder()||c.isFolderInsideTeamFolderTree())&&e instanceof R&&e.member_count>=N.SHARING_WARN_THRESHOLD&&C.success(V("This change may take a while.")),t===k.REMOVE?l===this._user.account_id?this._client.relinquishMembership({contentId:s,leaveACopy:r}).then(function(){return C.success(V("You have left the folder")),O.close(),i("/")}):(u=(a.isFileFolder()?this._client.getParentFolderAccess({contentId:this.getSharingInfo().parentSharedFolderId(),memberId:l}):this.removeMember(s,e,r)).then(n.bind(null,"remove")),o()):u=t===I.OWNER?this._client.transferContent({contentId:s,memberId:l}).then(function(t){return function(){return C.success(V("Made %(name)s the owner").format({name:e.displayName()})),t.initializeShareModal(a.delete("metadata")),o()}}(this)):(a.isFileFolder()&&t===I.READER?this._client.getParentFolderAccess({contentId:this.getSharingInfo().parentSharedFolderId(),memberId:l,accessLevel:t}):this.shareIfFileFolder().then(function(n){return function(){return n._changeMemberAccess(n._getContentInfo().id,e,t)}}(this))).then(n.bind(null,"update")),u.then(this.refreshSharedWithColumnContentData)},n.prototype._changeMemberAccess=function(e,t,n){var o;return o=t.access_type,this._dispatch(M.CHANGE_MEMBER_ACCESS_REQUEST,{member:t,newAccess:n}),this._client.updateMember({contentId:e,memberId:t.memberId(),accessLevel:n}).then(function(e){return function(n){return null!=n.access_level&&null!=n.warning?(e._dispatch(M.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:n.access_level}),n):void 0}}(this)).catch(W(function(e){return function(){return e._dispatch(M.CHANGE_MEMBER_ACCESS_FAILURE,{member:t,prevAccess:o})}}(this)))},n.prototype.changeRecipientAccess=function(e){return this._dispatch(M.CHANGE_RECIPIENT_ACCESS,{newAccess:e})},n.prototype.changeRecipientMessage=function(e){return this._dispatch(M.CHANGE_RECIPIENT_MESSAGE,{message:e})},n.prototype.closeModal=function(){return O.close()},n.prototype.createSharedLink=function(){return this.log("CLICK_TIB_CREATE_LINK"),this._dispatch(M.CREATE_LINK_REQUEST),this._client.createSharedLink({fileIdOrPath:this._getContentInfo().displayPath()}).then(function(e){return function(t){return e._dispatch(M.CREATE_LINK_SUCCESS,{linkMetadata:t}),e._refreshSharedWithColumnLinkData()}}(this)).catch(W(function(e){return function(){return e._dispatch(M.CREATE_LINK_FAILURE)}}(this)))},n.prototype.fetchLinkMetadata=function(){return this._dispatch(M.FETCH_LINK_METADATA_REQUEST),this._client.sharedLinkInfo({fileIdOrPath:this._getContentInfo().idForLink()}).then(function(e){return function(t){return e._dispatch(M.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}}(this))},n.prototype.fetchContentLinkMetadata=function(e){return this._dispatch(M.FETCH_LINK_METADATA_REQUEST),this._client.getLinkMetadata({url:e}).then(function(e){return function(t){return e._dispatch(M.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:t})}}(this))},n.prototype.fetchMemberCounts=function(){var e;return e=this._getContentInfo(),this._dispatch(M.FETCH_MEMBER_COUNTS_REQUEST),e.isSharedFolder()||e.isFolder()&&e.isInSharedFolder()?this._client.getMemberCounts({contentId:e.isSharedFolder()?e.sharedFolderId():e.nsId()}).then(function(e){return function(t){return e._dispatch(M.FETCH_MEMBER_COUNTS_SUCCESS,{memberCounts:t})}}(this)):x.resolve()},n.prototype.fetchMetadata=function(){},n.prototype._fetchSharingPrefs=function(){return this._dispatch(M.FETCH_SHARING_PREFS_REQUEST),this._client.getSharingPrefs().then(function(e){return function(t){return e._dispatch(M.FETCH_SHARING_PREFS_SUCCESS,{sharingPrefs:t})}}(this))},n.prototype._fetchTeamPolicy=function(){return this._dispatch(M.FETCH_TEAM_POLICY_REQUEST),this._client.getCurrentAccountCached().then(function(e){return function(t){var n;return e._dispatch(M.FETCH_TEAM_POLICY_SUCCESS,{teamPolicy:null!=(n=t.team)?n.sharing_policies:void 0})}}(this))},n.prototype.handleContentNameChange=function(e){return this._hasLoggedContentNameChange||(this._sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::CONTENT_NAME_CHANGE"),this._hasLoggedContentNameChange=!0),this._dispatch(M.HANDLE_CONTENT_NAME_CHANGE,{name:e})},n.prototype.handleContentNameFocusChange=function(e){return this._dispatch(M.HANDLE_CONTENT_NAME_FOCUS_CHANGE,{focus:e})},n.prototype.handleGetMetadataSuccess=function(e){return this._dispatch(M.FETCH_METADATA_SUCCESS,{metadata:e}),s.dispatch({type:L.FETCH_METADATA_SUCCESS,metadata:e,user:this._user})},n.prototype.handleLoadingError=function(e){var t,n;return e instanceof P?(this.log("VIEW_LINK_ONLY_MODAL",{timing:Date.now()-this._beginTime}),this._dispatch(M.FETCH_METADATA_FAILURE,{reason:null!=(t=e.error)&&null!=(n=t.bad_path)?n[".tag"]:void 0})):(C.error(e.message||C.DEFAULT_ERROR),O.close())},n.prototype.handleUpdateFilePolicy=function(e){var t,n,o,i,r,s;if(this._dispatch(M.UPDATE_FILE_POLICY,{filePolicy:e}),t=c.currentFile(),null!=t){if(n=t.ns_id,r=t.sjid,e.pass_policy===F.disabled)return p.resetPassInfo(n,r);if(e.pass_policy===F.enabled)return s=null!=(o=c.sharedLinkInfo())?o.url:void 0,i=c.shareToken(),D.setup(this._user,t,i,s,null,null)}},n.prototype.log=function(e,t){return G(this._getContentInfo(),this._user.id,e,t)},n.prototype.recipientsChange=function(e,t){return null==t&&(t=""),this._hasLoggedAddContacts||(this._sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::ADD_CONTACTS_CHANGE"),this._hasLoggedAddContacts=!0),x.resolve().then(function(n){return function(){return n._dispatch(M.CHANGE_RECIPIENTS,{recipientTokens:e,recipientRawInput:t})}}(this))},n.prototype.redirectToBrowseUrl=function(e){return a.setUrl({path:e})},n.prototype.redirectToNsId=function(e,n){var o,i;return i=A.mountPoints().get(e),o=function(){return n?t(["modules/clean/sharing/share_modal_util"],function(e){var t;return(t=e.showTiburonUIIfAllowedNonPublic)(this._user,A.context(),{origin:"PARENT_FOLDER_MODAL"})}):void 0},a.setPath({path:i,onPathLoaded:o,nsId:e})},n.prototype.refreshSharedWithColumnContentData=function(){return this._getContentInfo().isFolder()?s.dispatch({type:U.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}}):s.dispatch({type:U.SIGNAL_SHARED_FILE_DATA_OUT_OF_DATE,data:{fileIds:[this._getContentInfo().id]}})},n.prototype._refreshSharedWithColumnLinkData=function(){return s.dispatch({type:U.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this._getContentInfo().displayPath()]}})},n.prototype.removeMember=function(e,t,n){return this._dispatch(M.REMOVE_MEMBER_REQUEST,{member:t}),this._client.removeMember({contentId:e,memberId:t.memberId(),leaveACopy:n}).then(function(e){return function(n){return e.fetchMemberCounts().then(function(){return null!=(null!=n?n.access_level:void 0)&&null!=(null!=n?n.warning:void 0)?(e._dispatch(M.REMOVE_MEMBER_KEEP_ACCESS,{member:t,access:n.access_level}),n):(C.success(V("Removed %(name)s").format({name:t.displayName()})),e._dispatch(M.REMOVE_MEMBER_SUCCESS,{member:t}))})}}(this)).catch(W(function(e){return function(n){var o;return e._dispatch(M.REMOVE_MEMBER_FAILURE,{member:t}),o=n.error,"member_error"===n.error[".tag"]&&(o=n.error.member_error),"no_explicit_access"===o[".tag"]?j(e._user.id,o):C.error(n.message||C.DEFAULT_ERROR)}}(this)))},n.prototype.setAddMessageAsCommentChecked=function(e){return this._dispatch(M.SET_COMMENT_CHECKBOX_PREF_REQUEST,{checked:e}),this._client.setSharingPrefs({add_message_as_comment_checked:e})},n.prototype.setAddMessageAsCommentHelpClosed=function(){return this._dispatch(M.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST),this._client.setSharingPrefs({add_message_as_comment_help_shown:!1})},n.prototype.setLinkMetadata=function(e){return this._dispatch(M.FETCH_LINK_METADATA_SUCCESS,{linkMetadata:e})},n.prototype.setMembers=function(e){return this._dispatch(M.FETCH_USER_ACCOUNTS_SUCCESS,{members:e})},n.prototype.setSharedFolderId=function(e){return this._dispatch(M.SET_SHARED_FOLDER_ID,{sharedFolderId:e})},n.prototype.setUiMode=function(e){return this._dispatch(M.SET_UI_MODE,{uiMode:e})},n.prototype.shareIfFileFolder=function(){return this._getContentInfo().isFileFolder()?this._client.share({fqPath:this._getContentInfo().displayPath()}).then(function(e){return function(t){return e._dispatch(M.SHARE_FOLDER_SUCCESS,{metadata:t}),s.dispatch({type:L.FETCH_METADATA_SUCCESS,metadata:t,user:e._user})}}(this)):x.resolve()},n.prototype._sharingExperimentsLog=function(e,t){var n;return null==t&&(t={}),n=this._getContentInfo().extras.modalSessionId,t.modalSessionId||(t.modalSessionId=n),q.log(this._user.id,e,t)},n.prototype.updateMembers=function(e){return this._dispatch(M.FETCH_USER_ACCOUNTS_REQUEST),this._client.listMembers({contentId:e}).then(function(e){return function(t){var n,o;return e._updateMembersContinue(t.cursor),e._dispatch(M.FETCH_USER_ACCOUNTS_SUCCESS,{members:t}),o=(new Date).getTime()-e._beginTime,e.log("MEMBER_LIST_LOADED",{timing:o,member_count:null!=(n=e.getSharingInfo().members())?n.getMemberCount():void 0})}}(this))},n.prototype._updateMembersContinue=function(e){return e?(this._dispatch(M.FETCH_USER_ACCOUNTS_CONTINUED_REQUEST),this._client.listMembersContinue({cursor:e}).then(function(e){return function(t){return e._dispatch(M.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS,{members:t}),e._updateMembersContinue(t.cursor)}}(this))):x.resolve()},n.prototype.updateBanner=function(e){return this._dispatch(M.UPDATE_BANNER,{banner:e})},n.prototype.validateAndSetContentName=function(e,t,n,o){return new H(e).validate_new_sf_path(t,function(e){return function(){return e._dispatch(M.VALIDATE_CONTENT_NAME_SUCCESS,{contentName:t}),n()}}(this),function(e){return function(t){var n,i;return e._sharingExperimentsLog("SIMPLIFIED_WIZARD_UI::INVALID_CONTENT_NAME"),n=T.extract_errors(t.responseText),e._dispatch(M.VALIDATE_CONTENT_NAME_ERROR,{errorMsg:null!=(i=n.folder_name)?i.message_text:void 0}),o()}}(this))},n}()})}.call(this),function(){define("modules/clean/sharing/api",["modules/clean/ajax","modules/core/exception","jquery"],function(e,t,n){var o,i,r,s,a;return s=e.WebRequest,o=e.FormWebRequest,a=t.assert,i=function(){function e(e){this.user=e}return e.REQUEST_SUCCEEDED_EVENT="db:sharing_api:request_succeeded",e.prototype.get_sync_vars_for_ns_id=function(e,t,n,o){var i;return i={ns_id:e,sub_path:t},this._make_request("/sharing/get_sync_vars_for_ns_id",i,n,o,!0)},e.prototype.invite_more_to_folder=function(e,t,n,o,i,r){var s;return s={ns_id:e,emails:t.emails||[],fb_ids:t.fb_ids||[],group_ids:t.group_ids||[],new_style_group_ids:t.new_style_group_ids||[],custom_message:n||"",access_type:o},this._make_request("/share_ajax/invite_more",s,i,r,!0)},e.prototype.update_member_access_type=function(e,t,n,o,i){var r;return r={ns_id:e,member_uid:t,access_type:n},this._make_request("/share_ajax/update_member_access_type",r,o,i)},e.prototype.update_team_folder_access_type=function(e,t,n,o){var i;return i={ns_id:e,can_edit:t},this._make_request("/team/admin/team_folder/update_access_type",i,n,o,!0,!1)},e.prototype.update_invite_access_type=function(e,t,n,o){var i;return i={invite_id:e,access_type:t},this._make_request("/share_ajax/update_invite_access_type",i,n,o)},e.prototype.share_folder=function(e,t,n,o,i,r,s,a,l,u,c){var d,p;return d={emails:n.emails||[],fb_ids:n.fb_ids||[],group_ids:n.group_ids||[],new_style_group_ids:n.new_style_group_ids||[],custom_message:o||"",audience:i,inviter:r,shared_link_policy:s,access_type:a,folder_settings:1},e?(d.folder_name=t,p="/share_ajax/new"):(d.path=t,p=l?"/share_ajax/existing_no_recipient":"/share_ajax/existing"),(i||r)&&(d.custom_folder_settings=1),this._make_request(p,d,u,c,!0)},e.prototype.unshare_folder=function(e,t,n){var o;return o={ns_id:e,async:!0},t&&(o.keep_files=!0),this._make_request("/share_ajax/unshare?long_running",o,n)},e.prototype.leave_folder=function(e,t,n){var o;return o={ns_id:e},t&&(o.keep_files=!0),this._make_request("/share_ajax/leave?long_running",o,n)},e.prototype.transfer_ownership=function(e,t,n){var o;return o={ns_id:e,user_id:t},this._make_request("/share_ajax/change_sf_owner",o,n)},e.prototype.cancel_invite=function(e,t,n){var o;return o={ns_id:e,invite_id:t},this._make_request("/share_ajax/cancel_invite",o,n)},e.prototype.kick=function(e,t,n,o){var i;return i={ns_id:e,user_id:t},n&&(i.keep_files=!0),this._make_request("/share_ajax/kick_user",i,o)},e.prototype.reinvite_user=function(e,t,n){var o;return o={ns_id:e,invite_id:t},this._make_request("/share_ajax/reinvite_user",o,n)},e.prototype.update_sf_permissions=function(e,t,n,o){var i;return i={ns_id:e,new_permissions:t},this._make_request("/share_ajax/change_sf_perm",i,n,o)},e.prototype.update_sf_team_permissions=function(e,t,n,o,i,r){var s;return s={ns_id:e,audience:t,inviter:n,shared_link_policy:o},void 0!==i&&(s.activity_feed_enabled=i),this._make_request("/share_ajax/save_folder_settings",s,r)},e.prototype.validate_new_sf_path=function(e,t,n){var o;return o={share_type:"new",folder_name:e},this._make_request("/share_ajax/validate_folder",o,t,n,!0)},e.prototype.validate_existing_sf_path=function(e,t,n){var o;return o={share_type:"existing",path:e},this._make_request("/share_ajax/validate_folder",o,t,n,!0)},e.prototype.validate_shareable_existing_sf_path=function(e,t,n){var o;return o={share_type:"shareable_existing",path:e},this._make_request("/share_ajax/validate_folder",o,t,n,!0)},e.prototype._make_request=function(t,i,r,a,l,u){var c,d,p;return null==l&&(l=!1),null==u&&(u=!0),c={url:t,data:i,success:function(o,s,a){return"function"==typeof r&&r(a),n(document).trigger(e.REQUEST_SUCCEEDED_EVENT,{request_url:t,ns_id:i.ns_id||null})},error:function(e){return"function"==typeof a?a(e):void 0},complete:function(e){return function(){var t;return null!=(t=e.loading_elem)?t.removeClass("ajax-loading"):void 0}}(this)},u&&(c.subject_user=this.user.id),null!=(d=this.loading_elem)&&d.addClass("ajax-loading"),(p=l?o:s)(c)},e}(),r=function(){function e(){}return e.prototype.get_inbox_counts=function(e){return s({url:"/inbox_count",success:function(t,n,o){var i;return i=JSON.parse(o.responseText),a("object"==typeof i,"bad inbox_count"),e(i)}})},e.prototype.get_folder_info=function(e,t){return s({url:"/share_ajax/list_folders",success:function(t,n,o){return"function"==typeof e?e(o):void 0},error:function(e){return"function"==typeof t?t(e):void 0}})},e}(),{SharingApi:i,UserlessSharingApi:r}})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/api/client",["external/immutable","external/underscore","modules/clean/api_v2/client","modules/clean/api_v2/error","modules/clean/contacts/types","external/rsvp","modules/clean/sharing/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/api/util/types","modules/clean/sharing/ui_util","modules/core/exception","modules/core/user_i18n"],function(t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q;return A=o.UserActionClient,_=i.AppError,O=i.catchApiError,T=s.Promise,h=a.ACCESS_LEVEL,E=a.MEMBER_ACTION,m=l.FilePolicy,g=l.FolderPolicy,b=l.MemberPermission,I=l.SharingMembership,P=l.TeamSharingPolicies,N=u.accessLevelConstToApi,R=u.accountInfoApiToRecord,D=u.contactsToMembers,F=u.fileMetadataApiToRecord,x=u.folderMetadataApiToRecord,M=u.fullAccountApiToRecord,L=u.hasFolderMetadataRecordInMetadata,U=u.linkMetadataApiToRecord,B=u.listFilesResultApiToRecord,H=u.listFoldersResultApiToRecord,q=u.makeMemberSelector,V=u.memberAccessLevelApiToRecord,W=u.memberCountsApiToRecord,G=u.membershipApiToRecord,j=u.parseFolderPermissions,z=u.parseFolderPolicy,Y=u.sharedContentLinkMetadataToRecord,Q=u.sharingPrefsApiToRecord,y=c.GoldenGate,k=d.assert,C=function(t){function n(e){this.message=e,this.name="ShareError",this.stack=(new Error).stack}return e(n,t),n}(Error),S=function(){function e(e){var t;this.userId=e.userId,this.client=null!=(t=e.client)?t:null,null==this.client&&(this.client=new A)}return e.prototype.addMembers=function(e){var t,n,o,i,r,s,a;throw n=e.contentId,i=e.members,t=e.accessLevel,o=null!=(s=e.customMessage)?s:null,r=null!=(a=e.quiet)?a:!1,new TypeError("Not implemented")},e.prototype.removeMember=function(e){var t,n;throw t=e.contentId,n=e.memberId,new TypeError("Not implemented")},e.prototype.changeMemberAccess=function(e){var t,n,o;throw t=e.contentId,n=e.memberId,o=e.newAccess,new TypeError("Not implemented")},e.prototype.getMetadata=function(e){var t,n,o;throw n=e.contentId,t=null!=(o=e.actions)?o:[],new TypeError("Not implemented")},e.prototype.getMetadataInternal=function(e){var t,n,o;throw n=e.contentId,t=null!=(o=e.actions)?o:[],new TypeError("Not implemented")},e.prototype.getMetadataAlpha=function(e){var t,n,o;throw n=e.contentId,t=null!=(o=e.actions)?o:[],new TypeError("Not implemented")},e.prototype.listMembers=function(e){var t;throw t=e.contentId,new TypeError("Not implemented")},e.prototype.listMembersContinue=function(e){var t;throw t=e.cursor,new TypeError("Not implemented")},e.prototype.getMemberCounts=function(e){var t;throw t=e.contentId,new TypeError("Not implemented")},e.prototype.getParentFolderAccess=function(e){var t,n,o;throw n=e.contentId,o=e.memberId,t=e.accessLevel,new TypeError("Not implemented")},e.prototype.dismissInviteNotification=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/dismiss_invite_notification",{content_id:t})},e.prototype.getSharingPrefs=function(){return this.client.rpc(this.userId,"users/get_sharing_prefs",null,!1).then(Q)},e.prototype.setSharingPrefs=function(e){return this.client.rpc(this.userId,"users/set_sharing_prefs",e)},e.prototype.claimMembership=function(e){var t;return t=e.contentUrl,this.client.rpc(this.userId,"sharing/claim_membership",{content_url:t})},e.prototype.checkJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_job_status",{async_job_id:t})},e.prototype.getAccountBatch=function(e){var t;return t=e.accountIds,t.length>0?this.client.rpc(this.userId,"users/get_account_batch",{account_ids:t}).then(function(e){return e.map(R)}):T.resolve([])},e.prototype._getAccountBatchCache={},e.prototype.getAccountBatchCached=function(e){var t,o,i,r,s,a;return t=e.accountIds,r=this._getAccountBatchCache,s=n.partition(t,function(e){return e in r}),i=s[0],a=s[1],o=n.values(n.pick(r,i)),this.getAccountBatch({accountIds:a}).then(function(e){var t;return t=n.object(e.map(function(e){return[e.account_id,e]})),n.extendOwn(r,t),e.concat(o)})},e.prototype.resetGetAccountBatchCache=function(){return this._getAccountBatchCache={}},e.prototype.getCurrentAccount=function(e){return this.client.rpc(this.userId,"users/get_current_account").then(function(e){return M(e)})},e.prototype._getCurrentAccountCache=null,e.prototype.getCurrentAccountCached=function(e){return null==this._getCurrentAccountCache&&(this._getCurrentAccountCache=this.getCurrentAccount()),this._getCurrentAccountCache},e.prototype.resetGetCurrentAccountCache=function(){return this._getCurrentAccountCache={}},e.prototype.requestAccess=function(e){var t;return t=e.contentUrl,this.client.rpc(this.userId,"sharing/request_access",{content_url:t})},e.prototype.sharedLinkInfo=function(e){var t,n;return t=e.fileIdOrPath,k(null!=t,"an fqPath or fileId must be present to retrieve shared link info"),n=this.client.rpc(this.userId,"sharing/alpha/list_shared_links",{path:t,direct_only:!0}),n.then(function(e){return 0===e.links.length?null:U(e.links[0])})},e.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this.client.rpc(this.userId,"sharing/alpha/create_shared_link_with_settings",{path:t}).then(U)},e.prototype.modifySharedLinkSettings=function(e){var t,n,o;return o=e.url,n=e.settings,t=e.remove_expiration,this.client.rpc(this.userId,"sharing/alpha/modify_shared_link_settings",{url:o,settings:n,remove_expiration:t}).then(U)},e.prototype.revokeSharedLink=function(e){var t;return t=e.url,this.client.rpc(this.userId,"sharing/revoke_shared_link",{url:t})},e.prototype.getLinkMetadata=function(e){var t;return t=e.url,this.client.rpc(this.userId,"sharing/alpha/get_link_metadata",{url:t}).then(Y)},e.prototype.setLinkSettings=function(e){var t,n;return t=e.linkSettings,n=e.url,this.client.rpc(this.userId,"sharing/alpha/set_link_settings",{link_settings:t,url:n}).then(Y)},e.prototype._addAccountsToMembership=function(e){return this._addAccountsToMembershipBatch(t.Map([[1,e]])).then(function(e){return e.get(1)})},e.prototype._addAccountsToMembershipBatch=function(e){var n;return n=e.valueSeq().flatMap(function(e){return e.users.valueSeq()}).map(function(e){return e.memberId()}).toSet().toArray(),n.length>0?this.getAccountBatchCached({accountIds:n}).then(function(n){var o;return o=t.Map(n.map(function(e){return[e.account_id,e]})),e.map(function(e,t){return e.set("users",e.users.map(function(e){return function(e){var t;return t=o.get(e.account_id),null!=t?e.set("account",t):e}}(this)))})}):T.resolve(e)},e}(),w=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._promises={}}return e(n,t),n.prototype.addMembers=function(e){var t,n,o,i,r,s,a;return n=e.contentId,i=e.members,t=e.accessLevel,o=null!=(s=e.customMessage)?s:null,r=null!=(a=e.quiet)?a:!1,this.createPromise("addMembers")},n.prototype.changeMemberAccess=function(e){var t,n,o;return t=e.contentId,n=e.memberId,o=e.newAccess,this.createPromise("changeMemberAccess")},n.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.createPromise("getMetadata")},n.prototype.getMetadataInternal=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.createPromise("getMetadataInternal")},n.prototype.getMetadataAlpha=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.createPromise("getMetadataAlpha")},n.prototype.dismissInviteNotification=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.cursor)?o:null,this.createPromise("dismissInviteNotification")},n.prototype.getSharingPrefs=function(){return this.createPromise("getSharingPrefs")},n.prototype.listMembers=function(e){var t;return t=e.contentId,this.createPromise("listMembers")},n.prototype.listMembersContinue=function(e){var t;return t=e.contentId,this.createPromise("listMembersContinue")},n.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this.createPromise("getMemberCounts")},n.prototype.getParentFolderAccess=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.createPromise("getParentFolderAccess")},n.prototype.removeMember=function(e){var t,n;return t=e.contentId,n=e.memberId,this.createPromise("removeMember")},n.prototype.share=function(e){var t,n,o,i,r,s,a,l,u;return o=e.fqPath,i=null!=(r=e.memberPolicy)?r:null,t=null!=(s=e.aclUpdatePolicy)?s:null,u=null!=(a=e.sharedLinkPolicy)?a:null,n=null!=(l=e.forceAsync)?l:!1,this.createPromise("share")},n.prototype.shareInternal=function(e){var t,n,o,i,r,s,a;return i=e.fqPath,n=null!=(r=e.folderPolicy)?r:null,o=null!=(s=e.forceAsync)?s:!1,t=null!=(a=e.confidential)?a:!1,this.createPromise("shareInternal")},n.prototype.requestAccess=function(e){var t;return t=e.contentUrl,this.createPromise("requestAccess");
},n.prototype.sharedLinkInfo=function(e){var t;return t=e.fileIdOrPath,this.createPromise("sharedLinkInfo")},n.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this.createPromise("transferContent")},n.prototype.createSharedLink=function(e){var t;return t=e.fileIdOrPath,this.createPromise("createSharedLink")},n.prototype.updateMember=function(){return this.createPromise("updateMember")},n.prototype.validatePath=function(e){var t,n,o;return n=e.fqPath,t=null!=(o=e.actions)?o:[],this.createPromise("validatePath")},n.prototype.getCurrentAccountCached=function(e){return this.createPromise("getCurrentAccountCached")},n.prototype.modifySharedLinkSettings=function(e){var t,n,o;return o=e.url,n=e.settings,t=e.remove_expiration,this.createPromise("modifySharedLinkSettings")},n.prototype.revokeSharedLink=function(e){var t;return t=e.url,this.createPromise("revokeSharedLink")},n.prototype.relinquishMembership=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)?o:!1,this.createPromise("relinquishMembership")},n.prototype.setConfidentiality=function(e){var t,n;return n=e.contentId,t=e.confidential,this.createPromise("setConfidentiality")},n.prototype.createPromise=function(e){var t;return t=this._promises[e],t&&t.calledBeforeCreatePromise?(this._promises[e]=null,t.promise):(t={},t.promise=new T(function(e,n){return t.resolve=e,t.reject=n}),this._promises[e]=t,t.promise)},n.prototype.getPromise=function(e){var t;return null!=(t=this._promises[e])?t.promise:void 0},n.prototype.resolvePromise=function(e,t,n){var o;return null==n&&(n=!1),this._promises[e]||this.createPromise(e),o=this._promises[e],o.calledBeforeCreatePromise=n,o.resolve.apply(null,t),o.promise},n.prototype.rejectPromise=function(e,t){var n;return this._promises[e]||this.createPromise(e),n=this._promises[e],n.reject.apply(null,t),n.promise},n}(S),f=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,n),o.prototype.addMembers=function(e){var t,n,o,i,r,s,a,l,u,c,d;return i=e.contentId,s=e.members,r=null!=(l=e.customMessage)?l:null,a=null!=(u=e.quiet)?u:!1,t=null!=(c=e.accessLevel)?c:h.READER,n=null!=(d=e.addMessageAsComment)?d:!1,o=N(t),0===(null!=r?r.length:void 0)&&(r=null),this.client.rpc(this.userId,"sharing/add_file_member",{file:i,members:s,custom_message:r,quiet:a,access_level:o,add_message_as_comment:n})},o.prototype.removeMember=function(e){var t,n,o;return t=e.contentId,o=e.memberId,this.client.rpc(this.userId,"sharing/remove_file_member_2",{file:t,member:q(o)},n=!1).then(function(e){return function(t){return V(e.userId,t)}}(this))},o.prototype.changeMemberAccess=function(e){var t,n,o;throw t=e.contentId,n=e.memberId,o=e.newAccess,new C("Not permitted for files")},o.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.client.rpc(this.userId,"sharing/get_file_metadata",{file:n,actions:t},!1).then(F)},o.prototype.getMetadataAlpha=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this.client.rpc(this.userId,"sharing/alpha/get_file_metadata",{file:n,actions:t},!1).then(F)},o.prototype.share=function(e){var t;return t=e.fqPath,this.client.rpc(this.userId,"sharing/share_file",{path:t})},o.prototype.listMembers=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.limit)?o:100,this.client.rpc(this.userId,"sharing/list_file_members",{file:t,actions:E.ALL,include_inherited:!0,limit:n},!1).then(G).then(this._addAccountsToMembership.bind(this))},o.prototype.listMembersContinue=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/list_file_members/continue",{cursor:t}).then(function(e){return G(e,null)}).then(this._addAccountsToMembership.bind(this))},o.prototype.listMembersBatch=function(e){var n,o,i;return n=e.contentIds,o=null!=(i=e.limit)?i:10,this.client.rpc(this.userId,"sharing/list_file_members/batch",{files:n,limit:o}).then(function(e){var n,o,i,r;for(r={},o=0,i=e.length;i>o;o++)n=e[o],"result"===n.result[".tag"]&&(r[n.file]=G(n.result.members,n.result.member_count));return t.Map(r)}).then(this._addAccountsToMembershipBatch.bind(this))},o.prototype.getMemberCounts=function(e){var t;throw t=e.contentId,new C("Member counts not implemented for files yet")},o.prototype.getParentFolderAccess=function(e){var t,n,o;throw n=e.contentId,o=e.memberId,t=e.accessLevel,new C("Parent folder access points not implemented for files")},o.prototype.relinquishMembership=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/relinquish_file_membership",{file:String(t)})},o.prototype.listReceivedFiles=function(e){var t,n,o,i;return n=null!=(o=e.limit)?o:100,t=null!=(i=e.actions)?i:[],this.client.rpc(this.userId,"sharing/list_received_files",{limit:n,actions:t}).then(B)},o.prototype.listReceivedFilesContinue=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/list_received_files/continue",{cursor:t}).then(B)},o.prototype.updateMember=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/change_file_member_access",{file:String(n),member:q(o),access_level:N(t)})},o.prototype.updatePolicy=function(e){var t,n,o;return n=e.contentId,o=e.newPolicy,t={file:n},o.forEach(function(e,n){return null!=e?t[n]={".tag":e}:void 0}),this.client.rpc(this.userId,"sharing/update_file_policy",t)},o}(S),v=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.share=function(e){var t,n,o,i,r;return o=e.fqPath,t=null!=(i=e.folderPolicy)?i:null,n=null!=(r=e.forceAsync)?r:!1,this._share({fqPath:o,folderPolicy:t,forceAsync:n,confidential:!1,internal:!1})},n.prototype.shareInternal=function(e){var t,n,o,i,r,s,a;return i=e.fqPath,n=null!=(r=e.folderPolicy)?r:null,o=null!=(s=e.forceAsync)?s:!1,t=null!=(a=e.confidential)?a:!1,this._share({fqPath:i,folderPolicy:n,forceAsync:o,confidential:t,internal:!0})},n.prototype._share=function(e){var t,n,o,i,r,s,a;return r=e.fqPath,o=e.folderPolicy,i=e.forceAsync,n=e.confidential,s=e.internal,t={path:r},null!=o&&o.forEach(function(e,n){return null!=e&&"resolved_member_policy"!==n?t[n]={".tag":e}:void 0}),a="sharing/share_folder",s&&(t.confidentiality=n?"confidential":"not_confidential",a="sharing/share_folder_internal"),this.client.rpc(this.userId,a,t).then(function(e){return function(t){return"complete"===t[".tag"]?T.resolve(t):K(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id}))}}(this)).then(x)},n.prototype.checkShareJobStatus=function(e){var t,n;return t=e.jobId,n=y.confidentialFolderAware(this.userId)?"sharing/check_share_internal_job_status":"sharing/check_share_job_status",this.client.rpc(this.userId,n,{async_job_id:t})},n.prototype.checkRemoveMemberJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_remove_member_job_status",{async_job_id:t})},n.prototype.checkDowngradeTeamFolderJobStatus=function(e){var t;return t=e.jobId,this.client.rpc(this.userId,"sharing/check_downgrade_team_folder_job_status",{async_job_id:t})},n.prototype.addMembers=function(e){var t,n,o,i,r,s,a,l,u,c;return i=e.contentId,a=e.members,t=e.accessLevel,r=null!=(u=e.customMessage)?u:null,l=null!=(c=e.quiet)?c:!1,o=N(t),0===(null!=r?r.length:void 0)&&(r=null),n={shared_folder_id:String(i),members:function(){var e,t,n;for(n=[],e=0,t=a.length;t>e;e++)s=a[e],n.push({member:s,access_level:o});return n}(),custom_message:r,quiet:l},this.client.rpc(this.userId,"sharing/add_folder_member",n)},n.prototype.fetchNsId=function(e){return this.client.rpc(this.userId,"files/get_metadata",{path:e}).then(function(e){var t;return null!=(t=e.sharing_info)?t.shared_folder_id:void 0})},n.prototype.getMetadata=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/get_folder_metadata"})},n.prototype.getMetadataInternal=function(e){var t,n,o;return n=e.contentId,t=null!=(o=e.actions)?o:[],this._getMetadata({contentId:n,actions:t,metadataApi:"sharing/get_folder_metadata_2"})},n.prototype._getMetadata=function(e){var t,n,o,i;return n=e.contentId,t=null!=(i=e.actions)?i:[],o=e.metadataApi,this.client.rpc(this.userId,o,{shared_folder_id:String(n),actions:t}).then(x)},n.prototype._metadataAndInheritMembers=function(e){var t;return t=e.members_cursor,t?this.listMembersContinue({cursor:t}).then(function(t){return{metadata:e,inheritedMembers:t}}):{metadata:e,inheritedMembers:new I}},n.prototype.validatePath=function(e){var t,n,o,i,r,s,a;return n=e.fqPath,t=null!=(i=e.actions)?i:[],o=null!=(r=e.listMembersArg)?r:{},a=null!=(s=e.shouldParseMetadataFromError)?s:!1,this.client.rpc(this.userId,"sharing/validate_folder_path",{path:n,actions:t,list_members_arg:o},!1).catch(O(function(e){var t,n;if("already_shared"===(null!=(t=e.error)&&null!=(n=t.bad_path)?n[".tag"]:void 0))return e.error.bad_path;if(a&&e instanceof _&&e.error&&"no_permission"===e.error[".tag"]&&L(e.error))return e.error;throw e})).then(x).then(this._metadataAndInheritMembers.bind(this))},n.prototype.updatePolicy=function(e){var t,n,o;return n=e.contentId,o=e.newPolicy,t={shared_folder_id:String(n)},o.forEach(function(e,n){return null!=e&&"resolved_member_policy"!==n?t[n]={".tag":e}:void 0}),this.client.rpc(this.userId,"sharing/update_folder_policy",t).then(x)},n.prototype.unshare=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)?o:!1,this.client.rpc(this.userId,"sharing/unshare_folder",{shared_folder_id:String(t),leave_a_copy:n}).then(function(e){return function(t){return"complete"===t[".tag"]?T.resolve(t):K(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},n.prototype.downgradeTeamFolder=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/downgrade_team_folder",{shared_folder_id:String(t)}).then(function(e){return function(t){return"complete"===t[".tag"]?T.resolve(t):K(e.checkDowngradeTeamFolderJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},n.prototype.listMembers=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.limit)?o:100,this.client.rpc(this.userId,"sharing/list_folder_members",{shared_folder_id:String(t),actions:E.ALL,limit:n}).then(G).then(this._addAccountsToMembership.bind(this))},n.prototype.listMembersContinue=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/list_folder_members/continue",{cursor:t}).then(function(e){return G(e,null)}).then(this._addAccountsToMembership.bind(this))},n.prototype.listMountableFolders=function(e){var t,n,o,i,r;return o=null!=e?e:{},n=null!=(i=o.limit)?i:100,t=null!=(r=o.actions)?r:[],this.client.rpc(this.userId,"sharing/list_mountable_folders",{limit:n,actions:t}).then(H)},n.prototype.listMountableFoldersContinue=function(e){var t;return t=e.cursor,this.client.rpc(this.userId,"sharing/list_mountable_folders/continue",{cursor:t}).then(H)},n.prototype.getMemberCounts=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/get_folder_member_counts",{shared_folder_id:String(t)}).then(W)},n.prototype.getParentFolderAccess=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/get_parent_folder_access",{shared_folder_id:String(n),member:q(o),access_level:null!=t?N(t):void 0}).then(V.bind(null,this.userId))},n.prototype.relinquishMembership=function(e){var t,n,o;return t=e.contentId,n=null!=(o=e.leaveACopy)?o:!1,this.client.rpc(this.userId,"sharing/relinquish_folder_membership",{shared_folder_id:String(t),leave_a_copy:n}).then(function(e){return function(t){return"complete"===t[".tag"]?T.resolve():K(e.checkJobStatus.bind(e,{jobId:t.async_job_id}))}}(this))},n.prototype.removeMember=function(e){var t,n,o,i,r;return t=e.contentId,i=e.memberId,o=null!=(r=e.leaveACopy)?r:!1,this.client.rpc(this.userId,"sharing/remove_folder_member",{shared_folder_id:String(t),member:q(i),leave_a_copy:o},n=!1).then(function(e){return function(t){return"complete"===t[".tag"]?T.resolve():K(e.checkRemoveMemberJobStatus.bind(e,{jobId:t.async_job_id}))}}(this)).then(function(e){return function(t){return V(e.userId,t)}}(this))},n.prototype.transferContent=function(e){var t,n;return t=e.contentId,n=e.memberId,this.client.rpc(this.userId,"sharing/transfer_folder",{shared_folder_id:String(t),to_dropbox_id:n})},n.prototype.updateMember=function(e){var t,n,o;return n=e.contentId,o=e.memberId,t=e.accessLevel,this.client.rpc(this.userId,"sharing/update_folder_member",{shared_folder_id:String(n),member:q(o),access_level:N(t)}).then(function(e){return function(t){return V(e.userId,t)}}(this))},n.prototype.mount=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/mount_folder",{shared_folder_id:String(t)}).then(x)},n.prototype.unmount=function(e){var t;return t=e.contentId,this.client.rpc(this.userId,"sharing/unmount_folder",{shared_folder_id:String(t)})},n.prototype.setConfidentiality=function(e){var t,n;return n=e.contentId,t=e.confidential,this.client.rpc(this.userId,"sharing/set_confidentiality",{shared_folder_id:String(n),confidentiality:t?"confidential":"not_confidential"}).then(function(e){return function(t){return"complete"===t[".tag"]?T.resolve(t):K(e.checkShareJobStatus.bind(e,{jobId:t.async_job_id}))}}(this)).then(x)},n}(S),K=function(e,t){var n,o,i,r,s,a,l;return r=null!=t?t:{},i=null!=(s=r.interval)?s:1e3,l=null!=(a=r.timeout)?a:null,o=null!=l?Date.now()+l:null,n=function(t,r){return null!=o&&Date.now()>o?r():e().then(function(e){switch(e[".tag"]){case"failed":return r(e);case"complete":return t(e);case"in_progress":return window.setTimeout(n,i,t,r)}})},new T(n)},{contactsToMembers:D,FilePolicy:m,FileShareApiClient:f,FolderPolicy:g,FolderShareApiClient:v,MemberPermission:b,MockShareApiClient:w,parseFolderPermissions:j,parseFolderPolicy:z,ShareError:C,ShareApiClient:S,TeamSharingPolicies:P}})}.call(this),function(){define("modules/clean/sharing/api/types/metadata",["external/immutable","modules/clean/api_v2/types"],function(e,t){var n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y;return j=t.UnionScalar,C={team:new j("team"),anyone:new j("anyone")},n={owner:new j("owner"),editors:new j("editors")},B={anyone:new j("anyone"),members:new j("members")},M={team:new j("team"),anyone:new j("anyone")},x={from_team_only:new j("from_team_only"),from_anyone:new j("from_anyone")},U={default_public:new j("default_public"),default_team_only:new j("default_team_only"),team_only:new j("team_only")},N={policy_name:"requested_visibility",password:"password",public:"public",team_only:"team_only"},R={policy_name:"resolved_visibility",only_you:"only_you",password:"password",public:"public",shared_folder_only:"shared_folder_only",team_and_password:"team_and_password",team_only:"team_only"},K={delete_and_recreate:"delete_and_recreate",restricted_by_shared_folder:"restricted_by_shared_folder",restricted_by_team:"restricted_by_team",user_account_type:"user_account_type",user_not_on_team:"user_not_on_team"},_={policy_name:"expires"},P={policy_name:"pass_policy",enabled:"enabled",disabled:"disabled"},h={public:"public",team:"team",members:"members"},p=e.Record({change_audience:"change_audience",remove_expiry:"remove_expiry",remove_password:"remove_password",set_expiry:"set_expiry",set_password:"set_password"}),V=e.Record({id:null,name:null},"Team"),W=e.Record({display_name:null,member_id:null,team_info:null},"TeamMemberInfo"),u=e.Record({id:null,name:null,sharing_policies:null},"FullTeam"),G=e.Record({shared_folder_member_policy:null,shared_folder_join_policy:null,shared_link_create_policy:null}),o=e.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,is_teammate:!1,profile_photo_url:null,surname:null,team_member_id:null},"BasicAccount"),l=e.Record({account_id:null,display_name:null,disabled:!1,email:null,email_verified:!1,familiar_name:null,given_name:null,profile_photo_url:null,surname:null,team:null,team_member_id:null},"FullAccount"),A=e.Record({allow:!1,reason:null},"PermissionSetting"),L=e.Record({access_type:null,is_confidential:!1,is_team_folder:!1,members_cursor:null,name:null,owner_team:null,parent_shared_folder_id:null,path_lower:null,permissions:null,policy:null,preview_url:null,shared_folder_id:null,time_invited:null},"SharedFolderMetadata"),L.prototype.contentId=function(){var e;return null!=(e=this.shared_folder_id)?e:this.path_lower},L.prototype.isSharedFolder=function(){return null!=this.shared_folder_id},L.prototype.isNewSharedFolder=function(){return null==this.shared_folder_id},a=e.Record({acl_update_policy:null,member_policy:null,resolved_member_policy:null,shared_link_policy:null,pass_policy:null},"FolderPolicy"),s=e.Record({change_options:null,edit_contents:null,invite_editor:null,invite_viewer:null,invite_viewer_no_comment:null,leave_a_copy:null,relinquish_membership:null,update_confidentiality:null,unmount:null,unshare:null},"FolderPermissions"),E=e.Record({entries:new e.Map,cursor:null},"ListFoldersResult"),F=e.Record({access_type:null,id:null,file_policy:null,name:null,owner_team:null,policy:null,parent_shared_folder_id:null,path_display:null,path_lower:null,permissions:null,preview_url:null,time_invited:null},"SharedFileMetadata"),F.prototype.contentId=function(){return this.id},F.prototype.isSharedFolder=function(){return!1},F.prototype.isNewSharedFolder=function(){return!1},i=e.Record({change_options:null,edit_contents:null,invite_viewer:null,invite_viewer_no_comment:null,relinquish_membership:null,unshare:null,view_members:null},"FilePermissions"),r=e.Record({pass_policy:null},"FilePolicy"),y=e.Record({entries:new e.Map,cursor:null}),H=e.Record({cursor:null,invitees:new e.Map,groups:new e.Map,users:new e.Map,memberCount:null},"SharingMembership"),H.prototype.getMemberCount=function(){var e;return null!=(e=this.memberCount)?e:this.invitees.count()+this.groups.count()+this.users.count()},z=e.Record({access_type:null,account:null,account_id:null,initials:null,is_inherited:!1,permissions:null,same_team:null,team_member_id:null},"UserMembershipInfo"),d=e.Record({access_type:null,contact:null,contact_type:null,initials:!1,is_inherited:null,permissions:null,same_team:null},"InviteeMembershipInfo"),c=e.Record({access_type:null,group_external_id:null,group_id:null,group_name:null,group_type:null,initials:null,is_inherited:!1,is_owner:!1,member_count:null,permissions:null,same_team:!0},"GroupMembershipInfo"),z.prototype.memberId=function(){return this.account_id},z.prototype.memberKey=function(){return Y(this.is_inherited,this.memberId())},z.prototype.displayName=function(){var e;return null!=(e=this.account)?e.display_name:void 0},z.prototype.type=function(){return"users"},d.prototype.memberId=function(){return this.contact_type+":"+this.contact},d.prototype.memberKey=function(){return Y(this.is_inherited,this.memberId())},d.prototype.displayName=function(){return this.contact},d.prototype.type=function(){return"invitees"},c.prototype.memberId=function(){return this.group_id},c.prototype.memberKey=function(){return Y(this.is_inherited,this.memberId())},c.prototype.displayName=function(){return this.group_name},c.prototype.type=function(){return"groups"},Y=function(e,t){return e+":"+t},S=e.Record({leave_a_copy:null,make_editor:null,make_owner:null,make_viewer:null,make_viewer_no_comment:null,remove:null},"MemberPermissions"),T=e.Record({action:null,allow:!1,reason:null},"MemberPermission"),w=e.Record({total_unique_users:null,users_outside_team:null}),b=e.Record({access_level:null,warning:null,parentFolders:null},"MemberAccessLevelResult"),I=e.Record({name:null,shared_folder_id:null,permissions:null},"ParentFolderInfo"),m=e.Record({url:null,client_modified:null,content_owner_team_info:null,expires:null,file_type:null,id:null,link_permissions:null,name:null,path_lower:null,rev:null,server_modified:null,size:null,team_member_info:null,preview_type:null},"LinkMetadata"),m.prototype.isFolder=function(){return"folder"===this.file_type},m.prototype.teamInfo=function(){var e,t;return null!=(e=this.content_owner_team_info)?e:null!=(t=this.team_member_info)?t.team_info:void 0},g=e.Record({requested_visibility:null,link_password:null,expires:null,allow_download:null},"LinkPolicy"),f=e.Record({allow_comments:null,can_revoke:null,allow_download:null,can_allow_download:null,can_disallow_download:null,can_set_expiry:null,can_remove_expiry:null,requested_visibility:null,resolved_visibility:null,restricting_shared_folder_path:null,revoke_failure_reason:null,team_restricts_comments:null,visibility_policies:null},"LinkPermissions"),v=e.Record({policy:null,resolved_policy:null,allowed:null,disallowed_reason:null}),q=e.Record({add_message_as_comment_checked:null,add_message_as_comment_help_shown:null,access_reader_no_comment_content_links:null,access_reader_no_comment_shared_folders:null}),O=e.Record({action:null,allow:null,reason:null}),k=e.Record({audience_options:null,current_audience:null,expiry:null,link_permissions:null,password_protected:null,url:null}),D=e.Record({audience:null,remove_expiry:null,set_expiry:null,remove_password:null,set_password:null}),{AclUpdatePolicy:n,BasicAccount:o,FilePermissions:i,FilePolicy:r,FolderPermissions:s,FolderPolicy:a,FullAccount:l,FullTeam:u,GroupMembershipInfo:c,InviteeMembershipInfo:d,LinkAudience:h,LinkExpiryPolicy:_,LinkMetadata:m,LinkPermissions:f,LinkPolicy:g,LinkVisibilityPolicy:v,ListFilesResult:y,ListFoldersResult:E,makeMemberKey:Y,MemberAccessLevelResult:b,MemberCounts:w,MemberPermission:T,MemberPermissions:S,MemberPolicy:C,ParentFolderInfo:I,PassPolicy:P,PermissionSetting:A,RequestedVisibilityPolicy:N,ResolvedVisibilityPolicy:R,SharedContentLinkMetadata:k,SharedContentLinkPermission:O,SharedContentLinkSettings:D,SharedFileMetadata:F,SharedFolderMetadata:L,SharedLinkPolicy:B,SharingMembership:H,SharingPrefs:q,Team:V,TeamMemberInfo:W,TeamSharingPolicies:G,UserMembershipInfo:z,VisibilityDisallowedReason:K}})}.call(this),function(){define("modules/clean/sharing/api/util/types",["external/immutable","external/underscore","modules/clean/api_v2/types","modules/clean/contacts/types","modules/clean/sharing/constants","modules/clean/sharing/link_info","modules/clean/sharing/api/types/metadata","modules/clean/sharing/ui_util"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$,J,X,ee,te,ne,oe,ie,re,se,ae,le,ue,ce,de,pe,he,_e,me,fe,ge,ve,ye,Ee,be,we,Te,Se,Ce,Ie,Pe,Ae,Ne;return te=n.formatTimestamp,W=n.Union,G=n.UnionScalar,l=i.ACCESS_LEVEL,I=i.MEMBER_ACTION,c=i.FOLDER_METADATA_PERMISSIONS,E=r.LinkInfo,u=s.BasicAccount,d=s.FilePermissions,p=s.FilePolicy,h=s.FolderPermissions,_=s.FolderPolicy,m=s.FullAccount,f=s.FullTeam,v=s.GroupMembershipInfo,y=s.InviteeMembershipInfo,b=s.LinkMetadata,w=s.LinkPermissions,T=s.LinkVisibilityPolicy,S=s.ListFilesResult,C=s.ListFoldersResult,P=s.MemberAccessLevelResult,A=s.MemberCounts,N=s.MemberPermission,R=s.MemberPermissions,k=s.ParentFolderInfo,O=s.PassPolicy,D=s.PermissionSetting,U=s.SharingMembership,B=s.SharingPrefs,F=s.SharedContentLinkMetadata,x=s.SharedContentLinkPermission,M=s.SharedFileMetadata,L=s.SharedFolderMetadata,H=s.Team,q=s.TeamMemberInfo,V=s.TeamSharingPolicies,j=s.UserMembershipInfo,g=a.GoldenGate,K=function(e){switch(e){case l.OWNER:return new G("owner");case l.WRITER:return new G("editor");case l.READER:return new G("viewer");case l.READER_NO_COMMENT:return new G("viewer_no_comment")}},z=function(e){var t;switch(null!=(t=e.type)?t:e){case"owner":return l.OWNER;case"editor":return l.WRITER;case"viewer":return l.READER;case"viewer_no_comment":return l.READER_NO_COMMENT}},ie=function(e){return null!=e.path_lower&&null!=e.access_type&&null!=e.policy},J=function(e){return new L({access_type:z(W.parse(e.access_type)),is_team_folder:e.is_team_folder,members_cursor:e.members_cursor,name:e.name,owner_team:null!=e.owner_team?new H(e.owner_team):null,parent_shared_folder_id:e.parent_shared_folder_id,path_lower:e.path_lower,permissions:null!=e.permissions?X(e.permissions):void 0,policy:ve(e.policy),preview_url:e.preview_url,shared_folder_id:e.shared_folder_id,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0,is_confidential:null!=e.is_confidential?e.is_confidential:void 0})},X=function(e){var t,n,o,i,r;for(o={},t=0,n=e.length;n>t;t++)i=e[t],o[i.action[".tag"]]=new D({allow:i.allow,reason:null!=(r=i.reason)?r[".tag"]:void 0});return new h(o)},ee=function(e){var t,n,o,i;return null==e?new _:new _({acl_update_policy:null!=(t=e.acl_update_policy)?t[".tag"]:void 0,member_policy:null!=(n=e.member_policy)?n[".tag"]:void 0,resolved_member_policy:null!=(o=e.resolved_member_policy)?o[".tag"]:void 0,shared_link_policy:null!=(i=e.shared_link_policy)?i[".tag"]:void 0})},ue=function(t){return new C({entries:new e.Map(t.entries.map(J).map(function(e){return[e.shared_folder_id,e]})),cursor:t.cursor})},Z=function(e){return new M({access_type:null!=e.access_type?z(W.parse(e.access_type)):l.READER,id:e.id,file_policy:be(e.pass_policy),name:e.name,owner_team:null!=e.owner_team?new H(e.owner_team):null,policy:null!=e.policy?ve(e.policy):new _,parent_shared_folder_id:e.parent_shared_folder_id,path_display:e.path_display,path_lower:e.path_lower,permissions:$(e.permissions),preview_url:e.preview_url,time_invited:null!=e.time_invited?new Date(e.time_invited):void 0})},$=function(e){var t,n,o,i,r;if(o={},null!=e)for(t=0,n=e.length;n>t;t++)i=e[t],o[i.action[".tag"]]=new D({allow:i.allow,reason:null!=(r=i.reason)?r[".tag"]:void 0});return new d(o)},le=function(t){return new S({entries:new e.Map(t.entries.map(function(e){return[e.id,Z(e)]})),cursor:t.cursor})},me=function(t,n){var o,i,r,s;return null==n&&(n=null),new U({cursor:t.cursor,invitees:new e.Map(function(){var e,n,o,s;for(o=t.invitees,s=[],e=0,n=o.length;n>e;e++)i=o[e],r=re(i),s.push([r.memberKey(),r]);return s}()),groups:new e.Map(function(){var e,n,i,s;for(i=t.groups,s=[],e=0,n=i.length;n>e;e++)o=i[e],r=oe(o),s.push([r.memberKey(),r]);return s}()),users:new e.Map(function(){var e,n,o,i;for(o=t.users,i=[],e=0,n=o.length;n>e;e++)s=o[e],r=Ae(s),i.push([r.memberKey(),r]);return i}()),memberCount:n})},re=function(e){var t,n;return t=e.invitee[".tag"],new y({access_type:z(W.parse(e.access_type)),contact:e.invitee[t],contact_type:t,initials:e.initials,is_inherited:e.is_inherited,permissions:_e(e.permissions),same_team:Boolean(null!=(n=e.user)?n.same_team:void 0)})},oe=function(e){return new v({access_type:z(W.parse(e.access_type)),group_external_id:e.group.group_external_id,group_id:e.group.group_id,group_name:e.group.group_name,group_type:e.group.group_type[".tag"],initials:e.initials,is_inherited:e.is_inherited,is_owner:e.group.is_owner,member_count:e.group.member_count,permissions:_e(e.permissions),same_team:e.group.same_team})},Ae=function(e){return new j({access_type:z(W.parse(e.access_type)),account_id:e.user.account_id,initials:e.initials,is_inherited:e.is_inherited,permissions:_e(e.permissions),same_team:e.user.same_team,team_member_id:e.user.team_member_id})},_e=function(e){var t,n,o,i,r;if(o={},null!=e)for(t=0,n=e.length;n>t;t++)i=e[t],o[i.action[".tag"]]=new D({allow:i.allow,reason:null!=(r=i.reason)?r[".tag"]:void 0});return new R(o)},he=function(e){return new A(e)},pe=function(e,t){var n,o,i,r,s;if(!g.canActOnInheritedMembers(e))return new P;if(null!=t.access_details)for(r=[],s=t.access_details,n=0,o=s.length;o>n;n++)i=s[n],r.push(fe(i));return new P({access_level:null!=t.access_level?z(W.parse(t.access_level)):void 0,warning:t.warning,parentFolders:r})},fe=function(e){return new k({name:e.folder_name,shared_folder_id:e.shared_folder_id,permissions:_e(e.permissions)})},se=function(e){return new b({url:e.url,client_modified:null!=e.client_modified?new Date(e.client_modified):null,content_owner_team_info:null!=e.content_owner_team_info?new H(e.content_owner_team_info):null,expires:null!=e.expires?new Date(e.expires):null,file_type:e[".tag"],id:e.id,link_permissions:ae(e.link_permissions),name:e.name,path_lower:e.path_lower,rev:e.rev,server_modified:null!=e.server_modified?new Date(e.server_modified):null,size:e.size,team_member_info:Ie(e.team_member_info),preview_type:e.preview_type})},ae=function(e){var t,n,o,i;return null==e?new w:new w({allow_download:e.allow_download,allow_comments:e.allow_comments,can_allow_download:e.can_allow_download,can_disallow_download:e.can_disallow_download,can_revoke:e.can_revoke,can_set_expiry:e.can_set_expiry,can_remove_expiry:e.can_remove_expiry,requested_visibility:null!=(t=e.requested_visibility)?t[".tag"]:void 0,resolved_visibility:null!=(n=e.resolved_visibility)?n[".tag"]:void 0,restricting_shared_folder_path:e.restricting_shared_folder_path,revoke_failure_reason:null!=(o=e.revoke_failure_reason)?o[".tag"]:void 0,team_restricts_comments:e.team_restricts_comments,visibility_policies:null!=(i=e.visibility_policies)?i.map(Ne):void 0})},Ne=function(e){var t,n,o;return new T({policy:null!=(t=e.policy)?t[".tag"]:void 0,resolved_policy:null!=(n=e.resolved_policy)?n[".tag"]:void 0,allowed:e.allowed,disallowed_reason:null!=(o=e.disallowed_reason)?o[".tag"]:void 0})},Ie=function(e){return null==e?null:new q({display_name:e.display_name,member_id:e.member_id,team_info:null!=e.team_info?new H(e.team_info):null})},Y=function(e){return new u({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,is_teammate:e.is_teammate,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id})},ne=function(e){var t;return t=null!=e.team?new f({id:e.team.id,name:e.team.name,sharing_policies:Pe(e.team.sharing_policies)}):null,new m({account_id:e.account_id,disabled:e.disabled,display_name:e.name.display_name,email:e.email,email_verified:e.email_verified,familiar_name:e.name.familiar_name,given_name:e.name.given_name,profile_photo_url:e.profile_photo_url,surname:e.name.surname,team_member_id:e.team_member_id,team:t})},Pe=function(e){var t,n,o;return null==e?null:new V({shared_folder_member_policy:null!=(t=e.shared_folder_member_policy)?t[".tag"]:void 0,shared_folder_join_policy:null!=(n=e.shared_folder_join_policy)?n[".tag"]:void 0,shared_link_create_policy:null!=(o=e.shared_link_create_policy)?o[".tag"]:void 0})},Ce=function(e){return new B({add_message_as_comment_checked:e.add_message_as_comment_checked,add_message_as_comment_help_shown:e.add_message_as_comment_help_shown,access_reader_no_comment_content_links:e.access_reader_no_comment_content_links,access_reader_no_comment_shared_folders:e.access_reader_no_comment_shared_folders})},be=function(e){var t;return t={},t[O.policy_name]=(null!=e?e[".tag"]:void 0)||O.enabled,new p(t)},ce=function(e){return"email"===e.type?"email:"+e.value:e.value},de=function(e){return e.startsWith("email:")?new G("email",e.substr(6)):new G("dropbox_id",e)},ye=function(e){var t,n,o,i,r;if(o=[],null!=e)for(t=0,n=e.length;n>t;t++)i=e[t],o.push(new N({action:i.action[".tag"],allow:i.allow,reason:null!=(r=i.reason)?r[".tag"]:void 0}));return o},Ee=function(e){var n,o,i;return null!=e?(i=W.parse(e.link_permissions.resolved_visibility).type,o=null!=e.team_member_info?{teamId:e.team_member_info.team_info.id,teamName:e.team_member_info.team_info.name}:{teamId:null,teamName:null},n={isFolder:"folder"===e[".tag"],url:e.url,name:e.name,expires:null!=e.expires?new Date(e.expires):null,visibility:i,isPackage:e.is_package},t.extend(n,o),new E(n)):null},ve=ee,ge=function(e){var t,n,o,i;for(o={},t=0,n=e.length;n>t;t++)i=e[t],o[c[i.action[".tag"]]]=i.allow;return o},Q=function(e){var t;return function(){var n,i,r;for(r=[],n=0,i=e.length;i>n;n++)if(t=e[n],t.type===o.NEW_STYLE_GROUP)r.push(new G("dropbox_id",t.getContactID()));else{if(t.type===o.INVALID)throw new Error("Unknown contact type");r.push(new G("email",t.getContactID()))}return r}()},Te=function(e){var t;return new x({action:e.action[".tag"],allow:e.allow,reason:null!=(t=e.reason)?t[".tag"]:void 0
})},we=function(t){var n;return new F({audience_options:e.Set(function(){var e,o,i,r;for(i=t.audience_options,r=[],e=0,o=i.length;o>e;e++)n=i[e],r.push(n[".tag"]);return r}()),current_audience:t.current_audience[".tag"],expiry:null!=t.expiry?new Date(t.expiry):null,link_permissions:e.List(t.link_permissions.map(Te)),password_protected:t.password_protected,url:t.url})},Se=function(e){if(null!=e.remove_expiry&&null!=e.set_expiry)throw Error("Cannot set both remove_expiry and set_expiry");if(null!=e.remove_password&&null!=e.set_password)throw Error("Cannot set both remove_password and set_password");return{audience:new G(e.audience).toJSON(),expiry:null!=e.remove_expiry?new G("remove_expiry").toJSON():null!=e.set_expiry?new G("set_expiry",te(e.set_expiry)).toJSON():void 0,password:null!=e.remove_password?new G("remove_password").toJSON():null!=e.set_password?new G("set_password",e.set_password).toJSON():void 0}},{accessLevelApiToConst:z,accessLevelConstToApi:K,accountInfoApiToRecord:Y,contactsToMembers:Q,fileMetadataApiToRecord:Z,filePermissionsApiToRecord:$,folderMetadataApiToRecord:J,folderPermissionsApiToRecord:X,folderPolicyApiToRecord:ee,fullAccountApiToRecord:ne,groupMembershipApiToRecord:oe,hasFolderMetadataRecordInMetadata:ie,inviteeMembershipApiToRecord:re,linkMetadataApiToRecord:se,linkPermissionsApiToRecord:ae,listFilesResultApiToRecord:le,listFoldersResultApiToRecord:ue,makeMemberId:ce,makeMemberSelector:de,memberAccessLevelApiToRecord:pe,memberCountsApiToRecord:he,memberPermissionsApiToRecord:_e,membershipApiToRecord:me,parseFolderPermissions:ge,parseFolderPolicy:ve,parseMemberPermissions:ye,parseSharedLinkMetadata:Ee,sharedContentLinkMetadataToRecord:we,sharedContentLinkPermissionToRecord:Te,sharedContentLinkSettingsToApi:Se,sharingPrefsApiToRecord:Ce,teamMemberInfoApiToRecord:Ie,teamSharingPoliciesApiToRecord:Pe,userMembershipApiToRecord:Ae,visibilityPolicyApiToRecord:Ne}})}.call(this),function(){define("modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal",["external/purify","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/clean/sharing/keep_a_copy_modal","modules/core/i18n"],function(e,t,n,o,i,r){var s,a,l,u;return a=n.SimpleModal,s=o.MEMBER_ACTION,l=r.i18n_default_project("sharing")._,u=function(n,o,r,u,c,d,p){var h,_,m,f,g,v;return m={name:t.em_snippet(n,40)},o===s.REMOVE?(v=l("Remove access for %(name)s?").format(m),r?(h=u?l("<strong>%(name)s</strong> may still have access to this folder through a company group or parent folder.").format(m):l("If you remove <strong>%(name)s</strong>, they won’t be able to see future changes to these files.").format(m),c&&(f=l("%(name)s should be able to keep a copy of these files").format(m))):h=l("If you continue, <strong>%(name)s</strong> will lose access to this file.").format(m),_=l("Remove")):(v=l("Make %(name)s the owner of this folder?").format(m),h=l("Only <strong>%(name)s</strong> will be able to unshare this folder or change folder settings.").format(m),_=l("Make owner")),g={autoclose:!1,title_text:v,body_html:e.sanitize(h),option_text:f,confirm_text:_,cancel_text:l("Cancel"),confirm_callback:d,cancel_completed_callback:p},f?i.show(g):a.show(g)},{showMemberAccessChangeConfirmationModal:u}})}.call(this),function(){define("modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal",["external/purify","modules/clean/react/modal","modules/clean/sharing/keep_a_copy_modal","modules/core/i18n"],function(e,t,n,o){var i,r,s;return i=t.SimpleModal,r=o.i18n_default_project("sharing")._,s=function(t,o,s,a,l){var u,c,d,p,h;return t?(h=r("Remove your access to this folder?"),u=r(o?"You may still have access to this folder through a company group or parent folder.":"If you continue, you won’t be able to access this folder anymore."),l&&(d=r("Keep a copy of this folder"))):(h=r("Remove your access to this file?"),u=r("If you continue, you won’t be able to access this file anymore.")),c=r("Remove my access"),p={autoclose:!1,title_text:h,body_html:e.sanitize(u),option_text:d,confirm_text:c,cancel_text:r("Cancel"),confirm_callback:s,cancel_completed_callback:a},d?n.show(p):i.show(p)},{showRelinquishMembershipConfirmationModal:s}})}.call(this),function(){define("modules/clean/sharing/confirmation_modals/unshare_folder_confirmation_modal",["external/purify","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/clean/sharing/keep_a_copy_modal","modules/core/i18n"],function(e,t,n,o,i,r){var s,a,l,u;return a=n.SimpleModal,s=o.SNIPPET_SIZES,l=r.i18n_default_project("sharing")._,u=function(n,o,r){var u,c,d;return c=!0,null!=n.parent_shared_folder_id&&null!=n.owner_team?d={body:l("Resetting membership will remove people outside of your Dropbox team. People on your Dropbox team will still have access."),confirm:l("Reset membership"),title:l("Reset membership for “%(folder_name)s”").format({folder_name:t.em_snippet(n.name,s.FILENAME)})}:n.is_team_folder?(d={body:l("Only admins will be able to see the folder or access its contents. Unsharing will also convert this team folder into a regular shared folder, and you’ll be the owner."),confirm:l("Unshare"),title:l("Unshare “%(folder_name)s” team folder?").format({folder_name:t.em_snippet(n.name,s.FILENAME)})},c=!1):d={body:l("Everyone else will lose access to this folder. You’ll still keep a copy of this folder in your Dropbox."),confirm:l("Unshare"),title:l("Unshare “%(folder_name)s”?").format({folder_name:t.em_snippet(n.name,s.FILENAME)})},u={autoclose:!1,body_html:e.sanitize(d.body),cancel_completed_callback:r,cancel_text:l("Cancel"),confirm_callback:o,confirm_text:d.confirm,option_text:l("I want my collaborators to keep a copy of these files."),title_text:d.title},c?i.show(u):a.show(u)},{showUnshareFolderConfirmationModal:u}})}.call(this),function(){define("modules/clean/sharing/constants",["external/underscore","modules/constants/sharing"],function(e,t){var n,o,i;return n={ACCESS_NO_ACCESS:0,ACCESS_READER_NO_COMMENT:-10,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},o={PUBLIC:1,TEAM_ONLY:2,PASSWORD:3},i={ACCESS_LEVEL:{OWNER:"owner",WRITER:"writer",READER:"reader",READER_NO_COMMENT:"reader_no_comment"},MEMBER_ACTION:{LEAVE_A_COPY:"leave_a_copy",MAKE_EDITOR:"make_editor",MAKE_OWNER:"make_owner",MAKE_VIEWER:"make_viewer",MAKE_VIEWER_NO_COMMENT:"make_viewer_no_comment",REMOVE:"remove",ALL:["leave_a_copy","make_editor","make_owner","make_viewer","make_viewer_no_comment","remove"]},SNIPPET_SIZES:{FILENAME:30,DISPLAY_NAME:30,EMAIL:30,OUT_OF_QUOTA_FOLDER_NAME:15},NameSpaceAccess:n,SHMODEL_LINK_TOKEN_VISIBILITY:o,VALIDATE_PATH_PERMISSIONS:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership"},VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE:{change_options:"canChangeOptions",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unshare:"canUnshareFolder",update_confidentiality:"canUpdateConfidentiality",relinquish_membership:"canRelinquishMembership"},FOLDER_METADATA_PERMISSIONS:{change_options:"canChangeOptions",edit_contents:"canEditContents",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unmount:"canUnmountFolder",unshare:"canUnshareFolder",relinquish_membership:"canRelinquishMembership",leave_a_copy:"leaveACopy"},FOLDER_METADATA_PERMISSIONS_INTERNAL:{change_options:"canChangeOptions",edit_contents:"canEditContents",invite_editor:"canInviteEditor",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",unmount:"canUnmountFolder",unshare:"canUnshareFolder",update_confidentiality:"canUpdateConfidentiality",relinquish_membership:"canRelinquishMembership",leave_a_copy:"leaveACopy"},ALPHA_FILE_METADATA_PERMISSIONS:{change_options:"canChangeOptions",invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",relinquish_membership:"canRelinquishMembership"},FILE_METADATA_PERMISSIONS:{invite_viewer:"canInviteViewer",invite_viewer_no_comment:"canInviteViewerNoComment",relinquish_membership:"canRelinquishMembership"}},i.ACCESS_VALUES=e.values(i.ACCESS_LEVEL),e.extend(i,t),i})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/content_info",["external/immutable","modules/constants/python"],function(t,n){var o,i,r;return o=t.Record({extras:null,id:null,metadata:null},"ContentInfo"),i=t.Record({exists:!0,fileId:null,fqPath:null,isFolder:null,isTeamSharedFolder:!1,modalSessionId:null,nsId:null,nsPath:null,origin:null,targetNsId:null,userRootNs:null,teamGroupInfo:null},"ContentInfoExtras"),o.prototype.setNsId=function(e){var t;return t=this.setIn(["extras","targetNsId"],e),t.set("id",r(t.extras))},o.prototype.setFQPath=function(e){var t;return t=this.setIn(["extras","fqPath"],e),t.set("id",r(t.extras))},o.prototype.isFolder=function(){return this.extras.isFolder},o.prototype.isFile=function(){return!this.isFolder()},o.prototype.isFileFolder=function(){return this.isFolder()&&!this.isSharedFolder()},o.prototype.isSharedFolder=function(){return Boolean(this.extras.targetNsId)},o.prototype.isTeamSharedFolder=function(){return this.extras.isTeamSharedFolder},o.prototype.isInSharedFolder=function(){return Boolean(null!=this.extras.nsId&&this.extras.nsId!==this.extras.userRootNs)},o.prototype.isNestedSharedFolder=function(){return this.isInSharedFolder()&&this.isSharedFolder()},o.prototype.isOSXPackage=function(){var t,o;return o=this.extras.fqPath,t=o.substr(o.lastIndexOf(".")),e.call(n.PACKAGE_EXTS,t)>=0},o.prototype.pathExists=function(){return Boolean(this.extras.exists)},o.prototype.name=function(){var e;return null!=(e=this.displayPath())?e.split("/").pop():void 0},o.prototype.idForLink=function(){var e;if(e=this.extras.fileId||this.extras.fqPath,!e)throw new Error("No identifiers for getting links");return e},o.prototype.sharedFolderId=function(){var e;if(e=this.extras.targetNsId,!e)throw new Error("No shared folder ID");return e},o.prototype.displayPath=function(){return this.extras.fqPath},o.prototype.nsId=function(){if(null==this.extras.nsId)throw new Error("Can't determine nsId");return this.extras.nsId},o.prototype.nsPath=function(){if(null==this.extras.nsPath)throw new Error("Can't determine nsPath");return this.extras.nsPath},o.prototype.teamGroupInfo=function(){var e;return null!=(e=this.extras)?e.teamGroupInfo:void 0},o.createFromParams=function(e){var t;return t=new i(e),new o({extras:t,id:r(t)})},r=function(e){var t;if(t=e.isFolder?e.targetNsId||e.fqPath:e.fileId||e.fqPath,!t)throw new Error("Not enough fields provided for extras");return t},{ContentInfo:o,ContentInfoExtras:i}})}.call(this),function(){define("modules/clean/sharing/delete_link_modal",["modules/clean/ajax","modules/clean/em_string","modules/clean/react/modal","modules/clean/sharing/constants","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r){var s,a,l,u,c;return s=n.Modal,a=n.SimpleModal,l=i.i18n_default_project("sharing")._,u=function(e){var n,i,u,c,d,p,h,_;return n=e.client,_=e.url,i=e.contentName,d=null!=(p=e.onDeleteLink)?p:null,c=null!=(h=e.onCancel)?h:null,i=t.em_snippet(i,o.SNIPPET_SIZES.FILENAME),u=function(){return n.revokeSharedLink({url:_}).then(function(){var e;return e=l("Deleted link to “%(name)s”").format({name:i}),r.success(e),s.close(),"function"==typeof d?d():void 0})},a.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:c,cancel_text:l("Cancel"),confirm_callback:u,confirm_text:l("Delete link"),title_text:l("Delete link to “%(name)s”?").format({name:i})})},c=function(n){var i,u,c,d,p,h,_,m;return i=n.client,m=n.tkey,u=n.contentName,p=null!=(h=n.onDeleteLink)?h:null,d=null!=(_=n.onCancel)?_:null,u=t.em_snippet(u,o.SNIPPET_SIZES.FILENAME),c=function(){return e.WebRequest({url:"/sm/disable/"+m,type:"POST",data:{tkey:m},subject_user:i.userId,success:function(){var e;return e=l("Deleted link to “%(name)s”").format({name:u}),r.success(e),s.close(),"function"==typeof p?p():void 0}})},a.show({autoclose:!1,body_html:l("This link will no longer work for anyone who has it."),cancel_completed_callback:d,cancel_text:l("Cancel"),confirm_callback:c,confirm_text:l("Delete link"),title_text:l("Delete link to “%(name)s”?").format({name:u})})},{deleteLinkWithConfirm:u,deleteLinkWithConfirmLegacy:c}})}.call(this),function(){define("modules/clean/sharing/file_settings_modal",["external/react","external/rsvp","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/settings_modal_components","modules/clean/user","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E,b,w,T,S,C,I,P;return y=t.Promise,S=n.catchApiError,g=i.Modal,P=r.setStatePromise,f=s.FileShareApiClient,h=a.FilePolicy,v=a.PassPolicy,E=l.SNIPPET_SIZES,b=u.SettingsModalButtons,w=u.SinglePolicyControl,C=e.createElement,I=e.DOM,T=d.i18n_default_project("sharing")._,_=e.createClass({displayName:"FileSettingsModal",propTypes:{fileName:e.PropTypes.string.isRequired,canChangeOptions:e.PropTypes.bool,contentId:e.PropTypes.string.isRequired,initialPolicy:e.PropTypes.instanceOf(h).isRequired,onCancel:e.PropTypes.func,onPolicySet:e.PropTypes.func,ownerTeam:e.PropTypes.shape({id:e.PropTypes.string.isRequired,name:e.PropTypes.string.isRequired}),user:e.PropTypes.instanceOf(c).isRequired},getInitialState:function(){return{isSubmitting:!1,desiredPolicy:this.props.initialPolicy}},render:function(){var e;return e=this.props.canChangeOptions?C(b,{disableSave:!1,isAccepting:this.state.isSubmitting,onAccept:this._handleAcceptClick,onDismiss:this._handleDismissClick}):null,C(g,{autoClose:!1,className:"file-settings-modal",buttonComponent:I.span(),onDismissCompleted:this._handleDismissCompleted,title:T("“%(file_name)s” settings").format({file_name:o.em_snippet(this.props.fileName,E.FILENAME)})},C(m,{canChangeOptions:this.props.canChangeOptions,desiredPolicy:this.state.desiredPolicy,buttons:e,onPolicyUpdate:this._handlePolicyUpdate}))},_getClient:function(){return new f({userId:this.props.user.id})},_handleAcceptClick:function(){var e,t;return t=this._getPolicyUpdate(),null!=t?P(this,{isSubmitting:!0}).then(function(e){return function(){return e._getClient().updatePolicy({contentId:e.props.contentId,newPolicy:t})}}(this)).catch(S(function(e){return function(){return e.setState({isSubmitting:!1}),y.reject()}}(this))).then(function(e){return function(){var n;return p.success(T("File settings updated")),"function"==typeof(n=e.props).onPolicySet?n.onPolicySet(t):void 0}}(this)):"function"==typeof(e=this.props).onPolicySet?e.onPolicySet(null):void 0},_handleDismissClick:function(){var e;return g.close(),"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleDismissCompleted:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handlePolicyUpdate:function(e,t){return this.setState({desiredPolicy:this.state.desiredPolicy.set(e,t)})},_getPolicyUpdate:function(){return this.state.desiredPolicy.equals(this.props.initialPolicy)?null:this.state.desiredPolicy}}),m=e.createClass({displayName:"FileSettingsModalContents",propTypes:{desiredPolicy:e.PropTypes.instanceOf(h).isRequired,canChangeOptions:e.PropTypes.bool.isRequired,buttons:e.PropTypes.element,onPolicyUpdate:e.PropTypes.func},getDefaultProps:function(){return{desiredPolicy:null,buttons:null,onPolicyUpdate:null}},render:function(){return I.div({className:"file-settings-form"},this._renderHeader(),this._renderPolicies(),this.props.buttons)},_renderHeader:function(){return this.props.canChangeOptions?void 0:I.div({className:"u-pad-xs u-font-center u-mar-bottom-s file-settings-form__no-permission-banner"},T("You don’t have permission to change the settings on this file."))},_renderPolicies:function(){return I.div({},C(w,{canChange:this.props.canChangeOptions,policyName:v.policy_name,policyDescription:T("Show who accessed this file?"),currentValue:this.props.desiredPolicy[v.policy_name],options:[{label:T("Only show to people on your Dropbox team"),value:v.enabled},{label:T("Don’t show"),value:v.disabled}],handleOptionChange:this._handleOptionChange}))},_handleOptionChange:function(e){var t;return"function"==typeof(t=this.props).onPolicyUpdate?t.onPolicyUpdate(e.target.name,e.target.value):void 0}}),{FileSettingsModal:_,FileSettingsModalContents:m}})}.call(this),function(){define("modules/clean/sharing/folder_settings_modal",["external/classnames","external/immutable","external/purify","external/react","external/rsvp","external/underscore","modules/clean/api_v2/error","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/react/browse/constants","modules/clean/react/css","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/sharing/keep_a_copy_modal","modules/clean/sharing/settings_modal_components","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/confirmation_modals/unshare_folder_confirmation_modal","modules/clean/user","modules/constants/python","modules/core/i18n","modules/core/uri","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S){var C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$,J,X;return O=i.Promise,Y=s.catchApiError,C=u.BrowseActionTypes,H=u.SharedWithActionTypes,k=d.Modal,q=d.SimpleModal,J=p.setStatePromise,F=h.SNIPPET_SIZES,R=_.GoldenGate,$=_.genContentManagerBridgeUri,x=f.SettingsModalButtons,V=f.SinglePolicyControl,N=g.FolderShareApiClient,A=g.FolderPolicy,M=g.ShareApiClient,G=g.TeamSharingPolicies,L=v.SharedFolderMetadata,X=y.showUnshareFolderConfirmationModal,W=b.TRADEMARK_BUSINESS,Q=o.createElement,Z=o.DOM,j=w.i18n_default_project("sharing")._,I={shared_folder_member_policy:"team"},P={shared_folder_member_policy:"team"},D={member_policy:"shared_folder_member_policy"},K=function(e,t,n,o,i,r,s){var a,l,u,c,d;return null==s&&(s=void 0),c=D[e],null!=c&&null!=n&&(d=n.get(c)),l=null!=(u=null!=s?s.get(e):void 0)?u:o.get(e),a=t.canChangeOptions,null!=d&&I[c]===d&&(a=!1,l=P[c]),r&&(a=!1),[l,a]},U=o.createClass({displayName:"SharedFolderSettingsModal",propTypes:{altAction:o.PropTypes.node,folderName:o.PropTypes.string.isRequired,folderId:o.PropTypes.string,folderPath:o.PropTypes.string,initialHasParentSharedFolder:o.PropTypes.bool,initialIsTeamSharedFolder:o.PropTypes.bool,initialMetadata:o.PropTypes.instanceOf(L),initialOwnerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),initialPermissions:o.PropTypes.shape({canChangeOptions:o.PropTypes.bool,canUnshareFolder:o.PropTypes.bool}),initialPolicy:o.PropTypes.instanceOf(A),isFolderInsideTeamFolderTree:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isSharedFolder:o.PropTypes.bool,onCancel:o.PropTypes.func,onPolicySet:o.PropTypes.func,onUnshare:o.PropTypes.func,showContentManagerBridge:o.PropTypes.bool,isInContentManager:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(G),user:o.PropTypes.instanceOf(E).isRequired},getInitialState:function(){return{currentPolicy:this.props.initialPolicy,folderPermissions:this.props.initialPermissions,hasParentSharedFolder:this.props.initialHasParentSharedFolder,isLoading:!(null!=this.props.initialPolicy&&null!=this.props.initialPermissions),isPolicyChangeRecursive:this._hasRecursivePolicyChanges(this.props.initialIsTeamSharedFolder,this.props.initialHasParentSharedFolder),isSubmitting:!1,isTeamSharedFolder:this.props.initialIsTeamSharedFolder,metadata:this.props.initialMetadata,teamPolicy:this.props.teamPolicy,newPolicy:this.props.initialPolicy,ownerTeam:this.props.initialOwnerTeam}},componentDidMount:function(){return this.state.isLoading?this._fetchInitialState():void 0},render:function(){var t,n,o,i;return t=null!=(o=this.state.folderPermissions)?o.canChangeOptions:void 0,n=this._getPolicyUpdate(),i=t?Q(x,{disableSave:null==n,isAccepting:this.state.isSubmitting,onAccept:this._handleAcceptClick,onDismiss:this._handleDismissClick}):null,Q(k,{altAction:this.props.altAction,autoClose:!1,className:e({"shared-folder-settings-modal":!0,"shared-folder-settings-modal--no-permissions":!t}),buttonComponent:Z.span(),onDismissCompleted:this._handleDismissCompleted,title:this.state.isTeamSharedFolder?j("“%(folder_name)s” team folder settings").format({folder_name:a.em_snippet(this.props.folderName,F.FILENAME)}):j("“%(folder_name)s” settings").format({folder_name:a.em_snippet(this.props.folderName,F.FILENAME)})},this.state.isLoading?Z.div({className:"shared-folder-settings-modal__loading-text"},j("Loading...")):Q(B,{currentPolicy:this.state.currentPolicy,folderId:this.props.folderId,folderName:this.props.folderName,folderPath:this.props.folderPath,folderPermissions:this.state.folderPermissions,hasParentSharedFolder:this.state.hasParentSharedFolder,isFolderInsideTeamFolderTree:this.props.isFolderInsideTeamFolderTree,isInContentManager:this.props.isInContentManager,isLimitedTeam:this.props.isLimitedTeam,isSharedFolder:this.props.isSharedFolder,isTeamSharedFolder:this.state.isTeamSharedFolder,updateSettingsButtons:i,onPolicyUpdate:this._handlePolicyUpdate,onUnshare:this._handleUnshareFolder,ownerTeam:this.state.ownerTeam,showContentManagerBridge:this.props.showContentManagerBridge,shouldHideHeader:this.state.shouldHideHeader,teamPolicy:this.state.teamPolicy,policyUpdate:this._getPolicyUpdate()}))},_getClient:function(){return new N({userId:this.props.user.id})},_fetchFolderMetadata:function(){var e;return e=[{".tag":"change_options"},{".tag":"unshare"}],null!=this.props.folderId?this._getClient().getMetadata({contentId:this.props.folderId,actions:e}):this._getClient().validatePath({fqPath:this.props.folderPath,actions:e}).then(function(e){var t;return t=e.metadata})},_fetchInitialState:function(){return this._fetchFolderMetadata().then(function(e){return function(t){var n,o,i,r,s,a,l,u;return e.isMounted()?(n=t.policy,o={hasParentSharedFolder:null!=t.parent_shared_folder_id,isTeamSharedFolder:t.is_team_folder,shouldHideHeader:"folder_is_limited_team_folder"===(null!=(i=t.permissions)&&null!=(r=i.change_options)?r.reason:void 0),isLoading:!1,folderPermissions:{canChangeOptions:null!=(s=t.permissions)&&null!=(a=s.change_options)?a.allow:void 0,canUnshareFolder:null!=(l=t.permissions)&&null!=(u=l.unshare)?u.allow:void 0},newPolicy:n,ownerTeam:t.owner_team,metadata:t},null!=e.props.folderId&&(o.currentPolicy=n),o.isPolicyChangeRecursive=e._hasRecursivePolicyChanges(o.isTeamSharedFolder,o.hasParentSharedFolder),J(e,o)):void 0}}(this)).catch(Y(function(){return k.close()}))},_hasRecursivePolicyChanges:function(e,t){return R.canDeepNest(this.props.user.id)&&(e||t)},_handlePolicyUpdate:function(e,t){return this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_handleAcceptClick:function(){var e,t,o;return t=this._getPolicyUpdate(),null!=t?(e=function(e){return function(){var n;return n=e.props.onPolicySet,(e.isMounted()?J(e,{isSubmitting:!0}):O.resolve()).then(function(){var n;return n=function(e){return S.success(j("Folder settings updated")),O.resolve({policyUpdate:t,sharedFolderMetadata:e})},null!=e.props.folderId?e._getClient().updatePolicy({contentId:e.props.folderId,newPolicy:t}).then(n):e._getClient().share({fqPath:e.props.folderPath,folderPolicy:t}).then(n)}).then(function(e){var t,o;return t=e.policyUpdate,o=e.sharedFolderMetadata,"function"==typeof n?n(t,o):void 0}).catch(Y(function(){return e.isMounted()?e.setState({isSubmitting:!1}):void 0}))}}(this),this.state.isPolicyChangeRecursive?(o=this.props,q.show({title_text:j("Save settings?"),body_html:this.state.isTeamSharedFolder?n.sanitize(j("Your changes will be applied to this team folder and any folders inside it.")):n.sanitize(j("Your changes will be applied to this folder and any folders inside it.")),confirm_text:j("Save settings"),cancel_text:j("Cancel"),autoclose:!1,confirm_callback:e,cancel_completed_callback:function(){return k.showInstance(Q(U,o))}})):e()):void 0},_handleDismissClick:function(){var e;return k.close(),"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleDismissCompleted:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0},_handleUnshareFolder:function(){var e,t,n;return null!=this.props.folderId&&(null!=(n=this.state.folderPermissions)?n.canUnshareFolder:void 0)?(e=function(e){return function(t){var n,o;return n=e.state.isTeamSharedFolder,o=n?e._getClient().downgradeTeamFolder({contentId:e.props.folderId}):e._getClient().unshare({contentId:e.props.folderId,leaveACopy:t}),o.then(function(){return S.success(j("Unshared “%(folder_name)s”").format({folder_name:e.props.folderName})),k.close(),n?(l.dispatch({type:C.TEAM_FOLDER_DOWNGRADE,data:{nsId:e.props.folderId}}),l.dispatch({type:H.SIGNAL_SHARED_FOLDER_DATA_OUT_OF_DATE,data:{}})):void 0})}}(this),t=function(e){return function(){return k.showInstance(Q(U,e))}}(this.props),X(this.state.metadata,e,t)):void 0},_getPolicyUpdate:function(){var e,t,n;return n=null,null==this.state.newPolicy&&null==this.state.currentPolicy?null:(t=0,e={},this.state.newPolicy.forEach(function(n){return function(o,i){var r,s,a,l;return a=K(i,n.state.folderPermissions,n.state.teamPolicy,n.state.currentPolicy,n.state.isTeamSharedFolder,n.props.showContentManagerBridge),s=a[0],r=a[1],r?(null!=s&&s===o||(t+=1),e[i]=null!=(l=n.state.newPolicy.get(i))?l:s):void 0}}(this)),t>0&&(n=new A(e)),n)}}),z=o.createClass({displayName:"SharedFolderSettingsModalContents",propTypes:{currentPolicy:o.PropTypes.instanceOf(A),folderId:o.PropTypes.string,folderName:o.PropTypes.string.isRequired,folderPath:o.PropTypes.string,folderPermissions:o.PropTypes.shape({canChangeOptions:o.PropTypes.bool,canUnshareFolder:o.PropTypes.bool}).isRequired,hasParentSharedFolder:o.PropTypes.bool,isLimitedTeam:o.PropTypes.bool,isSharedFolder:o.PropTypes.bool,isTeamSharedFolder:o.PropTypes.bool,updateSettingsButtons:o.PropTypes.element,onPolicyUpdate:o.PropTypes.func,onUnshare:o.PropTypes.func,ownerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),showContentManagerBridge:o.PropTypes.bool,shouldHideHeader:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(G),policyUpdate:o.PropTypes.instanceOf(A)},getDefaultProps:function(){return{currentPolicy:null,folderId:null,hasParentSharedFolder:!1,isTeamSharedFolder:!1,updateSettingsButtons:null,onPolicyUpdate:null,onUnshareFolder:null,ownerTeam:null,shouldHideHeader:!1,teamPolicy:null,policyUpdate:null}},render:function(){return Z.div({},this._renderHeader(),this._renderPolicies(),this._renderButtons())},_renderHeader:function(){var t,n,o;if(!this.props.shouldHideHeader)return t={"shared-folder-settings-form__team-folder-banner":!0,"u-pad-xs":!0,"u-font-center":!0,"u-mar-bottom-s":!0},n=Z.div({},j("These settings will apply to all folders inside “%(folder_name)s”.").format({folder_name:this.props.folderName})),this.props.isInContentManager?Z.div({className:e(t)},n):this.props.showContentManagerBridge?(o=$(this.props.isLimitedTeam,this.props.folderPath),Z.div({className:e(t)},n,Z.div({},j("You can change these settings in the Admin Console. "),Z.a({href:o.toString(),target:"_blank"},j("Open in new tab."))))):this.props.isTeamSharedFolder||this.props.hasParentSharedFolder?Z.div({className:e(t)},n,Z.div({},Z.a({href:"/team",target:"_blank"},j("To edit, ask your admin.")))):this.props.folderPermissions.canChangeOptions?void 0:Z.div({className:e(r.extend(t,{"shared-folder-settings-form__team-folder-banner":!1,"shared-folder-settings-form__no-permissions-banner":!0}))},j("You don’t have permission to change the settings on this folder."))},_renderPolicies:function(){var e,t;return t=null!=this.props.ownerTeam,e=this.props.isTeamSharedFolder||this.props.isFolderInsideTeamFolderTree,Z.div({},t?this._renderPolicy("member_policy",j(e?"Who can be added to folders?":"Who can be invited to this folder?"),[{label:j("Only people on your %(trademark_business)s account").format({trademark_business:W}),value:"team"},{label:j("Anyone"),value:"anyone"}]):void 0,this._renderPolicy("acl_update_policy",j(e?"Who can manage access to folders?":"Who can manage access to this folder?"),[{label:j(e?"Only admins":"Only owners"),value:"owner"},{label:t?j("Anyone on your %(trademark_business)s account with edit permissions").format({trademark_business:W}):j("People with edit permissions"),value:"editors"}]),t?this._renderPolicy("shared_link_policy",j(this.props.isTeamSharedFolder?"Allow members of this team folder to share links with others?":"Allow links to be shared with people outside of this folder?"),[{label:j("No"),value:"members"},{label:j("Yes"),value:"anyone"}]):void 0)},_renderPolicy:function(e,t,n){var o,i,r;return r=K(e,this.props.folderPermissions,this.props.teamPolicy,this.props.currentPolicy,this.props.isTeamSharedFolder,this.props.showContentManagerBridge,this.props.policyUpdate),i=r[0],o=r[1],Q(V,{canChange:o,policyName:e,policyDescription:t,currentValue:i,options:n,handleOptionChange:this._handleOptionChange})},_renderButtons:function(){var e,t,n,o;return e=null!=(n=this.props.folderPermissions)?n.canChangeOptions:void 0,t=null!=(o=this.props.folderPermissions)?o.canUnshareFolder:void 0,Z.div({className:"u-mar-top-m clearfix"},this.props.isSharedFolder&&t?Z.div({className:"u-l-fl"},Z.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:this.props.onUnshare},j(this.props.hasParentSharedFolder?"Reset membership":"Unshare folder"))):void 0,this.props.updateSettingsButtons)},_handleOptionChange:function(e){var t,n;return this.props.folderPermissions.canChangeOptions&&(null!=(n=this.props.policyUpdate)?n.get(e.target.name):void 0)!==e.target.value&&"function"==typeof(t=this.props).onPolicyUpdate?t.onPolicyUpdate(e.target.name,e.target.value):void 0}}),B=c(z,["/static/css/sharing/settings_modal-vfl9q6spX.css"],[V]),{SharedFolderSettingsModal:U,SharedFolderSettingsModalContents:B}})}.call(this),function(){define("modules/clean/sharing/keep_a_copy_modal",["external/purify","external/react","external/underscore","modules/clean/react/modal"],function(e,t,n,o){var i,r;return r=o.Modal,i=t.createClass({displayName:"KeepACopyModal",statics:{show:function(e){var n;return n={acceptButtonText:e.confirm_text,bodyHtml:e.body_html,dismissButtonText:e.cancel_text,optionText:e.option_text,onInputAccept:e.confirm_callback,onInputDismiss:e.cancel_callback,onInputDismissCompleted:e.cancel_completed_callback,title:e.title_text,width:e.width,autoClose:e.autoclose,style:e.style},r.showInstance(t.createElement(i,n))}},propTypes:{acceptButtonText:t.PropTypes.string,autoClose:t.PropTypes.bool,bodyHtml:t.PropTypes.string,dismissButtonText:t.PropTypes.string,optionText:t.PropTypes.string,onInputAccept:t.PropTypes.func,onInputDismiss:t.PropTypes.func,onInputDismissCompleted:t.PropTypes.func,style:t.PropTypes.oneOf(["default","clean","simple","lightbox","bare"]),title:t.PropTypes.string,width:t.PropTypes.number},getInitialState:function(){return{checked:!1}},render:function(){var o;return o=n.extend({},this.props,{className:"simple-modal",onAccept:function(e){return function(){var t;return"function"==typeof(t=e.props).onInputAccept?t.onInputAccept(e.state.checked):void 0}}(this),onDismiss:function(e){return function(){var t;return"function"==typeof(t=e.props).onInputDismiss?t.onInputDismiss(e.state.checked):void 0}}(this),onDismissCompleted:function(e){return function(){var t;return"function"==typeof(t=e.props).onInputDismissCompleted?t.onInputDismissCompleted(e.state.checked):void 0;
}}(this)}),t.createElement(r,o,t.DOM.div({className:"simple-modal-content"},t.DOM.div({dangerouslySetInnerHTML:{__html:e.sanitize(this.props.bodyHtml)}}),t.DOM.div({className:"u-mar-vertical-s"},t.DOM.input({checked:this.state.checked,onClick:this._handleOptionClick,type:"checkbox"})," ",this.props.optionText)))},_handleOptionClick:function(){return this.setState({checked:!this.state.checked})}})})}.call(this),function(){define("modules/clean/sharing/link_description",["external/react","modules/clean/em_string","modules/clean/react_format","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/core/i18n","modules/constants/sharing"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T;return b=n.reactFormat,a=o.LinkAudience,l=i.SNIPPET_SIZES,w=r.i18n_default_project("sharing"),u=w._,T=w.ungettext,f=e.DOM,y=function(e){return function(){switch(e){case"public":return u("Anyone with the link");case"team_only":return u("Only people on your Dropbox team");case"password":return u("Only people with the password");case"team_and_password":return u("Only people on your Dropbox team with the password");default:throw Error("Unknown visibility option "+e)}}()},g=function(e,n,o){return null==o&&(o=null),e?function(){switch(n){case"public":return u("Anyone with the link can comment.");case"team_only":return u("Only people on your Dropbox team can comment.");case"password":return u("Only people with the password can comment.");case"team_and_password":return u("Only people on your Dropbox team with the password can comment.");case"shared_folder_only":return u("Only members of the shared folder “%(shared_folder_name)s” can comment.").format({shared_folder_name:t.em_snippet(o,l.FILENAME)});case"only_you":return u("Only you can comment.");default:throw Error("Unknown visibility setting "+n)}}():u("No one can comment.")},E=function(e){switch(e.current_audience){case a.public:return u("Anyone with the link can view");case a.team:return u("Anyone on your Dropbox team with the link can view");case a.members:return u("Only members of this content can view");default:throw Error("Unknown link audience "+e.current_audience)}},v=function(e){return e.link_permissions.allow_download===!1?d(e):c(e)},c=function(e){return null!=e.expires?_(e):p(e)},d=function(e){return null!=e.expires?m(e):h(e)},p=function(e){return function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return b(u("Anyone with the link and password can <strong>view</strong> this folder"),{strong:f.strong()});case"public":return b(u("Anyone with the link can <strong>view</strong> this folder"),{strong:f.strong()});case"shared_folder_only":return b(u("Members of this folder with this link can <strong>view</strong> this folder"),{strong:f.strong()});case"team_and_password":return b(u("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder"),{strong:f.strong()});case"team_only":return b(u("Anyone on your Dropbox team with the link can <strong>view</strong> this folder"),{strong:f.strong()});case"only_you":return b(u("Only you can <strong>view</strong> via the link."),{strong:f.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return b(u("Anyone with the link and password can <strong>view</strong> this file"),{strong:f.strong()});case"public":return b(u("Anyone with the link can <strong>view</strong> this file"),{strong:f.strong()});case"shared_folder_only":return b(u("Members of the containing shared folder with the link can <strong>view</strong> this file"),{strong:f.strong()});case"team_and_password":return b(u("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file"),{strong:f.strong()});case"team_only":return b(u("Anyone on your Dropbox team with the link can <strong>view</strong> this file"),{strong:f.strong()});case"only_you":return b(u("Only you can <strong>view</strong> via the link."),{strong:f.strong()});default:throw Error("Unknown visibility setting")}}()},h=function(e){return function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return b(u("Anyone with the link and password can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:f.strong()});case"public":return b(u("Anyone with the link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:f.strong()});case"shared_folder_only":return b(u("Members of this folder with this link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:f.strong()});case"team_and_password":return b(u("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:f.strong()});case"team_only":return b(u("Anyone on your Dropbox team with the link can <strong>view</strong> this folder. (Downloading is turned off.)"),{strong:f.strong()});case"only_you":return b(u("Only you can <strong>view</strong> via the link. (Downloading is turned off.)"),{strong:f.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return b(u("Anyone with the link and password can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:f.strong()});case"public":return b(u("Anyone with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:f.strong()});case"shared_folder_only":return b(u("Members of the containing shared folder with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:f.strong()});case"team_and_password":return b(u("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:f.strong()});case"team_only":return b(u("Anyone on your Dropbox team with the link can <strong>view</strong> this file. (Downloading is turned off.)"),{strong:f.strong()});case"only_you":return b(u("Only you can <strong>view</strong> via the link. (Downloading is turned off.)"),{strong:f.strong()});default:throw Error("Unknown visibility setting")}}()},_=function(e){var t,n,o,i;return t=null!=e.expires?(n=e.expires-new Date,0>n?n=0:void 0,Math.floor(n/864e5)):null,i=null!=(o=e.teamInfo())?o.name:void 0,function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return b(T("Anyone with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"public":return b(T("Anyone with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"shared_folder_only":return b(T("Members of this folder with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Members of this folder with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"team_and_password":return b(T("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"team_only":return b(T("Anyone on your Dropbox team with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"only_you":return b(T("Only you can <strong>view</strong> via the link. (expires in <strong>a day</strong>)","Only you can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return b(T("Anyone with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"public":return b(T("Anyone with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"shared_folder_only":return b(T("Members of the containing shared folder with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","Members of the containing shared folder with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"team_and_password":return b(T("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"team_only":return b(T("Anyone on your Dropbox team with the link can <strong>view</strong> this file (expires in <strong>a day</strong>)","Anyone on your Dropbox team with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});case"only_you":return b(T("Only you can <strong>view</strong> via the link. (expires in <strong>a day</strong>)","Only you can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>)",t),{expires_days:t,strong:f.strong()});default:throw Error("Unknown visibility setting")}}()},m=function(e){var t,n,o,i,r;return o=864e5,t=null!=e.expires?(n=e.expires-new Date,0>n?n=0:void 0,Math.floor(n/o)):null,r=null!=(i=e.teamInfo())?i.name:void 0,function(){if(e.isFolder())switch(e.link_permissions.resolved_visibility){case"password":return b(T("Anyone with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"public":return b(T("Anyone with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"shared_folder_only":return b(T("Members of this folder with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","Members of this folder with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"team_and_password":return b(T("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone on your Dropbox team with the link and the password can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"team_only":return b(T("Anyone on your Dropbox team with the link can <strong>view</strong> this folder (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone on your Dropbox team with the link can <strong>view</strong> this folder (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"only_you":return b(T("Only you can <strong>view</strong> via the link. (expires in <strong>a day</strong>). (Downloading is turned off.)","Only you can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});default:throw Error("Unknown visibility setting")}else switch(e.link_permissions.resolved_visibility){case"password":return b(T("Anyone with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"public":return b(T("Anyone with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"shared_folder_only":return b(T("Members of the containing shared folder with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","Members of the containing shared folder with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"team_and_password":return b(T("Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone on your Dropbox team with the link and the password can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"team_only":return b(T("Anyone on your Dropbox team with the link can <strong>view</strong> this file (expires in <strong>a day</strong>). (Downloading is turned off.)","Anyone on your Dropbox team with the link can <strong>view</strong> this file (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});case"only_you":return b(T("Only you can <strong>view</strong> via the link. (expires in <strong>a day</strong>). (Downloading is turned off.)","Only you can <strong>view</strong> via the link. (expires in <strong>%(expires_days)s days</strong>). (Downloading is turned off.)",t),{expires_days:t,strong:f.strong()});default:throw Error("Unknown visibility setting")}}()},{formatLinkCommentingVisibility:g,formatLinkVisibilityOption:y,formatLinkDescription:v,formatSharedContentLinkDescription:E}})}.call(this),function(){define("modules/clean/sharing/link_info",[],function(){var e;return e=function(){function e(e){this.expires=e.expires,this.isFolder=e.isFolder,this.name=e.name,this.teamId=e.teamId,this.teamName=e.teamName,this.url=e.url,this.visibility=e.visibility,this.isPackage=e.isPackage}return e}(),{LinkInfo:e}})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/sharing/link_settings_modal",["external/classnames","external/immutable","external/react","external/underscore","modules/clean/api_v2/types","modules/clean/datetime","modules/clean/em_string","modules/clean/filepath","modules/clean/react/bubble_menu","modules/clean/react/calendar","modules/clean/react/css","modules/clean/react/modal","modules/clean/react_format","modules/clean/react/sprite","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/delete_link_modal","modules/clean/sharing/link_description","modules/clean/static_urls","modules/clean/user","modules/clean/previews/util","modules/constants/python","modules/core/i18n","modules/core/notify"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C){var I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$;return z=r.formatTimestamp,q=s.daysAfterToday,K=s.format_date,Y=s.localized_date_format,W=l.file_extension,I=u.BubbleMenu,P=u.BubbleMenuItem,R=p.Modal,Q=h.reactFormat,D=m.ShareApiClient,A=f.LinkMetadata,N=f.LinkPolicy,k=f.RequestedVisibilityPolicy,O=f.ResolvedVisibilityPolicy,M=f.VisibilityDisallowedReason,V=v.deleteLinkWithConfirm,G=y.formatLinkCommentingVisibility,j=y.formatLinkVisibilityOption,$=E.static_url,x=T.TRADEMARK_BUSINESS,B=o.createElement,H=o.DOM,L=S.i18n_default_project("sharing")._,U=o.createClass({displayName:"SharedLinkSettingsModal",propTypes:{client:o.PropTypes.instanceOf(D).isRequired,isFile:o.PropTypes.bool.isRequired,linkMetadata:o.PropTypes.instanceOf(A).isRequired,onClose:o.PropTypes.func,onDeleteLink:o.PropTypes.func,onPolicySet:o.PropTypes.func,showUpgradeToBiz:o.PropTypes.bool.isRequired},getInitialState:function(){var e,t,n;return t=this.props.linkMetadata.link_permissions.requested_visibility,n=this.props.linkMetadata.link_permissions.resolved_visibility,t===k.public&&n===O.team_only&&(t=k.team_only),e=N({requested_visibility:t,link_password:t===k.password?null:"",expires:this.props.linkMetadata.expires,allow_download:this.props.linkMetadata.link_permissions.allow_download}),{existingPolicy:e,isSubmitting:!1,newPolicy:e}},render:function(){var e;return e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.disallowed_reason===M.user_account_type}),e=e.length>0,B(R,{autoClose:!1,className:"shared-link-settings-modal",buttonComponent:H.span(),onDismissCompleted:this._handleDismissed,title:L("Link permissions for “%(content_name)s”").format({content_name:this.props.linkMetadata.name})},B(F,{canSubmit:!this.state.existingPolicy.equals(this.state.newPolicy),isFile:this.props.isFile,isSubmitting:this.state.isSubmitting,linkMetadata:this.props.linkMetadata,onCancel:this._dismissModal,onSubmit:this._saveSettings,onPolicyUpdate:this._handlePolicyUpdate,onDeleteLink:this._deleteLink,renderedPolicy:this.state.newPolicy,showUpgradeToBiz:this.props.showUpgradeToBiz,showUpgradeToPro:e}))},_handlePolicyUpdate:function(e,t){return"expires"===e&&null!=t&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59)),this.setState({newPolicy:this.state.newPolicy.set(e,t)})},_getModifiedSettings:function(){var e,t;if(t=this.state.newPolicy,t.requested_visibility===k.password){if(null==t.link_password)t=t.set("requested_visibility",null);else if(""===t.link_password)return C.error(L("Password can’t be empty")),null}else t=t.set("link_password",null);return e=this.props.linkMetadata.link_permissions.resolved_visibility,e===O.shared_folder_only&&(t=t.set("requested_visibility",null)),null!=t.expires&&(t=this.props.linkMetadata.link_permissions.can_set_expiry?t.set("expires",z(t.expires)):t.set("expires",null)),t.allow_download===this.state.existingPolicy.allow_download&&(t=t.set("allow_download",void 0)),{url:this.props.linkMetadata.url,settings:t,remove_expiration:null!=this.props.linkMetadata.expires&&null==this.state.newPolicy.expires}},_saveSettings:function(){var e;return e=this._getModifiedSettings(),null!=e?(this.setState({isSubmitting:!0}),this.props.client.modifySharedLinkSettings(e).catch(function(e){return function(){return e.setState({isSubmitting:!1}),Promise.reject()}}(this)).then(function(e){return function(t){var n;return C.success(L("Settings saved.")),"function"==typeof(n=e.props).onPolicySet&&n.onPolicySet(t),e._dismissModal()}}(this))):void 0},_dismissModal:function(){return R.close(),this._handleDismissed()},_handleDismissed:function(){var e;return"function"==typeof(e=this.props).onClose?e.onClose():void 0},_deleteLink:function(){var e,t;return t=function(e){return function(){var t;return"function"==typeof(t=e.props).onDeleteLink&&t.onDeleteLink(),e._handleDismissed()}}(this),e=function(e){return function(){return R.showInstance(B(U,e))}}(this.props),V({client:this.props.client,contentName:this.props.linkMetadata.name,onCancel:e,onDeleteLink:t,url:this.props.linkMetadata.url})}}),F=o.createClass({displayName:"SharedLinkSettingsModalContents",propTypes:{canSubmit:o.PropTypes.bool.isRequired,isFile:o.PropTypes.bool.isRequired,isSubmitting:o.PropTypes.bool.isRequired,linkMetadata:o.PropTypes.instanceOf(A).isRequired,onCancel:o.PropTypes.func,onSubmit:o.PropTypes.func,onPolicyUpdate:o.PropTypes.func,onDeleteLink:o.PropTypes.func,renderedPolicy:o.PropTypes.instanceOf(N).isRequired,showUpgradeToBiz:o.PropTypes.bool.isRequired,showUpgradeToPro:o.PropTypes.bool.isRequired},getInitialState:function(){return{selectedExpiry:null!=this.props.renderedPolicy.expires?this.props.linkMetadata.link_permissions.can_set_expiry?"custom":"read-only":"no-expiry"}},render:function(){return H.div({className:"shared-link-settings-modal__contents"},this._renderHeader(),this._renderPolicies(),this._renderButtons())},_renderHeader:function(){return this.props.showUpgradeToBiz?H.div({className:"shared-link-settings-modal__upgrade-to-biz-banner"},H.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-text"},L("Did you know %(trademark_business)s lets you add passwords and expiration dates to shared links?").format({trademark_business:x})),H.div({className:"shared-link-settings-modal__upgrade-to-biz-banner-cta"},H.a({className:"c-btn c-btn--secondary shared-link-settings-modal__upgrade-to-biz-banner-cta-button",href:"/business?tk=teams&camp=sharing_link_modal",target:"_blank"},L("Learn More")))):this.props.showUpgradeToPro?H.div({className:"shared-link-settings-modal__upgrade-to-pro-banner"},H.a({href:"/upgrade?oqa=sfp",target:"_blank"},L("Upgrade to Dropbox Pro to enable permission settings."))):void 0},_renderPolicies:function(){return H.div({},this._renderVisibilityPolicies(),this._renderExpiryPolicy(),this._renderDownloadPolicy(),this._renderCommentsPolicy())},_renderVisibilityPolicies:function(){var e;return e=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(e){return e.allowed||e.disallowed_reason===M.user_account_type}),this._renderFieldset(L("Who can view this link?"),e.length<2?this._renderRestrictedBySharedFolderVisibility():e.map(this._renderVisibilityOption))},_renderRestrictedBySharedFolderVisibility:function(){var e,t,n;return t=this.props.linkMetadata.link_permissions.resolved_visibility,e=this.props.linkMetadata.link_permissions.visibility_policies[0].disallowed_reason,H.span({},H.span({className:"shared-link-settings-modal__visibility-text"},function(){if(t===O.shared_folder_only)return n=this.props.linkMetadata.link_permissions.restricting_shared_folder_path,n=a.em_snippet(n,g.SNIPPET_SIZES.FILENAME),L("Only members of the shared folder “%(shared_folder_name)s” can view this link.").format({shared_folder_name:n});if(t===O.only_you)return L("Only you can view this link.");throw"Unexpected visibility "+t}.call(this))," ",H.span({className:"shared-link-settings-modal__visibility-advice u-font-meta"},function(){if(e===M.restricted_by_shared_folder)return L("To change who can access the link, go to the shared folder options.");if(e===M.delete_and_recreate)return L("To change who can access the link, delete this link and create a new one.");throw"Unexpected disallowed reason "+e}()))},_renderVisibilityOption:function(e){var n,o;return n=e.disallowed_reason===M.user_account_type,[H.label({className:t({"u-font-meta":!e.allowed}),key:"visibility-label"},H.input({checked:e.policy===this.props.renderedPolicy.requested_visibility,className:t((o={"shared-link-settings-modal__audience":!0},o["shared-link-settings-modal__audience-"+e.policy]=!0,o)),disabled:n,name:k.policy_name,onChange:function(e){return function(t){return e.props.onPolicyUpdate(t.target.name,t.target.value)}}(this),type:"radio",value:e.policy}),this._renderVisibilityLabelText(e)),e.policy===k.password&&this.props.renderedPolicy.requested_visibility===k.password?H.div({key:"password-input"},this._renderPasswordInput(n)):void 0]},_renderVisibilityLabelText:function(e){var n;return H.span({className:t((n={"shared-link-settings-modal__audience":!0},n["shared-link-settings-modal__audience-"+e.policy+"-label"]=!0,n))},j(e.resolved_policy))},_renderPasswordInput:function(e){var t,n;return n=null==this.props.renderedPolicy.link_password,H.div({className:"shared-link-settings-modal__password-container u-mar-left-m u-mar-right-xl u-mar-top-xs"},H.input({className:"shared-link-settings-modal__password-input c-input",disabled:e||n,name:"link_password",onChange:function(e){return function(t){return e.props.onPolicyUpdate(t.target.name,t.target.value)}}(this),placeholder:L("Set password"),value:null!=(t=this.props.renderedPolicy.link_password)?t:"123456",type:"password"}),n&&!e?H.button({className:"shared-link-settings-modal__password-change button-as-link",onClick:function(e){return function(){return e.props.onPolicyUpdate("link_password","")}}(this)},L("Change",{comment:"A link to change the password for the shared link"})):void 0)},_renderExpiryPolicy:function(){return this._renderFieldset(L("Add an expiry date to this link?"),H.div({},H.label({className:t({"shared-link-settings-modal__expiry-label-yes":!0,"u-font-meta":!this.props.linkMetadata.link_permissions.can_set_expiry})},H.input({checked:"no-expiry"!==this.state.selectedExpiry,className:"shared-link-settings-modal__expiry-option-yes",disabled:!this.props.linkMetadata.link_permissions.can_set_expiry,onChange:function(e){return function(){return"no-expiry"===e.state.selectedExpiry?e._handleExpirySelectChange(30):void 0}}(this),type:"radio"}),this._renderYesExpiryText()),H.label({className:t({"u-font-meta":!this.props.linkMetadata.link_permissions.can_remove_expiry})},H.input({checked:null==this.props.renderedPolicy.expires,className:"shared-link-settings-modal__expiry-option-no",disabled:!this.props.linkMetadata.link_permissions.can_remove_expiry,onChange:function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate&&t.onPolicyUpdate("expires",null),e.setState({selectedExpiry:"no-expiry"})}}(this),type:"radio"}),L("No"))))},_renderYesExpiryText:function(){var e,t;if(7===(e=this.state.selectedExpiry)||30===e)return H.span({className:"shared-link-settings-modal__expiry-text-yes"},L("Yes, expires in",{comment:'Label followed by a date range e.g. "Yes, expires in 7 days"'})," ",this._renderExpirySelect());if("custom"===(t=this.state.selectedExpiry)||"read-only"===t)return H.span({className:"shared-link-settings-modal__expiry-text-yes"},L("Yes, expires on",{comment:'Label followed by a date. e.g. "Yes, expires on 5/10/2017"'})," ","custom"===this.state.selectedExpiry?this._renderExpiryCustom():"read-only"===this.state.selectedExpiry?K(this.props.linkMetadata.expires,Y):void 0);if("no-expiry"===this.state.selectedExpiry)return H.span({className:"shared-link-settings-modal__expiry-text-yes"},L("Yes"));throw"Expiry policy is in an unknown state"},_renderExpirySelect:function(){var e;return B(I,{position:I.POSITIONS.BOTTOM,targetFixed:!0,items:function(){var t,n,o,i;for(o=[7,30,"custom"],i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(B(P,{onClick:function(e){return function(t){return function(){return e._handleExpirySelectChange(t)}}}(this)(e)},this._renderExpirySelectLabel(e)));return i}.call(this),targetButton:H.button({className:"shared-link-settings-modal__selected-expiry button-as-link"},this._renderExpirySelectLabel(this.state.selectedExpiry)," ",H.img({alt:"",className:"sprite sprite_web s_web_arrow-down-gray",src:$("/static/images/icons/icon_spacer-vflN3BYt2.gif")}))})},_renderExpirySelectLabel:function(e){if(7===e)return L("7 days",{comment:'as in "This link expires in 7 days"'});if(30===e)return L("30 days",{comment:'as in "This link expires in 30 days"'});if("custom"===e)return L("Custom date...",{comment:"Dropdown option for expiry date on a link. The user can choose 7 days, 30 days, or a custom expiry"});throw"Unknown selected expiry"},_handleExpirySelectChange:function(e){var t;return this.setState({selectedExpiry:e}),"custom"===e&&(e=30),"function"==typeof(t=this.props).onPolicyUpdate?t.onPolicyUpdate("expires",q(e)):void 0},_renderExpiryCustom:function(){var e;return H.span({className:"shared-link-settings-modal__calendar-input"},B(c,{alignAtLeft:!1,onDateChange:function(e){return function(t){var n;return"function"==typeof(n=e.props).onPolicyUpdate?n.onPolicyUpdate("expires",t):void 0}}(this),initDate:null!=(e=this.props.linkMetadata.expires)?e:q(30),firstDay:q(1),lastDay:q(365)}))},_renderDownloadPolicy:function(){var e,n,o;return o=this.props.linkMetadata.link_permissions.can_disallow_download,n=this.props.linkMetadata.link_permissions.can_allow_download,e=this.props.linkMetadata.link_permissions.allow_download,null==o||null==n||null==e||o===!1&&e===!0?void 0:this._renderFieldset(L("Allow people to download this?"),H.div({},H.label({className:t({"u-font-meta":!n})},H.input({checked:this.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__allow-download-yes",disabled:!n,onChange:function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate?t.onPolicyUpdate("allow_download",!0):void 0}}(this),type:"radio"}),L("Yes")),H.label({className:t({"u-font-meta":!o})},H.input({checked:!this.props.renderedPolicy.allow_download,className:"shared-link-settings-modal__allow-download-no",disabled:!o,onChange:function(e){return function(){var t;return"function"==typeof(t=e.props).onPolicyUpdate?t.onPolicyUpdate("allow_download",!1):void 0}}(this),type:"radio"}),L("No"))),this._renderNoPreviewFileWarning())},_renderNoPreviewFileWarning:function(){var t,n,o,i,r;if(this.props.isFile&&(n=W(this.props.linkMetadata.name,t=!0),o=n.toUpperCase(),!(null!=(null!=(r=this.props.linkMetadata)?r.preview_type:void 0)&&(i=this.props.linkMetadata.preview_type,e.call(w.PreviewHelper.VALID_PREVIEW_TYPES,i)>=0))))return this.props.renderedPolicy.allow_download===!1?H.div({className:"shared-link-settings-modal__preview-warning c-banner c-banner--warning"},H.div({className:"o-flag"},H.div({className:"o-flag-fix"},B(_,{alt:"",group:"web",name:"page_white_32"})),H.div({className:"o-flag__flex u-pad-left-xs"},L("People can’t view this %(file_extension)s file if they can’t download it.",{comment:'as in "People can’t view this .PDF file'}).format({file_extension:"."+o})))):void 0},_renderCommentsPolicy:function(){return this.props.linkMetadata.link_permissions.team_restricts_comments?void 0:this._renderFieldset(L("Who can comment?"),H.div({},H.div({className:"shared-link-settings-modal__commenting-policy"},G(this.props.linkMetadata.link_permissions.allow_comments,this._getResolvedVisibility(this.props.renderedPolicy.requested_visibility),this.props.linkMetadata.link_permissions.restricting_shared_folder_path)),H.div({className:"shared-link-settings-modal__commenting-advice"},this.props.linkMetadata.link_permissions.allow_comments?this.props.isFile?Q(L("To disable comments on this file, go to the file’s Comments pane and open the <strong>Options</strong> menu."),{strong:H.strong()}):Q(L("To disable comments on a file, go to the file’s Comments pane and open the <strong>Options</strong> menu."),{strong:H.strong()}):Q(L("To enable comments, go to the file’s Comments pane and open the <strong>Options</strong> menu."),{strong:H.strong()})," ",H.a({href:"/help/9016",target:"_blank"},L("Learn more")))))},_getResolvedVisibility:function(e){var t;if(t=this.props.linkMetadata.link_permissions.visibility_policies.filter(function(t){return t.policy===e}),1!==t.length)throw"Logic error: "+t.length+" should be 1.";
return t[0].resolved_policy},_renderFieldset:function(e,t,n){return null==n&&(n=null),H.fieldset({className:"settings-form-entry"},H.legend({className:"settings-form-entry__explanation u-trim-margin"},e),H.div({className:"settings-form-entry__options"},t),H.div({className:"u-mar-top-m"},n))},_renderButtons:function(){return H.div({className:"u-mar-top-m clearfix"},this.props.linkMetadata.link_permissions.can_revoke?H.div({className:"u-l-fl"},H.button({className:"button-as-link delete-link",onClick:this.props.onDeleteLink,style:{lineHeight:"32px"},type:"button"},L("Delete link"))):void 0,H.div({className:"u-l-fr"},H.button({className:"c-btn c-btn--primary confirm-button",disabled:this.props.isSubmitting||!this.props.canSubmit,onClick:this.props.onSubmit},L(this.props.isSubmitting?"Saving...":"Save settings")),H.button({className:"c-btn c-btn--secondary u-mar-left-xs cancel-button",onClick:this.props.onCancel},L("Cancel"))))}}),Z=function(e){return g.SHARING_EXPERIMENTS.SHOW_UPGRADE_TO_BIZ_BANNER[e]},{SharedLinkSettingsModal:d(U,["/static/css/sharing/settings_modal-vfl9q6spX.css"]),SharedLinkSettingsModalContents:F,showUpgradeToBizBanner:Z}})}.call(this),function(){define("modules/clean/sharing/notifications",["jquery","modules/clean/browse_interface","modules/clean/sharing/api/client","modules/clean/viewer","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a){var l,u,c,d,p,h;return u=n.ShareApiClient,l=n.FolderShareApiClient,c=r._,d=function(t){var n,o;return n=e(t).closest("form"),null!=(o=n.closest(".sc-invite-action"))&&o.addClass("loading"),n.length&&new u({userId:n[0]._subject_uid.value}).dismissInviteNotification({contentId:n[0].content_id.value}).finally(function(){return n.closest(".sc-invite-action").removeClass("loading"),n.closest(".feed-row").remove()}),!1},p=function(n){var r,u;return r=e(n),r.closest(".sc-invite-action").addClass("loading"),u=o.get_viewer().get_user_by_id(n._subject_uid.value),new l({userId:u.id}).mount({contentId:n.sf_id.value,origin:"NOTIFICATION_WEB"}).then(function(e){var n,o,l;return n=r.closest(".sc-invite-action"),n.addClass("sf-mounted"),o=e.path_lower,l=a({path:t.get_browse_root(u)+o}).toString(),i.redirect(l),s.success(c("Added the shared folder %(folder_name)s.").format({folder_name:e.name}))}).finally(function(){return r.closest(".sc-invite-action").removeClass("loading")}),!1},h=function(){var e;return s.info(c("Continue upgrading to add the shared folder to your Dropbox.")),e=a({path:"/pro/buy"}),e.updateQuery({cont:"sf",oqa:"sf_aoq_b_n"}),i.redirect(e.toString()),!1},{register_dismiss:d,register_mount:p,upgrade_to_mount:h}})}.call(this),function(){define("modules/clean/sharing/parent_folder_access_modal",["external/classnames","external/react","modules/clean/em_string","modules/clean/react/flag","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y;return p=i.Modal,d=s.MemberAccessLevelResult,_=a.SNIPPET_SIZES,c=l.ContentInfo,f=t.createElement,g=t.DOM,v=u.i18n_default_project("sharing"),m=v._,y=v.ungettext,h=t.createClass({displayName:"ParentFolderAccessModal",propTypes:{contentInfo:t.PropTypes.instanceOf(c).isRequired,memberAccessLevelResult:t.PropTypes.instanceOf(d).isRequired,memberDisplayName:t.PropTypes.string.isRequired,originalAction:t.PropTypes.oneOf(["remove","update"]).isRequired,isInContentManager:t.PropTypes.bool,onClose:t.PropTypes.func,onParentFolderClicked:t.PropTypes.func},_dismissModal:function(){return p.close(),this._handleDismissed()},_handleDismissed:function(){var e;return"function"==typeof(e=this.props).onClose?e.onClose():void 0},_handleNavigateToParentFolder:function(e){var t;return p.close(),"function"==typeof(t=this.props).onParentFolderClicked?t.onParentFolderClicked(e.shared_folder_id,this._arePermissionsAllowed(e.permissions)):void 0},_arePermissionsAllowed:function(e){return e.some(function(e){return null!=e?e.allow:void 0})},_renderParentFolderContent:function(){var e;return e="remove"===this.props.originalAction?this.props.contentInfo.isFolder()?y("As a member of the parent folder listed below, %(member_name)s can still access the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access the contents of “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):y("As a member of the parent folder listed below, %(member_name)s can still access “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still access “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):"update"===this.props.originalAction?this.props.contentInfo.isFolder()?y("As a member of the parent folder listed below, %(member_name)s can still edit the contents of “%(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit the contents of “%(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):y("As a member of the parent folder listed below, %(member_name)s can still edit “%c(content_name)s”.","As a member of the parent folders listed below, %(member_name)s can still edit “%c(content_name)s”.",this.props.memberAccessLevelResult.parentFolders.length):void 0,g.div({},e.format({member_name:n.em_snippet(this.props.memberDisplayName,_.DISPLAY_NAME),content_name:n.em_snippet(this.props.contentInfo.name(),_.FILENAME)}),g.div({className:"parent-folder-access-modal__folder-list u-mar-top-s"},g.ul({className:"o-list-ui o-list-ui--dividers"},this.props.memberAccessLevelResult.parentFolders.map(this._renderParentFolder))))},_renderParentFolder:function(e){var t;return t=f(r,{group:"web",name:"folder_user_32",className:"u-pad-right-xs",alt:""}),g.li({},g.div({className:"parent-folder-access-modal__parent-folder u-pad-vertical-xs u-pad-horizontal-s",onClick:this._handleNavigateToParentFolder.bind(null,e)},f(o,{leftAttachment:t,rightAttachment:this._renderFolderLink(e)},g.span({className:"parent-folder-access-modal__folder-name"},n.em_snippet(e.name,_.FILENAME)))))},_renderFolderLink:function(e){return g.button({className:"button-as-link",onClick:this._handleNavigateToParentFolder.bind(null,e),type:"button"},m(this._arePermissionsAllowed(e.permissions)?"Manage membership":"View folder"))},_renderSimpleContent:function(){return g.div({},g.span({className:"parent-folder-access-modal__warning"},this.props.memberAccessLevelResult.warning),g.div({className:"u-mar-top-m clearfix"},g.div({className:"u-l-fr"},g.button({className:"c-btn c-btn--primary confirm-button",onClick:this._dismissModal},m("OK")))))},render:function(){var e;return e="remove"===this.props.originalAction?m(this.props.contentInfo.isFolder()?"%(member_name)s can still access this folder":"%(member_name)s can still access this file"):"update"===this.props.originalAction?m(this.props.contentInfo.isFolder()?"%(member_name)s can still edit this folder":"%(member_name)s can still edit this file"):void 0,f(p,{autoClose:!1,className:"parent-folder-access-modal",buttonComponent:g.span(),onDismissCompleted:this._handleDismissed,title:e.format({member_name:n.em_snippet(this.props.memberDisplayName,_.DISPLAY_NAME)})},g.div({className:"parent-folder-access-modal__contents"},null==this.props.memberAccessLevelResult.parentFolders||this.props.isInContentManager?this._renderSimpleContent():this._renderParentFolderContent()))}}),{ParentFolderAccessModal:h}})}.call(this),function(){define("modules/clean/sharing/set_confidential_modal",["external/react","modules/clean/em_string","modules/clean/filepath","modules/clean/react/modal","modules/clean/sharing/api/client","modules/clean/sharing/constants","modules/core/i18n"],function(e,t,n,o,i,r,s){var a,l,u,c,d,p,h,_;return h=n.filename,_=n.parent_dir,a=o.Modal,l=r.SNIPPET_SIZES,d=e.createElement,p=e.DOM,c=s.i18n_default_project("sharing")._,u=e.createClass({displayName:"SetConfidentialModal",propTypes:{client:e.PropTypes.instanceOf(i).isRequired,folderId:e.PropTypes.string.isRequired,folderName:e.PropTypes.string.isRequired,folderPath:e.PropTypes.string.isRequired,initialIsConfidentialFolder:e.PropTypes.bool.isRequired,onCancel:e.PropTypes.func,onUpdateConfidentiality:e.PropTypes.func},getInitialState:function(){return{isAccepting:!1,setConfidential:this.props.initialIsConfidentialFolder}},render:function(){return d(a,{autoClose:!1,buttonComponent:p.span(),onDismissCompleted:this._handleDismiss,title:c("“%(folder_name)s” access").format({folder_name:t.em_snippet(this.props.folderName,l.FILENAME)})},this._renderContent(),this._renderButtons())},_renderContent:function(){var e;return e=t.em_snippet(h(_(this.props.folderPath)),l.FILENAME),p.div({className:"set-confidential-content"},p.div({className:"set-confidential-content__info"},c("Should members of the parent folder “%(parent_folder)s” automatically get access to the folder “%(folder_name)s”?").format({folder_name:t.em_snippet(this.props.folderName,l.FILENAME),parent_folder:e})),p.div({className:"set-confidential-content__options u-pad-top-s"},p.label({className:"u-l-b",key:"inherit"},p.input({checked:!this.state.setConfidential,name:"inherit",onChange:this._handleSetConfidentialValueUpdate,type:"radio",value:!1}),c("Yes, allow members of “%(parent_folder)s” to access").format({parent_folder:e})),p.label({className:"u-l-b",key:"confidential"},p.input({checked:this.state.setConfidential,name:"confidential",onChange:this._handleSetConfidentialValueUpdate,type:"radio",value:!0}),c("No, make this folder invite only"))))},_renderButtons:function(){return p.div({className:"u-l-fr"},p.button({className:"c-btn c-btn--primary",disabled:this.state.isAccepting||this.state.setConfidential===this.props.initialIsConfidentialFolder,onClick:this._handleAcceptClick},c(this.props.isAccepting?"Saving...":"Save")),p.button({className:"c-btn c-btn--secondary u-mar-left-xs",onClick:this._handleDismiss},c("Cancel")))},_handleSetConfidentialValueUpdate:function(e){return this.setState({setConfidential:"true"===e.target.value})},_handleAcceptClick:function(){return this.setState({isAccepting:!0}),this.props.folderId?this.props.client.setConfidentiality({contentId:this.props.folderId,confidential:this.state.setConfidential}).then(function(e){return function(t){var n;return"function"==typeof(n=e.props).onUpdateConfidentiality?n.onUpdateConfidentiality(t):void 0}}(this)):this.props.client.shareInternal({fqPath:this.props.folderPath,confidential:this.state.setConfidential}).then(function(e){return function(t){var n;return"function"==typeof(n=e.props).onUpdateConfidentiality?n.onUpdateConfidentiality(t):void 0}}(this))},_handleDismiss:function(){var e;return"function"==typeof(e=this.props).onCancel?e.onCancel():void 0}}),{SetConfidentialModal:u}})}.call(this),function(){define("modules/clean/sharing/settings_modal_components",["external/classnames","external/react","modules/clean/react/css","modules/core/i18n"],function(e,t,n,o){var i,r,s,a,l;return l=t.DOM,s=o.i18n_default_project("sharing")._,i=t.createClass({displayName:"SettingsModalButtons",propTypes:{disableSave:t.PropTypes.bool,isAccepting:t.PropTypes.bool,onAccept:t.PropTypes.func,onDismiss:t.PropTypes.func},render:function(){return l.div({className:"u-l-fr"},l.button({className:"confirm-button c-btn c-btn--primary",disabled:this.props.disableSave||this.props.isAccepting,onClick:this.props.onAccept},s(this.props.isAccepting?"Saving...":"Save settings")),l.button({className:"cancel-button c-btn c-btn--secondary u-mar-left-xs",onClick:this.props.onDismiss},s("Cancel")))}}),a=t.createClass({displayName:"SinglePolicyControl",propTypes:{canChange:t.PropTypes.bool,policyName:t.PropTypes.string,policyDescription:t.PropTypes.string,currentValue:t.PropTypes.string,options:t.PropTypes.array,handleOptionChange:t.PropTypes.func},getDefaultProps:function(){return{canChange:!0}},render:function(){var t;return l.fieldset({className:e({"settings-form-entry":!0,"settings-form-entry--no-permissions":!this.props.canChange})},l.legend({className:"settings-form-entry__explanation u-trim-margin"},this.props.policyDescription),l.div({className:"settings-form-entry__options"},function(){var e,n,o,i;for(o=this.props.options,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(l.label({key:t.value},l.input({checked:t.value===this.props.currentValue,className:"settings-form-entry-option-"+this.props.policyName+"__"+t.value,disabled:!this.props.canChange,name:this.props.policyName,onChange:this.props.handleOptionChange,type:"radio",value:t.value}),t.label));return i}.call(this)))}}),r=n(a,["/static/css/sharing/settings_modal-vfl9q6spX.css"]),{SettingsModalButtons:i,SinglePolicyControl:r}})}.call(this),function(){define("modules/clean/sharing/share_modal",["jquery","external/immutable","external/purify","external/react","external/react-dom","external/underscore","modules/clean/api_v2/error","modules/clean/contacts/tokenizer","modules/clean/em_string","modules/clean/flux/dispatcher","modules/clean/flux/store_listener","external/rsvp","modules/clean/ajax","modules/clean/analytics","modules/clean/react/browse/constants","modules/clean/react/modal","modules/clean/react/util","modules/clean/sharing/actions/share_modal","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/file_settings_modal","modules/clean/sharing/folder_settings_modal","modules/clean/sharing/keep_a_copy_modal","modules/clean/sharing/link_settings_modal","modules/clean/sharing/confirmation_modals/member_access_change_confirmation_modal","modules/clean/sharing/confirmation_modals/relinquish_membership_confirmation_modal","modules/clean/sharing/parent_folder_access_modal","modules/clean/sharing/set_confidential_modal","modules/clean/sharing/share_page/action_types","modules/clean/sharing/shared_content_link_settings_modal","modules/clean/sharing/stores/sharing_info","modules/clean/teams/membership_discovery_util","modules/clean/sharing/ui_util","modules/clean/sharing/views/modal_content","modules/clean/user","modules/clean/viewer","modules/constants/teams","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q){var V,W,G,j,z,K,Y,Q,Z,$,J,X,ee,te,ne,oe,ie,re,se,ae,le,ue,ce,de,pe,he,_e,me,fe,ge,ve,ye,Ee,be,we,Te,Se,Ce,Ie,Pe,Ae,Ne,Re,ke,Oe,De,Fe,xe,Me,Le,Ue,Be,He,qe,Ve,We,Ge,je,ze;return G=s.AppError,ke=s.catchApiError,K=a.ContactTokenState,Be=c.listenToStores,ue=d.Promise,Ce=h.TeamsWebActionsLogger,we=_.SharedWithActionTypes,se=m.Modal,Te=m.SimpleModal,qe=f.setStatePromise,V=v.ACCESS_LEVEL,W=v.ALPHA_FILE_METADATA_PERMISSIONS,Q=v.FILE_METADATA_PERMISSIONS,Z=v.FOLDER_METADATA_PERMISSIONS,$=v.FOLDER_METADATA_PERMISSIONS_INTERNAL,oe=v.MEMBER_ACTION,ae=v.PASS_CONTROL_AVAILABILITY,ce=v.SHARING_EXPERIMENTS,Ie=v.VALIDATE_PATH_PERMISSIONS,Pe=v.VALIDATE_PATH_PERMISSIONS_CONFIDENTIAL_AWARE,Y=y.ContentInfo,De=E.contactsToMembers,pe=E.ShareApiClient,Se=E.TeamSharingPolicies,J=b.FilePolicy,ee=b.FolderPolicy,ne=b.LinkMetadata,re=b.MemberCounts,ve=b.SharedFileMetadata,ye=b.SharedFolderMetadata,fe=b.SharedContentLinkMetadata,X=w.FileSettingsModal,Ee=T.SharedFolderSettingsModal,be=C.SharedLinkSettingsModal,je=C.showUpgradeToBizBanner,Ve=I.showMemberAccessChangeConfirmationModal,We=P.showRelinquishMembershipConfirmationModal,le=A.ParentFolderAccessModal,de=N.SetConfidentialModal,me=R.SharePageActionTypes,ge=k.SharedContentLinkSettingsModal,Ge=k.showSharedContentLinkModal,Fe=D.filterSuggestableUsers,j=F.CONTACT_ERROR_LEVEL,z=F.CONTACT_ERROR_MESSAGES,te=F.GoldenGate,Le=F.getContactValidator,He=F.logTiburonEvent,xe=F.genAddMemberErrorMessage,Me=F.genShareSuccessMessage,ze=F.showZendeskFlyoutIfAllowed,_e=x.ShareModalContent,ie=x.MODES,Re=B.assert,Oe=o.createElement,Ae=H.i18n_default_project("sharing")._,Ue=function(e){var t,n;return n=e.actionHandler.getSharingInfo(),t={areSharingPrefsLoaded:n.areSharingPrefsLoaded(),banner:n.banner(),canChangeOptions:n.canChangeOptions(),canInviteEditor:n.canInviteEditor(),canInviteViewer:n.canInviteViewer(),canInviteViewerNoComment:n.canInviteViewerNoComment(),canMakeViewerNoComment:n.canMakeViewerNoComment(),canRelinquishMembership:n.canRelinquishMembership(),canShareLink:n.canShareLink(),canUnshareFolder:n.canUnshareFolder(),canUpdateConfidentiality:n.canUpdateConfidentiality(),contactsError:n.contactsError(),contentInfo:n.contentInfo(),contentNameMessage:n.contentNameMessage(),contentNameMessageLevel:n.contentNameMessageLevel(),filePolicy:n.filePolicy(),folderPolicy:n.folderPolicy(),hasDisplayableMembers:n.hasDisplayableMembers(),hasParentSharedFolder:n.hasParentSharedFolder(),icon:n.icon(),isAddMessageAsCommentChecked:n.isAddMessageAsCommentChecked(),isAddMessageAsCommentHelpShown:n.isAddMessageAsCommentHelpShown(),isConfidentialFolder:n.isConfidentialFolder(),isContentNameFocused:n.isContentNameFocused(),isFolderInsideTeamFolderTree:n.isFolderInsideTeamFolderTree(),isLinkMetadataLoaded:n.isLinkMetadataLoaded(),isMetadataLoaded:n.isMetadataLoaded(),isNoCommentEnabledForFolders:n.isNoCommentEnabledForFolders(),isNoCommentEnabledForLinks:n.isNoCommentEnabledForLinks(),isTeamPolicyLoaded:n.isTeamPolicyLoaded(),isTeamSharedFolder:n.isTeamSharedFolder(),isTokenizerEmpty:n.isTokenizerEmpty(),linkMetadata:n.linkMetadata(),linkOnlyReason:n.linkOnlyReason(),memberCounts:n.memberCounts(),members:n.members(),metadata:n.metadata(),ownerTeam:n.ownerTeam(),pendingRemoval:n.pendingRemoval(),recipientAccess:n.recipientAccess(),recipientMessage:n.recipientMessage(),recipientTokens:n.recipientTokens(),teamPolicy:n.teamPolicy(),uiMode:n.uiMode()},r.extend(r.extend({},e),t)},Ne=o.createClass({displayName:"ShareModal",propTypes:{actionHandler:o.PropTypes.instanceOf(g),areMembersLoaded:o.PropTypes.bool,areSharingPrefsLoaded:o.PropTypes.bool,canChangeOptions:o.PropTypes.bool,canInviteEditor:o.PropTypes.bool,canInviteViewer:o.PropTypes.bool,canInviteViewerNoComment:o.PropTypes.bool,canMakeViewerNoComment:o.PropTypes.bool,canRelinquishMembership:o.PropTypes.bool,canUnshareFolder:o.PropTypes.bool,client:o.PropTypes.instanceOf(pe),contactsError:o.PropTypes.shape({level:o.PropTypes.string,message:o.PropTypes.string}),contentInfo:o.PropTypes.instanceOf(Y).isRequired,expSubgrowthBizUpsell:o.PropTypes.bool,filePolicy:o.PropTypes.instanceOf(J),folderPolicy:o.PropTypes.instanceOf(ee),hasDisplayableMembers:o.PropTypes.bool,hasParentSharedFolder:o.PropTypes.bool,icon:o.PropTypes.string,initialRecipientRawInput:o.PropTypes.string,initialRecipientTokens:o.PropTypes.array,isAddMessageAsCommentChecked:o.PropTypes.bool,isAddMessageAsCommentHelpShown:o.PropTypes.bool,isMetadataLoaded:o.PropTypes.bool,isNoCommentEnabledForFolders:o.PropTypes.bool,isNoCommentEnabledForLinks:o.PropTypes.bool,isTeamSharedFolder:o.PropTypes.bool,linkMetadata:o.PropTypes.oneOfType([o.PropTypes.instanceOf(ne),o.PropTypes.instanceOf(fe)]),linkOnlyReason:o.PropTypes.string,memberCounts:o.PropTypes.instanceOf(re),metadata:o.PropTypes.oneOfType([o.PropTypes.instanceOf(ye),o.PropTypes.instanceOf(ve)]),ownerTeam:o.PropTypes.shape({id:o.PropTypes.string.isRequired,name:o.PropTypes.string.isRequired}),pendingRemoval:o.PropTypes.instanceOf(t.Set).isRequired,showSharingPaywallNotice:o.PropTypes.bool,teamPolicy:o.PropTypes.instanceOf(Se),user:o.PropTypes.instanceOf(M).isRequired,viewer:o.PropTypes.object,teamGroupInfo:o.PropTypes.shape({id:o.PropTypes.string,name:o.PropTypes.string}),isInContentManager:o.PropTypes.bool},getDefaultProps:function(){return{initialRecipientRawInput:"",initialRecipientTokens:[],viewer:L.get_viewer()}},componentWillMount:function(){return this.beginTime=Date.now()},componentDidMount:function(){return this.client=this.props.client,this.initialLoadingPromise=this.props.isMetadataLoaded?ue.resolve():this._getMetadata()},_getMetadata:function(){var e,t,n;return n=[],!this.props.contentInfo.isFolder()||this.props.contentInfo.pathExists()&&!this.props.contentInfo.isFileFolder()?this.props.contentInfo.isSharedFolder()?te.confidentialFolderAware(this.props.user.id)?Array.prototype.push.apply(n,[this.client.getMetadataInternal({contentId:this.props.contentInfo.id,actions:Object.keys($)}).then(this._handleGetMetadataSuccess),this.updateMembers()]):Array.prototype.push.apply(n,[this.client.getMetadata({contentId:this.props.contentInfo.id,actions:Object.keys(Z)}).then(this._handleGetMetadataSuccess),this.updateMembers()]):(t=this._showFileSettings()?"getMetadataAlpha":"getMetadata",e=Object.keys(this._showFileSettings()?W:Q),Array.prototype.push.apply(n,[this.client[t]({contentId:this.props.contentInfo.id,actions:e}).then(this._handleGetMetadataSuccess).catch(ke(this.props.actionHandler.handleLoadingError)),this.updateMembers()])):Array.prototype.push.apply(n,[this.client.validatePath({fqPath:this.props.contentInfo.displayPath(),actions:Object.keys(te.confidentialFolderAware(this.props.user.id)?Pe:Ie),listMembersArg:{actions:te.canActOnInheritedMembers(this.props.user.id)?oe.ALL:[]},shouldParseMetadataFromError:te.canDeepNest(this.props.user.id)}).then(function(e){return function(t){var n,o;return o=t.metadata,n=t.inheritedMembers,e._handleGetMetadataSuccess(o),e.props.contentInfo.isSharedFolder()?e.updateMembers():e.props.actionHandler.setMembers(n)}}(this)).catch(ke(this.props.actionHandler.handleLoadingError))]),n.push(this.props.actionHandler.fetchMemberCounts(this.props.contentInfo)),ue.all(n)},render:function(){var e;return e={headerId:"unified-share-modal-title",areCheckboxSettingsLoaded:this.props.areSharingPrefsLoaded,isLimitedTeam:this.props.viewer.team_is_limited,onSettingsClick:this._handleSettingsClick,onMemberAccessChange:this._handleMemberAccessChange,onLinkSettingsClick:this._handleLinkSettingsClick,onSend:this._handleSend,onSetConfidentialClick:this._handleSetConfidentialClick,mode:this.props.uiMode,ref:"content",showContentManagerBridge:this._shouldRenderContentManagerBridge(),showPassFileSettings:this._showFileSettings(),showSharingPaywallNotice:ce.SHARED_FOLDER_PAYWALL[this.props.user.id],suppressLinkUI:this.props.isInContentManager},r.extend(e,r.omit(this.props,r.keys(e))),Oe(se,{style:"bare",acceptButtonText:null,dismissButtonText:null,headerId:"unified-share-modal-title",ref:"modal"},Oe(_e,e))},_getRecipientTokens:function(){var e,t;return(null!=(e=this.refs.content)&&null!=(t=e.getWrappedComponent())?t.getRecipientTokens():void 0)||[]},_handleMemberAccessChange:function(e,t){var n,o,i,r,s,a,l,u,c,d,p,h,_;return i=this.props.actionHandler.changeAccess,r=e.displayName(),p=this._getReopenModalProps(),_=function(){return se.showInstance(Oe(he,p))},d=function(e){return function(t,n){return null!=n?se.showInstance(Oe(le,{contentInfo:e.props.contentInfo,memberAccessLevelResult:n,memberDisplayName:r,originalAction:t,isInContentManager:e.props.isInContentManager,onClose:_,onParentFolderClicked:e.props.actionHandler.redirectToNsId})):void 0}}(this),t===oe.REMOVE||t===V.OWNER?(l=t===oe.REMOVE&&e.memberId()===this.props.user.account_id,s=this.props.contentInfo.isFolder(),a=this.props.contentInfo.isNestedSharedFolder(),o=null!=(h=e.permissions.leave_a_copy)?h.allow:void 0,u=function(n){return function(o){return i(e,t,d,_,n.props.actionHandler.redirectToBrowseUrl,o===!0)}}(this),c=function(){return se.showInstance(Oe(he,p))},l?We(s,a,u,c,n=!0):Ve(r,t,s,a,o,u,c)):i(e,t,d)},_showFileSettings:function(){return!(!ae.SHOW_FILE_SETTINGS||!this.props.user.is_team)},_refreshSharedWithColumnLinkData:function(){return u.dispatch({type:we.SIGNAL_SHARED_LINK_DATA_OUT_OF_DATE,data:{fileFqPaths:[this.props.contentInfo.displayPath()]}})},_sendShare:function(){var e;return He(this.props.contentInfo,this.props.user.id,"CLICK_TIB_SEND_BUTTON"),e=Date.now(),this.props.actionHandler.recipientsChange(this._getRecipientTokens()).then(function(t){return function(){var n;if(t.props.contactsError.level!==j.ERROR)return n=De(t.props.recipientTokens),t.props.actionHandler.setUiMode(ie.SHARE_SENDING),t.props.actionHandler.shareIfFileFolder().then(function(){return t.client.addMembers({accessLevel:t.props.recipientAccess,contentId:t.props.contentInfo.id,addMessageAsComment:t.props.isAddMessageAsCommentChecked,customMessage:t.props.recipientMessage,members:n})}).catch(ke(function(o){return q.error(xe(o)),He(t.props.contentInfo,t.props.user.id,"SHARE_MODAL_SEND_FAIL",{timing:Date.now()-e,num_recipients:n.length}),t.props.actionHandler.setUiMode(ie.SHARE),ue.reject()})).then(function(){var o,i,r;return q.success(Me(t.props.recipientTokens,t.props.contentInfo.name(),r=t.props.isTeamSharedFolder||t.props.isFolderInsideTeamFolderTree)),He(t.props.contentInfo,t.props.user.id,"SHARE_MODAL_SEND_SUCCESS",{timing:Date.now()-e,num_recipients:n.length}),t._getTokenizer().finishLogging(!1),"OFFICE_INTEGRATION"!==t.props.contentInfo.extras.origin&&ze("tiburon_send",Ae("You just shared a file or a folder with Dropbox")),t.props.actionHandler.refreshSharedWithColumnContentData(),"V1"===U.SUBGROWTH_BIZ_UPSELL_VARIANT&&t.props.ownerTeam?(o=t.props.recipientTokens.map(function(e){return e.email}),t._getSuggestableUsers(o)):null!=(i=t.refs.modal)?i.close():void 0})}}(this))},_getSuggestableUsers:function(e){return Fe(e,function(e){return function(t){var n,o,i;return n=t.contacts,o=t.is_admin,n.length>0&&require(["modules/clean/teams/membership_suggestion_modal"],function(t){var i;return i=t.MembershipSuggestionModal,se.showInstance(Oe(i,{isAdmin:o,isFile:e.props.contentInfo.isFile(),contacts:n}))}),null!=(i=e.refs.modal)?i.close():void 0}}(this),function(e){return function(){var t;return null!=(t=e.refs.modal)?t.close():void 0}}(this))},_handleFolderPolicySuccess:function(e,t){return u.dispatch({type:me.FETCH_FOLDER_POLICY_SUCCESS,user:this.props.user,metadata:t,folderPolicy:e})},_handleSend:function(){var e;return this.props.contentInfo.pathExists()?this._sendShare():(e=this._getInputContentName(),this.props.actionHandler.validateAndSetContentName(this.props.user,e,this._sendShare,this._selectInputContentName))},_handleGetMetadataSuccess:function(e){return this.props.actionHandler.handleGetMetadataSuccess(e),He(this.props.contentInfo,this.props.user.id,"VIEW_SHARE_MODAL",{timing:(new Date).getTime()-this.beginTime}),Ge(this.props.user.id)&&null!=e.preview_url?this.props.actionHandler.fetchContentLinkMetadata(e.preview_url):void 0},updateMembers:function(){return this.props.actionHandler.updateMembers(this.props.contentInfo.id)},_handleLinkSettingsClick:function(){var e,t,n,o,i;if(n=this._getReopenModalProps(),o=function(e){return function(){return se.showInstance(Oe(he,n))}}(this),e=function(e){return function(){return e._refreshSharedWithColumnLinkData(),n.actionHandler.setLinkMetadata(null)}}(this),t=function(e){return function(t){return n.actionHandler.setLinkMetadata(t),e._refreshSharedWithColumnLinkData()}}(this),this.props.linkMetadata instanceof fe)return se.showInstance(Oe(ge,{client:this.client,contentName:this.props.contentInfo.name(),linkMetadata:this.props.linkMetadata,onClose:o,onPolicySet:t}));if(this.props.linkMetadata instanceof ne)return i=je(this.props.user),Ce.log("open_link_settings_modal"),se.showInstance(Oe(be,{client:this.client,isFile:this.props.contentInfo.isFile(),linkMetadata:this.props.linkMetadata,onClose:o,onDeleteLink:e,onPolicySet:t,showUpgradeToBiz:i}));throw Error("Unsupported link metadata type "+this.props.linkMetadata._name)},_getInputContentName:function(){var e,t;return null!=(e=i.findDOMNode(null!=(t=this.refs.content)?t.getWrappedComponent().refs.contentNameInput:void 0))?e.value:void 0},_selectInputContentName:function(){var t,n;return null!=(t=e(i.findDOMNode(null!=(n=this.refs.content)?n.getWrappedComponent().refs.contentNameInput:void 0)))?t.select():void 0},_getTokenizer:function(){var e;return null!=(e=this.refs.content)?e.getWrappedComponent().refs.tokenizer:void 0},_getReopenModalProps:function(){var e,t,n,o,i,s,a;return t=[r.extend({},this.props),r.extend({},this.state)],e=t[0],i=t[1],o=(null!=(n=this._getTokenizer())?n.serializeInputData():void 0)||{tokens:null,value:null},s=o.tokens,a=o.value,r.extend(e,{initialRecipientTokens:s,initialRecipientRawInput:a})},_handleSettingsClick:function(e){return e?this._handleFolderSettingsClick():this._handleFileSettingsClick()},_handleFileSettingsClick:function(){var e,t;return t=this._getReopenModalProps(),e=function(e){return null!=e&&t.actionHandler.handleUpdateFilePolicy(e),se.showInstance(Oe(he,t))},se.showInstance(Oe(X,{fileName:this.props.contentInfo.name(),contentId:this.props.contentInfo.id,canChangeOptions:this.props.canChangeOptions,initialPolicy:this.props.filePolicy,isInContentManager:this.props.isInContentManager,onCancel:e,onPolicySet:e,user:this.props.user})),He(this.props.contentInfo,this.props.user.id,"OPEN_FILE_SETTINGS_MODAL")},_handleFolderSettingsClick:function(){var e,t;return t=this._getReopenModalProps(),e=function(e){return function(n,o){return null!=o&&(t.actionHandler.handleGetMetadataSuccess(o),e._handleFolderPolicySuccess(n,o),o.policy.shared_link_policy!==e.props.folderPolicy.shared_link_policy&&(t.actionHandler.fetchLinkMetadata(),e._refreshSharedWithColumnLinkData())),se.showInstance(Oe(he,t))}}(this),se.showInstance(Oe(Ee,{folderName:this.props.contentInfo.name(),folderId:this.props.contentInfo.isSharedFolder()?this.props.contentInfo.sharedFolderId().toString():void 0,folderPath:this.props.contentInfo.displayPath(),hasParentSharedFolder:this.props.hasParentSharedFolder,initialHasParentSharedFolder:this.props.hasParentSharedFolder,initialMetadata:this.props.metadata,initialOwnerTeam:this.props.ownerTeam,initialPermissions:{canChangeOptions:this.props.canChangeOptions,canUnshareFolder:this.props.canUnshareFolder},initialPolicy:this.props.folderPolicy,isInContentManager:this.props.isInContentManager,isSharedFolder:this.props.contentInfo.isSharedFolder(),initialIsTeamSharedFolder:this.props.isTeamSharedFolder,onCancel:e,onPolicySet:e,showContentManagerBridge:this._shouldRenderContentManagerBridge(!0),teamPolicy:this.props.teamPolicy,user:this.props.user}))},_handleSetConfidentialClick:function(){var e,t;return t=this._getReopenModalProps(),e=function(e){return function(n){return n&&(e._handleGetMetadataSuccess(n),t.actionHandler.updateMembers(n.shared_folder_id)),se.showInstance(Oe(he,t))}}(this),se.showInstance(Oe(de,{client:this.client,folderId:this.props.contentInfo.isSharedFolder()?this.props.contentInfo.sharedFolderId().toString():void 0,folderName:this.props.contentInfo.name(),folderPath:this.props.contentInfo.displayPath(),initialIsConfidentialFolder:this.props.isConfidentialFolder,onCancel:e.bind(this,null),onUpdateConfidentiality:e}))},_shouldRenderContentManagerBridge:function(e){return null==e&&(e=!1),te.hasContentManager(this.props.user.id)&&this.props.user.is_team_admin&&!this.props.isInContentManager&&(this.props.contentInfo.isTeamSharedFolder()||e&&(this.props.isFolderInsideTeamFolderTree||this.props.isTeamSharedFolder))}}),he=Be(Ne,{SharingInfoStore:O},Ue),{ShareModal:he}})}.call(this),function(){define("modules/clean/sharing/share_modal_util",["external/react","external/underscore","modules/clean/account/email","modules/clean/react/browse/action_logger","modules/clean/react/browse/constants","modules/clean/react/browse/models","modules/clean/react/modal","modules/clean/react/teams/modals/limited_team_folder_settings_modal","modules/clean/react/teams/modals/limited_team_share_folder_modal","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/client","modules/clean/sharing/content_info","modules/clean/sharing/share_modal","modules/clean/sharing/ui_util","modules/clean/user","modules/clean/viewer","modules/constants/sharing"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f){var g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x;return E=n.EmailVerification,v=o.BrowseLogger,T=i.FileTypes,
g=r.BrowseContext,b=r.File,I=s.Modal,w=c.FileShareApiClient,S=c.FolderShareApiClient,y=d.ContentInfo,P=p.ShareModal,C=h.GoldenGate,A=e.createElement,N=function(){return Math.random()},O=function(e,n,o){var i,r,s;null==o&&(o={}),e.id||(e=m.get_viewer().get_user_by_id(e)),null==o.userRootNs&&(o.userRootNs=e.root_ns),s=R(n),t.extend(s,o),s.modalSessionId||(s.modalSessionId=N()),v.logViewShareModel({uid:e.id,modal_session_id:s.modalSessionId});try{r=y.createFromParams(s)}catch(e){r=null}return i=n instanceof g?n:s.browseContext,{browseContext:i,contentInfo:r,shareModalInfo:s,user:e}},x=function(e,t,n,o){var i,r,s,a,l;return s=(null!=n?n.isNonUserRelativeContext:void 0)||o.isNonUserRelativeContext,D(e,t,n)?(E.get_for_user(e).verified_or_show()&&(l=e.id+":"+t.id,a=t.isFolder()?S:w,r=new a({userId:e.id}),i=new u(l,r,e),i.initializeShareModal(t,s),I.showInstance(A(P,{actionHandler:i,client:r,user:e,initialRecipientTokens:o.prefillContacts,teamGroupInfo:t.teamGroupInfo(),isInContentManager:s}))),!0):!1},D=function(e,t,n){var o;return t.isFolder()&&null!=t.pathExists()?(o=t.displayPath(),o&&"/"!==o):!0},F=function(e,t,n){var o;return t.isTeamSharedFolder&&m.get_viewer().team_is_limited?(!e.is_team_admin||"BROWSE_SHARED_FOLDER_BANNER"!==(o=t.origin)&&"BROWSE_GLOBAL_ACTIONS"!==o?l.showModalInstance({fqPath:t.fqPath}):a.showWithProps({folderId:t.targetNsId.toString(),folderName:n.getNameOfTargetFolder(),user:e}),!0):void 0},R=function(e){var t,n;return e instanceof b?(t=(n=e.type)===T.FILE||n===T.PACKAGE,{exists:!e.isDeleted,fileId:e.file_id,fqPath:e.fq_path,isFolder:!t,isTeamSharedFolder:e.type===T.TEAM_SHARED_FOLDER,nsId:e.ns_id,nsPath:e.ns_path,targetNsId:e.target_ns}):e instanceof g?k(e):e},k=function(e){return e.isInsideDeletedFolder||e.isInsideDeletedSharedFolder?null:e.isInFolderMode?e.isInsideSharedFolder?e.currentNSPath?{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentMountPoint,isFolder:!0,nsId:null,nsPath:e.currentMountPoint,targetNsId:e.currentNSID,isTeamSharedFolder:e.isInsideAutoTeamFolder}:{fqPath:e.currentFQPath,isFolder:!0,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}:{fqPath:e.currentFQPath,isFolder:!1,nsId:e.currentNSID,nsPath:e.currentNSPath,targetNsId:null}},{generateModalSessionId:N,getShareModalInfo:R,getShareModalInfoFromContext:k,getSharingInfo:O,shouldShowTiburonUI:D,showFastrakShareModalIfAllowed:F,showTiburonUIIfAllowedNonPublic:x}})}.call(this),function(){define("modules/clean/sharing/share_page/action_types",["modules/clean/flux/action_type"],function(e){var t,n;return n=e.withActionNamespace,t=n("share-page",{INITIALIZE:"initialize-store",EMAIL_UNVERIFIED:"email-unverified",SWITCH_TAB:"switch-tab",SWITCH_ROLE:"switch-role",SWITCH_USER:"switch-user",LOAD_FOLDER_DATA_REQUEST:"load-folder-data-request",LOAD_FOLDER_DATA_SUCCESS:"load-folder-data-success",LOAD_FOLDER_DATA_ERROR:"load-folder-data-error",LOAD_FILE_DATA_REQUEST:"load-file-data-request",LOAD_FILE_DATA_SUCCESS:"load-file-data-success",LOAD_FILE_DATA_ERROR:"load-file-data-error",MOUNT_FOLDER_REQUEST:"mount-folder-request",MOUNT_FOLDER_SUCCESS:"mount-folder-success",MOUNT_FOLDER_ERROR:"mount-folder-error",UNMOUNT_FOLDER_REQUEST:"unmount-folder-request",UNMOUNT_FOLDER_SUCCESS:"unmount-folder-success",UNMOUNT_FOLDER_ERROR:"unmount-folder-error",UNSHARE_FOLDER_REQUEST:"unshare-folder-request",UNSHARE_FOLDER_SUCCESS:"unshare-folder-success",UNSHARE_FOLDER_ERROR:"unshare-folder-error",FETCH_TEAM_POLICY_REQUEST:"fetch-team-policy-request",FETCH_TEAM_POLICY_SUCCESS:"fetch-team-policy-success",FETCH_TEAM_POLICY_ERROR:"fetch-team-policy-error",FETCH_FOLDER_POLICY_SUCCESS:"fetch-folder-policy-success",FETCH_METADATA_SUCCESS:"fetch-metadata-success",RELINQUISH_FOLDER_MEMBERSHIP_REQUEST:"relinquish-folder-membership-request",RELINQUISH_FOLDER_MEMBERSHIP_SUCCESS:"relinquish-folder-membership-success",RELINQUISH_FOLDER_MEMBERSHIP_ERROR:"relinquish-folder-membership-error",RELINQUISH_FILE_MEMBERSHIP_REQUEST:"relinquish-file-membership-request",RELINQUISH_FILE_MEMBERSHIP_SUCCESS:"relinquish-file-membership-success",RELINQUISH_FILE_MEMBERSHIP_ERROR:"relinquish-file-membership-error"}),{SharePageActionTypes:t}})}.call(this),function(){define("modules/clean/sharing/shared_content_link_settings_modal",["external/react","modules/clean/api_v2/types","modules/clean/react/css","modules/clean/react/modal","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/settings_modal_components","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f,g,v,y,E,b,w,T,S;return y=t.UnionScalar,p=o.Modal,_=i.ShareApiClient,d=r.LinkAudience,m=a.SharedContentLinkMetadata,f=a.SharedContentLinkSettings,h=l.SettingsModalButtons,v=l.SinglePolicyControl,w=e.createElement,T=e.DOM,E=u.i18n_default_project("sharing")._,b=e.createClass({displayName:"SharedContentLinkSettingsModal",propTypes:{linkMetadata:e.PropTypes.instanceOf(m).isRequired,client:e.PropTypes.instanceOf(_).isRequired,contentName:e.PropTypes.string.isRequired,onClose:e.PropTypes.func,onPolicySet:e.PropTypes.func},getInitialState:function(){return{desiredSettings:new f({audience:this.props.linkMetadata.current_audience})}},render:function(){return w(p,{autoClose:!1,buttonComponent:T.span(),className:"shared-content-link-settings-modal",onDismissCompleted:this._handleDismissed,title:E("Link settings for “%(content_name)s”").format({content_name:this.props.contentName})},T.div({},w(v,{canChange:!0,currentValue:this.state.desiredSettings.get("audience"),handleOptionChange:this._handleOptionChange,options:[{label:E("Anyone with the link"),value:d.public},{label:E("Anyone on your Dropbox team with the link"),value:d.team},{label:E("Only members of this content"),value:d.members}],policyName:"audience",policyDescription:E("Who can view this content via the link?")}),w(h,{disableSave:!1,isAccepting:this.state.isAccepting,onAccept:this._saveSettings,onDismiss:this._dismissModal})))},_handleOptionChange:function(e){return this.setState({desiredSettings:this.state.desiredSettings.set(e.target.name,e.target.value)})},_saveSettings:function(){return this.setState({isAccepting:!0}),this.props.client.setLinkSettings({linkSettings:{audience:new y(this.state.desiredSettings.get("audience"))},url:this.props.linkMetadata.url}).catch(function(e){return function(){return e.setState({isAccepting:!1}),Promise.reject()}}(this)).then(function(e){return function(t){var n;return"function"==typeof(n=e.props).onPolicySet&&n.onPolicySet(t),c.success(E("Settings saved.")),e._dismissModal()}}(this))},_dismissModal:function(){return p.close(),this._handleDismissed()},_handleDismissed:function(){var e;return"function"==typeof(e=this.props).onClose?e.onClose():void 0}}),S=function(e){return s.TRUELINK.TRUELINK_UI[e]},g=n(b,["/static/css/sharing/settings_modal-vfl9q6spX.css"],[v]),{SharedContentLinkSettingsModal:g,showSharedContentLinkModal:S}})}.call(this),function(){define("modules/clean/sharing/shared_content_link_sync_modal",["external/classnames","external/react","modules/clean/ajax","modules/clean/avatar/triple_avatars","modules/clean/analytics","modules/clean/avatar/avatar_with_default","modules/clean/avatar/faceholder","modules/clean/avatar/size","modules/clean/em_string","modules/clean/filepath","modules/clean/react/button","modules/clean/react/browse/models","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react_format","modules/clean/sharing/constants","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/clean/viewer","modules/clean/web_timing_logger","modules/constants/teams","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I){var P,A,N,R,k,O,D,F,x,M,L,U,B;return D=o.TripleAvatars,R=i.ShareTibEventLogger,P=a.AVATAR_DIMENSION_BY_SIZE,x=c.button,A=d.File,N=h.Modal,U=m.reactFormat,B=v.static_url,O=w.TRADEMARK_BUSINESS,F=S.i18n_default_project("sharing")._,L=t.DOM,M=t.createElement,k=t.createClass({statics:{showInstance:function(e){return N.showInstance(e)}},displayName:"SharedContentLinkSyncModal",ASK:"ask",ASKING:"asking",propTypes:{accessLevel:t.PropTypes.string.isRequired,folderName:t.PropTypes.string.isRequired,folderSize:t.PropTypes.string.isRequired,syncSharedFolderCallback:t.PropTypes.func.isRequired,previewCallback:t.PropTypes.func,previewUrl:t.PropTypes.string,outOfQuotaQP:t.PropTypes.string,ownerName:t.PropTypes.string,senderName:t.PropTypes.string,usageRemaining:t.PropTypes.string,usageNeeded:t.PropTypes.string,targetFile:t.PropTypes.instanceOf(A),syncNSId:t.PropTypes.string,expProSharingOverquotaModal:t.PropTypes.string,ownerProfilePhotoUrl:t.PropTypes.string,expSubgrowthBizUpsell:t.PropTypes.bool},getDefaultProps:function(){return{expSubgrowthBizUpsell:"V1"===b.SUBGROWTH_BIZ_UPSELL_VARIANT}},getInitialState:function(){return{state:this.ASK,ownerTeam:null}},componentWillMount:function(){var e,t,n,o;return o=E.start_time(),e=(new Date).getTime(),this.userId=y.get_viewer().get_users()[0].id,n="SYNC_MODAL",t=this.props.targetFile?"UNMOUNTED_SEARCH_MODAL_RENDER":"SYNC_MODAL_RENDER",R.log(this.userId,t,n,{timing:e-o,ns_id:this.props.syncNSId})},_renderTopPanelIcon:function(){return this.props.targetFile?M(_,{alt:"",group:"web",name:this.props.targetFile.icon}):M(_,{alt:"",group:"web",name:"folder_user_32"})},_renderTopPanelTitle:function(){return this.props.targetFile?l.em_snippet(u.filename(this.props.targetFile.fq_path,15)):l.em_snippet(this.props.folderName,15)},_renderTopPanelSubtitle:function(){return this.props.targetFile?null!=this.props.ownerName?F("Owned by %(name)s").format({name:this.props.ownerName}):F("Not currently owned"):this.props.folderSize},_renderAccessText:function(){return this.props.expSubgrowthBizUpsell?this.state.ownerTeam?this.props.outOfQuotaQP?L.div({},L.div({className:"content-link-sync-modal__access-text u-mar-top-m"},M(D,{contacts:this.state.ownerTeam.contacts,count:this.state.ownerTeam.count})),L.div({className:"content-link-sync-modal__access-text"},F("Your Dropbox is full—join the %(team_name)s Dropbox?").format({team_name:this.state.ownerTeam.name}))):L.div({className:"content-link-sync-modal__access-text"},null!=this.props.senderName?"can_view"===this.props.accessLevel?F("%(name)s gave you access to view this folder").format({name:this.props.senderName}):F("%(name)s gave you access to edit this folder").format({name:this.props.senderName}):F("can_view"===this.props.accessLevel?"You have access to view this folder":"You have access to edit this folder")):L.div({}):L.div({className:"content-link-sync-modal__access-text"},this.props.outOfQuotaQP?F("Not enough space"):null!=this.props.senderName?"can_view"===this.props.accessLevel?F("%(name)s gave you access to view this folder").format({name:this.props.senderName}):F("%(name)s gave you access to edit this folder").format({name:this.props.senderName}):F("can_view"===this.props.accessLevel?"You have access to view this folder":"You have access to edit this folder"))},_renderSharedFolderInfo:function(){var e;return L.div({className:"content-link-sync-modal__shared-folder-info"},L.div({className:"content-link-sync-modal__shared-folder-text"},F((null!=(e=this.props.targetFile)?e.is_dir:void 0)?"This folder is part of a shared folder:":"This file is part of a shared folder:")),L.div({},M(_,{alt:"",group:"web",name:"folder_user_32"})),L.p({className:"u-font-meta"},this.props.folderName,L.br({}),this.props.folderSize))},_renderTipBody:function(){return this.props.expSubgrowthBizUpsell?this.props.outOfQuotaQP?this.state.ownerTeam?this.state.ownerTeam.contacts.length>0?F("Join %(name)s and your coworkers and get more space to work together.").format({name:this.state.ownerTeam.contacts[0].display_name}):void 0:L.img({className:"content-link-sync-modal__loader",src:B("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:F("Loading")}):this.state.state===this.ASKING?L.img({src:B("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:F("Loading")}):F("can_view"===this.props.accessLevel?this.props.targetFile?"For easy access to this file in the future, add the folder to your Dropbox.":"For easy access to this folder in the future, add it to your Dropbox.":this.props.targetFile?"To start working on this file, you need to add the folder to your Dropbox first.":"To start working on this folder, you need to add it to your Dropbox first."):this.props.outOfQuotaQP?this.props.usageRemaining?F("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have %(remaining)s of space left.").format({remaining:this.props.usageRemaining,needed:this.props.usageNeeded}):F("To add this folder, you’ll need %(needed)s of space in your Dropbox. You currently have no space left.").format({needed:this.props.usageNeeded}):this.state.state===this.ASKING?L.img({src:B("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:F("Loading")}):F("can_view"===this.props.accessLevel?this.props.targetFile?"For easy access to this file in the future, add the folder to your Dropbox.":"For easy access to this folder in the future, add it to your Dropbox.":this.props.targetFile?"To start working on this file, you need to add the folder to your Dropbox first.":"To start working on this folder, you need to add it to your Dropbox first.")},render:function(){var t,n,o,i,r;return o="V1"===(i=this.props.expProSharingOverquotaModal)||"V2"===i||"V3"===i,n=e({"content-link-sync-modal":!0,"exp-subgrowth-biz-upsell":this.props.expSubgrowthBizUpsell,"content-link-sync-modal--pro-variant":o}),this.props.outOfQuotaQP&&o?(r=this.renderVariant(),t=this.renderButtonsVariant()):(r=this.renderControl(),t=this.renderButtons()),M(N,{autoClose:!1,buttonComponent:t,className:n,clickOutToClose:!1,ref:"modal",showX:!1,title:""},r)},renderControl:function(){return L.div({className:"content-link-sync-modal__content u-mar-bottom-xs"},L.div({className:"content-link-sync-modal__top-panel u-pad-s"},L.div({className:"content-link-sync-modal__icon"},this._renderTopPanelIcon()),L.div({className:"content-link-sync-modal__name-size u-l-ib u-pad-left-xs u-pad-top-xs o-flag__flex"},L.h3({className:"u-font-strong"},this._renderTopPanelTitle()),L.h4({className:"u-trim-margin u-font-meta"},this._renderTopPanelSubtitle())),L.div({className:"content-link-sync-modal__close u-pad-xs o-flag__fix"},M(g,{onClick:function(e){return function(){return e.refs.modal.close()}}(this)}))),L.div({className:"content-link-sync-modal__tip-panel"},this.props.targetFile?this._renderSharedFolderInfo():this._renderAccessText(),L.div({className:"content-link-sync-modal__tip-body"},this._renderTipBody())))},renderVariant:function(){var e,t,n;return n=this.props.usageRemaining>0?U(F("To add this folder, you’ll need <strong>%(needed)s</strong> of space in your Dropbox. You currently have <span>%(remaining)s</span> of space left."),{strong:L.strong(),span:L.span({className:"content-link-sync-modal__alert"}),remaining:this.props.usageRemaining,needed:this.props.usageNeeded}):U(F("To add this folder, you’ll need <strong>%(needed)s</strong> of space in your Dropbox. You currently have no space left."),{strong:L.strong(),needed:this.props.usageNeeded}),t=null!=this.props.ownerName,L.div({className:"content-link-sync-modal--pro-variant__content u-mar-bottom-xs"},L.div({className:"content-link-sync-modal--pro-variant__close u-pad-xs u-font-right"},M(g,{onClick:function(e){return function(){return e.refs.modal.close()}}(this)})),L.div({className:"content-link-sync-modal--pro-variant__container"},L.div({className:"content-link-sync-modal--pro-variant__left-container"},"V1"===this.props.expProSharingOverquotaModal?M(p,{src:B("/static/images/pro/overquota/big-shared-folder-vflkQGYtl.svg")}):"V2"===this.props.expProSharingOverquotaModal?L.div({className:"content-link-sync-modal--pro-variant__folder-container"},M(p,{src:B("/static/images/pro/overquota/big-shared-folder-vflkQGYtl.svg")}),t?L.div({className:"avatar-img"},M(r,{dimension:P.MEDIUM,photoUrl:this.props.ownerProfilePhotoUrl,shape:"CIRCLE",defaultAvatar:M(s,{dimension:P.MEDIUM})})):void 0):"V3"===this.props.expProSharingOverquotaModal?M(p,{src:B("/static/images/pro/overquota/spot-overquota-folder-vflUsxn3C.svg")}):"V4"===this.props.expProSharingOverquotaModal?M(p,{src:B("/static/images/pro/overquota/big-shared-folder-vflkQGYtl.svg")}):void 0,L.div({className:"content-link-sync-modal--pro-variant__content"},L.div({className:"content-link-sync-modal--pro-variant__folder-name"},l.em_snippet(this.props.folderName,f.OUT_OF_QUOTA_FOLDER_NAME)),"V1"!==(e=this.props.expProSharingOverquotaModal)&&"V2"!==e&&"V3"!==e||!t?void 0:L.div({className:"content-link-sync-modal--pro-variant__owner-name"},l.em_snippet(this.props.ownerName,f.DISPLAY_NAME)))),L.div({className:"content-link-sync-modal--pro-variant__right-container"},L.div({className:"content-link-sync-modal--pro-variant__tip-title"},F("Not enough space")),L.div({className:"content-link-sync-modal--pro-variant__tip-body"},n))))},renderButtons:function(){return this.props.expSubgrowthBizUpsell?this.state.ownerTeam?L.div({className:"content-link-sync-modal__buttons u-mar-bottom-s"},this.props.outOfQuotaQP?L.div({},M(x,{importance:"primary",className:"content-link-sync-modal__request-to-join-button",disabled:this.state.state===this.ASKING,onClick:this.onRequestButtonClicked},F(this.state.ownerTeam.is_limited?"Join the team":"Request to join")),M(x,{importance:"tertiary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},F("Upgrade to add folder"))):L.div({},M(x,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},F("Add to Dropbox"))),"can_view"===this.props.accessLevel?L.div({},L.span({className:"content-link-sync-modal__or"},F("Or")),L.button({className:"content-link-sync-modal__not-now-label button-as-link",onClick:this.onPreviewButtonClicked},F(this.props.targetFile.is_dir?"preview this folder":"preview this file"))):void 0):L.div({}):L.div({className:"content-link-sync-modal__buttons u-mar-bottom-s"},M(x,{importance:"primary",className:"content-link-sync-modal__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onSyncButtonClicked},F(this.props.outOfQuotaQP?"Upgrade to add folder":this.props.targetFile?"Add folder to Dropbox":"Add to Dropbox")),"can_view"===this.props.accessLevel?L.div({},L.span({className:"content-link-sync-modal__or"},F("Or")),L.button({className:"content-link-sync-modal__not-now-label button-as-link",onClick:this.onPreviewButtonClicked},F(!this.props.targetFile||this.props.targetFile.is_dir?"preview this folder":"preview this file"))):void 0)},renderButtonsVariant:function(){return L.div({className:"content-link-sync-modal--pro-variant__buttons"},M(x,{importance:"primary",className:"content-link-sync-modal--pro-variant__add-to-dropbox-button",disabled:this.state.state===this.ASKING,onClick:this.onUpgradeButtonClicked},F("Upgrade to add folder")))},requestCallback:function(){return this.props.outOfQuotaQP?T.redirect(I({path:"/pro/buy"}).updateQuery({oqa:this.props.outOfQuotaQP})):(this.props.targetFile&&R.log(this.userId,"UNMOUNTED_SEARCH_SYNC","SYNC_MODAL",{ns_id:this.props.syncNSId}),this.props.syncSharedFolderCallback())},onSyncButtonClicked:function(){return this.setState({state:this.ASKING}),this.props.expSubgrowthBizUpsell&&!this.props.outOfQuotaQP?this.activateRequestModal():this.requestCallback()},onPreviewButtonClicked:function(){var e;return null!=this.props.previewCallback?(R.log(this.userId,"UNMOUNTED_SEARCH_PREVIEW","SYNC_MODAL",{ns_id:this.props.syncNSId}),this.props.previewCallback()):(e=null!=this.props.previewUrl?I.parse(this.props.previewUrl):T.get_uri().removeQuery("sm"),e.updateQuery({from_sync_modal:!0}),T.redirect(e))},onRequestButtonClicked:function(){return this.setState({state:this.ASKING}),require(["modules/clean/teams/membership_discovery_util"],function(e){return function(t){var n;return(n=t.sendTeamRequest)(e.state.ownerTeam.id,function(){return N.close()})}}(this))},activateRequestModal:function(){return this.props.expSubgrowthBizUpsell?require(["modules/clean/teams/membership_request_modal"],function(e){return function(t){var n;return n=t.MembershipRequestModal,N.showInstance(M(n,{senderName:e.props.senderName,team:e.state.ownerTeam,folderName:l.em_snippet(e.props.folderName,15),requestCallback:e.requestCallback}))}}(this)):void 0},componentDidMount:function(){return this.props.expSubgrowthBizUpsell?require(["modules/clean/teams/membership_discovery_util"],function(e){return function(t){var n;return n=t.getDiscoverableTeamForFolder,e.setState({state:e.ASKING}),n(e.props.syncNSId,function(t){return e.setState({state:e.ASK,ownerTeam:t})})}}(this)):void 0}})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sharing/signup_modal_proxy",["external/rsvp"],function(t){var n,o;return n=t.Promise,new(o=function(){function t(){this.signup=e(this.signup,this),this._defaultModalSignupPromiseResolver=e(this._defaultModalSignupPromiseResolver,this),this.signupForDirectDownload=e(this.signupForDirectDownload,this),this._directDownloadSignupPromiseResolver=e(this._directDownloadSignupPromiseResolver,this),this.disconnectModal=e(this.disconnectModal,this),this.connectModal=e(this.connectModal,this),this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null}return t.prototype.connectModal=function(e){return this._signupModal=e},t.prototype.disconnectModal=function(){return this._signupModal=null,this._directDownloadPromise=null,this._defaultModalPromise=null},t.prototype._directDownloadSignupPromiseResolver=function(e,t){var n,o;return o=function(t){return function(){return t._directDownloadPromise=null,e()}}(this),n=function(e){return function(){return e._directDownloadPromise=null,t()}}(this),this._signupModal.handle_direct_download(o),this._signupModal.handle_direct_download_cancel(n)},t.prototype.signupForDirectDownload=function(){var e;return null==this._signupModal?n.resolve():(null==this._directDownloadPromise&&(this._directDownloadPromise=new n(this._directDownloadSignupPromiseResolver)),e=this._directDownloadPromise,this._signupModal.on_request_direct_download(),e)},t.prototype._defaultModalSignupPromiseResolver=function(e,t){var n,o;return n=function(t){return e(t)},o=function(e){return function(){return e._defaultModalPromise=null,t()}}(this),this._signupModal.handle_default_modal_authenticate(n),this._signupModal.handle_default_modal_cancel(o),this._signupModal.on_request_default_signup()},t.prototype.signup=function(){return null==this._signupModal?n.reject():(null==this._defaultModalPromise&&(this._defaultModalPromise=new n(this._defaultModalSignupPromiseResolver)),this._defaultModalPromise)},t}())})}.call(this),function(){var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty;define("modules/clean/sharing/stores/sharing_info",["external/immutable","modules/clean/filepath","modules/clean/flux/base_store","modules/clean/sharing/action_types","modules/clean/sharing/api/client","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants"],function(t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N;return I=n.file_icon,P=n.folder_icon,b=i.ShareModalActionTypes,E=r.ShareApiClient,m=r.FileShareApiClient,f=r.FolderShareApiClient,_=s.FilePolicy,v=s.PassPolicy,y=s.PermissionSetting,A=s.makeMemberKey,C=s.SharingPrefs,c=a.ACCESS_LEVEL,N=l.validateContacts,g=u.MODES,d=u.BANNERS,h=u.CONTENT_NAME_MESSAGE_LEVELS,p=u.CONTENT_NAME_EMPTY_TOOLTIP,T=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,n),o.prototype._init=function(){return this.state=new t.Map},o.prototype.getSharingInfo=function(e){return this.state.get(e)},o.prototype._new_payload=function(e){var t,n;return n=null!=e&&null!=(t=e.action)?t.sharingKey:void 0,this.state.has(n)||(this.state=this.state.set(n,new w)),this.state.get(n)._new_payload(e.action.type,e.action.content)?this.emit_change():void 0},o}(o),w=function(){function e(){}return e.prototype._clear=function(){return this._linkMetadata=null,this._memberCounts=null,this._members=null,this._metadata=null,this._modalInfo=null,this._sharingPrefs=C(),this._teamPolicy=null,this._user=null},e.prototype._new_payload=function(e,t){var n,o;switch(e){case b.CHANGE_MEMBER_ACCESS_FAILURE:n=t.member,this._members=this._members.setIn([n.type(),n.memberKey(),"access_type"],t.prevAccess);break;case b.CHANGE_MEMBER_ACCESS_REQUEST:n=t.member,this._members=this._members.setIn([n.type(),n.memberKey(),"access_type"],t.newAccess);break;case b.CHANGE_RECIPIENTS:this._modalInfo._recipientTokens=t.recipientTokens,this._modalInfo._recipientRawInput=t.recipientRawInput,o=null,t.recipientTokens.length>0||t.recipientRawInput.length>0?this.uiMode()===g.MEMBERSHIP&&(o=g.SHARE):this.uiMode()===g.SHARE&&(o=g.MEMBERSHIP),o&&(this._modalInfo._uiMode=o);break;case b.CHANGE_RECIPIENT_ACCESS:this._modalInfo._recipientAccess=t.newAccess;break;case b.CHANGE_RECIPIENT_MESSAGE:this._modalInfo._recipientMessage=t.message;break;case b.CREATE_LINK_SUCCESS:this._linkMetadata=t.linkMetadata;break;case b.FETCH_MEMBER_COUNTS_SUCCESS:this._memberCounts=t.memberCounts;break;case b.FETCH_METADATA_FAILURE:this._modalInfo._uiMode=g.LINK_ONLY,this._modalInfo._linkOnlyReason=t.reason;break;case b.FETCH_METADATA_REQUEST:this._modalInfo._isMetadataLoaded=!1;break;case b.FETCH_METADATA_SUCCESS:this._setMetadata(t.metadata);break;case b.FETCH_SHARING_PREFS_REQUEST:this._modalInfo._areSharingPrefsLoaded=!1;break;case b.FETCH_SHARING_PREFS_SUCCESS:this._modalInfo._areSharingPrefsLoaded=!0,this._sharingPrefs=t.sharingPrefs;break;case b.FETCH_LINK_METADATA_REQUEST:this._modalInfo._isLinkMetadataLoaded=!1;break;case b.FETCH_LINK_METADATA_SUCCESS:this._modalInfo._isLinkMetadataLoaded=!0,this._linkMetadata=t.linkMetadata;break;case b.FETCH_USER_ACCOUNTS_REQUEST:this._modalInfo._hasDisplayableMembers=!1;break;case b.FETCH_USER_ACCOUNTS_SUCCESS:this._modalInfo._hasDisplayableMembers=!0,this._members=t.members;break;case b.FETCH_USER_ACCOUNTS_CONTINUED_SUCCESS:this._members=this._members.mergeDeep(t.members);break;case b.FETCH_TEAM_POLICY_REQUEST:this._modalInfo._isTeamPolicyLoaded=!1;break;case b.FETCH_TEAM_POLICY_SUCCESS:this._modalInfo._isTeamPolicyLoaded=!0,this._teamPolicy=t.teamPolicy;break;case b.HANDLE_CONTENT_NAME_CHANGE:""===t.name?(this._modalInfo._contentNameMessage=p,this._modalInfo._contentNameMessageLevel=h.INFO):(this._modalInfo._contentNameMessage=null,this._modalInfo._contentNameMessageLevel=h.INFO);break;case b.HANDLE_CONTENT_NAME_FOCUS_CHANGE:this._modalInfo._isContentNameFocused=t.focus;break;case b.REMOVE_MEMBER_FAILURE:this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.delete(t.member.memberKey());break;case b.REMOVE_MEMBER_KEEP_ACCESS:n=t.member,this._members=this._members.setIn([n.type(),n.memberKey(),"access_type"],t.access),this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.delete(n.memberKey());break;case b.REMOVE_MEMBER_REQUEST:this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.add(t.member.memberKey());break;case b.REMOVE_MEMBER_SUCCESS:n=t.member,this._members=this._members.deleteIn([n.type(),n.memberKey()]),this._modalInfo._pendingRemoval=this._modalInfo._pendingRemoval.delete(n.memberKey());break;case b.SEND_SHARE_FAILURE:this._modalInfo._isSending=!1;break;case b.SEND_SHARE_START:this._modalInfo._isSending=!0;break;case b.SEND_SHARE_SUCCESS:this._modalInfo._isSending=!1;break;case b.SET_COMMENT_CHECKBOX_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_checked",t.checked);break;case b.SET_COMMENT_CHECKBOX_HELP_PREF_REQUEST:this._sharingPrefs=this._sharingPrefs.set("add_message_as_comment_help_shown",!1);break;case b.SET_SHARED_FOLDER_ID:this._modalInfo._contentInfo=this._modalInfo._contentInfo.setNsId(t.sharedFolderId);break;case b.SET_UI_MODE:this._modalInfo._uiMode=t.uiMode;break;case b.SHARE_FOLDER_SUCCESS:this._setMetadata(t.metadata);break;case b.SHARE_MODAL_OPEN:this._clear(),this._modalInfo=new S(t.contentInfo),this._modalInfo._icon=this._calcIcon(),this._user=t.user;break;case b.UPDATE_BANNER:this._modalInfo._banner=t.banner;break;case b.UPDATE_FILE_POLICY:this._metadata=this._metadata.set("file_policy",t.filePolicy);break;case b.VALIDATE_CONTENT_NAME_ERROR:this._modalInfo._contentNameMessage=t.errorMsg,this._modalInfo._contentNameMessageLevel=h.ERROR;break;case b.VALIDATE_CONTENT_NAME_SUCCESS:this._modalInfo._contentInfo=this._modalInfo._contentInfo.setFQPath("/"+t.contentName);break;default:return!1}return!0},e.prototype._calcIcon=function(){var e,t,n;return this.isFolder()?this.contentInfo().pathExists()?(e=(null!=(t=this._metadata)&&null!=(n=t.permissions.edit_contents)?n.allow:void 0)===!1,P({isTeamFolder:this.isTeamSharedFolder(),isShared:this.contentInfo().isSharedFolder(),isViewOnly:e})):"folder_user_32":I(this.contentInfo().name())+"_32"},e.prototype._setMetadata=function(e){var t,n;return this._modalInfo._isMetadataLoaded=!0,t=e.permissions||(null!=(n=this._metadata)?n.permissions:void 0),this._metadata=e.set("permissions",t),null!=e.shared_folder_id&&(this._modalInfo._contentInfo=this._modalInfo._contentInfo.setNsId(e.shared_folder_id)),this._modalInfo._icon=this._calcIcon()},e.prototype._isViewerNoCommentEnabled=function(){return this.isFolder()?this.isNoCommentEnabledForFolders():this.isNoCommentEnabledForLinks()},e.prototype.areMembersFullyLoaded=function(){return this.hasDisplayableMembers()&&!this._members.cursor},e.prototype.areSharingPrefsLoaded=function(){return this._modalInfo._areSharingPrefsLoaded},e.prototype.banner=function(){return this._modalInfo._banner},e.prototype.canChangeOptions=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.change_options)?t.allow:void 0)},e.prototype.canInviteEditor=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.invite_editor)?t.allow:void 0)},e.prototype.canInviteViewer=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.invite_viewer)?t.allow:void 0)},e.prototype.canInviteViewerNoComment=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.invite_viewer_no_comment)?t.allow:void 0)&&this._isViewerNoCommentEnabled()},e.prototype.canMakeViewerNoComment=function(){return this._isViewerNoCommentEnabled()},e.prototype.canRelinquishMembership=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.relinquish_membership)?t.allow:void 0)},e.prototype.canShareLink=function(){return!this.isTeamSharedFolder()&&this.contentInfo().pathExists()},e.prototype.canUnshareFolder=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.unshare)?t.allow:void 0)},e.prototype.canUpdateConfidentiality=function(){var e,t;return Boolean(null!=(e=this._metadata)&&null!=(t=e.permissions.update_confidentiality)?t.allow:void 0)},e.prototype.contactsError=function(){return N(this.recipientTokens(),this._user,this.ownerTeam(),this.folderPolicy(),this.isTeamSharedFolder(),this.isFolderInsideTeamFolderTree())},e.prototype.contentId=function(){return this._modalInfo._contentInfo.id},e.prototype.contentInfo=function(){return this._modalInfo._contentInfo},e.prototype.contentNameMessage=function(){return this._modalInfo._contentNameMessage},e.prototype.contentNameMessageLevel=function(){return this._modalInfo._contentNameMessageLevel;
},e.prototype.filePolicy=function(){var e;return null!=(e=this._metadata)?e.file_policy:void 0},e.prototype.folderPolicy=function(){var e;return null!=(e=this._metadata)?e.policy:void 0},e.prototype.fqPath=function(){return this._modalInfo._contentInfo.displayPath()},e.prototype.hasDisplayableMembers=function(){return this._modalInfo._hasDisplayableMembers},e.prototype.hasParentSharedFolder=function(){var e;return null!=(null!=(e=this._metadata)?e.parent_shared_folder_id:void 0)},e.prototype.icon=function(){return this._modalInfo._icon},e.prototype.isAddMessageAsCommentChecked=function(){return Boolean(this._sharingPrefs.add_message_as_comment_checked)},e.prototype.isAddMessageAsCommentHelpShown=function(){return Boolean(this._sharingPrefs.add_message_as_comment_help_shown)},e.prototype.isNoCommentEnabledForFolders=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_shared_folders)},e.prototype.isNoCommentEnabledForLinks=function(){return Boolean(this._sharingPrefs.access_reader_no_comment_content_links)},e.prototype.isFolder=function(){return this._modalInfo._contentInfo.isFolder()},e.prototype.isConfidentialFolder=function(){var e;return Boolean(null!=(e=this._metadata)?e.is_confidential:void 0)},e.prototype.isContentNameFocused=function(){return this._modalInfo._isContentNameFocused},e.prototype.isFolderInsideTeamFolderTree=function(){return this.isFolder()&&this.isInsideSharedFolder()},e.prototype.isInsideSharedFolder=function(){var e;return Boolean(null!=(null!=(e=this._metadata)?e.parent_shared_folder_id:void 0)||this.contentInfo().isInSharedFolder())},e.prototype.isLinkMetadataLoaded=function(){return this._modalInfo._isLinkMetadataLoaded&&this.areSharingPrefsLoaded()},e.prototype.isMetadataLoaded=function(){return this._modalInfo._isMetadataLoaded},e.prototype.isTeamPolicyLoaded=function(){return this._modalInfo._isTeamPolicyLoaded},e.prototype.isTeamSharedFolder=function(){var e;return Boolean((null!=(e=this._metadata)?e.is_team_folder:void 0)||this.contentInfo().isTeamSharedFolder())},e.prototype.isTokenizerEmpty=function(){return 0===this.recipientRawInput().length&&0===this.recipientTokens().length},e.prototype.isSending=function(){return this._modalInfo._isSending},e.prototype.linkMetadata=function(){return this._linkMetadata},e.prototype.linkOnlyReason=function(){return this._modalInfo._linkOnlyReason},e.prototype.memberCounts=function(){return this._memberCounts},e.prototype.members=function(){return this._members},e.prototype.metadata=function(){return this._metadata},e.prototype.ownerTeam=function(){var e;return null!=(e=this._metadata)?e.owner_team:void 0},e.prototype.parentSharedFolderId=function(){var e;return null!=(e=this._metadata)?e.parent_shared_folder_id:void 0},e.prototype.pendingRemoval=function(){return this._modalInfo._pendingRemoval},e.prototype.recipientAccess=function(){return this._modalInfo._recipientAccess},e.prototype.recipientMessage=function(){return this._modalInfo._recipientMessage},e.prototype.recipientRawInput=function(){return this._modalInfo._recipientRawInput},e.prototype.recipientTokens=function(){return this._modalInfo._recipientTokens},e.prototype.teamPolicy=function(){return this._teamPolicy},e.prototype.uiMode=function(){return this._modalInfo._uiMode},e}(),S=function(){function e(e){this._areSharingPrefsLoaded=!1,this._banner=d.NO_MEMBERS,this._canRelinquishMembership=!1,this._contentInfo=e,this._contentNameMessage=e.pathExists()?null:p,this._contentNameMessageLevel=h.INFO,this._hasDisplayableMembers=!1,this._icon=null,this._isContentNameFocused=e.pathExists(),this._isLinkMetadataLoaded=!1,this._isMetadataLoaded=!1,this._isSending=!1,this._isTeamPolicyLoaded=!1,this._linkOnlyReason=null,this._pendingRemoval=new t.Set,this._recipientAccess=this._contentInfo.isFolder()?c.WRITER:c.READER,this._recipientMessage="",this._recipientRawInput="",this._recipientTokens=[],this._uiMode=g.MEMBERSHIP}return e}(),new T})}.call(this),function(){define("modules/clean/sharing/strings",["modules/clean/sharing/constants","modules/core/i18n"],function(e,t){var n,o,i,r;return n=e.ACCESS_LEVEL,i=t.i18n_default_project("sharing")._,r={},r[""+n.OWNER]=i("Owner"),r[""+n.WRITER]=i("Can edit"),r[""+n.READER]=i("Can view"),r[""+n.READER_NO_COMMENT]=i("View-only"),o=r,{ACCESS_NAME:o}})}.call(this),function(){define("modules/clean/sharing/ui_util",["external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/api_v2/error","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/zendesk_feedback","modules/core/i18n","modules/core/notify","modules/core/uri","modules/core/user_i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$,J;return P=n.ShareTibEventLogger,f=o.AppError,y=i.ContactTokenState,B=s.file_icon,q=s.folder_icon,S=s.ICON_SIZES,E=a.FileTypes,T=l.GroupMembershipInfo,m=u.ACCESS_LEVEL,b=u.GOLDEN_GATE,I=u.SHARING_EXPERIMENTS,Y=c.showZendeskFlyout,K=d.i18n_default_project("sharing"),N=K._,Z=K.ungettext,w={canActOnInheritedMembers:function(e){return b.CAN_ACT_ON_INHERITED_MEMBERS[e]},canDeepNest:function(e){return b.CAN_DEEP_NEST[e]},hasGoldenGateIconography:function(e){return b.HAS_GOLDEN_GATE_ICONOGRAPHY[e]},hasNewMembershipUI:function(e){return b.HAS_NEW_MEMBERSHIP_UI[e]},hasAudienceBox:function(e){return b.HAS_AUDIENCE_BOX[e]},hasContentManager:function(e){return b.HAS_CONTENT_MANAGER[e]},hasContentManagerAndSuperAdmin:function(e){return b.HAS_CONTENT_MANAGER_AND_SUPER_ADMIN[e]},hasContentManagerActionsDisabled:function(e){return b.HAS_CONTENT_MANAGER_ACTIONS_DISABLED[e]},hasContentManagerDetails:function(e){return b.HAS_CONTENT_MANAGER_DETAILS[e]},hasPermanentDelete:function(e){return b.HAS_PERMANENT_DELETE[e]},confidentialFolderAware:function(e){return b.CONFIDENTIAL_FOLDER_AWARE[e]},SHARING_LIMIT:b.SHARING_LIMIT,SHARING_WARN_THRESHOLD:b.SHARING_WARN_THRESHOLD},A={},C={SHARED_FILE:"shared-file",SHARED_FOLDER:"shared-folder",SHARED_LINK:"shared-link",LEGACY_TEAM_FOLDER:"team-folder",PUBLIC:"public",NO_SHARE:"no-share"},v={SINGLE_INVALID:N("The email address you entered is invalid"),SINGLE_OUT_OF_TEAM:N("This person isn’t on your Dropbox team"),SINGLE_LARGE_GROUP:N("Sharing may take a while"),SINGLE_TOO_LARGE_GROUP:N("Can’t share with this many people"),GENERAL_INVALID:N("One or more names or email addresses you entered are invalid."),GENERAL_OUT_OF_TEAM:N("One or more invitees are outside your Dropbox team."),GENERAL_MANY_MEMBERS:N("Sharing with a lot of people can take a while."),GENERAL_TOO_MANY_MEMBERS:N("Sorry, you can’t share with this many people at a time."),NONGROUP_INVITEE:N("Only groups can be added to team folders.")},g={ERROR:"error",WARN:"warn"},L=function(e,t){var n,o,i,r,s;return n=null!=(r=t.allowLegacyPublicLinks)?r:!1,o=null!=(s=t.hasLegacyPublicAppToken)?s:!1,i=e.fq_path.toLowerCase(),o||n&&i.startsWith("/public/")?C.PUBLIC:e.is_deleted?C.NO_SHARE:e.is_team_shared_folder()?C.LEGACY_TEAM_FOLDER:e.is_shared_folder()||e.could_be_shared_folder()?C.SHARED_FOLDER:e.dir&&e.type!==E.PACKAGE?e.could_be_shared_link()?C.SHARED_LINK:C.NO_SHARE:C.SHARED_FILE},k=function(e,t){var n,o,i,r,s;return r=t.memberId()===e?"0":"1",i=t.access_type===m.OWNER?"0":"1",o=t.is_inherited?"0":"1",n=t instanceof T?"0":"1",s=t.displayName().toLowerCase(),""+r+i+o+n+"-"+s},R=function(e,t){return t.displayName().toLowerCase()},z=function(e){var t;return t=function(){return w.canActOnInheritedMembers(e.id)?R:k},function(n,o){var i,r,s;return s=t(),i=s(e.account_id,n),r=s(e.account_id,o),r>i?-1:i===r?0:1}},J=function(e,t,n,o,i,r){var s,a,l,u,c,d,p,h,_,m;for(a=null,l=null,m=0,u=0,c=e.length;c>u;u++){if(s=e[u],p=$(s,t,n,o,i,r),_=p.state,d=p.msg,_===y.invalid){if(a=g.ERROR,d===v.SINGLE_INVALID){l=v.GENERAL_INVALID;break}d===v.SINGLE_OUT_OF_TEAM&&(l=v.GENERAL_OUT_OF_TEAM),d===v.NONGROUP_INVITEE&&(l=v.NONGROUP_INVITEE),d===v.SINGLE_TOO_LARGE_GROUP&&(l=v.GENERAL_TOO_MANY_MEMBERS)}_===y.warn&&d===v.SINGLE_OUT_OF_TEAM&&(a||(a=g.WARN,l=v.GENERAL_OUT_OF_TEAM)),m+=null!=(h=s.group_size)?h:1}return(i||r)&&(a!==g.ERROR&&m>w.SHARING_LIMIT?(a=g.ERROR,l=v.GENERAL_TOO_MANY_MEMBERS):a!==g.ERROR&&m>=w.SHARING_WARN_THRESHOLD&&(a=g.WARN,l=v.GENERAL_MANY_MEMBERS)),{level:a,message:l}},$=function(e,t,n,o,i,r){var s;if(s={state:y.ok},i&&!e.group_id)return{state:y.invalid,msg:v.NONGROUP_INVITEE};if(i||r){if(null!=e.group_size&&e.group_size>w.SHARING_LIMIT)return{state:y.invalid,msg:v.SINGLE_TOO_LARGE_GROUP};if(null!=e.group_size&&e.group_size>=w.SHARING_WARN_THRESHOLD)return{state:y.warn,msg:v.SINGLE_LARGE_GROUP}}if(e.invalid)s={state:y.invalid,msg:v.SINGLE_INVALID};else{if(e.email===t.email)return s;null!=n&&t.is_team&&e.dbx_team_id!==n.id&&!e.group_id&&(s={msg:v.SINGLE_OUT_OF_TEAM},"team"===(null!=o?o.member_policy:void 0)||"team"===(null!=o?o.resolved_member_policy:void 0)?s.state=y.invalid:s.state=y.warn)}return s},O=function(e){switch(e){case"reader":return"viewer";case"writer":return"editor";case"owner":return"owner";default:return"default"}},M=function(e){var t,n,o;return t=e.displayName(),{access_type:O(e.access_type),display_name:t,initials:null!=(n=e.initials)?n:_.getInitials(t),photo_url:null!=(o=e.account)?o.profile_photo_url:void 0,user_id:e.memberId()}},F=function(e){return{access_type:O(e.access_type),gid:e.memberId(),is_automatic:"team"===e.group_type,name:e.displayName(),num_users:e.member_count}},x=function(e){return{access_type:O(e.access_type),invitation_id:e.memberId(),email_or_fbname:e.displayName()}},j=function(t,n,o,i){return null==i&&(i={}),P.log(n,o,t.extras.origin,e.extend(i,{fq_path:t.displayPath(),ns_id:t.isSharedFolder()?t.sharedFolderId():void 0,modal_session_id:t.extras.modalSessionId}))},D={access_error:N("You don’t have access to this content."),email_unverified:N("You haven’t verified your email. Check your email and try again."),bad_member:N("You entered an invalid name or email address."),cant_share_outside_team:N("Your team settings don’t allow sharing outside your team."),too_many_members:N("You’re sharing with too many people."),too_many_pending_invites:N("You’re sharing with too many people."),rate_limit:N("You’ve hit the limit of invites for today. Try again later."),insufficient_plan:N("You need a Dropbox Pro or Business account to do this."),team_folder:N("You can’t add members to a team folder. Contact your team admin."),no_permission:N("You don’t have permission to do this. Contact the owner.")},V=function(e){return e.message?e.message:e instanceof f&&e.error[".tag"]&&D[e.error[".tag"]]?D[e.error[".tag"]]:p.DEFAULT_ERROR},G=function(e,t,n){var o,i,s,a,l,u,c,d;if(s=e.filter(function(e){var t;return(t=e.type)===r.EMAIL||t===r.DBX_ID}),o=e.filter(function(e){return e.type===r.NEW_STYLE_GROUP}),n&&(i=o.map(function(e){var t;return null!=(t=e.group_size)?t:1}),c=function(e,t){return e+t},d=i.reduce(c,0),d+=s.length,d>=w.SHARING_WARN_THRESHOLD))return N("This change may take a while.");if(a={content_name:t,group_name:null!=(l=o[0])?l.name:void 0,num_groups:o.length,num_people:s.length,recipient:null!=(u=s[0])?u.email:void 0},s.length>0&&0===o.length)return n?Z("Securely added %(recipient)s to “%(content_name)s”.","Securely added %(num_people)s people to “%(content_name)s”.",s.length).format(a):Z("Securely shared “%(content_name)s” with %(recipient)s.","Securely shared “%(content_name)s” with %(num_people)s people.",s.length).format(a);if(0===s.length&&o.length>0)return n?Z(N("Securely added %(group_name)s to “%(content_name)s”."),N("Securely added  %(num_groups)s groups to “%(content_name)s”."),o.length).format(a):Z(N("Securely shared “%(content_name)s” with %(group_name)s."),N("Securely shared “%(content_name)s” with %(num_groups)s groups."),o.length).format(a);if(1===s.length&&o.length>0)return n?Z(N("Securely added %(recipient)s and 1 group to “%(content_name)s”."),N("Securely added %(recipient)s and %(num_groups)s groups to “%(content_name)s”."),o.length).format(a):Z(N("Securely shared “%(content_name)s” with %(recipient)s and 1 group."),N("Securely shared “%(content_name)s” with %(recipient)s and %(num_groups)s groups."),o.length).format(a);if(s.length>1&&o.length>0)return N("Securely shared “%(content_name)s.”").format(a);throw"Logic error: There should be at least 1 recipient"},Q=function(e,n,o){var i;return null==o&&(o="TIBURON"),i=function(){return t.BackgroundRequest({url:"/sharing/show_feedback_flyout",data:{dont_show_again:!0}})},t.WebRequest({url:"/sharing/show_feedback_flyout",success:function(t){return JSON.parse(t)?Y({title:n,zendeskTag:e,formType:o,onCloseClick:i}):void 0}})},H=function(e,t){var n;return null==t&&(t=!1),q({isShared:e.isSharedFolder(),isDeleted:null==e.path_lower,isInTeamFolderTree:null!=e.parent_shared_folder_id,isTeamFolder:e.is_team_folder,isViewOnly:null!=(null!=(n=e.permissions)?n.edit_contents:void 0)?!e.permissions.edit_contents.allow:!1,hasGoldenGateIconography:t})},U=function(e){return B(e.name,{size:S.LARGE})},W=function(e,t){return h(e?{path:"/preview_admin_console"}:{path:"/team/admin/team_folders",query:t?{select:t}:void 0})},{apiInviteeMemberToAvatarInfo:x,apiGroupMemberToAvatarInfo:F,apiUserMemberToAvatarInfo:M,CONTACT_ERROR_LEVEL:g,CONTACT_ERROR_MESSAGES:v,fileIconForMetadata:U,folderIconForMetadata:H,makeMemberSortCmp:z,chooseShareUIType:L,GoldenGate:w,SharingExperiments:A,SHARE_UI_TYPE:C,genAddMemberErrorMessage:V,genShareSuccessMessage:G,genContentManagerBridgeUri:W,logTiburonEvent:j,showZendeskFlyoutIfAllowed:Q,validateContact:$,validateContacts:J}})}.call(this),function(){define("modules/clean/sharing/views/comments_help",["external/classnames","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/sharing/views/hover_close_button","modules/clean/static_urls","modules/core/i18n"],function(e,t,n,o,i,r,s){var a,l,u,c,d;return d=r.static_url,l=s._,u=t.createElement,c=t.DOM,a=t.createClass({displayName:"ShareModalCommentsHelp",mixins:[t.addons.PureRenderMixin],propTypes:{onClose:t.PropTypes.func.isRequired,onButtonClick:t.PropTypes.func.isRequired,isFeedbackRequest:t.PropTypes.bool},renderText:function(){return this.props.isFeedbackRequest?[c.h1({key:"heading"},l("Get feedback on your work")),c.p({key:"content"},l("This will ask recipients to leave comments on your file and post your message as a comment."))]:c.p({},l("New! You can now post your message as a comment on the file. Anyone who views this file can see this comment."))},render:function(){return c.div({className:e(["bubble-dropdown","right-bottom","u-font-center","u-pad-m","u-l-b","comments-help-dialog"])},c.div({className:"close-button u-font-right"},u(i,{onClick:this.props.onClose})),u(o,{src:d("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:d("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),this.renderText(),c.button({className:"c-btn c-btn--primary",onClick:this.props.onButtonClick},l("Try it out")),c.div({className:"bubble-arrow-border"}),c.div({className:"bubble-arrow"}))}}),a=n(a,["/static/css/components/bubble_dropdown-vflbLryNB.css"])})}.call(this),function(){define("modules/clean/sharing/views/constants",["external/underscore","modules/core/i18n"],function(e,t){var n,o;return o=t.i18n_default_project("sharing")._,n={MODES:{LINK_ONLY:"link-only",LOADING:"loading",MEMBERSHIP:"membership",SHARE:"share",SHARE_SENDING:"share-sending"},BANNERS:{NO_MEMBERS:"no-members",INPUT_CONTENT_NAME:"input-content-name"},CONTENT_NAME_MESSAGE_LEVELS:{INFO:"info",ERROR:"error"},LINK_ONLY_REASON:{INSIDE_SHARED_FOLDER:"inside_shared_folder",CONTAINS_SHARED_FOLDER:"contains_shared_folder"},CONTENT_NAME_EMPTY_TOOLTIP:o("Name your shared folder")},n.MODE_VALUES=e.values(n.MODES),n.BANNER_VALUES=e.values(n.BANNERS),n.CONTENT_NAME_MESSAGE_LEVEL_VALUES=e.values(n.CONTENT_NAME_MESSAGE_LEVELS),n})}.call(this),function(){define("modules/clean/sharing/views/hover_close_button",["external/classnames","external/react","external/underscore","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,o,i){var r,s,a,l;return s=i.i18n_default_project("sharing")._,a=t.createElement,l=t.DOM,r=t.createClass({displayName:"HoverCloseButton",propTypes:{className:t.PropTypes.string},getInitialState:function(){return{hover:!1}},render:function(){var t;return t={className:e("c-borderless-button",this.props.className),onMouseOver:function(e){return function(){return e.setState({hover:!0})}}(this),onMouseOut:function(e){return function(){return e.setState({hover:!1})}}(this)},l.button(n.extend(t,n.omit(this.props,Object.keys(t))),a(o,{group:"web",name:this.state.hover?"xclose":"xclose_light_gray",alt:s("Close Modal")}))}})})}.call(this),function(){define("modules/clean/sharing/views/member_list",["external/immutable","external/react","external/underscore","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/content_info","modules/clean/sharing/views/member_list_item","modules/clean/sharing/ui_util","modules/clean/user","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v;return _=i.SharingMembership,c=r.ContentInfo,h=s.SharingMemberListItem,d=a.GoldenGate,v=a.makeMemberSortCmp,m=u.i18n_default_project("sharing")._,f=t.createElement,g=t.DOM,p=t.createClass({displayName:"SharingMemberList",propTypes:{actionHandler:t.PropTypes.instanceOf(o),canInviteMembers:t.PropTypes.bool,canMakeViewerNoComment:t.PropTypes.bool,canRelinquishMembership:t.PropTypes.bool,canUpdateConfidentiality:t.PropTypes.bool,contentInfo:t.PropTypes.instanceOf(c).isRequired,disabled:t.PropTypes.bool,membership:t.PropTypes.instanceOf(_).isRequired,onMemberAccessChange:t.PropTypes.func,onSetConfidentialClick:t.PropTypes.func,pendingRemoval:t.PropTypes.instanceOf(e.Set).isRequired,user:t.PropTypes.instanceOf(l).isRequired},getDefaultProps:function(){return{disabled:!1}},render:function(){var e,t,n,o,i,r;return n=v(this.props.user),o=this._membersByInheritance(),e=null!=(i=o.get(!1))?i.sort(n):void 0,t=null!=(r=o.get(!0))?r.sort(n):void 0,g.div({className:"sharing-member-list"},(null!=e?e.count():void 0)>0?g.ul({className:"o-list-ui u-trim-margin"},e.map(this._renderMembersListItem).toArray()):void 0,(null!=t?t.count():void 0)>0?[g.h5({className:"sharing-member-list__inherited-separator u-pad-vertical-xs u-pad-horizontal-s u-font-meta u-font-strong",key:"separator"},[m("Can access via parent folders"),this.props.canUpdateConfidentiality?g.button({className:"button-as-link u-l-fr",onClick:this.props.onSetConfidentialClick},m("Manage access")):void 0]),g.ul({className:"o-list-ui u-trim-margin",key:"inherited-members"},t.map(this._renderMembersListItem).toArray())]:void 0)},_renderMembersListItem:function(e){var t;return t=e.memberKey(),f(h,{canInviteMembers:this.props.canInviteMembers,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,contentInfo:this.props.contentInfo,key:t,disabled:this.props.disabled,isPendingRemoval:this.props.pendingRemoval.has(t),member:e,onMemberAccessChange:this.props.onMemberAccessChange,user:this.props.user})},_membersByInheritance:function(){return null==this.props.membership?e.Map():this.props.membership.groups.valueSeq().concat(this.props.membership.invitees.valueSeq()).concat(this.props.membership.users.valueSeq()).groupBy(function(e){return function(t){return e._shouldSortByInherited()&&t.is_inherited}}(this))},_shouldSortByInherited:function(){return d.confidentialFolderAware(this.props.user.id)||!d.canActOnInheritedMembers(this.props.user.id)}})})}.call(this),function(){define("modules/clean/sharing/views/member_list_item",["external/classnames","external/react","external/underscore","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/avatar/size","modules/clean/em_string","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/static_urls","modules/clean/user","modules/core/i18n","modules/core/user_i18n"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R;return f=r.AVATAR_DIMENSION_BY_SIZE,v=a.GroupMembershipInfo,y=a.InviteeMembershipInfo,E=a.MemberPermission,b=a.MemberPermissions,S=a.UserMembershipInfo,m=l.ACCESS_VALUES,w=l.SNIPPET_SIZES,g=u.ContentInfo,N=d.static_url,A=h.i18n_default_project("sharing"),C=A._,R=A.ungettext,I=t.createElement,P=t.DOM,T=t.createClass({displayName:"SharingMemberListItem",propTypes:{canInviteMembers:t.PropTypes.bool,canMakeViewerNoComment:t.PropTypes.bool,canRelinquishMembership:t.PropTypes.bool,disabled:t.PropTypes.bool,isPendingRemoval:t.PropTypes.bool,member:t.PropTypes.oneOfType([t.PropTypes.instanceOf(v),t.PropTypes.instanceOf(y),t.PropTypes.instanceOf(S)]),contentInfo:t.PropTypes.instanceOf(g).isRequired,onMemberAccessChange:t.PropTypes.func,pendingAccessChange:t.PropTypes.oneOf(m),user:t.PropTypes.instanceOf(p).isRequired},_shouldLinkMemberName:function(e){return this.props.contentInfo.isTeamSharedFolder()&&!this.props.canInviteMembers&&"group"===e&&this.props.member.is_owner},render:function(){var t,n,r,a,l,u,d,p,h;if(this.props.member instanceof S){if(h=this.props.member.account,u="user",null==h)return null;d=h.profile_photo_url}else this.props.member instanceof v?(h=null,u="group",d="team"===this.props.member.group_type?N("/static/images/icons/team_24@2x-vflR8kGKs.png"):void 0):(h=null,u="invitee");return n=this.props.member.displayName(),a=this.props.member.initials||_.getInitials(n),p="group"===u?"SQUARE":"CIRCLE",P.li({className:"sharing-member-list__item o-flag u-mar-s"},P.div({className:"o-flag__flex"},P.div({className:"sharing-member-info o-flag u-pad-right-m"},P.div({className:"o-flag__fix"},I(o,{dimension:f.MEDIUM,photoUrl:d,shape:p,defaultAvatar:I(i,{dimension:f.MEDIUM,shape:p,initials:a,name:n})})),P.div({className:"sharing-member-info__contact o-flag__flex u-pad-left-xs u-pad-right-xs"},P.div({className:e([this.props.isPendingRemoval?"u-font-meta":null,"u-font-strong","u-ellip"])},n?(r=s.em_snippet(n,w.DISPLAY_NAME),this._shouldLinkMemberName(u)?P.a({href:"/team#groups/"+this.props.member.group_id,target:"_blank",className:"sharing-member-info__group-name-link"},r):r):void 0,(null!=h?h.disabled:void 0)?[P.span({className:"dot"},"•"),P.span({className:"u-font-danger"},C("Deleted"))]:this.props.user.is_team&&!this.props.member.same_team?[P.span({className:"dot"},"•"),P.span({className:"u-font-meta"},C("Outside of your Dropbox team"))]:void 0),P.div({className:"u-font-meta u-ellip sharing-member-info__email"},"group"===u&&this.props.member.member_count?R("%(member_num)s member","%(member_num)s members",this.props.member.member_count).format({member_num:this.props.member.member_count}):(null!=h?h.email:void 0)&&(null!=h?h.email_verified:void 0)?s.em_snippet(h.email,w.EMAIL):void 0)))),P.div({className:"o-flag__fix"},this.props.isPendingRemoval?P.img({src:N("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),alt:C("Removing")}):(t=this.props.member.permissions.get("make_viewer_no_comment")&&this.props.canMakeViewerNoComment,l=this.props.member.permissions.set("make_viewer_no_comment",new E({allow:t})),I(c,{allowRelinquishMembership:this.props.member.memberId()===this.props.user.account_id&&this.props.canRelinquishMembership,canInviteMembers:this.props.canInviteMembers,contentInfo:this.props.contentInfo,currentAccess:this.props.member.access_type,disabled:this.props.disabled,isInherited:this.props.member.is_inherited,memberPermissions:l,onAccessChange:function(e){return function(t){var n;return"function"==typeof(n=e.props).onMemberAccessChange?n.onMemberAccessChange(e.props.member,t):void 0}}(this),pendingAccessChange:this.props.pendingAccessChange}))))}}),{SharingMemberListItem:T}})}.call(this),function(){define("modules/clean/sharing/views/modal_content",["external/classnames","external/immutable","external/react","external/react-dom","external/underscore","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/contacts/util","modules/clean/em_string","modules/clean/react/css","modules/clean/react/image","modules/clean/react/sprite","modules/clean/react/bubble","modules/clean/react_format","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/ui_util","modules/clean/sharing/views/constants","modules/clean/sharing/views/comments_help","modules/clean/sharing/views/hover_close_button","modules/clean/sharing/views/member_list","modules/clean/sharing/views/modal_link_info","modules/clean/sharing/views/sharing_bubble_menu","modules/clean/static_urls","modules/clean/user","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A){var N,R,k,O,D,F,x,M,L,U,B,H,q,V,W,G,j,z,K,Y,Q,Z,$,J,X,ee,te,ne,oe,ie,re,se;return M=r.ContactsTokenizer,ne=h.reactFormat,U=m.FolderPolicy,H=m.LinkMetadata,W=m.MemberCounts,G=m.MemberPermissions,z=m.PermissionSetting,Q=m.SharedContentLinkMetadata,Z=m.SharingMembership,N=f.ACCESS_VALUES,K=f.SNIPPET_SIZES,O=f.COMMENTING,L=g.ContentInfo,D=v.CONTACT_ERROR_LEVEL,te=v.genContentManagerBridgeUri,se=v.validateContact,q=y.MODES,V=y.MODE_VALUES,R=y.BANNERS,k=y.BANNER_VALUES,F=y.CONTENT_NAME_MESSAGE_LEVELS,x=y.CONTENT_NAME_MESSAGE_LEVEL_VALUES,B=y.LINK_ONLY_REASON,j=T.ModalLinkInfo,ie=C.static_url,X=n.createElement,ee=n.DOM,oe=P.i18n_default_project("sharing"),$=oe._,re=oe.ungettext,J=n.createClass({displayName:"ShareModalContent",statics:{MODES:q},propTypes:{actionHandler:n.PropTypes.instanceOf(_).isRequired,banner:n.PropTypes.oneOf(k),canInviteEditor:n.PropTypes.bool.isRequired,canInviteViewer:n.PropTypes.bool.isRequired,canInviteViewerNoComment:n.PropTypes.bool.isRequired,canMakeViewerNoComment:n.PropTypes.bool.isRequired,canRelinquishMembership:n.PropTypes.bool,canShareLink:n.PropTypes.bool.isRequired,canUpdateConfidentiality:n.PropTypes.bool,contactsError:n.PropTypes.shape({level:n.PropTypes.string,message:n.PropTypes.string}),contentInfo:n.PropTypes.instanceOf(L).isRequired,contentNameMessage:n.PropTypes.string,contentNameMessageLevel:n.PropTypes.oneOf(x),displayContentNameTooltip:n.PropTypes.bool,displayContentNameBanner:n.PropTypes.bool,folderPolicy:n.PropTypes.instanceOf(U),hasDisplayableMembers:n.PropTypes.bool.isRequired,headerId:n.PropTypes.string,icon:n.PropTypes.string,initialRecipientRawInput:n.PropTypes.string,initialRecipientTokens:n.PropTypes.array,isAddMessageAsCommentChecked:n.PropTypes.bool,isAddMessageAsCommentHelpShown:n.PropTypes.bool,isConfidentialFolder:n.PropTypes.bool,isContentNameFocused:n.PropTypes.bool,isFolderInsideTeamFolderTree:n.PropTypes.bool,isLimitedTeam:n.PropTypes.bool,isLinkMetadataLoaded:n.PropTypes.bool.isRequired,isMetadataLoaded:n.PropTypes.bool.isRequired,isTeamSharedFolder:n.PropTypes.bool,isTokenizerEmpty:n.PropTypes.bool.isRequired,linkMetadata:n.PropTypes.oneOfType([n.PropTypes.instanceOf(H),n.PropTypes.instanceOf(Q)]),linkOnlyReason:n.PropTypes.oneOf(B),memberCounts:n.PropTypes.instanceOf(W),members:n.PropTypes.instanceOf(Z),name:n.PropTypes.string,mode:n.PropTypes.oneOf(V),onContentNameChange:n.PropTypes.func,onCreateLinkClick:n.PropTypes.func,onSettingsClick:n.PropTypes.func,onLinkSettingsClick:n.PropTypes.func,onMemberAccessChange:n.PropTypes.func,onSend:n.PropTypes.func,onSetConfidentialClick:n.PropTypes.func,ownerTeam:n.PropTypes.shape({id:n.PropTypes.string.isRequired,name:n.PropTypes.string.isRequired}),pendingRemoval:n.PropTypes.instanceOf(t.Set).isRequired,recipientAccess:n.PropTypes.oneOf(N).isRequired,recipientMessage:n.PropTypes.string.isRequired,showContentManagerBridge:n.PropTypes.bool,showPassFileSettings:n.PropTypes.bool,showSharingPaywallNotice:n.PropTypes.bool,suppressLinkUI:n.PropTypes.bool,teamGroupInfo:n.PropTypes.shape({id:n.PropTypes.string,name:n.PropTypes.string}),user:n.PropTypes.instanceOf(I).isRequired},componentDidMount:function(){return this.refs.contentNameInput?o.findDOMNode(this.refs.contentNameInput).focus():void 0},getDefaultProps:function(){return{contactsError:{level:null,message:null},headerId:"unified-share-modal-title",linkMetadata:null,members:null,initialRecipientRawInput:"",initialRecipientTokens:[],isTeamSharedFolder:!1,mode:q.MEMBERSHIP,onCreateLinkClick:null,onFolderSettingsClick:null,onLinkSettingsClick:null,onMemberAccessChange:null,onSend:null}},render:function(){return ee.div({className:"unified-share-modal unified-share-modal--"+this.props.mode},this._renderHeaderSection(),this._renderToSection(),this._renderErrorMessageSection(),this._renderConfidentialFolderSection(),this._renderMainSection(),this._renderPaywallSection(),this._renderFooterSection())},_renderHeaderSection:function(){var t,n,o,i;return n=this._getMemberNum(),o=this.props.user.is_team&&(null!=(i=this.props.memberCounts)?i.users_outside_team:void 0)>0&&null!=this.props.ownerTeam?re("%(outside_team_count)s outside your Dropbox team","%(outside_team_count)s outside your Dropbox team",this.props.memberCounts.users_outside_team).format({outside_team_count:this.props.memberCounts.users_outside_team}):void 0,t=n?o?re("%(member_num)s member (%(outside_team_string)s)","%(member_num)s members (%(outside_team_string)s)",n,{comment:'Description of the count of total folder members and count of outside-of-team folder members, like "10 members (3 outside of your Dropbox team)"'}):re("%(member_num)s member","%(member_num)s members",n):"",t=t.format({member_num:n,outside_team_string:o}),ee.div({className:"unified-share-modal__section u-pad-s"},ee.div({className:"unified-share-modal__close u-l-fr o-flag__fix u-mar-top-xxs"},X(b,{className:"u-mar-left-s u-mar-top-xs",onClick:function(e){return function(){var t;return null!=(t=e.refs.tokenizer)&&t.finishLogging(!0),e.props.actionHandler.closeModal()}}(this)})),ee.div({className:"unified-share-modal__header o-flag"},ee.span({className:"o-flag__fix"},X(d,{alt:"",className:"unified-share-modal__title-icon",group:"web",name:this.props.icon})),ee.div({className:e("unified-share-modal__title","u-pad-left-xs","o-flag__flex",n?"unified-share-modal__title--member-count":void 0)},this.props.contentInfo.pathExists()?ee.h3({className:"u-font-strong",id:this.props.headerId},l.em_snippet(this.props.contentInfo.name(),K.FILENAME)):this._renderContentNameInput(),n?ee.h4({className:"u-trim-margin u-font-meta",id:this.props.headerId},t):void 0)))},_renderContentNameInput:function(){return ee.div({className:"unified-share-modal__content-name"},null==this.props.contentNameMessage||!this.props.isContentNameFocused&&this.props.contentNameMessageLevel!==F.ERROR?void 0:X(p,{arrow:p.ARROW.TOP,className:e({"unified-share-modal__content-name__tooltip":!0,"unified-share-modal__content-name__tooltip-error":this.props.contentNameMessageLevel===F.ERROR,"u-font-strong":!0})},ee.div({className:e(["u-pad-top-xxs","u-pad-bottom-xxs","u-pad-left-xs","u-pad-right-xs"])},this.props.contentNameMessage)),ee.input({className:e(["u-trim-padding","u-trim-margin","u-l-ib","u-font-strong"]),id:this.props.headerId,ref:"contentNameInput",onChange:function(e){return function(t){return e.props.actionHandler.handleContentNameChange(t.target.value)}}(this),onFocus:function(e){return function(){return e.props.actionHandler.handleContentNameFocusChange(!0)}}(this),onBlur:function(e){return function(){return e.props.actionHandler.handleContentNameFocusChange(!1)}}(this),onKeyUp:function(e){return function(t){var n,i;return(null!=(n=e.refs.tokenizer)&&null!=(i=n.refs.tokenizer)?i.refs.input:void 0)&&13===t.keyCode?o.findDOMNode(e.refs.tokenizer.refs.tokenizer.refs.input).focus():void 0}}(this),placeholder:this.props.isContentNameFocused?void 0:$("Folder name")}))},_renderToSection:function(){var t;return t=this.props.contentInfo.isFile()&&!this.props.canInviteEditor&&!this.props.canInviteViewerNoComment,
this.props.mode===q.LINK_ONLY?this._renderNoPermissionSection():this.props.isMetadataLoaded?this.props.showContentManagerBridge?this._renderContentManagerBridge():this.props.canInviteEditor||this.props.canInviteViewer?ee.div({className:"unified-share-modal__section u-pad-horizontal-s u-pad-vertical-xs"},ee.div({className:"o-flag"},ee.label({className:"o-flag__fix u-font-strong",htmlFor:"unified-share-modal-contacts-tokenizer"},this.props.isTeamSharedFolder?$("Add groups:",{comment:"Label for with whom to share"}):$("To:",{comment:"Label for with whom to share"})),ee.div({className:"unified-share-modal__to-input-box o-flag__flex"},X(M,{ref:"tokenizer",context:"tiburon",customContactFilter:this.props.isTeamSharedFolder?function(e){return e.type!==s.FB&&e.group_id}:function(e){return function(t){return t.type!==s.FB&&t.email!==e.props.user.email}}(this),focusOnMount:this.props.contentInfo.pathExists(),id:"unified-share-modal-contacts-tokenizer",onContentsChange:this.props.actionHandler.recipientsChange,populatedInputData:{tokens:this.props.initialRecipientTokens,value:this.props.initialRecipientRawInput},customContactValidator:function(e){return function(t){return se(t,e.props.user,e.props.ownerTeam,e.props.folderPolicy,e.props.isTeamSharedFolder,e.props.isFolderInsideTeamFolderTree)}}(this),placeholder:$(this.props.isTeamSharedFolder?"Group names":this.props.user.is_team?"Email, name, or group":"Email or name"),shouldLogContactSearch:!0,showContactImport:!this.props.isTeamSharedFolder,teamGroupInfo:this.props.isTeamSharedFolder?this.props.teamGroupInfo:null,user:this.props.user})),ee.div({className:e({"o-flag__fix":!0,"c-title-bubble":t}),"data-title":$("Only folders can be shared with edit access")},t?ee.span({className:"ax-visually-hidden"},$("Only folders can be shared with edit access")):void 0,X(S,{asButton:!0,contentInfo:this.props.contentInfo,currentAccess:this.props.recipientAccess,disabled:this.props.showContentManagerBridge,memberPermissions:new G({make_editor:new z({allow:this.props.canInviteEditor}),make_viewer:new z({allow:this.props.canInviteViewer}),make_viewer_no_comment:new z({allow:this.props.canInviteViewerNoComment})}),onAccessChange:this.props.actionHandler.changeRecipientAccess})))):this._renderNoPermissionSection():ee.div({className:"unified-share-modal__section u-pad-horizontal-s u-pad-vertical-xs"},ee.div({className:"unified-share-modal__to-placeholder"}," "))},_shouldRenderFooterSection:function(){var e;return this.props.isMetadataLoaded&&(this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()||this.props.contentInfo.isFile()&&this.props.showPassFileSettings||(e=this.props.mode)===q.SHARE||e===q.SHARE_SENDING)},_renderFooterSection:function(){var e,t,n;if(this._shouldRenderFooterSection())return ee.div({className:"unified-share-modal__section clearfix u-pad-horizontal-s u-pad-vertical-xs"},ee.div({className:"u-l-fl"},this.props.contentInfo.isFolder()&&this.props.contentInfo.pathExists()?ee.button({className:"unified-share-modal__settings u-font-meta c-borderless-button",disabled:this.props.mode===q.SHARE_SENDING,onClick:null!=(e=this.props.onSettingsClick)?e.bind(this,!0):void 0},X(d,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),$("Folder settings")):this.props.contentInfo.isFile()&&this.props.showPassFileSettings?ee.button({className:"unified-share-modal__settings u-font-meta c-borderless-button",disabled:this.props.mode===q.SHARE_SENDING,onClick:null!=(t=this.props.onSettingsClick)?t.bind(this,!1):void 0},X(d,{alt:"",className:"u-mar-right-xs u-l-ib u-l-ib--m",group:"web",name:"settings"}),$("File settings")):!this.props.contentInfo.isFolder()&&(this._canSendFeedbackRequest()||(null!=(n=this.props.recipientMessage)?n.length:void 0)>0)?this._renderFeedbackCheckbox():void 0),ee.div({className:"u-l-fr"},function(){switch(this.props.mode){case q.SHARE:case q.SHARE_SENDING:return ee.button({className:"unified-share-modal__share-send c-btn c-btn--primary",disabled:this.props.mode===q.SHARE_SENDING||this.props.isTokenizerEmpty||this.props.contactsError.level===D.ERROR||null!=this.props.contentNameMessage,onClick:this.props.onSend},$(this.props.mode===q.SHARE_SENDING?this.props.isTeamSharedFolder?"Adding...":"Sharing...":this.props.isTeamSharedFolder?"Add":"Share"));default:return null}}.call(this)))},_renderErrorMessageSection:function(){return this.props.contactsError.message?ee.div({className:e(["unified-share-modal__section","unified-share-modal__error-message","u-pad-s","u-font-center",this.props.contactsError.level===D.WARN?"unified-share-modal__warn":void 0,this.props.contactsError.level===D.ERROR?"unified-share-modal__error":void 0])},this.props.contactsError.message):null},_renderMainSection:function(){if(this.props.mode===q.LINK_ONLY)return this._renderMainLinkOnly();if(!this.props.isMetadataLoaded||!this.props.hasDisplayableMembers)return this._renderMainLoading();switch(this.props.mode){case q.MEMBERSHIP:return this._renderMainMembership();case q.SHARE:case q.SHARE_SENDING:return this._renderMainShare();default:return null}},_renderPaywallSection:function(){return this.props.isMetadataLoaded&&this.props.showSharingPaywallNotice&&this.props.contentInfo.isFolder()?ee.div({className:e(["paywall-banner","unified-share-modal__section","unified-share-modal__no-permission","u-pad-s","u-font-center"])},$("You can own 5 shared folders.")+" ",ee.a({href:"/guide",target:"_blank"},$("Learn more"))):null},_renderNoPermissionSection:function(){return ee.div({className:"unified-share-modal__section unified-share-modal__no-permission u-pad-s u-font-center"},this.props.mode===q.LINK_ONLY?this.props.contentInfo.isOSXPackage()?ee.span({},$("This package file can only be shared as a link.")+" ",ee.a({href:"/help/6691",target:"_blank"},$("Learn more"))):this.props.linkOnlyReason===B.INSIDE_SHARED_FOLDER?ee.span({},$("This folder can only be shared as a link because it’s in a shared folder.")+" ",ee.a({href:"/help/1931",target:"_blank"},$("Learn more"))):this.props.linkOnlyReason===B.CONTAINS_SHARED_FOLDER?ee.span({},$("This folder can only be shared as a link because it contains a shared folder.")+" ",ee.a({href:"/help/1931",target:"_blank"},$("Learn more"))):$("This folder can only be shared as a link."):this.props.isTeamSharedFolder&&this._shouldRenderTeamFolderNoPermissionMessage(this.props.members)?$("This folder is automatically shared with all members of %(team_name)s").format({team_name:this.props.ownerTeam.name}):this.props.isTeamSharedFolder?ee.span({},$("Only admins can change team folder membership.")+" ",ee.a({href:"/team?_tk=left_nav_team",target:"_blank"},$("See list of admins."))):$("You don’t have permission to manage membership of this folder"))},_renderConfidentialFolderSection:function(){return this.props.isConfidentialFolder?ee.div({className:"unified-share-modal__section unified-share-modal__confidential-folder u-pad-s u-font-center"},ee.span({},ne($("<b>Invite only.</b> Members of parent folders can’t access."),{b:ee.b()})," ",this.props.canUpdateConfidentiality?ee.a({onClick:this.props.onSetConfidentialClick},$("Settings")):void 0)):void 0},_renderContentManagerBridge:function(){var e;return e=te(this.props.isLimitedTeam,this.props.contentInfo.displayPath()),ee.div({className:"unified-share-modal__section unified-share-modal__no-permission u-pad-s u-font-center"},ee.span({},$("You can manage folder membership in the Admin Console. "),ee.a({href:e.toString(),target:"_blank"},$("Open in new tab."))))},_shouldRenderTeamFolderNoPermissionMessage:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){var n,o;return"team"===e.group_type&&(null!=(n=e.permissions.make_editor)?n.allow:void 0)&&(null!=(o=e.permissions.make_viewer)?o.allow:void 0)})},_isOwnerOfAtLeastOneGroup:function(e){return null!=e&&null!=e.groups&&e.groups.some(function(e,t){return e.is_owner})},_renderMainLoading:function(){return ee.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),ee.div({className:"u-font-center u-font-meta u-pad-top-xl"},ee.div({className:"c-loader"},$("Loading..."))))},_renderMainLinkOnly:function(){return ee.div({className:e(["unified-share-modal__main","unified-share-modal__main--link-only","unified-share-modal__section"])},this._renderLinkRow())},_renderMainMembership:function(){return ee.div({className:e(["unified-share-modal__main","unified-share-modal__section",this._shouldRenderFooterSection()?void 0:"unified-share-modal__main--no-footer"])},this._renderLinkRow(),this._hasNonOwnerMembers()?X(w,{actionHandler:this.props.actionHandler,canInviteMembers:this.props.canInviteEditor||this.props.canInviteViewer,canMakeViewerNoComment:this.props.canMakeViewerNoComment,canRelinquishMembership:this.props.canRelinquishMembership,canUpdateConfidentiality:this.props.canUpdateConfidentiality,contentInfo:this.props.contentInfo,viewerAccountId:this.props.user.account_id,disabled:this.props.showContentManagerBridge,membership:this.props.members,onMemberAccessChange:this.props.onMemberAccessChange,onSetConfidentialClick:this.props.onSetConfidentialClick,pendingRemoval:this.props.pendingRemoval,user:this.props.user,viewer:this.props.viewer}):this.props.banner===R.INPUT_CONTENT_NAME?ee.div({className:e(["unified-share-modal__input-content-name-banner","u-font-center","u-font-meta","u-mar-top-xs"])},X(c,{src:ie("/static/images/sharing/illo-name-folder-vfl38PzAv.png"),srcHiRes:ie("/static/images/sharing/illo-name-folder@2x-vflzK0uJv.png")}),ee.h3({className:e(["u-font-strong","u-mar-top-xs"])},$("Name your shared folder")),ee.p({className:e(["u-pad-left-xxl","u-pad-right-xxl"])},$("Shared folders are for collaborting on projects, client works, and organizing departments"))):ee.div({className:e(["unified-share-modal__no-members-banner","u-font-center","u-font-meta","u-mar-top-l","u-font-center","u-font-meta"])},this.props.isTeamSharedFolder?null!=this.props.teamGroupInfo?[ee.p({className:"u-mar-top-xxl"},ee.a({onClick:this._addEveryoneGroup},$("Add everyone at %(team_name)s").format({team_name:this.props.ownerTeam.name}))),ee.p({},$("Or, add groups to this team folder.")+" ",ee.a({href:"/team#groups/newgroup"},$("Create a group")))]:ee.p({className:"u-mar-top-xxl"},$("Add groups to this team folder.")+" ",ee.a({href:"/team#groups/newgroup"},$("Create a group"))):ee.div({},X(c,{className:"unified-share-modal__illo",src:ie("/static/images/sharing/sharing-invite-users-vflfTH_fj.png"),srcHiRes:ie("/static/images/sharing/sharing-invite-users@2x-vflgGHzXi.png")}),ee.p({className:"u-mar-top-s"},$("Add people you want to share with")))))},_renderMainShare:function(){return ee.div({className:"unified-share-modal__main unified-share-modal__section u-pad-s"},ee.textarea({placeholder:$("Add a message (optional)"),onChange:function(e){return function(t){return e.props.actionHandler.changeRecipientMessage(t.target.value)}}(this),value:this.props.recipientMessage}))},_renderMainShareSending:function(){return ee.div({className:"unified-share-modal__main unified-share-modal__main--text unified-share-modal__section u-pad-s u-font-center u-font-meta u-mar-top-xl"},$("Sending..."))},_renderLinkRow:function(){return this.props.suppressLinkUI?void 0:this.props.isLinkMetadataLoaded&&(this.props.isMetadataLoaded||this.props.mode===q.LINK_ONLY)?X(j,{actionHandler:this.props.actionHandler,canShareLink:this.props.canShareLink||this.props.mode===q.LINK_ONLY,contentInfo:this.props.contentInfo,linkMetadata:this.props.linkMetadata,onLinkSettingsClick:this.props.onLinkSettingsClick,user:this.props.user}):this.props.contentInfo.isTeamSharedFolder()?void 0:ee.div({className:"unified-share-modal__link-filler"})},_renderFeedbackCheckbox:function(){var e,t;return t=this._canSendFeedbackRequest(),e=$(t?"I want feedback on this file":"Post this message as a comment"),ee.div({className:"u-pad-top-xs"},ee.div({className:"unified-share-modal__add-message-as-comment-checkbox-container"},ee.input({type:"checkbox",id:"add_message_as_comment",name:"add_message_as_comment",checked:this.props.isAddMessageAsCommentChecked,onChange:this._handleAddMessageAsCommentChange}),this.props.isAddMessageAsCommentHelpShown?X(E,{onClose:this._commentsHelpClosed,onButtonClick:this._commentsHelpButtonClicked,isFeedbackRequest:t}):void 0),ee.label({htmlFor:"add_message_as_comment"},e))},_getMemberNum:function(){var e;return null!=this.props.memberCounts?this.props.memberCounts.total_unique_users:null!=(e=this.props.members)?e.getMemberCount():void 0},_hasNonOwnerMembers:function(){var e,t,n;return e=null!=(n=this.props.members)?n.getMemberCount():void 0,e?1===e&&1===this.props.members.users.count()?(t=this.props.members.users.first(),t.account_id!==this.props.user.account_id):!0:!1},_handleAddMessageAsCommentChange:function(e){return this.props.actionHandler.setAddMessageAsCommentChecked(e.target.checked)},_commentsHelpClosed:function(){return this.props.actionHandler.setAddMessageAsCommentHelpClosed()},_commentsHelpButtonClicked:function(){return this.props.actionHandler.setAddMessageAsCommentHelpClosed(),this.props.actionHandler.setAddMessageAsCommentChecked(!0)},_canSendFeedbackRequest:function(){return!!O.CAN_SEND_FEEDBACK_REQUEST[this.props.user.id]},_addEveryoneGroup:function(){var e;return null!=(e=this.refs.tokenizer)?e.addExternalContacts([a.teamGroupInfoToContact(this.props.teamGroupInfo)]):void 0},getRecipientTokens:function(){var e;return null!=(e=this.refs.tokenizer)?e.getContacts():void 0}}),Y=u(J,["/static/css/react/contacts_tokenizer-vflR5K70C.css","/static/css/scooter/scooter-scoped-vflx8uhBs.css","/static/css/sharing/share_modal-vflmiYW60.css"]),{ShareModalContent:Y,MODES:q}})}.call(this),function(){define("modules/clean/sharing/views/modal_link_info",["jquery","external/classnames","external/react","external/react-dom","modules/clean/clipboard_v2","modules/clean/react/sprite","modules/clean/react/util","modules/clean/sharing/actions/share_modal","modules/clean/sharing/api/types/metadata","modules/clean/sharing/content_info","modules/clean/sharing/link_description","modules/clean/sharing/ui_util","modules/clean/user","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b,w,T,S,C;return C=s.setStatePromise,f=l.LinkMetadata,v=l.SharedContentLinkMetadata,m=u.ContentInfo,w=c.formatLinkDescription,T=c.formatSharedContentLinkDescription,S=d.logTiburonEvent,y=h.i18n_default_project("sharing")._,E=n.createElement,b=n.DOM,g=n.createClass({displayName:"ModalLinkInfo",propTypes:{actionHandler:n.PropTypes.instanceOf(a),canShareLink:n.PropTypes.bool.isRequired,contentInfo:n.PropTypes.instanceOf(m).isRequired,linkMetadata:n.PropTypes.oneOfType([n.PropTypes.instanceOf(f),n.PropTypes.instanceOf(v)]),onCopyLinkClick:n.PropTypes.func,onLinkSettingsClick:n.PropTypes.func,user:n.PropTypes.instanceOf(p).isRequired},getInitialState:function(){return{showingUrl:!1}},componentWillMount:function(){var e;return this.clipboard=new i(null!=(e=this.props.linkMetadata)?e.url:void 0,function(){return _.success(y("Link copied to clipboard"))},function(){return _.error(y("Unable to copy the link, please copy manually"))},this._handleCopyLinkClicked)},componentDidMount:function(){return this.setupCopy()},componentDidUpdate:function(){return this.setupCopy()},setupCopy:function(){var t;return t=e(".copy-link-button"),t.length?this.clipboard.setupCopy(t,e(".copy-link-container")):void 0},render:function(){return null!=this.props.linkMetadata?this._renderLink():this.props.canShareLink?this._renderNoLink():null},_renderLink:function(){return b.div({className:"unified-share-modal-link-info o-flag u-mar-horizontal-s u-mar-bottom-s u-pad-top-s"},b.div({className:"o-flag__fix"},b.div({className:"unified-share-modal-link-info__icon"},E(r,{alt:"",group:"web",name:"shared_link_white"}))),b.div({className:"unified-share-modal-link-info__details o-flag__flex u-pad-left-xs"},function(){if(this.state.showingUrl)return[b.label({className:"ax-visually-hidden",htmlFor:"unified-share-modal-link-url",key:"link-label"},y("Shared link URL")),b.input({className:"unified-share-modal-link-info__url",id:"unified-share-modal-link-url",key:"link-url-input",onClick:this._handleUrlClick,readOnly:!0,ref:"urlField",type:"text",value:this.props.linkMetadata.url})];if(this.props.linkMetadata instanceof f)return w(this.props.linkMetadata);if(this.props.linkMetadata instanceof v)return T(this.props.linkMetadata);throw Error("Unsupported link metadata type "+this.props.linkMetadata._name)}.call(this)),b.ul({className:"unified-share-modal-link-info__actions o-flag__fix"},this.state.showingUrl?void 0:b.li({className:"u-l-ib"},b.button({className:"button-as-link",onClick:this.props.onLinkSettingsClick},y("Link settings")),b.span({className:"u-l-ib u-mar-left-xs u-mar-right-xs"},"•")),b.li({className:"u-l-ib"},b.button({className:"button-as-link copy-link-container",onClick:this._handleCopyLinkClicked},this.state.showingUrl?y("Hide link"):i.is_supported()?b.span({className:"copy-link-button"},y("Copy link")):y("Show link")))))},_renderNoLink:function(){return b.div({className:"unified-share-modal-link-info unified-share-modal-link-info--no-link o-flag u-mar-horizontal-s u-mar-bottom-s u-pad-top-s"},b.div({className:"o-flag__fix"},b.div({className:"unified-share-modal-link-info__icon"},E(r,{alt:"",group:"web",name:"shared_link_gray"}))),b.div({className:"unified-share-modal-link-info__details u-pad-left-xs o-flag__flex"},y("No link created yet")),b.div({className:"unified-share-modal-link-info__actions o-flag__fix"},b.button({className:"button-as-link",onClick:this.props.actionHandler.createSharedLink.bind(this.props.actionHandler)},y("Create a link"))))},_handleCopyLinkClicked:function(){return this.state.showingUrl||S(this.props.contentInfo,this.props.user.id,"CLICK_TIB_COPY_LINK"),C(this,{showingUrl:!this.state.showingUrl}).then(function(e){return function(){var t;return null!=e.refs.urlField?(t=o.findDOMNode(e.refs.urlField),t.focus(),t.select(),e.clipboard.do_copy()):void 0}}(this))},_handleUrlClick:function(e){return e.target.select()}}),{ModalLinkInfo:g}})}.call(this),function(){define("modules/clean/sharing/views/sharing_bubble_menu",["external/classnames","external/react","modules/clean/react/bubble_menu","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/sharing/api/types/metadata","modules/clean/sharing/constants","modules/clean/sharing/content_info","modules/clean/sharing/strings","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y,E,b,w,T;return h=n.BubbleMenu,_=n.BubbleMenuItem,y=i.Tooltip,E=i.TooltipPosition,g=r.MemberPermissions,c=s.ACCESS_LEVEL,p=s.ACCESS_VALUES,f=s.MEMBER_ACTION,m=a.ContentInfo,d=l.ACCESS_NAME,b=u.i18n_default_project("sharing")._,w=t.createElement,T=t.DOM,v=t.createClass({displayName:"SharingBubbleMenu",propTypes:{allowRelinquishMembership:t.PropTypes.bool,asButton:t.PropTypes.bool,canInviteMembers:t.PropTypes.bool,contentInfo:t.PropTypes.instanceOf(m).isRequired,currentAccess:t.PropTypes.oneOf(p).isRequired,disabled:t.PropTypes.bool,isInherited:t.PropTypes.bool,memberPermissions:t.PropTypes.instanceOf(g).isRequired,onAccessChange:t.PropTypes.func.isRequired,pendingAccessChange:t.PropTypes.oneOf(p)},getDefaultProps:function(){return{allowRelinquishMembership:!1,asButton:!1,canInviteMembers:!1,disabled:!1,pendingAccessChange:null}},_getMemberActionInfo:function(){return[[f.MAKE_EDITOR,{value:c.WRITER,title:d[c.WRITER],folder_description:b("People can edit, delete, comment, and add the files to their Dropbox"),file_description:b("People can edit, delete, comment, and add the file to their Dropbox")}],[f.MAKE_VIEWER,{value:c.READER,title:d[c.READER],folder_description:b("People can view, download, and comment"),file_description:b("People can view, download, and comment")}],[f.MAKE_VIEWER_NO_COMMENT,{value:c.READER_NO_COMMENT,title:d[c.READER_NO_COMMENT],folder_description:b("People can only view and download the files"),file_description:b("People can only view and download the file")}],[f.MAKE_OWNER,{value:c.OWNER,title:b("Make owner")}],[f.REMOVE,{value:"remove",title:this.props.allowRelinquishMembership?T.div({className:"u-font-danger"},b("Remove my access")):T.div({className:"u-font-danger"},b("Remove"))}]]},_renderMenuItem:function(e){var t,n,i,r,s;return s=e.value,r=e.title,n=e.file_description,i=e.folder_description,t=this.props.contentInfo.isFolder()?i:n,w(_,{className:"sharing-access-menu-item",key:s,onClick:function(e){return function(){return s!==e.props.currentAccess?e.props.onAccessChange(s):void 0}}(this)},T.div({className:"sharing-access-menu-item__left-margin u-l-ib u-l-ib--t"},s===this.props.currentAccess?w(o,{alt:"",group:"web",name:"check_gray"}):void 0),T.div({className:"sharing-access-menu-item__label u-l-ib u-l-ib--t"},T.div({className:"u-font-nowrap u-font-black sharing-access-menu-item__title"},r),T.div({className:"u-font-wrap u-font-meta sharing-access-menu-item__description"},t)))},_renderCurrentAccessText:function(t){return T.button({className:e(["sharing-access-menu__current-access","u-font-nowrap",this.props.asButton?["sharing-access-menu__current-access--button","c-btn","c-btn--secondary","u-trim-margin"]:{"c-borderless-button":!0,"change-access-button":!t}]),disabled:t},d[this.props.currentAccess],t?void 0:[T.div({className:"gray-arrow",key:"gray"},w(o,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-gray"})),T.div({className:"blue-arrow",key:"blue"},w(o,{alt:"",className:"u-l-ib u-l-ib--m u-mar-left-xs",group:"web",name:"arrow-down-blue"}))])},render:function(){var e,t,n,o,i,r,s,a;for(i=[],r=this._getMemberActionInfo(),t=0,o=r.length;o>t;t++)s=r[t],e=s[0],n=s[1],(n.value===this.props.currentAccess||(null!=(a=this.props.memberPermissions.get(e))?a.allow:void 0)||n.value===f.REMOVE&&this.props.allowRelinquishMembership)&&i.push(this._renderMenuItem(n));return i.length<=1&&this.props.isInherited&&this.props.canInviteMembers?w(y,{position:E.RIGHT,tooltip_contents:b("This member’s permissions can only be changed from a parent folder."),tooltip_classname:"sharing-access-menu__tooltip"},T.span({className:"ax-visually-hidden"},b("This member’s permissions can only be changed from a parent folder.")),this._renderCurrentAccessText(!0)):i.length<=1||this.props.pendingAccessChange?this._renderCurrentAccessText(!0):w(h,{targetButton:this._renderCurrentAccessText(this.props.disabled),targetFixed:!0,position:h.POSITIONS.BOTTOM_ALIGN_RIGHT,className:"sharing-access-menu o-list-ui o-list-ui--dividers",items:i,shouldShowArrow:!1,disabled:this.props.disabled,verticalDisplacement:this.props.asButton?-5:0})}})})}.call(this),function(){define("modules/clean/sharing/wizard/share_a_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/radio","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f,g,v,y;return y=n.text,u=o.Modal,p=i.RadioGroup,h=i.RadioItem,_=i.RadioItemVariant,c=l.ROLE_PERSONAL,d=l.ROLE_WORK,g=e.createElement,v=e.DOM,f=r.i18n_default_project("sharing")._,m=e.createClass({displayName:"ShareAFolderWizardModal",propTypes:{onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{option:"new-folder"}},render:function(){return g(u,{autoClose:!1,className:"shared-folder-wizard",buttonComponent:v.span(),title:function(){switch(this.props.user.role){case d:return f("Share a folder from your %(team_name)s Dropbox").format({team_name:a.get_viewer().team_name});case c:return f("Share a folder from your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return v.form({className:"shared-folder-wizard__contents",onSubmit:function(e){return function(t){var n;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},this._renderHeader(),this._renderRadio(),this._renderButtons())},_renderHeader:function(){return v.div({className:"shared-folder-wizard__header u-mar-bottom-s"},f("What would you like to do?"))},_renderRadio:function(){var e;return e={value:this.state.option,requestChange:this._handleChange},v.div({className:"radio-input"},g(p,{variant:_.Normal,legend:f("Share a Folder options"),displayLegend:!1,valueLink:e},this._renderRadioItems()))},_renderRadioItems:function(){var e,t;return t=g(h,{className:"u-pad-m",value:"new-folder",key:"new-folder-option"},v.div({className:"new-folder_title u-l-ib u-pad-left-xs"},f("I’d like to create and share a new folder"))),e=g(h,{className:"u-pad-m",value:"existing-folder",key:"existing-folder-option"},v.div({className:"existing-folder_title u-l-ib u-pad-left-xs"},f("I’d like to share an existing folder"))),[t,e]},_handleChange:function(e){return this.setState({option:e})},_renderButtons:function(){return v.div({className:"u-mar-top-m clearfix"},v.div({className:"u-l-fr"},v.button({className:"c-btn c-btn--primary",onClick:function(e){return function(t){var n;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.option)}}(this)},f("Next"))))}}),m=t(m,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),{ShareAFolderWizardModal:m}})}.call(this),function(){define("modules/clean/sharing/wizard/share_existing_folder_wizard_modal",["external/react","modules/clean/react/css","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/tree_view","modules/core/i18n","modules/clean/user","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,o,i,r,s,a,l){var u,c,d,p,h,_,m,f,g;return g=n.text,c=o.Modal,u=i.FolderTreeView,d=l.ROLE_PERSONAL,p=l.ROLE_WORK,m=e.createElement,f=e.DOM,_=r.i18n_default_project("sharing")._,h=e.createClass({displayName:"ShareExistingFolderWizardModal",propTypes:{onBack:e.PropTypes.func,onSubmit:e.PropTypes.func,user:e.PropTypes.instanceOf(s).isRequired},getInitialState:function(){return{folderPath:null,errorMsg:null}},render:function(){return m(c,{autoClose:!1,className:"existing-shared-folder-wizard",buttonComponent:f.span(),onDismissCompleted:function(){return c.close()},title:function(){switch(this.props.user.role){case p:return _("Choose a folder from your %(team_name)s Dropbox").format({team_name:a.get_viewer().team_name});case d:return _("Choose a folder from your personal Dropbox")}}.call(this)},this._renderContent())},_renderContent:function(){return f.form({className:"existing-shared-folder-wizard__contents",onSubmit:function(e){return function(){return e.props.onSubmit(e.state.folderPath,e._setError)}}(this)},this._renderError(),this._renderTreeView(),this._renderButtons())},_renderError:function(){var e;return null!=this.state.folderPath&&(null!=(e=this.state.errorMsg)?e.length:void 0)>0?f.div({className:"text-input-error-wrapper"},f.div({className:"text-input-error-text u-font-danger"},this.state.errorMsg)):void 0},_renderTreeView:function(){return f.div({className:"wizard-tree-view"},m(u,{user:this.props.user,onFolderSelected:this._setFolderPath,ref:"treeView"}))},_renderButtons:function(){return f.div({className:"u-mar-top-m clearfix"},f.div({className:"u-l-fr"},f.button({className:"c-btn c-btn--primary",disabled:!this._isValid(),onClick:function(e){return function(t){var n;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),e.props.onSubmit(e.state.folderPath,e._setError)}}(this)},_("Next"))),f.div({className:"u-l-fl"},f.button({className:"button-as-link",style:{lineHeight:"32px"},onClick:function(e){return function(t){var n,o;return"function"==typeof(n=t.nativeEvent).preventDefault&&n.preventDefault(),c.close(),"function"==typeof(o=e.props).onBack?o.onBack():void 0}}(this)},_("Back"))))},_setFolderPath:function(e){return this.setState({folderPath:e,errorMsg:null})},_setError:function(e){var t;return this.setState({errorMsg:null!=e&&null!=(t=e.path)?t.message_text:void 0})},_isValid:function(){return null!=this.state.folderPath&&null==this.state.errorMsg}}),h=t(h,["/static/css/sharing/wizard_modals-vfl2L3rOp.css"]),{ShareExistingFolderWizardModal:h}})}.call(this),define("modules/clean/teams/admin/api/admin_console_api_client",["require","exports","modules/clean/api_v2/client","modules/clean/teams/admin/api/types/managed_sync","modules/clean/filepath","modules/clean/viewer","modules/constants/viewer"],function(e,t,n,o,i,r,s){"use strict";var a=function(){function e(){var e=r.get_viewer();e.work_user&&(this.teamMemberId=e.work_user.team_member_id),this.userId=e.get_uid_by_role(s.ROLE_WORK),this.rpcClient=new n.TeamActionsClient}return e.prototype.setPermanentDeletePolicy=function(e){var t={permanent_delete_enabled:e},n="team/set_permanent_delete_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setMultipleAccountsPolicy=function(e){var t={multiple_accounts_enabled:e},n="team/set_multiple_accounts_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setFileRequestPolicy=function(e){var t={file_request_enabled:e},n="team/sharing/set_file_request_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSharedLinkPolicy=function(e,t){var n={sharing_outside_enabled:e};1==e&&(n.default_visibility=t);var o="team/sharing/set_shared_link_policy";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.setSharedFolderSharingPolicy=function(e){var t={sharing_outside_enabled:e},n="team/sharing/set_shared_folder_sharing_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSharedFolderJoiningPolicy=function(e){var t={joining_outside_enabled:e},n="team/sharing/set_shared_folder_joining_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setCommentingPolicy=function(e){var t={commenting_enabled:e},n="team/sharing/set_commenting_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.resetsAllPasswords=function(){var e="team/reset_all_passwords";return this.rpcClient.rpc(this.userId,e)},e.prototype.setPaperPolicy=function(e,t){var n={paper_enabled:e};t&&(n.dropbox_terms="agree");var o="team/paper/set_paper_policy";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.setPaperSharingPolicy=function(e,t){var n={external_sharing_allowed:void 0===e?!0:e,default_visibility:t},o="team/paper/set_paper_sharing_policy";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.setRequestMembershipPolicy=function(e){var t={request_membership:e},n="team/set_request_membership_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSuggestMembersPolicy=function(e){var t={suggest_members_enabled:e},n="team/set_suggest_members_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.deviceManagementGetExcludedUsers=function(){var e="team/device_management/get_excluded_users";return this.rpcClient.rpc(this.userId,e,null)},e.prototype.deviceManagementUpdateExcludedUsers=function(e,t){var n={users_to_add:e,users_to_remove:t},o="team/device_management/update_excluded_users";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.deviceManagementConfigureSettings=function(e){var t="team/device_management/configure_settings";return this.rpcClient.rpc(this.userId,t,e)},e.prototype.deviceManagementRemoveDevice=function(e,t){var n={user_id:e,device_id:t},o="team/device_management/remove_device";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.deviceManagementRemoveClient=function(e,t,n){var o={user_id:e,device_id:t,client_unique_identifier:n},i="team/device_management/remove_client";return this.rpcClient.rpc(this.userId,i,o)},e.prototype.teamFolderArchive=function(e){var t="team/team_folder/archive",n={team_folder_id:String(e),force_async_off:!0};return this.rpcClient.rpc(this.userId,t,n)},e.prototype.teamFolderUnarchive=function(e){var t="team/team_folder/activate",n={team_folder_id:String(e)};return this.rpcClient.rpc(this.userId,t,n)},e.prototype.teamFolderCreate=function(e,t){var n="team/team_folder/create",i={
name:e,default_sync_setting:o.defaultSyncSettingToApi(t)};return this.rpcClient.rpc(this.userId,n,i)},e.prototype.teamFoldersList=function(e){void 0===e&&(e=1e3);var t={limit:e},n="team/team_folder/list";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.teamFolderRename=function(e,t){var n="team/team_folder/rename",o={team_folder_id:String(e),name:t};return this.rpcClient.rpc(this.userId,n,o)},e.prototype.teamFolderPermanentlyDelete=function(e){var t="team/team_folder/permanently_delete",n={team_folder_id:String(e)};return this.rpcClient.rpc(this.userId,t,n)},e.prototype.updateDefaultSyncSetting=function(e,t,n){void 0===n&&(n="");var i={team_folder_id:String(e),default_sync_setting:o.defaultSyncSettingToApi(t),target_path:n},r="team/team_folder/update_default_sync_setting";return this.rpcClient.rpc(this.userId,r,i)},e.prototype.updateAllSyncSettings=function(e){var t={default_sync_setting:o.defaultSyncSettingToApi(e)},n="team/team_folder/update_all_default_sync_settings";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setTeamFolderInitialSyncSetting=function(e){var t={initial_sync_setting:o.defaultSyncSettingToApi(e)},n="team/set_team_folder_initial_sync_setting";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setSharedFolderInitialSyncSetting=function(e){var t={initial_sync_setting:o.defaultSyncSettingToApi(e)},n="team/set_shared_folder_initial_sync_setting";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setGroupsCreationPolicy=function(e){var t={group_creation:e},n="team/groups/set_creation_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setNTSBlockTrafficPolicy=function(e){var t={block_traffic_enabled:e},n="team/nts/set_block_traffic_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.setResellerSupportSetting=function(e){var t={reseller_support_enabled:e},n="team/change_reseller_support";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.folderCreate=function(e,t,n){"/"!=t&&(t+="/");var o="ns:"+e+t+n,i={path:o},r="files/create_folder",s={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,r,i,s)},e.prototype.bulkFileDelete=function(e){for(var t=[],n=null,o=0,i=e.length;i>o;o++)n=e[o],t.push({path:"ns:"+n.ns_id+n.ns_path});var r={entries:t},s="files/delete_batch_with_changeset_sync",a={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,s,r,a)},e.prototype.fileRename=function(e,t,n){var o="ns:"+e+t,i=t.substring(0,t.lastIndexOf("/"))+"/"+n,r="ns:"+e+i,s={from_path:o,to_path:r},a="files/move",l={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,a,s,l)},e.prototype.setInfinitePolicy=function(e,t){var n={policy:e,setting:t},o="team/set_infinite_policy";return this.rpcClient.rpc(this.userId,o,n)},e.prototype.unsetInfinitePolicy=function(e){var t={policy:e},n="team/unset_infinite_policy";return this.rpcClient.rpc(this.userId,n,t)},e.prototype.fileCopy=function(e,t,n){var o="ns:"+e+t,r=i.filename(t),s="ns:"+e+n+"/"+r,a={from_path:o,to_path:s},l="files/copy",u={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,l,a,u)},e.prototype.fileMove=function(e,t,n){var o="ns:"+e+t,r=i.filename(t),s="ns:"+e+n+"/"+r,a={from_path:o,to_path:s},l="files/move",u={"Dropbox-API-Select-Admin":this.teamMemberId};return this.rpcClient.rpc(this.userId,l,a,u)},e}();t.AdminConsoleApiClient=a,t.default=a}),function(){define("modules/clean/teams/admin/api/types/managed_sync",["external/immutable","modules/clean/api_v2/types"],function(e,t){var n,o,i,r,s,a,l,u,c,d,p;return l=t.UnionScalar,n={SYNC:"sync",NO_SYNC:"no_sync"},r={INITIALIZE_SYNC_PAGE:"INITIALIZE_SYNC_PAGE",SET_SYNC_SETTING_REQUEST:"SET_SYNC_SETTING_REQUEST",SET_SYNC_SETTING_FAILURE:"SET_SYNC_SETTING_FAILURE",SET_SYNC_SETTING_SUCCESS:"SET_SYNC_SETTING_SUCCESS",SET_ALL_SYNC_SETTING_REQUEST:"SET_ALL_SYNC_SETTING_REQUEST",SET_ALL_SYNC_SETTING_FAILURE:"SET_ALL_SYNC_SETTING_FAILURE",SET_ALL_SYNC_SETTING_SUCCESS:"SET_ALL_SYNC_SETTING_SUCCESS",SET_TEAM_FOLDER_DEFAULT_REQUEST:"SET_TEAM_FOLDER_DEFAULT_REQUEST",SET_TEAM_FOLDER_DEFAULT_FAILURE:"SET_TEAM_FOLDER_DEFAULT_FAILURE",SET_SHARED_FOLDER_DEFAULT_REQUEST:"SET_SHARED_FOLDER_DEFAULT_REQUEST",SET_SHARED_FOLDER_DEFAULT_FAILURE:"SET_SHARED_FOLDER_DEFAULT_FAILURE",SET_INFINITE_POLICY_REQUEST:"SET_INFINITE_POLICY_REQUEST",SET_INFINITE_POLICY_FAILURE:"SET_INFINITE_POLICY_FAILURE",UNSET_INFINITE_POLICY_REQUEST:"UNSET_INFINITE_POLICY_REQUEST",UNSET_INFINITE_POLICY_FAILURE:"UNSET_INFINITE_POLICY_FAILURE"},o={INITIAL_ROOT_POLICY:new l("initial_root_policy"),LOCKED_ROOT_POLICY:new l("locked_root_policy")},i={ON_DEMAND:new l("on_demand"),LOCAL:new l("local")},u=function(e){switch(e){case n.SYNC:return new l(n.SYNC);case n.NO_SYNC:return new l(n.NO_SYNC)}},c=function(e){return e?n.SYNC:n.NO_SYNC},a=!1,s=e.Record({name:"",nsId:0,shouldSync:!0},"ManagedSyncInfo"),p=function(e){return new s({name:e.name,nsId:e.target_ns,shouldSync:0===e.managed_sync_setting})},d=function(e){var t,n,o,i,r,s;for(s=p(e.team_folder),r={},i=e.subfolders,n=0,o=i.length;o>n;n++)t=i[n],r[t.name]=p(t);return[s,r]},{DEFAULT_SYNC_SETTING:n,ManagedSyncActionTypes:r,InfinitePolicy:o,InfinitePolicySetting:i,defaultSyncSettingToApi:u,getDefaultSyncSetting:c,ManagedSyncInfo:s,serverManagedSyncInfoToRecord:p,serverManagedSyncInfoMapToRecord:d,SHOULD_RENDER_SIZE_COL:a}})}.call(this),function(){define("modules/clean/teams/limited_team_invite_form",["external/underscore","external/classnames","external/react","modules/core/uri","modules/core/i18n","modules/clean/react_format","modules/clean/ajax","modules/clean/css","modules/clean/contacts/data","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/react/input","modules/clean/react/modal"],function(e,t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R;b=i._,R=i.ungettext,A=r.reactFormat,h=l.Contact,m=u.ContactsTokenizer,_=u.ContactTokenState,E=p.Modal,T=n.DOM,P=n.PropTypes,f=function(){function e(){this.inFlight=!0,this.canInvite=!1,this.reason="checking",this.callbacks=[]}return e.prototype.whenReady=function(e){return this.inFlight?this.callbacks.push(e):e()},e.prototype.resultArrived=function(e,t){var n,o,i,r;if(this.inFlight){for(this.inFlight=!1,this.canInvite=e,this.reason=t,r=this.callbacks,o=0,i=r.length;i>o;o++)(n=r[o])();return delete this.callbacks}},e}(),g=function(){function e(e){this.checkUrl=e,this.checkedEmails={}}return e.prototype.checkEmails=function(e,t){var n,o,i,r,a,l,u;if(l={},u=e.length,0===u)return t(l);for(i=[],r=0,a=e.length;a>r;r++)o=e[r],n=this.checkedEmails[o],n||(n=this.checkedEmails[o]=new f,i.push(o)),n.whenReady(function(){return l[o]=n,0===--u?t(l):void 0});!function(e){return function(t){return s.WebRequest({url:e.checkUrl,data:{emails:t.join(",")},success:function(t){var n,i,r,s,a,l;r=JSON.parse(t),l=[];for(o in r)s=r[o],n=s.can_invite,i=s.reason,l.push(null!=(a=e.checkedEmails[o])?a.resultArrived(n,i):void 0);return l},error:function(){var n,i,r;for(r=[],n=0,i=t.length;i>n;n++)o=t[n],r.push(delete e.checkedEmails[o]);return r}})}}(this)(i)},e.prototype.getEmailCheckResult=function(e){return this.checkedEmails[e]},e}(),v={existingTeam:{id:"existingTeam",checkUrl:"/team/manage/check_can_invite"},createLimitedTeam:{id:"createLimitedTeam",checkUrl:"/team/create_limited/check_can_invite"}},S={};for(I in v)N=v[I],C=N.id,w=N.checkUrl,S[C]=new g(w);return y=n.createClass({displayName:"LimitedTeamInviteForm",propTypes:{user:P.object.isRequired,invitationContext:P.oneOf(e.values(v)),populatedCustomMessage:P.string,populatedContacts:P.arrayOf(P.instanceOf(h)),customClass:P.string,onChange:P.func,emailPlaceholder:P.string,messagePlaceholder:P.string,errorMessageSpaceFixed:P.bool,emailCheckerStore:P.object,includeCustomMessage:P.bool,autofocusTokenizer:P.bool,memberInviteLimit:P.number,maxTeamSize:P.number,tokenSpacing:P.number},statics:{InvitationContexts:v},getDefaultProps:function(){return{customClass:"",invitationContext:v.existingTeam,populatedContacts:[],emailPlaceholder:b("Name or email"),messagePlaceholder:b("Add a message (optional)"),includeCustomMessage:!0,autofocusTokenizer:!0}},getInitialState:function(){return{errorMessage:null}},componentWillMount:function(){return a.require_css("/static/css/teams/limited_team_invite_form-vflX7ACyW.css"),a.require_css("/static/css/react/contacts_tokenizer-vflR5K70C.css"),this.emailCheckerStore=this.props.emailCheckerStore||S[this.props.invitationContext.id],this.props.populatedContacts.length>0?this._ensureContactsStateUpdated(this.props.populatedContacts,function(e){return function(){var t;return e._updateErrorMessage(),"function"==typeof(t=e.props).onChange?t.onChange():void 0}}(this)):void 0},getContacts:function(){return this.refs.tokenizer.getContacts()},getFinalData:function(t){var n,o;return this.refs.tokenizer.tokenizeAll(),n=this.getContacts(),this.props.includeCustomMessage&&(o=this.refs.message.getValue()),this._ensureContactsStateUpdated(n,function(i){return function(){var r,s;return r=e.filter(n,function(e){return e.type===c.EMAIL}),s=e.map(r,function(e){return e.email}),i._updateErrorMessage(),t({emails:s,custom_message:o})}}(this))},areAllContactsValid:function(){var t;return this._overInviteLimit()?!1:(t=this.refs.tokenizer.serializeInputData().tokens,0===t.length?!0:e.all(t,function(e){return function(t){return e._validateContact(t).state===_.ok}}(this)))},isEmpty:function(){var e,t,n;return e=this.refs.tokenizer.serializeInputData(),t=e.tokens,n=e.value,0===t.length&&0===n.length},_ensureContactsStateUpdated:function(t,n){var o;return t=e.filter(t,function(e){return e.type===c.EMAIL&&!e.invalid&&!e.on_team}),o=e.map(t,function(e){return e.email}),this.emailCheckerStore.checkEmails(o,function(e){return function(){return e.isMounted()?n():void 0}}(this))},_validateContact:function(e){var t,n;return e.invalid?n={state:_.invalid,msg:b("Invalid email.")}:e.on_team?n={state:_.invalid,msg:b("User is already a member of this team.")}:(t=this.emailCheckerStore.getEmailCheckResult(e.email),n=t?t.inFlight?{state:_.pending}:t.canInvite?{state:_.ok}:{state:_.invalid,msg:function(){switch(t.reason){case"team_member":return b("This person is already on another team.");case"already_on_this_team":return b("User is already invited to this team.");case"error":return b("User isn’t eligible to join this team.");default:return null}}()}:{state:_.invalid}),n},_overInviteLimit:function(){var e;return e=this.refs.tokenizer.serializeInputData().tokens,null!=this.props.memberInviteLimit&&e.length>this.props.memberInviteLimit},_updateErrorMessage:function(){var e,t,n,i,r,s,a,l,u;for(s=this.refs.tokenizer.serializeInputData().tokens,t=0,n=s.length;n>t;t++)if(e=s[t],a=this._validateContact(e),l=a.state,i=a.msg,l!==_.ok)return void this.setState({errorMessage:i});return this._overInviteLimit()?(r={tk:this.props.maxTeamSize,_camp:"invite"},u=o({path:"/team/upgrade",query:r}),void this.setState({errorMessage:A(R("You have %(num_rem)s invite remaining. <upgradeLink>Upgrade</upgradeLink> now to add as many members as you like to your team.","You have %(num_rem)s invites remaining. <upgradeLink>Upgrade</upgradeLink> now to add as many members as you like to your team.",this.props.memberInviteLimit),{num_rem:this.props.memberInviteLimit,upgradeLink:T.a({href:u.toString()})})})):this.setState({errorMessage:null})},onContentsChange:function(e,t){return this._ensureContactsStateUpdated(e,function(e){return function(){var t;return e._updateErrorMessage(),"function"==typeof(t=e.props).onChange?t.onChange():void 0}}(this))},render:function(){var e;return e={"limited-team-invite-form":!0,"error-message-fixed":this.props.errorMessageSpaceFixed,"has-custom-message":this.props.includeCustomMessage},this.props.customClass&&(e[this.props.customClass]=!0),T.div({className:t(e)},T.div({className:"error-message u-mar-bottom-xss"},this.state.errorMessage),n.createElement(m,{ref:"tokenizer",user:this.props.user,placeholder:this.props.emailPlaceholder,onContentsChange:this.onContentsChange,autofocus:this.props.autofocusTokenizer,populatedInputData:{tokens:this.props.populatedContacts,value:""},tokenSpacing:this.props.tokenSpacing,customContactValidator:this._validateContact,customContactFilter:function(e){return function(t){return t.type===c.EMAIL&&!t.team&&t.name&&t.email!==e.props.user.email}}(this)}),this.props.includeCustomMessage?n.createElement(d.textarea,{ref:"message",className:"custom-message","disable-errors":!0,placeholder:this.props.messagePlaceholder,value:this.props.populatedCustomMessage}):void 0)}})})}.call(this),function(){define("modules/clean/teams/modals/suggest_team_invite_modal",["external/react","external/underscore","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/ajax","modules/clean/contacts/data","modules/clean/contacts/types","modules/clean/teams/limited_team_invite_form","modules/clean/react/modal","modules/clean/react/input","modules/clean/viewer"],function(e,t,n,o,i,r,s,a,l,u,c,d,p){var h,_,m,f,g,v,y,E;return g=o._,f=r.TeamsWebActionsLogger,h=a.Contact,_=c.Modal,v=e.DOM,y=e.PropTypes,E=p.get_viewer(),m=e.createClass({displayName:"SuggestTeamInviteModal",statics:{showIfNeeded:function(n,o){return m.showInviteModal(function(i){return i?m.validateSuggestions(n,function(i){var r;return i.length>0?("function"==typeof o.onCheckCompleted&&o.onCheckCompleted(!0),o=t.extend({},o,{usersSharedOnFolder:n.emails,suggestedUsersToInviteToTeam:i}),r=e.createElement(m,o),_.showInstance(r)):"function"==typeof o.onCheckCompleted?o.onCheckCompleted(!1):void 0}):"function"==typeof o.onCheckCompleted?o.onCheckCompleted(!1):void 0})},validateSuggestions:function(e,t){return s.WebRequest({url:"/team/validate_emails_to_suggest_inviting",data:{emails_to_verify:JSON.stringify(e.emails)},success:function(e){return e=JSON.parse(e),t(e)}})},showInviteModal:function(e){var t;return(null!=(t=E.work_user)?t.is_team:void 0)?m._getShouldShowInviteModalData(function(t){return e(t.isOnLimitedTeam&&!t.hasSeenSuggestTeamInviteModal)}):e(!1)},_getShouldShowInviteModalData:function(e){return s.WebRequest({url:"/team/should_show_invite_modal",success:function(t){return t=JSON.parse(t),e(t)}})}},propTypes:{sharingType:y.string.isRequired,suggestedUsersToInviteToTeam:y.arrayOf(y.string).isRequired,usersSharedOnFolder:y.arrayOf(y.string),teamName:y.string,onDidAccept:y.func,onDidDismiss:y.func,onDidClose:y.func},getDefaultProps:function(){return{onDidAccept:function(){},onDidDismiss:function(){},teamName:E.team_name}},getInitialState:function(){return{canAccept:this.props.suggestedUsersToInviteToTeam.length>0,submitting:!1,errors:null}},_canAccept:function(){var e,t;return(null!=(e=this.refs.members)?e.areAllContactsValid():void 0)&&!(null!=(t=this.refs.members)?t.isEmpty():void 0)},onAccept:function(e){return this.refs.members.getFinalData(function(e){return function(o){var r,a,l;return l=o.emails,a=o.custom_message,r=e._canAccept(),e.setState({canAccept:r}),r?(e.setState({submitting:!0}),s.WebRequest({url:"/account/team/add_users",subject_user:E.work_user,data:{emails:l,custom_message:a,team_id:E.team_id},complete:function(){return null!=e.refs.modal?e.setState({submitting:!1}):void 0},success:function(n){var o,r,s,a,u;return n=JSON.parse(n),a=t.values(n.users),u=void 0,1===a.length?u=g("Member invited."):a.length>1&&(u=g("Members invited.")),u?(i.success(u),f.log("team_member_invited_to_team_while_sharing",s={sharing_type:e.props.sharingType,num_users_invited_to_team:null!=l?l.length:void 0}),"function"==typeof(o=e.props).onDidAccept&&o.onDidAccept(),e.refs.modal.close(),"function"==typeof(r=e.props).onDidClose?r.onDidClose():void 0):i.error()},error:function(e){return"rate-limit"===e.getResponseHeader("x-dropbox-app-error")?i.error(new n(g('%(team_name)s has reached the maximum number of team members allowed on Dropbox Basic. Please <a href="/business/contact">contact sales</a> to add more members to your team.').format({team_name:E.team_name}))):i.error()}})):void 0}}(this))},onDidDismiss:function(){var e,t;return"function"==typeof(e=this.props).onDidDismiss&&e.onDidDismiss(),"function"==typeof(t=this.props).onDidClose?t.onDidClose():void 0},onMembersFormChange:function(){return this.setState({canAccept:this._canAccept()})},componentDidMount:function(){var e,t,n;return f.log("team_member_saw_suggestions_while_sharing",e={sharing_type:this.props.sharingType,num_users_shared:null!=(t=this.props.usersSharedOnFolder)?t.length:void 0,num_users_suggested_to_team:null!=(n=this.props.suggestedUsersToInviteToTeam)?n.length:void 0}),s.WebRequest({url:"/team/saw_suggest_team_invite_modal"})},render:function(){var t,n;return n=function(){var e,n,o,i;for(o=this.props.suggestedUsersToInviteToTeam,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(new h({email:t,type:l.EMAIL}));return i}.call(this),e.createElement(_,{className:"suggest-team-invite-modal",title:g("Do you want to invite these people to join your “%(team_name)s” team?").format({team_name:this.props.teamName}),acceptButtonText:g("Invite"),dismissButtonText:g("No thanks"),acceptButtonDisabled:!this.state.canAccept,submitting:this.state.submitting,onAccept:this.onAccept,onDismissCompleted:this.onDidDismiss,autoClose:!1,ref:"modal"},e.createElement(u,{ref:"members",errorMessageSpaceFixed:!0,invitationContext:u.InvitationContexts.existingTeam,onChange:this.onMembersFormChange,user:E.work_user,populatedContacts:n,autofocusTokenizer:!0}))}})})}.call(this),function(){define("modules/clean/teams/prop_types",["external/react"],function(e){var t;return t=e.PropTypes,{joinableTeam:t.shape({team_id:t.number,team_name:t.string,num_members:t.number,is_invite:t.bool,is_limited:t.bool,join_request_state:t.number,signup_key:t.string,inviting_user_name:t.string,approver_display_name:t.string,members_to_display:t.arrayOf(t.shape({display_name:t.string.isRequired,avatar_url:t.string}))}),suggestedMember:t.shape({id:t.number,email:t.string,display_name:t.string,avatar_url:t.string}),valueLink:function(e){return null==e&&(e=t.any),t.shape({value:e,requestChange:t.func.isRequired})}}})}.call(this),function(){define("modules/clean/teams/team_assume_user_personal_locked_modal",["external/react","modules/core/i18n","modules/clean/react/modal"],function(e,t,n){var o,i,r,s,a;return r=t._,i=n.Modal,a=e.DOM,s=e.createElement,o=e.createClass({displayName:"AssumePersonalLockedModal",statics:{show:function(e){return i.showInstance(s(o,e))}},propTypes:{displayName:e.PropTypes.string,teamName:e.PropTypes.string},_close:function(e){return e.preventDefault(),i.close()},_getModalProps:function(){return{title:r("Personal account not accessible"),acceptButtonText:r("Close"),dismissButtonText:null,onAccept:this._close}},render:function(){return s(i,this._getModalProps(),a.div({className:"team-assume-user-modal"},r("%(display_name)s’s personal account isn’t managed by the %(team_name)s team, so its contents aren’t accessible to admins.").format({display_name:this.props.displayName,team_name:this.props.teamName})))}}),{AssumePersonalLockedModal:o}})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=function(e,t){function o(){this.constructor=e}for(var i in t)n.call(t,i)&&(e[i]=t[i]);return o.prototype=t.prototype,e.prototype=new o,e.__super__=t.prototype,e},n={}.hasOwnProperty;define("modules/clean/teams/team_folder_modal",["modules/core/browser","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(n,o,i){var r,s;return r=i.DBModal,s=function(i){function r(){return this.on_confirm_button_click=e(this.on_confirm_button_click,this),this._$form=e(this._$form,this),r.__super__.constructor.apply(this,arguments)}return t(r,i),r.prototype._$form=function(){return this.$modal_window.find(".new_team_folder_form")},r.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this._$form().submit()},r.prototype.on_show=function(){var e;return e=this._$form(),new o(e),e.on(o.SUCCESS_EVENT,function(e){return function(t,o){return e.options.open_created_folder?n.redirect(o.sf_info.href):n.reload()}}(this)),this.options.back_fn?this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn(t,e)}}(this)):void 0},r}(r)})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/tokenizer",["external/classnames","external/react","external/react-dom","jquery","external/underscore","modules/clean/keycode","modules/clean/typeahead"],function(t,n,o,i,r,s,a){var l,u,c,d;return c=a.TypeaheadSelector,d=n.DOM,l=n.createClass({displayName:"Token",propTypes:{className:n.PropTypes.string,data:n.PropTypes.any,onRemove:n.PropTypes.func},render:function(){var e;return e={"tokenizer-token":!0},e[this.props.className]=!0,d.a(i.extend({tabIndex:-1},this.props,{className:t(e)}),String(this.props.data),this._makeCloseButton())},_makeCloseButton:function(){return this.props.onRemove?d.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),u=n.createClass({displayName:"Tokenizer",propTypes:{customClass:n.PropTypes.string,dataSource:n.PropTypes.object.isRequired,initialInputText:n.PropTypes.string,logSearchBegin:n.PropTypes.func,logSearchComplete:n.PropTypes.func,logTokenChangeEvent:n.PropTypes.func,onContentsChange:n.PropTypes.func,onTokensAdd:n.PropTypes.func,onTokenRemove:n.PropTypes.func,placeholderText:n.PropTypes.string,populatedTokenData:n.PropTypes.array,renderToken:n.PropTypes.func.isRequired,renderTokenHover:n.PropTypes.func,renderInput:n.PropTypes.func.isRequired,renderSelector:n.PropTypes.func.isRequired,stringTokenizer:n.PropTypes.func.isRequired,tokenSpacing:n.PropTypes.number,focusOnMount:n.PropTypes.bool,tabIndex:n.PropTypes.number},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return d.input()},renderSelector:function(){return n.createElement(c,null)},renderToken:function(e){return n.createElement(l,{data:e})},stringTokenizer:function(e,t){var n,o;return n=e.split(","),o=t?"":n.pop(),{tokens:n,value:o}},tokenSpacing:3,focusOnMount:!1,logSearchBegin:null,logSearchComplete:null}},getInitialState:function(){return this.tokenData=[],{queryResults:null,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150,numLines:1}},componentDidMount:function(){var e,t;return setTimeout(this._resizeTokenizerInput,0),o.findDOMNode(this.refs.input).value=this.props.initialInputText,i(o.findDOMNode(this.refs.tokenizer_input)).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1),this.props.focusOnMount&&o.findDOMNode(this.refs.input).focus(),"function"==typeof(e=this.props.dataSource).registerForUpdates&&e.registerForUpdates(this._dataUpdatedCallback),(null!=(t=this.props.populatedTokenData)?t.length:void 0)>0?this._addTokens(this.props.populatedTokenData,!1,null):void 0},componentWillUnmount:function(){return i(o.findDOMNode(this.refs.tokenizer_input)).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(){return this._resizeTokenizerInput()},render:function(){var e,n;return e={"react-tokenizer":!0},null!=this.props.customClass&&(e[this.props.customClass]=null!=this.props.customClass),n={padding:this.props.tokenSpacing,paddingRight:0,maxHeight:this.props.tokenSpacing+3*(this.props.tokenSpacing+29)+14+2},this.state.numLines>3&&(n.overflowY="auto",n.overflowX="visible"),d.div({onClick:this._handleMyClick,className:t(e)},d.div({className:"tokenizer-input",ref:"tokenizer_input",style:n},d.div({className:"token-container",style:{marginLeft:-this.props.tokenSpacing,marginBottom:-this.props.tokenSpacing}},this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:o.findDOMNode(this.refs.input).value}},tokenizeAll:function(){var e,t;return e=o.findDOMNode(this.refs.input),t=this.props.stringTokenizer(e.value,!0).tokens,t.length>0&&this._addTokens(t,!1),e.value="",this.refs.selector.close()},addExternalTokens:function(e){this._addTokens(e,!1,null),this.refs.selector.close()},queryDataSource:function(t){return this.props.dataSource.query(t,function(n){return function(o){var i,s,a;return t||(o=null),s=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},a=r.map(n.tokenData,s),o=null!=o?o.filter(function(t){var n;return n=s(t),e.call(a,n)<0}):null,n.setState({queryResults:o}),"function"==typeof(i=n.props).logSearchComplete?i.logSearchComplete(t,(null!=o?o.length:void 0)||0):void 0}}(this))},_dataUpdatedCallback:function(){var e,t;return this.isMounted()?(e=Boolean(this.state.queryResults),null!=(t=this.refs.selector)&&"function"==typeof t.reset&&t.reset(),e&&o.findDOMNode(this.refs.input).focus(),this.queryDataSource(o.findDOMNode(this.refs.input).value)):void 0},_addTokens:function(t,n,i){var s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w;for(null==n&&(n=!1),null==i&&(i=null),c=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},w=r.map(this.tokenData,c),f=[],d=0,_=t.length;_>d;d++)b=t[d],h=c(b),e.call(w,h)<0&&(f.push(b),w.push(h));for(this.tokenData=this.tokenData.concat(f),this.setState({tokenData:this.tokenData}),"function"==typeof(s=this.props).onTokensAdd&&s.onTokensAdd(f,this),"function"==typeof(a=this.props).onContentsChange&&a.onContentsChange(this.tokenData,null!=(g=o.findDOMNode(this.refs.input))?g.value:void 0),u=n?{search_expr:i,selected_pos:(null!=(v=this.refs.selector)?v.state.selectionIndex:void 0)||0,num_query_results:null!=(y=this.state.queryResults)?y.length:void 0,did_select_suggestion:!0}:{did_select_suggestion:!1},E=[],p=0,m=f.length;m>p;p++)b=f[p],E.push("function"==typeof(l=this.props).logTokenChangeEvent?l.logTokenChangeEvent(b,!1,u):void 0);return E},_addToken:function(e,t,n){return null==t&&(t=!1),null==n&&(n=null),this._addTokens([e],t,n)},removeTokens:function(e){var t,n,i,r,s,a,l,u,c,d,p,h,_,m;for(m=this.state.selectedTokenIndex,_=[],a=0,c=e.length;c>a;a++)r=e[a],h=this.tokenData.indexOf(r),-1!==h&&(m===h?m=null:m>h&&(m-=1),this.tokenData.splice(h,1),_.push(r));for(s=o.findDOMNode(this.refs.input),s.focus(),this._setSelectedToken(m),this.setState({tokenData:this.tokenData,queryResults:null}),l=0,d=_.length;d>l;l++)r=_[l],"function"==typeof(t=this.props).onTokenRemove&&t.onTokenRemove(r);for(u=0,p=_.length;p>u;u++)r=_[u],"function"==typeof(n=this.props).logTokenChangeEvent&&n.logTokenChangeEvent(r,!0);return"function"==typeof(i=this.props).onContentsChange?i.onContentsChange(this.tokenData,s.value):void 0},removeToken:function(e){return this.removeTokens([e])},replaceTokens:function(e){var t,n,i,s;return i=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},n=function(e){var t,n;return t=e[0],n=e[1],i(t)===i(n)},e.length===this.tokenData.length&&r.every(r.zip(this.tokenData,e),n)?void 0:(this.tokenData=e,this.setState({tokenData:e}),"function"==typeof(t=this.props).onContentsChange?t.onContentsChange(this.tokenData,null!=(s=o.findDOMNode(this.refs.input))?s.value:void 0):void 0)},_renderTokens:function(){var e,o,i,r,s,a,l,u,c,d,p,h;for(d=[],l=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},c=this.state.tokenData,s=a=0,u=c.length;u>a;s=++a)i=c[s],h=this.props.renderToken(i),p=this.state.selectedTokenIndex===s,r="function"==typeof(e=this.props).renderTokenHover?e.renderTokenHover(i):void 0,o=[{selected:p,"c-title-bubble":null!=r,"c-title-bubble--s":null!=r}],d.push(n.cloneElement(h,{ref:"token"+s,key:"token"+l(i),style:{margin:"0 0 "+this.props.tokenSpacing+"px "+this.props.tokenSpacing+"px"},className:t(o,h.props.className),"data-title":r,onClick:this._setSelectedToken.bind(this,s),onRemove:this.removeToken.bind(this,i),tokenSpacing:this.props.tokenSpacing}));return d},_renderSelector:function(){return n.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var e;return e=this.state.tokenData.length?"":this.props.placeholderText,n.cloneElement(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth,marginLeft:this.props.tokenSpacing,marginBottom:this.props.tokenSpacing},onChange:this._textUpdated,placeholder:e,tabIndex:this.props.tabIndex,onClick:this._setSelectedToken.bind(this,null)})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenComponents:function(){var e;return function(){var t,n,o;for(o=[],e=t=0,n=this.state.tokenData.length;n>=0?n>t:t>n;e=n>=0?++t:--t)o.push(this.refs["token"+e]);return o}.call(this).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(o.findDOMNode(this.refs["token"+e]).focus(),this.refs.selector.close()):o.findDOMNode(this.refs.input).focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(){var e,t,n,i,r,s,a,l,u,c,d,p,h;for(i=function(e){return o.findDOMNode(e).clientWidth},t=80,p=i(this._getTokenizerInput()),n=this.props.tokenSpacing+2,e=this.props.tokenSpacing,l=0,h=this._getTokenComponents(),u=1,s=0,a=h.length;a>s;s++)c=h[s],d=i(c)+n,l+d+e>p&&(u+=1,l=0),l+=d;return r=p-l-e-2,t>r&&(u+=1,r=p-e),r!==this.state.inputWidth&&this.setState({inputWidth:r}),u!==this.state.numLines?this.setState({numLines:u}):void 0},_onSelect:function(e){var t;return t=o.findDOMNode(this.refs.input),t.focus(),this._addToken(e,!0,t.value),t.value="",this.setState({queryResults:null})},_handleMyClick:function(e){var t;return"function"==typeof(t=e.nativeEvent).stopImmediatePropagation?t.stopImmediatePropagation():void 0},_handleDocumentClick:function(e){return this.refs.selector.close()},_proxyKeys:function(e){var t;if(this._shouldListenForTokenNavigation())switch(t=this.state.selectedTokenIndex,e.keyCode){case s.BACKSPACE:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]));case s.LEFT:return void(null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1));case s.RIGHT:if(null!==t)return void(t>=this.state.tokenData.length-1?this._setSelectedToken(null):this._setSelectedToken(t+1));break;case s.DELETE:if(null!==t)return void this.removeToken(this.state.tokenData[t])}return this.refs.selector.onKeyDown(e),e.isDefaultPrevented()?void 0:e.keyCode===s.TAB&&""!==o.findDOMNode(this.refs.input).value?(this.tokenizeAll(),e.preventDefault()):void 0},_shouldListenForTokenNavigation:function(){var e;return this.state.tokenData.length?(e=o.findDOMNode(this.refs.input),0===e.selectionStart&&0===e.selectionEnd):!1},_textUpdated:function(){var e,t,n,i,r,s,a;return n=o.findDOMNode(this.refs.input),i=n.value,r=this.props.stringTokenizer(i),s=r.tokens,a=r.value,"function"==typeof(e=this.props).logSearchBegin&&e.logSearchBegin(a),a!==i&&(n.value=a,a||this.refs.selector.close()),s.length>0?this._addTokens(s,!1):"function"==typeof(t=this.props).onContentsChange&&t.onContentsChange(this.tokenData,a),this.queryDataSource(a)},_clearResults:function(){return this.setState({queryResults:null})}}),{Token:l,Tokenizer:u}})}.call(this),function(){define("modules/clean/top_notif",["jquery","modules/clean/ajax"],function(e,t){var n,o,i,r,s;return s={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){return e("#top-notification-bar-container").remove(),e("body").removeClass("top-notification-bar"),e(".maestro .has-top-notification").removeClass("has-top-notification"),e(document).trigger(this.HIDE_EVENT)}},n={init:function(){return e(".eu-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.SilentBackgroundRequest({url:"/dismiss_eu_cookie_notification"})})}},o={init:function(){return e(".expired-ios-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.SilentBackgroundRequest({url:"/dismiss_expired_ios_notification"
})})}},i={init:function(){return e("#locale-switch-banner-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.SilentBackgroundRequest({url:"/dismiss_locale_switch_banner"})})}},r={init:function(){return e("#super-inactive-recover-bar-dismiss").on("click",function(e){return e.preventDefault(),s.hide(),t.SilentBackgroundRequest({url:"/dismiss_super_inactive_recover_bar"})})}},{TopNotificationBar:s,EUCookieNotificationBar:n,ExpiredIOSNotificationBar:o,LocaleSwitchBar:i,SuperInactiveRecoverBar:r}})}.call(this),function(){define("modules/clean/typeahead",["external/classnames","external/react","external/react-dom","external/underscore","modules/clean/fuzzy","modules/clean/keycode","require"],function(e,t,n,o,i,r,s){var a,l,u,c,d;return d=t.DOM,l=function(){function e(e){this.local=(null!=e?e:{}).local}return e.prototype.query=function(e,t){var n;return n=o.map(i.filter(e,this.local),function(e){return e.original}),t(n)},e}(),c={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){var e;return this.props.queryOptions?(e=this.props.maxVisible||this.props.queryOptions.length,this.props.queryOptions.slice(0,e)):[]},renderOptions:function(){var n,o,i,r,s,a,l,u,c;for(c=[],u=this.getOptions(),s=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},r=i=0,a=u.length;a>i;r=++i)o=u[r],n={selected:this.state.selectionIndex===r,"typeahead-option":!0,"u-pad-xs":!0},l=this.renderOption(o),c.push(t.cloneElement(l,{className:e(n,l.props.className),key:"option"+s(o),onMouseEnter:this._hover.bind(this,r),onClick:this.onSelect.bind(this,o)}));return c},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){switch(e.keyCode){case r.UP:return this._navigate(-1),e.preventDefault();case r.DOWN:return this._navigate(1),e.preventDefault();case r.ENTER:return this._selectSelectionIndex(e);case r.ESC:if(Boolean(this.props.queryOptions))return this.close(),e.preventDefault();break;case r.TAB:return this._selectSelectionIndex(e);default:return this.reset()}},_selectSelectionIndex:function(e){var t,n;return n=this.getOptions(),n.length&&(t=this.state.selectionIndex,-1!==t)?(this.onSelect(n[t]),e.preventDefault()):void 0},reset:function(){return this._changeSelectionIndex(0)},close:function(){var e;return"function"==typeof(e=this.props).onClose&&e.onClose(),this.reset()},_hover:function(e){return this._changeSelectionIndex(e)},_navigate:function(e){var t,n,o;return(n=this.getOptions().length)?(t=this.state.selectionIndex+e,o=n+1,-1>t?t+=o:t>=n&&(t-=o),this._changeSelectionIndex(t)):void 0},_changeSelectionIndex:function(e){return e!==this.state.selectionIndex&&"function"==typeof this.onSelectionIndexChange&&this.onSelectionIndexChange(e),this.setState({selectionIndex:e})}},a=t.createClass({displayName:"Autocomplete",propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,dataSource:t.PropTypes.object.isRequired,onBlur:t.PropTypes.func,onSelect:t.PropTypes.func,onChange:t.PropTypes.func,placeholder:t.PropTypes.string,renderCompletionText:t.PropTypes.func.isRequired,renderInput:t.PropTypes.func.isRequired,renderSelector:t.PropTypes.func.isRequired,value:t.PropTypes.string,name:t.PropTypes.string},getDefaultProps:function(){return{value:"",maxVisible:7,onBlur:function(){},onSelect:function(e){},onChange:function(e){},renderCompletionText:function(e){return String(e)},renderInput:function(){return d.input()},renderSelector:function(){return t.createElement(u)}}},getInitialState:function(){return{queryResults:null,value:this.props.value,focus:!1}},render:function(){var t;return t={},t[this.props.customClass]=null!=this.props.customClass,d.div({className:e(t),onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave},this._renderInput(),this._renderSelector())},_onMouseOver:function(){return this.setState({focus:!0})},_onMouseLeave:function(){return this.setState({focus:!1})},_onBlur:function(){return this.props.onBlur(),this.state.focus?void 0:this._clearResults()},_onFocus:function(){return this._queryDataSource(this.state.value),this.refs.selector.reset()},_renderInput:function(){return t.cloneElement(this.props.renderInput(),{ref:"input",onChange:this._inputChanged,onKeyDown:this._proxyKeys,onBlur:this._onBlur,onFocus:this._onFocus,placeholder:this.props.placeholder,value:this.state.value,name:this.props.name,autoComplete:"off"})},_renderSelector:function(){return t.cloneElement(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults,maxVisible:this.props.maxVisible})},_inputChanged:function(e){var t;return t=e.target.value,this.setState({value:e.target.value}),this.props.onChange(t),this._queryDataSource(t),this.refs.selector.reset()},_queryDataSource:function(e){return this.props.dataSource.query(e,function(t){return function(n){return e||(n=[]),t.setState({queryResults:n})}}(this))},_proxyKeys:function(e){return this.refs.selector.onKeyDown(e)},_autocomplete:function(e){var t;return t=n.findDOMNode(this.refs.input),t.focus(),e=this.props.renderCompletionText(e),this.setState({value:e}),this.props.onSelect(e),this._clearResults()},_clearResults:function(){return this.setState({queryResults:null})},componentWillReceiveProps:function(e){return this.setState({value:e.value})}}),u=t.createClass({displayName:"TypeaheadSelector",mixins:[c],propTypes:{customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,onClose:t.PropTypes.func.isRequired,onSelect:t.PropTypes.func.isRequired,queryOptions:t.PropTypes.array,renderQueryOption:t.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(e){},renderQueryOption:function(e){return d.li({},String(e))}}},render:function(){var t;return this.getOptions().length?(t={"typeahead-selector":!0},t[this.props.customClass]=null!=this.props.customClass,d.ul({className:e(t)},this.renderOptions())):d.div({})}}),{Autocomplete:a,DataSource:l,TypeaheadSelector:u,TypeaheadSelectorMixin:c}})}.call(this),function(){define("modules/clean/unity/check_file_cache",["modules/clean/unity/features"],function(e){var t;if(null!=e)return t=function(){function t(){}return t._cache={},t.is_cached_and_locally_available=function(t,n){var o;return o=this._cache[e.server_path(t,n)],null!=o&&o.is_locally_available},t.get=function(t,n){return this._cache[e.server_path(t,n)]},t.set=function(e,t){return this._cache[e]=t},t.set_batch=function(e){var t,n,o;n=[];for(o in e)t=e[o],n.push(this._cache[o]=t);return n},t.clear=function(){return this._cache={}},t}(),__CONDITIONAL_JS__.UnityCheckFileCache=t,t})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/unity/connection",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/connection_error","modules/clean/unity/logger","modules/clean/unity/versions","modules/clean/unity/web_socket","modules/clean/viewer"],function(n,o,i,r,s,a,l,u,c,d){var p;if(c.web_sockets_supported())return p=function(){function p(){this._on_response_timeout=e(this._on_response_timeout,this),this._on_message=e(this._on_message,this),this._set_connection_state=e(this._set_connection_state,this),this._on_error=e(this._on_error,this),this._on_close=e(this._on_close,this),s.getGandalfRule("unity-web-debug")&&(window.uc=this),this.client_version=null,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._ws=null,this._port=null,this._active_ports={},this._connection_state=p._CONNECTION_PENDING,this._current_message_id=1,this._permission_level=null,this.logger=new l,this._routes={check_unity_version:this._check_unity_version.bind(this),fetch_unity_nonce:this._fetch_unity_nonce.bind(this),complete_handshake:this._complete_handshake.bind(this)}}return p._CONNECTION_OPENED_STATE=0,p._VERSION_CHECK_STATE=1,p._FETCHING_NONCE_STATE=2,p._NONCE_RETURNED_TO_CLIENT_STATE=3,p._HANDSHAKE_COMPLETED_STATE=4,p._CONNECTION_PENDING=0,p._CONNECTION_ESTABLISHED=1,p._CONNECTION_CLOSED=2,p._CONNECTION_RETRYING=3,p._RESPONSE_TIMEOUT=5e3,p._MIN_PORT=17600,p._MAX_PORT=17602,p.SECURE_PERMISSION="secure",p.INSECURE_WEB_PERMISSION="insecure_web",p.INSECURE_CLIENT_PERMISSION="insecure_client",p.INSECURE_PERMISSION="insecure",p.prototype.start=function(){return c.load_flash_policy_if_needed()?this._attempt_handshake():void this._set_connection_state(p._CONNECTION_CLOSED)},p.prototype._attempt_handshake=function(){var e,t,n,r,s,a,l,u;try{for(r=n=s=p._MIN_PORT,a=p._MAX_PORT;a>=s?a>=n:n>=a;r=a>=s?++n:--n)this._active_ports[r]=!0,l={scheme:"ws",authority:"127.0.0.1:"+r.toString(),path:"/ws"},u=c.create(i(l).toString()),u.onmessage=this._on_message({ws:u,port:r,state:p._CONNECTION_OPENED_STATE,client_version:null,client_has_auth:null}),u.onclose=this._on_close(r),u.onerror=this._on_error(r)}catch(t){e=t,this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Message: "+e.message,error_name:e.name,port:r,stack:o.stackTrace()}),this._set_connection_state(p._CONNECTION_CLOSED)}return this.logger.report_event("handshake_started")},p.prototype._on_close=function(e){return function(t){return function(n){var o;return 1e3===(o=n.code)||1001===o||1005===o||1006===o||t.logger.report_event("unity_failure",{message:"WebSocket closed. Code: "+n.code+". Reason: "+n.reason,port:e}),t._close_port(e)}}(this)},p.prototype._on_error=function(e){return function(t){return function(n){return t.logger.report_event("unity_failure",{message:"WebSocket error. Message: "+n.data,port:e}),t._close_port(e)}}(this)},p.prototype._close_port=function(e){return e in this._active_ports&&(delete this._active_ports[e],n.isEmptyObject(this._active_ports))?this._connection_state===p._CONNECTION_ESTABLISHED?this._retry_connection():this._set_connection_state(p._CONNECTION_CLOSED):void 0},p.prototype._retry_connection=function(){return this.logger.report_event("connection_retrying"),this._set_connection_state(p._CONNECTION_RETRYING),this.client_version=this._ws=this._port=null,this._attempt_handshake()},p.prototype._set_connection_state=function(e){var t,n,i,r,s,l,u,c,d,h,_,m,f,g,v,y,E,b,w,T;if(e!==this._connection_state){if(h=this._connection_state,o.assert(h!==p._CONNECTION_CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===p._CONNECTION_ESTABLISHED){if(o.assert(this._is_connection_in_progress(h),"Can only establish from pending or retrying."),this.logger.report_event("handshake_complete"),h===p._CONNECTION_PENDING)for(g=this._on_open_callbacks,r=0,u=g.length;u>r;r++)(m=g[r])();for(w=[];this._pending_callbacks.length;)v=this._pending_callbacks.pop(),n=v[0],i=v[1],this.is_ready()?w.push(n()):w.push("function"==typeof i?i(a.UNEXPECTED_ERROR):void 0);return w}if(e!==p._CONNECTION_RETRYING){if(e===p._CONNECTION_CLOSED){if(h===p._CONNECTION_PENDING)for(this.logger.report_event("connection_not_established"),y=this._on_open_failed_callbacks,s=0,c=y.length;c>s;s++)(f=y[s])();else if(h===p._CONNECTION_RETRYING)for(this.logger.report_event("connection_terminated"),E=this._on_close_callbacks,l=0,d=E.length;d>l;l++)(_=E[l])();else o.assert(!1,"CONNECTION_CLOSED can only be set from PENDING or RETRYING");for(T=[];this._pending_callbacks.length;)b=this._pending_callbacks.pop(),t=b[0],i=b[1],T.push("function"==typeof i?i(a.CONNECTION_CLOSED):void 0);return T}return o.assert(!1,"Changing connection_state to CONNECTION_PENDING not supported.")}}},p.prototype._on_message=function(e){return function(t){return function(n){var o,i,r,s,a,l;return i=JSON.parse(n.data),null==i.func||null==(null!=(r=i.header)?r.message_id:void 0)||null==(null!=(s=i.header)?s.should_respond:void 0)?void t._terminate_handshake(e.ws,"Malformed message from client.",{message:n.data}):(null!=(null!=(a=i.header)?a.log_data:void 0)&&t.logger.update(i.header.log_data),t.logger.update({port:e.port}),"response"===i.func?t._on_response(i.header.message_id,i.data):(o=t._routes[i.func],null==o?void t._terminate_handshake(e.ws,"Unknown function.",{function:i.func}):(l=t.is_ready()?o(i.data):o(e,i.data),i.header.should_respond?t.send("response",l,null,null,i.header.message_id):void 0)))}}(this)},p.prototype.send=function(e,t,n,o,i){return null==t&&(t=null),null==n&&(n=null),null==o&&(o=null),null==i&&(i=null),this._send_with_ws(this._ws,e,t,n,o,i)},p.prototype._send_with_ws=function(e,t,n,i,r,s){var l,u,c,d;null==n&&(n=null),null==i&&(i=null),null==r&&(r=null),null==s&&(s=null),null==s&&(s=this._current_message_id,o.assert(this._current_message_id%2===1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==i&&(d=window.setTimeout(this._on_response_timeout(s),p._RESPONSE_TIMEOUT),this._response_callbacks[s]=[i,r,d]),c={func:t,header:{message_id:s,should_respond:null!==i,log_data:this.logger.get_log_data_for_client()}},null!=n&&(c.data=n);try{return e.send(JSON.stringify(c))}catch(e){return l=e,this.logger.report_event("unity_failure",{message:"WebSocket send failed. Message: "+l.message,error_name:l.name}),"function"==typeof r?r(a.COULD_NOT_SEND):void 0}},p.prototype._on_response=function(e,t){var n,o,i,r;return e in this._response_callbacks?(o=this._response_callbacks[e],i=o[0],n=o[1],r=o[2],delete this._response_callbacks[e],window.clearTimeout(r),i(t)):void 0},p.prototype._on_response_timeout=function(e){return function(t){return function(){var n,o,i;return i=t._response_callbacks[e],n=i[0],o=i[1],n=i[2],delete t._response_callbacks[e],"function"==typeof o?o(a.CONNECTION_TIMEOUT):void 0}}(this)},p.prototype._check_unity_version=function(e,t){var n;return e.state!==p._CONNECTION_OPENED_STATE?void this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol."):(e.state=p._VERSION_CHECK_STATE,e.client_version=t.client_version,t.client_version<u.UNITY_HANDSHAKE?void this._terminate_handshake(e.ws,"Client version is too old."):(n=d.get_viewer().is_signed_in,t.client_version<u.PERMISSION_LEVELS&&!n?void this._terminate_handshake(e.ws,"Client version is too old to support insecure web connections."):(this.logger.report_event("handshake_version_check"),t.client_version>=u.PERMISSION_LEVELS?this._send_with_ws(e.ws,"initiate_handshake",{secure_web:n}):this._send_with_ws(e.ws,"initiate_handshake"))))},p.prototype._fetch_unity_nonce=function(e,t){return e.state===p._VERSION_CHECK_STATE?(e.state=p._FETCHING_NONCE_STATE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},p.prototype._retrieve_unity_nonce=function(e,t){return r.WebRequest({url:i({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:t},success:function(t){return function(n){var i;switch(n.status){case"OK":return e.state=p._NONCE_RETURNED_TO_CLIENT_STATE,e.client_version>=u.PORT_CHECK&&(o.assert(n.message.client_port,"Port check must happen in version "+e.client_version),n.message.client_port!==e.port)?void t._terminate_handshake(e.ws,"Mismatched ports.",{client_port:n.message.client_port,web_port:e.port}):(e.client_has_auth=n.message.client_has_auth,i=d.get_viewer().is_signed_in,e.client_has_auth&&i?t._permission_level=p.SECURE_PERMISSION:(o.assert(e.client_version>=u.PERMISSION_LEVELS,"Insecure connections only supported by client_version >= "+u.PERMISSION_LEVELS+"."),t._permission_level=e.client_has_auth?p.INSECURE_WEB_PERMISSION:i?p.INSECURE_CLIENT_PERMISSION:p.INSECURE_PERMISSION),t.logger.update({unity_permission_level:t._permission_level}),t.logger.report_event("handshake_nonce_sent_to_unity_server"),t._send_with_ws(e.ws,"verify_unity_nonce",{nonce:n.message.nonce}));case"MISMATCHED_USER_IDS":return t._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:n.message.client_user_ids,web_user_ids:n.message.web_user_ids});case"INVALID":return t._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.");case"AUTH_REQUIRED":return t._terminate_handshake(e.ws,"Did not have the necessary authentication to retrieve nonce.")}}}(this),error:function(t){return function(n,o,i){return t._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:o,error_string:i})}}(this)})},p.prototype._complete_handshake=function(e,t){var n;return e.state===p._NONCE_RETURNED_TO_CLIENT_STATE&&t.is_success?(e.state=p._HANDSHAKE_COMPLETED_STATE,this._connection_state===p._CONNECTION_CLOSED?this._terminate_handshake(e.ws,"No more handshakes are allowed to complete."):null!=this._ws?(n="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.",this._terminate_handshake(e.ws,n),this._terminate_handshake(this._ws,n),this.client_version=null,this._ws=null,this._port=null,this._set_connection_state(p._CONNECTION_CLOSED)):(this.client_version=e.client_version,this._ws=e.ws,this._port=e.port,this._set_connection_state(p._CONNECTION_ESTABLISHED))):this._terminate_handshake(e.ws,"Unable to complete handshake.")},p.prototype._terminate_handshake=function(e,t,o){var i;return null==o&&(o=null),i={message:t},null!=o&&n.extend(i,o),s.getGandalfRule("unity-web-debug")&&console.error(i),this.logger.report_event("unity_failure",i),e.close()},p.prototype._is_connection_in_progress=function(e){return e===p._CONNECTION_PENDING||e===p._CONNECTION_RETRYING},p.prototype.add_on_open_callback=function(e){return this._on_open_callbacks.push(e)},p.prototype.add_on_open_failed_callback=function(e){return this._on_open_failed_callbacks.push(e)},p.prototype.add_on_close_callback=function(e){return this._on_close_callbacks.push(e)},p.prototype.call_when_ready=function(e,t){return null==t&&(t=null),this.is_ready()?e():this._is_connection_in_progress(this._connection_state)?this._pending_callbacks.push([e,t]):"function"==typeof t?t(a.CONNECTION_CLOSED):void 0},p.prototype.is_ready=function(){var e;return(null!=(e=this._ws)?e.readyState:void 0)===WebSocket.OPEN&&this._connection_state===p._CONNECTION_ESTABLISHED},p.prototype.feature_supported=function(e,n){var i;return o.assert(null!==this._permission_level,"Connection is not ready."),this.client_version<e?!1:(i=this._permission_level,t.call(n,i)>=0)},p}()})}.call(this),function(){define("modules/clean/unity/connection_error",[],function(){var e;return e=function(){function e(){}return e.CONNECTION_TIMEOUT="connection_timeout",e.CONNECTION_CLOSED="connection_closed",e.COULD_NOT_SEND="could_not_send",e.UNEXPECTED_ERROR="unexpected_error",e}()})}.call(this),function(){define("modules/clean/unity/features",["jquery","modules/clean/ajax","modules/clean/filepath","modules/clean/unity/connection","modules/clean/unity/versions","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,l){var u;if(null!=o)return u=function(){function u(){}return u._uc=new o,u._has_handshake_started=!1,u._start_handshake_if_needed=function(){return this._has_handshake_started?void 0:(this._uc.start(),this._has_handshake_started=!0)},u._cached_file_browser_display_name=null,u.continue_as_user=function(e,t,n,r){return null==r&&(r=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(s){return function(){return s._uc.feature_supported(i.WEB_DESTINY,[o.INSECURE_WEB_PERMISSION])?(s._uc.logger.report_event("continue_as_user",{browser:e,refresh_token:t}),s._uc.send("continue_as_user",{browser:e,refresh_token:t},n,r)):void 0}}(this),r)},u.continue_as_user_direct=function(e,t){return null==t&&(t=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(n){return function(){return n._uc.feature_supported(i.WEB_DESTINY_V2,[o.INSECURE_WEB_PERMISSION])?(n._uc.logger.report_event("continue_as_user_direct"),n._uc.send("continue_as_user_direct",null,e,t)):void 0}}(this),t)},u.web_destiny_info=function(e,t){return null==t&&(t=null),this._start_handshake_if_needed(),this._uc.call_when_ready(function(n){return function(){return n._uc.feature_supported(i.WEB_DESTINY_V2,[o.INSECURE_WEB_PERMISSION])?(n._uc.logger.report_event("web_destiny_info"),n._uc.send("web_destiny_info",null,e,t)):void 0}}(this),t)},u.client_supports_open_in_file_browser=function(){return this._uc.feature_supported(i.OPEN_IN_FILE_BROWSER,[o.SECURE_PERMISSION])},u.open_file=function(e,s,a,u,c,d){var p;return null==c&&(c=null),null==d&&(d=!1),this._start_handshake_if_needed(),p=this.server_path(e,s),this._uc.call_when_ready(function(e){return function(){var s;return e._uc.feature_supported(i.UNITY_HANDSHAKE,[o.SECURE_PERMISSION])?(e._uc.logger.report_event("open_file",{user_id:a,path_id:p,file_extension:n.file_extension_for_logging(p),in_file_browser:d}),t.SilentBackgroundRequest({url:l({path:"/unity_open_log"}),data:{user_id:a,server_path:p,file_extension:n.file_extension_for_logging(p),in_file_browser:d,unity_session_id:e._uc.logger.unity_session_id(),buildno:e._uc.logger._data.buildno,host_id:e._uc.logger._data.host_id}}),s={server_path:p,user_id:a},e._uc.client_version>=i.OPEN_IN_FILE_BROWSER?s.in_file_browser=d:r.assert(!d,"The connected client doesn't support opening in file browser."),e._uc.send("open_file",s,u,c)):void 0}}(this),c)},u.standard_open_file_handler=function(e){return e?void 0:a.error(s._("Error opening file"))},u.check_file=function(e,t,r,s,a){var l,u;return null==a&&(a=null),this._start_handshake_if_needed(),u=this.server_path(e,t),l=function(e){return function(t){return e._check_file_deprecated_on_client()&&(t={is_locally_available:t}),s(t)}}(this),this._uc.call_when_ready(function(e){return function(){return e._uc.feature_supported(i.UNITY_HANDSHAKE,[o.SECURE_PERMISSION])?(e._uc.logger.report_event("check_file",{user_id:r,path_id:u,file_extension:n.file_extension_for_logging(u)}),e._uc.send("check_file",{server_path:u,user_id:r},l,a)):void 0}}(this),a)},u.add_on_ready_callback=function(e){return this._uc.call_when_ready(e)},u.check_file_batch=function(t,r,s,a){var l,u,c,d,p;return null==a&&(a=null),l=e.Deferred(),this._start_handshake_if_needed(),p=function(){var e,n,o;for(o=[],e=0,n=t.length;n>e;e++)c=t[e],o.push(this.server_path(c.ns_id,c.ns_path));return o}.call(this),d=function(e){return function(t){var n,o;if(e._check_file_deprecated_on_client())for(n in t)o=t[n],t[n]={is_locally_available:o};return s(t),l.resolve(t)}}(this),u=function(e){return"function"==typeof a&&a(e),l.reject(e)},this._uc.call_when_ready(function(e){return function(){var t;return e._uc.feature_supported(i.UNITY_HANDSHAKE,[o.SECURE_PERMISSION])?(e._uc.logger.report_event("check_file_batch",{user_id:r,path_ids:p,file_extensions:function(){var e,o,i;for(i=[],e=0,o=p.length;o>e;e++)t=p[e],i.push(n.file_extension_for_logging(t));return i}()}),e._uc.send("check_file_batch",{server_paths:p,user_id:r},d,u)):void 0}}(this),u),l.promise()},u.file_browser_display_name=function(e,t){var n,r;return null==t&&(t=null),null!=this._cached_file_browser_display_name?void e(this._cached_file_browser_display_name):(n=function(t){return function(n){return t._cached_file_browser_display_name=n,e(n)}}(this),this._start_handshake_if_needed(),r=function(r){return function(){return r._uc.feature_supported(i.CHECK_FILE_RETURNS_OBJ,[o.SECURE_PERMISSION])?(r._uc.logger.report_event("file_browser_display_name"),r._uc.send("file_browser_display_name",null,n,t)):e(null)}}(this),this._uc.call_when_ready(r,t))},u._check_file_deprecated_on_client=function(){return i.UNITY_HANDSHAKE<=this._uc.client_version&&this._uc.client_version<i.CHECK_FILE_RETURNS_OBJ},u.server_path=function(e,t){return e+":"+t},u}(),__CONDITIONAL_JS__.UnityFeatures=u,u})}.call(this),function(){define("modules/clean/unity/flash_config",["modules/clean/gandalf_util","modules/clean/unity/websocket_config","modules/constants/static"],function(e,t,n){return window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,window.DefaultWebSocket=window.WebSocket,t.useFlashShim()&&(window.WEB_SOCKET_FORCE_FLASH=!0),window.WEB_SOCKET_SWF_LOCATION=n.static_url_web_socket_swf,e.getGandalfRule("unity-web-debug")?void 0:window.WEB_SOCKET_LOGGER={log:function(){},error:function(){}}})}.call(this),function(){define("modules/clean/unity/logger",["jquery","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/versions"],function(e,t,n,o,i){var r;return r=function(){function r(){this._data={logging_source:"web",web_unity_version:i.LATEST}}return r.prototype.update=function(t){return e.extend(this._data,t)},r.prototype.report_event=function(e,i){return null==i&&(i=null),this._data.event_name=e,this._data.local_ts=(new Date).getTime()/1e3,this._data.extra=JSON.stringify(i||{}),n.WebRequest({url:t({path:"/unity_connection_log"}),data:this._data}),o.getGandalfRule("unity-web-debug")?console.log(this._data):void 0},r.prototype.get_log_data_for_client=function(){return{web_unity_version:this._data.web_unity_version,user_agent:window.navigator.userAgent}},r.prototype.unity_session_id=function(){return this._data.unity_session_id},r}()})}.call(this),function(){define("modules/clean/unity/versions",function(){var e;return e=function(){function e(){}return e.LATEST=9,e.INITIAL_UNITY=1,e.UNITY_HANDSHAKE=2,e.REUNITY=3,e.OPEN_IN_FILE_BROWSER=4,e.CHECK_FILE_RETURNS_OBJ=5,e.PERMISSION_LEVELS=6,e.WEB_DESTINY=7,e.WEB_DESTINY_V2=8,e.PORT_CHECK=9,e}()})}.call(this),function(){define("modules/clean/unity/web_socket",["modules/constants/env","modules/clean/unity/logger","modules/clean/unity/websocket_config","external/web_socket"],function(e,t,n,o){var i,r;return i=e.IS_PROD?17603:17604,r=function(){function e(){}return e.create=function(e){return"function"==typeof o.__initialize&&o.__initialize(),new o(e)},e.load_flash_policy_if_needed=function(){var e;if(e=new t,null!=(null!=o?o.loadFlashPolicyFile:void 0))e.report_event("load_flash_policy_file"),o.loadFlashPolicyFile("xmlsocket://127.0.0.1:"+i);else{if(n.useFlashShim())return e.report_event("unity_failure",{message:"Could not use WebSockets."}),!1;e.report_event("using_default_web_socket")}return!0},e.web_sockets_supported=function(){return null!=o},e}()})}.call(this),function(){define("modules/clean/unity/websocket_config",["external/flash_detect","modules/constants/unity","modules/core/browser"],function(e,t,n){var o;return o=function(){function o(){}return o.useFlashShim=function(){var o;return t.FORCE_NATIVE_WEBSOCKET?!1:e.versionAtLeast(10,3)?(o=parseInt(n.version,10),n.safari&&9>o?!1:!(n.chrome&&o>=53&&t.ALLOW_CHROME_WEBSOCKET)):!1},o}()})}.call(this),function(){define("modules/clean/video_util",["jquery","modules/core/browser","modules/core/i18n","external/flash_detect","external/underscore","external/videojs/video","external/videojs/videojs_hls","modules/clean/ajax","modules/constants/static","modules/clean/previews/util"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h;return p=n._,c=u.PermissionHelper,d={_video_counter:0,embed:function(n,o){var r,s,u,d,_,m,f,g,v,y,E,b,w;if(null==o&&(o={}),!this.can_embed_type(o.type))return null!=o.onError&&setTimeout(function(){return o.onError("needflash")},0),document.createElement("div");for(o.preload="undefined"!=typeof o.preload?o.preload:!0,o.preload&&(o.preload="auto"),d="video-"+this._video_counter,this._video_counter+=1,w=e("<video/>",{class:"video-js vjs-default-skin vjs-big-play-centered",id:d,controls:o.controls}),w=w[0],r=-1,null==o.width&&(o.width="100%"),null==o.height&&(o.height="100%"),v=["width","height","preload","poster","autoplay"],u=0,_=v.length;_>u;u++)f=v[u],o[f]&&w.setAttribute(f,o[f]);return y=e("<source/>",{src:o.src,type:o.type}),y=y[0],w.appendChild(y),n=e(n),n.empty(),n=n[0],n.appendChild(w),m=function(){var n,s,l,u;return u=this,"function"==typeof o.onReady&&o.onReady(this),n=function(){return null!=u.hls?u.hls.fillBuffer():void 0},t&&(t.ipad&&(s=0,e(document).on("dropdownOpened modalOpened",function(t,n){return s+=n,e(u.el_).children("video").removeAttr("controls")}),e(document).on("dropdownClosed modalClosed",function(t,n){return s-=n,0===s?e(u.el_).children("video").attr("controls","controls"):void 0})),t.msie&&"9.0"===t.version&&u.on("playing",function(){return u.removeClass("vjs-seeking")})),"Hls"===u.techName&&u.on("seeked",function(){return u.controlBar.currentTimeDisplay.updateContent()}),u.on("pause",function(){return r=setInterval(n,500),u.ended()?u.removeClass("vjs-has-started"):void 0}),u.on("play",function(){return clearInterval(r),r=-1}),u.on("dispose",function(){return clearInterval(r)}),u.on("ended",function(){return u.src({type:o.type,src:o.src})}),"application/vnd.apple.mpegurl"===o.type&&h(u),l=function(){return u.addClass("show-truncated-bar")},!o.metadata&&o.metadata_link?a.SilentBackgroundRequest({url:o.metadata_link,type:"GET",data:{},xhrFields:{withCredentials:!0},success:function(e){return"function"==typeof o.metadata_cb&&o.metadata_cb(e),e=JSON.parse(e),e.is_truncated?i.defer(l):void 0}}):o.metadata&&o.metadata.is_truncated?i.defer(l):void 0},b=p("The clip displayed here is a preview. To view the entire video, download or add it to your Dropbox."),c.use_hls_video()&&(videojs.Hls.GOAL_BUFFER_LENGTH=120),videojs.TruncatedBar=videojs.Component.extend(),videojs.TruncatedBar.prototype.options_={loadEvent:"play",components:{}},videojs.TruncatedBar.prototype.createEl=function(){var e;return e=videojs.createEl("div",{className:"truncated-bar",id:"truncated-video-message-bar"}),e.textContent=b,e},videojs.options.children.TruncatedBar={},s={swf:l.static_url_video_js_swf,flashVars:{contentType:o.type}},E=c.use_hls_video()?["html5","hls","flash"]:["flash"],g=videojs(w,{flash:s,techOrder:E},m),o.onError&&g.on("error",o.onError),o.onPlay&&g.on("play",o.onPlay),o.onEnd&&g.on("ended",o.onEnd),o.onCanPlay&&g.on("canplay",o.onCanPlay),e(".vjs-poster").hide(),e(".vjs-big-play-button").hide()},can_embed_type:function(e){var t;return""!==("function"==typeof(t=document.createElement("video")).canPlayType?t.canPlayType(e):void 0)?!0:o.installed&&o.majorAtLeast(10)?"application/vnd.apple.mpegurl"===e||"video/flv"===e||"video/mp4"===e:!1}},h=function(e){var t,n,o,i,r,s,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R,k,O,D,F;for(T=[250,500,1500,3e3],f=null,b=null,E=null,R=0,v=-1,m=!1,y=null,_=-1,I=[],k=!0,D=0,h={},g=0,w=T.length;w>g;g++)P=T[g],h[P.toString()]=0;return O=null,F=[],C=100,A=function(){var t,n,o,i,r;for(t={},n=0,o=T.length;o>n;n++)P=T[n],r=h[P.toString()],t[P.toString()]=Math.round(r/D*100)||0;return i={duration:Math.round(1e3*e.duration()),initial_bitrate:T[v]||0,initial_play_wait:y||0,bitrate_percentages:JSON.stringify(t),stalls:R,quality_events:JSON.stringify(I),xhr_errors:JSON.stringify(F),percentage_watched:C},N(),a.SilentBackgroundRequest({url:"/video_web_play_log",type:"POST",data:i})},N=function(){var e,t;for(f=null,b=null,E=null,R=0,v=-1,m=!1,y=null,_=-1,I=[],k=!0,D=0,h={},e=0,t=T.length;t>e;e++)P=T[e],h[P.toString()]=0;return O=null,F=[],C=100},o=function(){return d(),A()},u=function(){return d(),C=Math.round(e.currentTime()/e.duration()*100),isFinite(C)||(C=0),A()},p=function(){return k?(O=Date.now(),k=!1):void 0},d=function(){var e;if(!k)return e=Date.now()-O,D+=e,h[T[_].toString()]+=e,k=!0},r=function(){return null===f&&(E=f=Date.now()),b=Date.now()},t=function(){var t;return t=e.hls.selectPlaylist().attributes.BANDWIDTH/1e3,T.indexOf(t)},n=function(){return _=t(),v=_,p(),m?void 0:(y=null===f?0:Date.now()-f,m=!0)},i=function(){return d()},l=function(){return b=Date.now()},c=function(){return d(),Date.now()-b>5e3?R+=1:void 0},s=function(){var n;if(!(e.ended()||e.error()||e.paused()))return d(),n=_,_=t(),Date.now()-f<1e3?v=_:I.push([T[n],T[_],Date.now()-E]),E=Date.now(),p()},e.on("play",r),e.on("pause",i),e.on("canplay",n),e.on("waiting",c),e.on("seeking",l),e.on("ended",o),e.on("shutdown",u),e.on("mediachange",s),"Hls"===e.techName?(S=videojs.Hls.xhr,videojs.Hls.xhr=function(e,t){
var n;return n=function(e,n){var o;return e&&(o="",""!==this.responseType&&"text"!==this.responseType||(o=this.responseText),F.push([this.status.toString(),o,n])),t.call(this,e,n)},S.call(this,e,n)}):void 0},d})}.call(this),function(){define("modules/clean/zendesk_feedback",["jquery","external/classnames","external/react","external/react-dom","modules/core/i18n","modules/clean/ajax","modules/clean/react/modal","modules/clean/react/css","modules/clean/react/select","modules/clean/sharing/views/hover_close_button","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,u,c){var d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I,P,A,N,R;return d=s.Modal,p=l.input,h=l.option,C=n.DOM,T=n.createElement,R=n.addons.update,v=i.i18n_default_project("sharing")._,y=n.createClass({displayName:"ZendeskFeedbackButton",render:function(){return C.button({className:"button-as-link zendesk-feedback-button",onClick:A.bind(null,!1)},v("Feedback",{comment:"For context, this is a button on the main page the user can click on to give feedback"}))}}),E=n.createClass({displayName:"ZendeskFeedbackForm",propTypes:{forAirshare:n.PropTypes.bool.isRequired},getInitialState:function(){return{}},componentDidMount:function(){return o.findDOMNode(this.refs.textbox).focus()},render:function(){return T(d,{className:"zendesk-feedback-form",title:v("Send us your feedback"),acceptButtonDisabled:!this.state.message||this.state.isSending,acceptButtonText:v("Send feedback"),autoClose:!1,dismissButtonText:v("Cancel"),onAccept:function(e){return function(){var t,n,o;return e.setState({isSending:!0}),o=e.props.forAirshare?"airshare_form":"tiburon_form",t=o+"_"+e.refs.category.getValue(),n=o+"_perm",I([t,n],e.state.message,null,function(){return e.setState({isSending:!1})})}}(this)},C.label({htmlFor:"feedback-category"},v("Category")),T(p,{ref:"category",className:"u-mar-bottom-m feedback-category",id:"feedback-category",defaultValue:"fdbk_shrr"},T(h,{value:"fdbk_shrr"},v("I have feedback about sharing files with others")),T(h,{value:"fdbk_rcvr"},v("I have feedback about accessing files shared with me")),T(h,{value:"fdbk_gen"},v("I have general feedback")),T(h,{value:"fdbk_bug"},v("I found a bug"))),C.label({htmlFor:"feedback-content"},v("What is your feedback?")),C.textarea({className:"zendesk-feedback-form__textbox",id:"feedback-content",onChange:function(e){return function(t){return e.setState({message:t.target.value})}}(this),ref:"textbox"}))}}),w=n.createClass({displayName:"ZendeskQuantitativeForm",SCORES:{TIBURON:[{NAME:"easy_score",PROMPT:v("How easy or difficult was it for you?"),ONE_LABEL:v("Very easy"),FIVE_LABEL:v("Very difficult"),HIDDEN_ONE_LABEL:v("1 means very easy"),HIDDEN_FIVE_LABEL:v("5 means very difficult"),TYPE:"SCALE"},{NAME:"clearness_score",PROMPT:v("Were your options clear, or did you find them confusing?"),ONE_LABEL:v("Very clear"),FIVE_LABEL:v("Very confusing"),HIDDEN_ONE_LABEL:v("1 means very clear"),HIDDEN_FIVE_LABEL:v("5 means very confusing"),TYPE:"SCALE"},{NAME:"confidence_score",PROMPT:v("How confident are you that you did things the right way?"),ONE_LABEL:v("Very confident"),FIVE_LABEL:v("Not at all confident"),HIDDEN_ONE_LABEL:v("1 means very confident"),HIDDEN_FIVE_LABEL:v("5 means not at all confident"),TYPE:"SCALE"}],PASS:[{NAME:"awareness_score",PROMPT:v("Did you know that the circles at the top of the preview tell you who has seen the file?"),TYPE:"YESNO"},{NAME:"helpfulness_score",PROMPT:v("Has this feature been helpful for your work?"),ONE_LABEL:v("No, and it’s caused problems for me"),FIVE_LABEL:v("Yes, often"),HIDDEN_ONE_LABEL:v("1 means not at all helpful"),HIDDEN_FIVE_LABEL:v("5 means very helpful"),TYPE:"SCALE"},{NAME:"sentiment_score",PROMPT:v("Which of these best describes how you feel about this feature?"),ONE_LABEL:v("Very pleased if this feature was removed"),FIVE_LABEL:v("Very disappointed if this feature was removed"),HIDDEN_ONE_LABEL:v("1 means very disappointed"),HIDDEN_FIVE_LABEL:v("5 means very pleased"),TYPE:"SCALE"}]},propTypes:{title:n.PropTypes.string.isRequired,zendeskTag:n.PropTypes.string.isRequired,formType:n.PropTypes.string.isRequired},getInitialState:function(){return{message:"",scores:{}}},_renderScaleQuestion:function(e){var n;return C.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-s",role:"radiogroup"},C.label({},e.PROMPT),function(){var o,i;for(i=[],n=o=1;6>o;n=++o)i.push(C.button({"aria-checked":this.state.scores[e.NAME]===n,onClick:function(e){return function(t,n){return function(){var o;return o={},o[n.NAME]={$set:t},e.setState({scores:R(e.state.scores,o)})}}}(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n})},n));return i}.call(this),C.div({},C.span({className:"zendesk-feedback-form__score-label"},e.ONE_LABEL),C.span({className:"ax-visually-hidden"},e.HIDDEN_ONE_LABEL),C.span({className:"zendesk-feedback-form__score-label"},e.FIVE_LABEL),C.span({className:"ax-visually-hidden"},e.HIDDEN_FIVE_LABEL)))},_renderYesNoQuestion:function(e){var n;return C.div({className:"zendesk-feedback-form__score-bar u-mar-bottom-s",role:"radiogroup"},C.label({},e.PROMPT),function(){var o,i,r,s;for(r=[{key:"YES",answer_text:v("Yes")},{key:"NO",answer_text:v("No")}],s=[],o=0,i=r.length;i>o;o++)n=r[o],s.push(C.button({"aria-checked":this.state.scores[e.NAME]===n.key,onClick:function(e){return function(t,n){return function(){var o;return o={},o[n.NAME]={$set:t.key},e.setState({scores:R(e.state.scores,o)})}}}(this)(n,e),role:"radio",className:t("c-btn","c-btn--secondary","zendesk-feedback-form__score-button",{"c-btn--disabled":this.state.scores[e.NAME]===n.key})},n.answer_text));return s}.call(this))},render:function(){var e;return T(d,{className:"zendesk-feedback-form",title:this.props.title,acceptButtonDisabled:this.state.isSending||this.SCORES[this.props.formType].reduce(function(e){return function(t,n){return!e.state.scores[n.NAME]||t}}(this),!1),acceptButtonText:v("Send feedback"),autoClose:!1,dismissButtonText:v("Cancel"),onAccept:function(e){return function(){return e.setState({isSending:!0}),I([e.props.zendeskTag],e.state.message,e.state.scores,function(){return e.setState({isSending:!1})})}}(this)},function(){var t,n,o,i;for(o=this.SCORES[this.props.formType],i=[],t=0,n=o.length;n>t;t++)e=o[t],"SCALE"===e.TYPE?i.push(this._renderScaleQuestion(e)):"YESNO"===e.TYPE?i.push(this._renderYesNoQuestion(e)):i.push(void 0);return i}.call(this),C.label({htmlFor:"feedback--main-reason"},v("What’s the main reason for your scores?")),C.textarea({className:"zendesk-feedback-form__textbox",id:"feedback--main-reason",onChange:function(e){return function(t){return e.setState({message:t.target.value})}}(this)}))}}),b=n.createClass({displayName:"ZendeskFlyout",propTypes:{onCloseClick:n.PropTypes.func},componentDidMount:function(){return o.findDOMNode(this.refs.mainButton).focus()},render:function(){return C.div({className:"zendesk-flyout"},C.div({className:"zendesk-flyout__header u-pad-left-l u-pad-bottom-m u-pad-top-m"},v("Have a moment?"),T(u,{className:"zendesk-flyout__x u-mar-right-m",onClick:function(e){return function(){var t;return"function"==typeof(t=e.props).onCloseClick&&t.onCloseClick(),S()}}(this)})),C.div({className:"u-pad-left-l u-mar-bottom-m u-pad-top-m u-mar-right-m"},v("Help us make your Dropbox experience even better by answering a few questions."),C.button({className:"c-btn c-btn--primary u-mar-top-m zendesk-flyout__main_button",onClick:function(e){return function(){return S(),d.showInstance(T(g,e.props))}}(this),ref:"mainButton"},v("Give feedback"))))}}),_=a(y,["/static/css/zendesk_feedback-vfljBsKoD.css"]),m=a(E,["/static/css/zendesk_feedback-vfljBsKoD.css"]),g=a(w,["/static/css/zendesk_feedback-vfljBsKoD.css"]),f=a(b,["/static/css/zendesk_feedback-vfljBsKoD.css"]),P=function(){return d.showInstance(T(g,{title:v("Send us your feedback"),zendeskTag:"pass_feedback",formType:"PASS"}))},A=function(e){return null==e&&(e=!1),d.showInstance(T(m,{forAirshare:e}))},N=function(t){var n;return n=e("<div />").attr({class:"zendesk-flyout-container"}).prependTo("body")[0],o.render(T(f,t),n)},S=function(){return e(".zendesk-flyout-container").remove()},I=function(e,t,n,o){return""===t&&null!=n&&(t="Scores only"),r.WebRequest({url:"/help/user_feedback",data:{tags:JSON.stringify(e),details:t,user_feedback:JSON.stringify(n)},success:function(){return c.success(v("Thanks for helping make Dropbox better!")),d.close()},error:o})},{ZendeskFeedbackButton:_,showQualitativeFeedbackForm:A,showZendeskFlyout:N,showPASSFeedbackForm:P}})}.call(this),function(){define("modules/constants/browse",[],function(){return window.BrowseConstants})}.call(this),function(){define("modules/constants/comments_panel",[],function(){return window.CommentsPanelConstants})}.call(this),function(){define("modules/constants/contacts",[],function(){return window.ContactsConstants})}.call(this),function(){define("modules/constants/file_viewer",[],function(){return window.FileViewerConstants})}.call(this),function(){define("modules/constants/legacy",[],function(){return DropboxConstants||{}})}.call(this),function(){define("modules/constants/notifications",[],function(){return window.NotificationsConstants})}.call(this),function(){define("modules/constants/python",[],function(){return PythonConstants||{}})}.call(this),function(){define("modules/constants/sharing",[],function(){return"undefined"!=typeof SharingServerConstants&&null!==SharingServerConstants?SharingServerConstants:{}})}.call(this),function(){define("modules/constants/static",[],function(){return StaticConstants||{}})}.call(this),function(){define("modules/constants/unity",[],function(){return window.UnityConstants})}.call(this),function(){"use strict";define("modules/core/type",["external/underscore"],function(e){var t,n,o,i,r,s,a,l;return r={},r.Type=t=function(){function t(t,n){if(!e.isString(t)&&!e.isFunction(t))throw new TypeError("First parameter needs to be a string identifying the type");if(!e.isFunction(n))throw new TypeError("Second parameter needs to be a predicate defining the type");e.isFunction(t)?this.getTypeString=t:this.getTypeString=function(){return t},this.predicate=n}return t}(),o=function(n){var i,r;if(l(n))return!0;if(n instanceof t)return!0;if(e.isFunction(n))return!0;if(e.isArray(n)){if(1!==n.length)return!1;if(!o(n[0]))return!1}else{if(!(e.isObject(n)&&null==n.prototype&&n.constructor===Object&&e.keys(n).length>0))return!1;for(i in n)if(r=n[i],!o(r))return!1}return!0},n=function(){var n,i,r,s,a,l,u;return u=new t("undefined",e.isUndefined),i=new t("null",e.isNull),n=new t("Boolean",e.isBoolean),r=new t("Number",e.isNumber),a=new t("String",e.isString),s=new t("Object",function(t){return e.isObject(t)&&!e.isFunction(t)&&!e.isArray(t)}),l=new t("Type",o),function(e){return"undefined"==typeof e?u:null===e?i:e===Boolean?n:e===Number?r:e===String?a:e===Object?s:e===t?l:void 0}}(),r.isBasicType=l=function(e){return null!=n(e)},r.firstFailingKeypath=s=function(o,i,r){var a,u,c,d,p,h,_,m,f,g,v,y,E;if(null==r&&(r=[]),l(o)){if(!n(o).predicate(i))return r}else if(o instanceof t){if(!o.predicate(i))return r}else if(e.isFunction(o)){if(!(i instanceof o))return r}else if(e.isArray(o)){if(s(Array,i,r))return r;for(u=c=0,h=i.length;h>c;u=++c){if(a=i[u],r.push(u),s(o[0],a,r))return r;r.pop()}}else{if(s(Object,i,r))return r;for(y=e.keys(o),E=e.keys(i),g=e.difference(y,E),p=0,_=g.length;_>p;p++)if(d=g[p],s(o[d],void 0,r))return r;for(v=e.intersection(E,y),f=0,m=v.length;m>f;f++){if(d=v[f],r.push(d),s(o[d],i[d],r))return r;r.pop()}}},r.checkType=i=function(e,t){return null==s(e,t)},r.getTypeString=a=function(o){var i,r,s;if(l(o))return n(o).getTypeString();if(o instanceof t)return o.getTypeString();if(e.isFunction(o))return o.name;if(e.isArray(o))return"["+a(o[0])+"]";r=[];for(i in o)s=o[i],r.push(i+": "+a(s));return"{"+r.join(", ")+"}"},r})}.call(this),function(){"use strict";var e=function(e,n){function o(){this.constructor=e}for(var i in n)t.call(n,i)&&(e[i]=n[i]);return o.prototype=n.prototype,e.prototype=new o,e.__super__=n.prototype,e},t={}.hasOwnProperty,n=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},o=[].slice;define("modules/core/types",["external/underscore","modules/constants/env","modules/core/type"],function(t,i,r){var s,a,l,u,c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C;return f=r.Type,g=r.checkType,b=r.getTypeString,E=r.firstFailingKeypath,w=r.isBasicType,h=function(){try{return Boolean(localStorage.production_typechecking)}catch(e){return!1}}(),m=function(t){function n(e){n.__super__.constructor.call(this,b.bind(null,e),g.bind(null,e))}return e(n,t),n}(f),c=function(o){function i(e,n){null!=i.names?i.names.set(this,e):this.__name===e,null!=n&&t.extend(this,n)}e(i,o);try{i.names=new WeakMap}catch(e){i.names=null}return i.prototype.getTypeString=function(){return null!=i.names?i.names.get(this):this.__name},i.prototype.predicate=function(e){return n.call(t.values(this),e)>=0},i}(f),l=function(t){function n(e){this.valType=e}return e(n,t),n.prototype.getTypeString=function(){return"Dict[string -> "+b(this.valType)+"]"},n.prototype.predicate=function(e){var t,n;return function(){var o;o=[];for(t in e)n=e[t],o.push(g(this.valType,n));return o}.call(this).every(function(e){return e})},n}(f),v=function(e,n){var i,r,s,a,l,u,c,d;if(w(e));else if(e instanceof f)null!=e.parameter_types&&t.isFunction(n)&&!n.isTypeChecked&&(n=C.apply(null,o.call(e.parameter_types).concat([n])));else if(t.isFunction(e));else if(t.isArray(e))for(s=a=0,u=n.length;u>a;s=++a)i=n[s],r=v(e[0],i),r!==i&&(n=n.slice(),n[s]=r);else for(l in e)c=e[l],d=v(c,n[l]),d!==n[l]&&(n=t.clone(n),n[l]=d);return n},T=function(e,n,o,i){var r,s,a,l;for(r=0,l=n.length;l>r;r++)s=n[r],i=i[s],o=t.isArray(o)?o[0]:o[s];return n.length>0&&(a=", key "+n.join(".")),a=null!=a?a:"","Argument "+e+a+": Value "+JSON.stringify(i,null,"  ")+" doesn't match type "+b(o)},C=function(){var e,n,i,r;return r=2<=arguments.length?o.call(arguments,0,n=arguments.length-1):(n=0,[]),e=arguments[n++],i=function(){var n,i,s,a,l,u,c,d,p,h,_,f;for(i=1<=arguments.length?o.call(arguments,0):[],n=r,d=t.find(r,function(e){return e instanceof m}),null!=d&&(p=t.indexOf(n,d),h=Math.max(i.length-n.length+1,0),_=[p,1],t.times(h,function(){return _.push(d)}),n=n.slice(),n.splice.apply(n,_)),a=l=0,u=n.length;u>l;a=++l){if(f=n[a],s=E(f,i[a]),null!=s)throw c=T(a,s,f,i[a]),new TypeError(c);i[a]=v(f,i[a])}return e.apply(this,i)},i.isTypeChecked=!0,i},S=function(e,t){var n;return n=function(){var n,i,r,s;if(n=1<=arguments.length?o.call(arguments,0):[],s=t.apply(this,n),i=E(e,s),null!=i)throw r=T(0,i,e,s),new TypeError(r);return s},t.isTypeChecked&&(n.isTypeChecked=!0),n},u=function(e,t){var n,o;return n=function(){return"("+b(e)+"|"+b(t)+")"},o=function(n){return g(e,n)||g(t,n)},new f(n,o)},p=function(e){var t,n,o;return e instanceof f&&e.isOptional||e instanceof m?e:(t=function(){return"?"+b(e)},n=function(t){return null==t||g(e,t)},o=new f(t,n),e instanceof f&&null!=e.parameter_types&&(o.parameter_types=e.parameter_types),o.isOptional=!0,o)},d=function(){var e,n,i,r;return r=1<=arguments.length?o.call(arguments,0):[],e=function(){return"function("+r.map(b).join(", ")+")"},n=t.isFunction,i=new f(e,n),i.parameter_types=r,i},_=function(e){return new m(e)},a=function(e){return new l(e)},y={},y.takes=S(Function,C(_(f),Function,C)),y.returns=S(Function,C(f,Function,S)),y.Type=f,y.Enum=c,y.Dict=S(f,C(f,a)),y.Either=S(f,C(f,f,u)),y.Maybe=S(f,C(f,p)),y.Splat=S(f,C(f,_)),y.Any=s=new f("Any",function(e){return!0}),y.Func=S(f,C(_(f),d)),y.inject=S(Object,C(Object,function(e){return t.extend(e,t.omit(y,"inject"))})),i.IS_PROD&&!h&&(y.takes=function(){var e,t,n;return e=2<=arguments.length?o.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++]},y.returns=function(){var e,t,n;return e=2<=arguments.length?o.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++]}),y})}.call(this),function(){define("modules/core/user_i18n",["modules/constants/viewer"],function(e){var t;return t=function(){function t(){}return t.getInitials=function(e){var n;return e?(n=e.trim().split(" "),n.length>=2?t._is_cjk_locale()?n[n.length-1][0]+n[0][0]:n[0][0]+n[n.length-1][0]:t._is_cjk_locale()&&!t._is_ascii_name(e)&&e.length>1?e.substring(0,2):e.substring(0,1)):""},t._is_ascii_name=function(e){var t,n,o,i;for(n=o=0,i=e.length;i>o;n=++o)if(t=e[n],e.charCodeAt(n)>=128)return!1;return!0},t._is_cjk_locale=function(){var t;return"zh"===(t=e.USER_LOCALE)||"ja"===t||"ko"===t},t}()})}.call(this),function(){define("modules/core/visibility",["jquery"],function(e){var t,n,o;return t={},o=function(){return document.hasFocus()},n=function(t){return e(window).one("focus",t)},t.when=function(){var t,i;return t=new e.Deferred,i=function(){return t.resolve()},o()?i():n(i),t.promise()},t})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/growth/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/clean/sharing/signup_modal_proxy","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/analytics","modules/clean/components/login_form","modules/clean/dbmodal","modules/clean/growth/experiments/logger","modules/clean/profile_services/third_party_signup","modules/clean/register_form"],function(t,n,o,i,r,s,a,l,u,c,d,p,h,_){var m,f,g,v,y,E,b;return v=t.SharingModel,b=s._,E=u.WebMiscActivityLogger,m=d.DBModal,y=h.ThirdPartySignup,g=_.RegisterForm,f=function(){function t(t){this.kind=t,this.register_success=e(this.register_success,this),this.show_login_form=e(this.show_login_form,this),this.save_to_dropbox=e(this.save_to_dropbox,this),this.direct_download=e(this.direct_download,this),this.handle_default_modal_cancel=e(this.handle_default_modal_cancel,this),this.handle_default_modal_authenticate=e(this.handle_default_modal_authenticate,this),this.handle_direct_download_cancel=e(this.handle_direct_download_cancel,this),this.handle_direct_download=e(this.handle_direct_download,this),this.on_request_default_signup=e(this.on_request_default_signup,this),this.on_request_direct_download=e(this.on_request_direct_download,this),this.show_create_password_modal=e(this.show_create_password_modal,this),this.show_welcome_modal=e(this.show_welcome_modal,this),this.before_create_password_modal=e(this.before_create_password_modal,this),this.before_download_signup_modal=e(this.before_download_signup_modal,this),this.before_default_signup_modal=e(this.before_default_signup_modal,this),this.before_signup_modal=e(this.before_signup_modal,this),this.init_modals=e(this.init_modals,this),this.init_modals(),i.connectModal(this),"immediate"===this.kind&&(E.log("signup_modal-show-upfront",{auth_google:null!=n.find(".auth-google")}),this.default_signup_modal.show(),this.has_seen_modal=!0),"download"!==this.kind?n("#download_button_link, #default_content_download_button").click(this.direct_download):n("#download_button_link, #default_content_download_button").click(function(e){return function(){return e.has_seen_modal?e.direct_download():(e.has_seen_modal=!0,E.log("signup_modal-show-download",{auth_google:null!=n.find(".auth-google")}),e.download_type="direct_download",e.download_signup_modal.show())}}(this)),n(".add_to_my_dropbox_link, #default_content_a2md").click(function(e){return function(){return e.download_type="add_to_dropbox",e.download_signup_modal.show()}}(this))}return t.prototype.init_modals=function(){return this.default_signup_modal=new m({element_id:"shared-link-immediate-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.default_signup_modal.on_hide=function(e){return function(){return e._has_authenticated?void 0:"function"==typeof e._on_default_modal_cancel?e._on_default_modal_cancel():void 0}}(this),this.download_signup_modal=new m({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.download_signup_modal.on_hide=function(e){return function(){return e._direct_download_started?void 0:"function"==typeof e._on_direct_download_cancel?e._on_direct_download_cancel():void 0}}(this),this.welcome_modal=new m({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal,this.create_password_modal=new m({element_id:"shared-link-create-password-modal"}),this.create_password_modal.before_show=this.before_create_password_modal},t.prototype.before_signup_modal=function(e){var t,n;return e.find(".toggle-form-link").click(function(t){return function(){return t.toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&(n.on(g.NEW_ACCOUNT_FROM_3RD_PARTY,function(t){return function(n,o){return t.profile_info=o,t.show_create_password_modal(e,t.profile_info)}}(this)),n.on(g.USER_EXISTS,function(t){return function(n){return t.show_login_form(e,n)}}(this)),n.on(g.REGISTER_SUCCESS,function(e){return function(t,n){return e.user_info=n,e.register_success(e.user_info)}}(this))),t=e.find(".login-form"),t.length?t.on(c.LOGIN_SUCCESS,function(e){return function(t,n){return e.user_info=n,a.success(b("Successfully signed in to Dropbox")),e.download_type?"direct_download"===e.download_type?(e.direct_download(),e.reload()):"add_to_dropbox"===e.download_type?e.save_to_dropbox(!1):void 0:e.reload()}}(this)):void 0},t.prototype.before_default_signup_modal=function(e){return this.before_signup_modal(e),e.find(".close-link").click(function(e){return function(){return e.default_signup_modal.hide()}}(this))},t.prototype.before_download_signup_modal=function(e){return this.before_signup_modal(e),this._direct_download_started=!1,"add_to_dropbox"===this.download_type&&(e.find(".login-form-component").is(":visible")||this.toggle_form(e)),e.find(".close-link").click(function(e){return function(){return e.direct_download(),e.download_signup_modal.hide()}}(this))},t.prototype.before_create_password_modal=function(e){var t,n;return e.find(".close-link").click(function(e){return function(){return e.create_password_modal.hide()}}(this)),t=e.find(".create-password-form-component"),y.handle_picture_url(this.profile_info.picture_url,null,null,!1),n=t.find(".register-form"),n.on(g.REGISTER_SUCCESS,function(e){return function(t,n){return e.user_info=n,e.register_success(e.user_info)}}(this))},t.prototype.before_welcome_modal=function(e){return p.log("sharing","shared_link_welcome_modal_view"),e.find(".go-to-dropbox-button").click(function(){return p.log("sharing","shared_link_welcome_modal_button_click")}),e.find(".welcome-modal-no-thanks a").click(function(){return r.reload()})},t.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},t.prototype.show_create_password_modal=function(e,t){var n,o,i;return this.default_signup_modal.hide(),this.download_signup_modal.hide(),i={".input-fname":this.profile_info.fname,".input-lname":this.profile_info.lname,".input-email":this.profile_info.email,"input[name=email_sig]":this.profile_info.email_sig,"input[name=refresh_token]":this.profile_info.refresh_token},this.create_password_modal.show(n="input[name=password]",o=i)},t.prototype.on_request_direct_download=function(){return this.has_seen_modal?this.direct_download():(this.has_seen_modal=!0,E.log("signup_modal-show-download",{auth_google:null!=n.find(".auth-google")}),this.download_type="direct_download",this.download_signup_modal.show())},t.prototype.on_request_default_signup=function(){return this.download_type="add_to_dropbox",this._has_authenticated=!1,this.default_signup_modal.show()},t.prototype.handle_direct_download=function(e){return this._direct_download_override_callback=e},t.prototype.handle_direct_download_cancel=function(e){return this._on_direct_download_cancel=e},t.prototype.handle_default_modal_authenticate=function(e){return this._on_default_modal_authenticate=e},t.prototype.handle_default_modal_cancel=function(e){return this._on_default_modal_cancel=e},t.prototype.direct_download=function(){var e;return this._direct_download_started=!0,null!=this._direct_download_override_callback?void this._direct_download_override_callback():(e=r.get_uri().updateQuery({dl:1}),r.redirect(e))},t.prototype.reload=function(){return r.reload()},t.prototype.save_to_dropbox=function(e){var t;return null!=this._on_default_modal_authenticate?(this._on_default_modal_authenticate(this.user_info.id),this._has_authenticated=!0,void this.default_signup_modal.hide()):(e||a.success(b("Saving to your Dropbox ...")),t=v.c2d_vars,t.job=v.is_folder,o.WebRequest({url:v.c2d_url,data:t,subject_user:this.user_info.id,success:function(t){return e?void 0:(a.success(b("Successfully saved to your Dropbox.")),r.redirect(t))}}))},t.prototype.show_login_form=function(e,t){var n,o,i,r,s;o=e.find(".login-form-component"),i=o.find(".login-form"),r=t.prefill;for(n in r)s=r[n],i.find(n).val(s);return i.find(t.focus).focus(),o.is(":visible")?void 0:this.toggle_form(e,!0)},t.prototype.toggle_form=function(e,t){var o,i;return i=e.find(".register-form-component"),o=e.find(".login-form-component"),i.is(":visible")?i.fadeOut({complete:function(){return o.show(),null!=t?setTimeout(function(){return n(o.find(".login-form .login-password input[name='login_password']")[0]).focus()},0):void 0}}):o.fadeOut({complete:function(){return i.show()}})},t.prototype.register_success=function(e){return a.success(b("Successfully signed up for Dropbox.")),this.download_type?"direct_download"===this.download_type?(this.direct_download(),this.show_welcome_modal()):"add_to_dropbox"===this.download_type?this.save_to_dropbox(!1):void 0:this.show_welcome_modal()},t}()})}.call(this),function(){define("modules/dirty/sharing/browse_ui_util",["require","external/react","external/underscore","modules/clean/filepath","modules/clean/sharing/api","modules/clean/sharing/content_info","modules/clean/sharing/share_modal_util","modules/clean/sharing/ui_util","modules/constants/env","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,u){var c,d,p,h,_,m,f,g,v,y,E,b,w,T,S,C,I;return d=i.SharingApi,c=r.ContentInfo,_=s.generateModalSessionId,f=s.getShareModalInfo,g=s.getSharingInfo,b=s.shouldShowTiburonUI,w=s.showFastrakShareModalIfAllowed,I=s.showTiburonUIIfAllowedNonPublic,E=a.logTiburonEvent,C=function(t,n,o){var i,r,s,a,l;return null==o&&(o={}),a=g(t,n,o),i=a.browseContext,r=a.contentInfo,l=a.shareModalInfo,t=a.user,null==r?!1:(E(r,t.id,"BEGIN_SHARE_FLOW"),w(t,l,i)?!0:(s=m(t,r,i),s?(e(["dropbox"],function(e){var t;return t=e.BrowseActions,t.showCopyPublicUrlModal(s)}),!0):I(t,r,i,l)))},T=function(e,t){var n;return null==t&&(t=null),t||(t=_()),n=function(){var e,t,n,o;for(n="/",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=t=1;100>=t;e=++t)n+=o.charAt(Math.floor(Math.random()*o.length));return n},C(e,{fqPath:n(),isFolder:!0,exists:!1,origin:"WIZARD",modalSessionId:t})},y=function(e,t,n){var o,i;i=f(t);try{o=c.createFromParams(i)}catch(e){return!1}return Boolean(m(e,o,n)||b(e,o,n))},p=function(e,t){var n;return(null!=e?e.config.isPublicFolderEnabled:void 0)?(n=t.displayPath(),o.normalize(n).toLowerCase().match(/^\/public($|\/)/)):!1},h=function(e,t){var n,o;return o=f(t),n=c.createFromParams(o),p(e,n)},m=function(e,t,n){var o,i,r,s;return(null!=n?n.config:void 0)?(t instanceof c?o=t:(r=f(t),o=c.createFromParams(r)),null!=n.config.publicAppToken&&o.nsPath()?i="/spa/"+n.config.publicAppToken+o.nsPath()+"/data":p(n,o)&&o.isFile()&&(i="/u/"+e.id+o.displayPath().substring("/public".length)),i&&(s=String(new u({scheme:"https",authority:l.PUBSERVER,path:i}))),s):null},v=function(e,t,n){return t.is_dir&&h(n,t)?!1:!e||t.isDeleted?!1:!n.isNonUserRelativeContext||null!=t.target_ns},S=function(t,n){var o,i,r;return o=new d(t),r=t.id,i=function(t){var o;return o=JSON.parse(t.responseText),e(["dropbox"],function(e){var t;return t=e.SharingModel,t.show_shared_content_sync_modal(o,n)})},o.get_sync_vars_for_ns_id(n.ns_id,n.ns_path,i)},{generateModalSessionId:_,fileIsInPublicFolder:h,getLegacyPublicFolderShareURI:m,getShareModalInfo:f,isShareButtonEnabled:v,isTiburonUIAllowed:y,showTiburonUIIfAllowed:C,showNewFolderTiburonUIIfAllowed:T,showSharedContentLinkSyncModal:S}})}.call(this),function(){define("modules/dirty/sharing/sharing_model_modals",["jquery"],function(e){return{initialize_module:function(t){return require(["dropbox"],function(n){var o,i;return i=n.SharingModel,o=n.Modal,t.instances.forEach(function(t){return e("#"+t.accept_button_dom_id).on("click",function(e){return i.do_remove(o.vars)}),e("#"+t.cancel_button_dom_id).on("click",function(e){return o.hide()})})})}}})}.call(this),function(){var e=[].slice;define("modules/dirty/sharing/wizard_modals",["require","external/react","modules/core/notify","modules/clean/analytics","modules/clean/components/ajax_form","modules/clean/react/modal","modules/clean/sharing/api","modules/clean/sharing/share_modal_util","modules/clean/sharing/wizard/share_existing_folder_wizard_modal","modules/clean/sharing/wizard/share_a_folder_wizard_modal","modules/dirty/sharing/browse_ui_util"],function(t,n,o,i,r,s,a,l,u,c,d){var p,h,_,m,f,g,v,y,E,b,w,T,S;return f=i.SharingExperimentsLogger,p=s.Modal,m=a.SharingApi,v=l.generateModalSessionId,_=u.ShareExistingFolderWizardModal,h=c.ShareAFolderWizardModal,S=d.showTiburonUIIfAllowed,E=d.showNewFolderTiburonUIIfAllowed,g=n.createElement,y=function(e,t,n,i){var s,a,l;return l=function(){if(!S(e,{fqPath:t,isFolder:!0,exists:!0,origin:"WIZARD",shouldFetchNsId:!0,modalSessionId:null!=i?i:void 0}))throw new Error("Tiburon UI must be allowed")},s=function(e){var t;return t=r.extract_errors(e.responseText),t!==!1?"string"==typeof t?o.error(t):"function"==typeof n?n(t):void 0:void 0},a=new m(e),a.validate_shareable_existing_sf_path(t,l,s)},T=function(e,t){return w(e,t.show)},w=function(t,o,i){return null!=i&&f.log(t.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_EXISTING_FOLDER_WIZARD",{modalSessionId:i}),p.showInstance(n.createElement(_,{user:t,onBack:o,onSubmit:function(n,o){var r;return r=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],null!=i&&f.log(t.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_EXISTING_FOLDER_WIZARD_ERROR",{modalSessionId:i}),o.apply(null,n)},null!=i&&f.log(t.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_EXISTING_FOLDER_WIZARD",{modalSessionId:i}),y(t,n,r)}}))},b=function(e){var t;return t=v(),f.log(e.id,"SIMPLIFIED_WIZARD_UI::BEGIN_SHARE_A_FOLDER_WIZARD",{modalSessionId:t}),p.showInstance(n.createElement(h,{user:e,onSubmit:function(n){return null!=t&&f.log(e.id,"SIMPLIFIED_WIZARD_UI::SUBMIT_SHARE_A_FOLDER_WIZARD",{target:n,modalSessionId:t}),"new-folder"===n?E(e,t):"existing-folder"===n?w(e,b.bind(this,e,t),t):void 0}}))},{shareExistingFolder:y,showShareExistingFolderWizardModalIfAllowed:T,showShareAFolderWizardModal:b}})}.call(this);
//# sourceMappingURL=pkg-aa.min.js-vfl1BXAV8.map